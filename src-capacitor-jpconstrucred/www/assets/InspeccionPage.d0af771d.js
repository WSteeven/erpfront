var X=Object.defineProperty;var Y=(e,i,n)=>i in e?X(e,i,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[i]=n;var d=(e,i,n)=>(Y(e,typeof i!="symbol"?i+"":i,n),n);import{c as Z,u as x,E as ee,e as v,s as ie,bA as oe,n as ne,v as se,x as c,y as r,S as L,H as l,D as a,a7 as ae,B as s,K as g,z as t,I as $,J as h,M as b,G as M,L as u,F as B,k as le,R as O,N as re,aa as te}from"./index.846478c1.js";import{Q as de,a as ce}from"./QItemSection.ca64420c.js";import{Q as me}from"./QSelect.d8222f79.js";import{Q as pe,a as ue,C as be}from"./QPopupProxy.7844573b.js";import{Q as fe}from"./QForm.0a21c4a5.js";import{a as R,g as ve,e as ge}from"./utils.7dcda2a3.js";import{r as Q,a as G}from"./i18n-validators.06501904.js";import{u as $e}from"./index.15c331c5.js";import{u as he}from"./filtrosListadosGenerales.c330183b.js";import{T as Ve}from"./TabLayoutFilterTabs2.94e4b3e1.js";import{M as ye}from"./MultiplePageLayout.ccc598d6.js";import{S as Ie}from"./SolicitudDescuentoPage.15e0f26c.js";import{G as ke}from"./GestorArchivos.33ade07b.js";import{C as Ce}from"./CoordenadasInput.d5d596eb.js";import{E as qe}from"./EssentialEditor.aaa2717e.js";import{I as Ee,a as Ae}from"./IncidentePage.da8ac11f.js";import{a as Be}from"./EssentialTable.01bbad48.js";import{C as Qe}from"./ContenedorSimpleMixin.1a882cca.js";import{E as Te}from"./entidadAuditable.75a46700.js";import"./QChip.697486c2.js";import"./QMenu.c0bc1e4b.js";import"./position-engine.456d5331.js";import"./format.8ac60962.js";import"./utils.19b149f6.js";import"./index.209eea81.js";import"./QTabs.19bbf6a5.js";import"./QResizeObserver.847ee253.js";import"./QTabPanels.ca44a1cd.js";import"./use-panel.27349585.js";import"./touch.9135741d.js";import"./QPage.b0adedad.js";import"./EssentialTableTabs.d6bee6af.js";import"./QBadge.60ffdb76.js";import"./EssentialTablePagination.3349ebcb.js";import"./QTable.d5868e69.js";import"./use-fullscreen.18eeae01.js";import"./QToolbar.2bb5adc4.js";import"./QBtnGroup.b7cc3fd9.js";import"./buttonSubmits.31738227.js";import"./selector.b0f0805f.js";import"./SelectorController.6c5262b2.js";import"./EssentialSelectableTable.57ea1b28.js";import"./configuracionColumnasDetallesModal.ec8d68f5.js";import"./ClienteMaterialEmpleadoController.24905e1f.js";import"./CategoriaController.68fbf3b3.js";import"./QUploader.c061fd0f.js";import"./QCircularProgress.b5ba4a87.js";import"./QFile.c3222262.js";import"./configuracionColumnasArchivoSubtarea.215f4ffd.js";import"./extend.4a22771d.js";import"./QBtnToggle.0b8ca156.js";import"./SimpleLayout.8d9b09cb.js";import"./DevolucionPage.f26838d0.js";import"./DevolucionController.e847c0ff.js";import"./ModalEntidad.5edc5f68.js";import"./configuracion_general.cac1c388.js";import"./ConfiguracionController.1234694f.js";import"./devolucion.f55fb486.js";import"./TareaController.4af45b78.js";import"./configuracionColumnasProductosSeleccionados.8e4ddf6e.js";import"./listadoMaterialesDevolucion.71dfd77c.js";import"./ComponenteModal.domain.3bd8db1f.js";import"./PedidoPage.86bfda2c.js";import"./VisualizarPedidoPage.19914e20.js";import"./TabLayout.b05b8b79.js";import"./pedido.a0fd8edf.js";import"./PedidoController.86fd6f7e.js";import"./configuracionColumnasDetallesModal.0b76e70c.js";import"./ClienteController.b9526fcf.js";import"./ComportamientoModalesPedido.a8ba4038.js";import"./ProyectoController.13ba2d04.js";import"./EtapaController.2ce7dfae.js";import"./ErrorComponent.eba095ef.js";import"./NoOptionComponent.5e086980.js";import"./_commonjsHelpers.8402d862.js";import"./QImg.e43b947c.js";import"./VisorImagen.93b8e0f6.js";import"./seleccionContratacionPersonal.utils.e3e1ed3d.js";import"./ArchivoController.689a40cd.js";const _e=[{name:"id",field:"id",label:"Id",align:"left",sortable:!0},{name:"titulo",field:"titulo",label:"Titulo",align:"left",sortable:!0},{name:"descripcion",field:"descripcion",label:"Descripci\xF3n",align:"left",sortable:!0},{name:"responsable",field:"responsable",label:"Responsable",align:"left",sortable:!0},{name:"fecha_inicio",field:"fecha_inicio",label:"Fecha de inicio",align:"left",sortable:!0},{name:"estado",field:"estado",label:"Estado",align:"left",sortable:!0},{name:"cantidad_incidentes",field:"cantidad_incidentes",label:"Cantidad de incidentes",align:"left",sortable:!0}];class we extends Te{constructor(){super();d(this,"titulo");d(this,"descripcion");d(this,"estado");d(this,"fecha_inicio");d(this,"responsable");d(this,"empleado_involucrado");d(this,"finalizado");d(this,"tiene_incidencias");d(this,"coordenadas");d(this,"seguimiento");d(this,"cantidad_incidentes");this.titulo=null,this.descripcion=null,this.estado=R.CREADO,this.fecha_inicio=null,this.responsable=null,this.finalizado=!1,this.tiene_incidencias=!1,this.empleado_involucrado=null,this.coordenadas=null,this.seguimiento="",this.cantidad_incidentes=0}}var Fe=Z({name:"inspecciones",components:{CoordenadasInput:Ce,TabLayoutFilterTabs2:Ve,Estado:Be,IncidentePage:Ee,GestorArchivos:ke,EssentialEditor:qe,MultiplePageLayout:ye,SolicitudDescuentoPage:Ie},setup(){const e=x(),i=new Qe(we,new Ae),{entidad:n,disabled:T,listadosAuxiliares:_,accion:w,tabsPage:V}=i.useReferencias(),{setValidador:y,listar:I,cargarVista:k,obtenerListados:C}=i.useComportamiento(),{onConsultado:q,onReestablecer:E,onBeforeGuardar:o,onGuardado:z,onModificado:N,onBeforeModificar:j}=i.useHooks();k(async()=>{await C({empleados:{controller:new ee,params:{campos:"id,nombres,apellidos",estado:1}}})});const F=v(),f=v(),m=v(),A=v();n.responsable=e.user.apellidos+" "+e.user.nombres;const{empleados:H,filtrarEmpleados:J}=he(_);function S(p){I({estado:p}),F.value=p}const D=async()=>await f.value.subir(),P=()=>{m.value.incidente.es_parte_inspeccion=!0,m.value.incidente.inspeccion=n.id},K=()=>{V.value="2",ne(()=>{m.value.tabs="listado",m.value.refrescarListados("inspecciones"),m.value.filtrarIncidentes(ge.CREADO,{inspeccion_id:n.id}),P()})},W={titulo:{required:Q},descripcion:{required:Q},fecha_inicio:{required:Q},empleado_involucrado:{requiredIf:G(()=>!n.tiene_incidencias)},coordenadas:{requiredIf:G(()=>!n.tiene_incidencias)}};console.log(!n.tiene_incidencias);const U=$e(W,n);return y(U.value),q(()=>{n.tiene_incidencias=n.tiene_incidencias||!!n.cantidad_incidentes,setTimeout(()=>f.value.listarArchivosAlmacenados(n.id),1)}),z(p=>{A.value=p,setTimeout(()=>D(),1)}),o(()=>{n.tiene_incidencias&&(n.empleado_involucrado=null,n.coordenadas=null)}),j(()=>{n.tiene_incidencias&&(n.empleado_involucrado=null,n.coordenadas=null)}),N(p=>{A.value=p,setTimeout(()=>D(),1)}),E(()=>{n.responsable=e.user.nombres+" "+e.user.apellidos,f.value.limpiarListado()}),S(R.CREADO),{validador$:U,refIncidentePage:m,idEntidad:A,refArchivo:f,mixin:i,inspeccion:n,accion:w,disabled:T,maskFecha:ie,configuracionColumnasInspecciones:_e,tabActual:F,filtrarInspecciones:S,tabOptionsEstadosInspecciones:ve,acciones:oe,empleados:H,filtrarEmpleados:J,marcarTieneIncidencias:P,irIncidencias:K}}});const Se={class:"row q-col-gutter-sm q-py-md"},De={class:"col-12 col-md-3"},Pe={class:"error-msg"},Ue={class:"col-12 col-md-9"},Le={class:"error-msg"},Me={key:0,class:"col-12 col-md-3"},Oe={class:"error-msg"},Ge={class:"col-12 col-md-3"},Re={key:1,class:"col-12 col-md-3"},ze={class:"col-12 col-md-3"},Ne={class:"row items-center justify-end"},je={class:"error-msg"},He={key:2,class:"col-12 col-md-3"},Je={class:"col-12 q-mb-md"},Ke={class:"col-12 col-md-3"},We={key:3,class:"col-12 col-md-3"},Xe={class:"col-12"},Ye={key:4,class:"col-12 border-callout-warning bg-solid q-pb-sm"},Ze={class:"bg-desenfoque rounded q-pa-md"},xe={class:"q-px-md q-py-xs rounded text-bold q-mb-md inline-block bg-grey-3"};function ei(e,i,n,T,_,w){const V=c("coordenadas-input"),y=c("essential-editor"),I=c("gestor-archivos"),k=c("tab-layout-filter-tabs2"),C=c("incidente-page"),q=c("solicitud-descuento-page"),E=c("multiple-page-layout");return r(),L(E,{mixin:e.mixin},{tab1:l(()=>[a(k,{mixin:e.mixin,"configuracion-columnas":e.configuracionColumnasInspecciones,tabOptions:e.tabOptionsEstadosInspecciones,filtrar:e.filtrarInspecciones,tabDefecto:e.tabActual,"ajustar-celdas":"","forzar-listar":"","multiple-pages":""},{formulario:l(()=>[a(fe,{onSubmit:i[10]||(i[10]=ae(()=>{},["prevent"]))},{default:l(()=>[s("div",Se,[s("div",De,[i[13]||(i[13]=s("label",{class:"q-mb-sm block"},"T\xEDtulo",-1)),a(g,{modelValue:e.inspeccion.titulo,"onUpdate:modelValue":i[0]||(i[0]=o=>e.inspeccion.titulo=o),placeholder:"Obligatorio",disable:e.disabled,autofocus:"",outlined:"",dense:"",error:!!e.validador$.titulo.$errors.length,onBlur:e.validador$.titulo.$touch},{error:l(()=>[(r(!0),t($,null,h(e.validador$.titulo.$errors,o=>(r(),t("div",{key:o.$uid},[s("div",Pe,b(o.$message),1)]))),128))]),_:1},8,["modelValue","disable","error","onBlur"])]),s("div",Ue,[i[14]||(i[14]=s("label",{class:"q-mb-sm block"},"Descripci\xF3n",-1)),a(g,{modelValue:e.inspeccion.descripcion,"onUpdate:modelValue":i[1]||(i[1]=o=>e.inspeccion.descripcion=o),placeholder:"Obligatorio",disable:e.disabled,outlined:"",dense:"",error:!!e.validador$.descripcion.$errors.length,onBlur:e.validador$.descripcion.$touch},{error:l(()=>[(r(!0),t($,null,h(e.validador$.descripcion.$errors,o=>(r(),t("div",{key:o.$uid},[s("div",Le,b(o.$message),1)]))),128))]),_:1},8,["modelValue","disable","error","onBlur"])]),e.inspeccion.tiene_incidencias?u("",!0):(r(),t("div",Me,[i[16]||(i[16]=s("label",{class:"q-mb-sm block"},"Empleado involucrado",-1)),a(me,{modelValue:e.inspeccion.empleado_involucrado,"onUpdate:modelValue":i[2]||(i[2]=o=>e.inspeccion.empleado_involucrado=o),options:e.empleados,"transition-show":"scale","transition-hide":"scale","options-dense":"",dense:"",outlined:"","use-input":"","input-debounce":"0",disable:e.disabled,error:!!e.validador$.empleado_involucrado.$errors.length,onBlur:e.validador$.empleado_involucrado.$touch,onFilter:e.filtrarEmpleados,"option-label":o=>o.apellidos+" "+o.nombres,"option-value":o=>o.id,"emit-value":"","map-options":""},{"no-option":l(()=>[a(de,null,{default:l(()=>[a(ce,{class:"text-grey"},{default:l(()=>i[15]||(i[15]=[M(" No hay resultados ")])),_:1})]),_:1})]),error:l(()=>[(r(!0),t($,null,h(e.validador$.empleado_involucrado.$errors,o=>(r(),t("div",{key:o.$uid},[s("div",Oe,b(o.$message),1)]))),128))]),_:1},8,["modelValue","options","disable","error","onBlur","onFilter","option-label","option-value"])])),s("div",Ge,[i[17]||(i[17]=s("label",{class:"q-mb-sm block"},"Responsable de la inspecci\xF3n",-1)),a(g,{modelValue:e.inspeccion.responsable,"onUpdate:modelValue":i[3]||(i[3]=o=>e.inspeccion.responsable=o),disable:"",outlined:"",dense:""},null,8,["modelValue"])]),e.inspeccion.tiene_incidencias?u("",!0):(r(),t("div",Re,[a(V,{modelValue:e.inspeccion.coordenadas,"onUpdate:modelValue":i[4]||(i[4]=o=>e.inspeccion.coordenadas=o),disable:e.disabled,validador:e.validador$},null,8,["modelValue","disable","validador"])])),s("div",ze,[i[18]||(i[18]=s("label",{class:"q-mb-sm block"},"Fecha de inicio",-1)),a(g,{modelValue:e.inspeccion.fecha_inicio,"onUpdate:modelValue":i[6]||(i[6]=o=>e.inspeccion.fecha_inicio=o),placeholder:"Obligatorio",outlined:"",disable:e.disabled,type:"datetime",error:!!e.validador$.fecha_inicio.$errors.length,onBlur:e.validador$.fecha_inicio.$touch,dense:""},{append:l(()=>[a(B,{name:"event",class:"cursor-pointer"},{default:l(()=>[a(pe,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:l(()=>[a(ue,{modelValue:e.inspeccion.fecha_inicio,"onUpdate:modelValue":i[5]||(i[5]=o=>e.inspeccion.fecha_inicio=o),mask:e.maskFecha,"today-btn":""},{default:l(()=>[s("div",Ne,[le(a(O,{label:"Cerrar",color:"primary",flat:""},null,512),[[be]])])]),_:1},8,["modelValue","mask"])]),_:1})]),_:1})]),error:l(()=>[(r(!0),t($,null,h(e.validador$.fecha_inicio.$errors,o=>(r(),t("div",{key:o.$uid},[s("div",je,b(o.$message),1)]))),128))]),_:1},8,["modelValue","disable","error","onBlur"])]),e.inspeccion.created_at?(r(),t("div",He,[i[19]||(i[19]=s("label",{class:"q-mb-sm block"},"Fecha hora de solicitud",-1)),s("b",null,b(e.inspeccion.created_at),1)])):u("",!0),s("div",Je,[i[20]||(i[20]=s("label",{class:"q-mb-sm block"},"Seguimiento",-1)),a(y,{modelValue:e.inspeccion.seguimiento,"onUpdate:modelValue":i[7]||(i[7]=o=>e.inspeccion.seguimiento=o),disable:e.disabled},null,8,["modelValue","disable"])]),s("div",Ke,[a(re,{modelValue:e.inspeccion.tiene_incidencias,"onUpdate:modelValue":i[8]||(i[8]=o=>e.inspeccion.tiene_incidencias=o),label:"\xBFTiene incidencias?",disable:e.disabled||e.inspeccion.cantidad_incidentes>0,outlined:"",dense:""},null,8,["modelValue","disable"])]),e.accion!==e.acciones.nuevo?(r(),t("div",We,[a(te,{modelValue:e.inspeccion.finalizado,"onUpdate:modelValue":i[9]||(i[9]=o=>e.inspeccion.finalizado=o),label:"\xBFFinalizado?",disable:e.disabled,color:"positive",outlined:"",dense:""},null,8,["modelValue","disable"])])):u("",!0),s("div",Xe,[a(I,{ref:"refArchivo",label:"Adjuntar archivos",mixin:e.mixin,disable:e.disabled,listarAlGuardar:!1,"permitir-eliminar":e.accion==e.acciones.nuevo||e.accion==e.acciones.editar,idModelo:e.idEntidad},null,8,["mixin","disable","permitir-eliminar","idModelo"])]),e.inspeccion.tiene_incidencias&&e.accion===e.acciones.nuevo?(r(),t("div",Ye,[a(B,{name:"bi-exclamation-octagon",color:"warning",class:"q-mr-sm"}),i[21]||(i[21]=s("span",{innerHTML:"Usted est\xE1 a punto de registrar una inspecci\xF3n con incidencias. Para poder agregar incidencias primero guarde la inspecci\xF3n, luego vaya a Listado y presione el bot\xF3n <b>Editar</b> de la inspecci\xF3n agregada recientemente."},null,-1))])):u("",!0)])]),_:1})]),"custom-buttons":l(()=>[e.accion!==e.acciones.nuevo&&e.inspeccion.tiene_incidencias?(r(),L(O,{key:0,onClick:i[11]||(i[11]=o=>e.irIncidencias()),color:"positive",label:"Gestionar incidentes",icon:"bi-person-hearts","no-caps":"",push:""})):u("",!0)]),_:1},8,["mixin","configuracion-columnas","tabOptions","filtrar","tabDefecto"])]),tab2:l(()=>[s("div",Ze,[s("span",xe,[a(B,{name:"bi-person-hearts",class:"q-mr-sm"}),i[22]||(i[22]=M(" Incidentes de la inspecci\xF3n seleccionada "))]),a(C,{ref:"refIncidentePage",onGuardado:i[12]||(i[12]=o=>e.marcarTieneIncidencias())},null,512)])]),tab3:l(()=>[a(q)]),_:1},8,["mixin"])}var Bo=se(Fe,[["render",ei]]);export{Bo as default};
