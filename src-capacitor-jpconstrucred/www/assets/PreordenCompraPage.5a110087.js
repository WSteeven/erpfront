var ve=Object.defineProperty;var Ce=(e,o,t)=>o in e?ve(e,o,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[o]=t;var U=(e,o,t)=>(Ce(e,typeof o!="symbol"?o+"":o,t),t);import{bz as Pe,t as Ee,c as K,e as i,v as Z,x as w,y as m,z as b,D as l,H as r,R as B,a6 as Q,F as R,B as s,c8 as ye,I as W,bi as Ve,U as we,be as Se,p as H,u as qe,a1 as ke,E as Fe,bA as G,w as ze,a3 as Le,q as Ie,b_ as J,a7 as Ne,K as V,L as v,G as d,S as Qe,Q as F,M as z}from"./index.846478c1.js";import{Q as E,a as u}from"./QItemSection.ca64420c.js";import{Q as L}from"./QSelect.d8222f79.js";import{Q as Te}from"./use-fullscreen.18eeae01.js";import{Q as Me}from"./QForm.0a21c4a5.js";import{c as Oe}from"./configuracionColumnasItemOrdenCompra.236a777f.js";import{r as $e}from"./i18n-validators.06501904.js";import{u as Ae}from"./index.15c331c5.js";import{T as De}from"./TabLayoutFilterTabs2.94e4b3e1.js";import{E as X,a2 as je,a3 as Ue,a4 as Be}from"./EssentialTable.01bbad48.js";import{E as Y}from"./EssentialSelectableTable.57ea1b28.js";import{M as Re}from"./ModalEntidad.5edc5f68.js";import{E as He}from"./EssentialPopupEditableTable.1016d059.js";import{C as Ge}from"./ContenedorSimpleMixin.1a882cca.js";import{u as Je,S as Ke,s as Ze}from"./utils.19b149f6.js";import{u as h,P as We}from"./preorden.b60012ab.js";import{P as Xe}from"./PedidoController.86fd6f7e.js";import{u as Ye}from"./filtrosListadosGenerales.c330183b.js";import{C as he,a as xe}from"./ComponenteModal.domain.3bd8db1f.js";import{E as _e}from"./EmpleadoRolesController.89b1a3b6.js";import"./QChip.697486c2.js";import"./QMenu.c0bc1e4b.js";import"./position-engine.456d5331.js";import"./format.8ac60962.js";import"./index.209eea81.js";import"./QTabs.19bbf6a5.js";import"./QResizeObserver.847ee253.js";import"./QTabPanels.ca44a1cd.js";import"./use-panel.27349585.js";import"./touch.9135741d.js";import"./QPopupProxy.7844573b.js";import"./QPage.b0adedad.js";import"./EssentialTableTabs.d6bee6af.js";import"./QBadge.60ffdb76.js";import"./EssentialTablePagination.3349ebcb.js";import"./QTable.d5868e69.js";import"./QToolbar.2bb5adc4.js";import"./QBtnGroup.b7cc3fd9.js";import"./buttonSubmits.31738227.js";import"./QFile.c3222262.js";import"./_commonjsHelpers.8402d862.js";import"./QImg.e43b947c.js";import"./VisorImagen.93b8e0f6.js";import"./seleccionContratacionPersonal.utils.e3e1ed3d.js";import"./ErrorComponent.eba095ef.js";import"./configuracion_general.cac1c388.js";import"./ConfiguracionController.1234694f.js";import"./entidadAuditable.75a46700.js";const eo=[{name:"id",field:"id",label:"N\xB0",align:"left",sortable:!0},{name:"created_at",field:"created_at",label:"Fecha de creaci\xF3n",align:"left",sortable:!0},{name:"solicitante",field:"solicitante",label:"Solicitante",align:"left",sortable:!0},{name:"pedido",field:"pedido",label:"Pedido",align:"left",sortable:!0},{name:"autorizacion",field:"autorizacion",label:"Autorizaci\xF3n",align:"left",sortable:!0},{name:"autorizador",field:"autorizador",label:"Autorizador",align:"left",sortable:!0},{name:"estado",field:"estado",label:"Estado",align:"left",sortable:!0}],oo=[{name:"cantidad",field:"cantidad",label:"Cantidad",align:"left",type:"number",sortable:!0,editable:!0},{name:"producto",field:"producto",label:"Producto",align:"left",sortable:!0},{name:"descripcion",field:"descripcion",label:"Descripci\xF3n",align:"left",sortable:!0},{name:"unidad_medida",field:"unidad_medida",label:"Medida",align:"left",sortable:!0},{name:"precio_unitario",field:"precio_unitario",label:"Precio U",hint:"Precio unitario",align:"center",sortable:!0},{name:"iva",field:"iva",label:"IVA",align:"left",type:"number",editable:!1,sortable:!0},{name:"subtotal",field:"subtotal",label:"Subtotal",align:"left",type:"number",editable:!1,sortable:!0},{name:"total",field:"total",label:"Total",align:"left",type:"number",editable:!1,sortable:!0}];class ao extends Pe{constructor(){super(Ee.preordenes_compras)}}const lo=[{name:"producto",field:"producto",label:"Producto",align:"left",sortable:!0},{name:"descripcion",field:"descripcion",label:"Descripci\xF3n",align:"left",sortable:!0},{name:"preordenes",field:"preordenes",label:"Preordenes",align:"left",sortable:!0},{name:"unidad_medida",field:"unidad_medida",label:"Medida",align:"left",sortable:!0},{name:"cantidad",field:"cantidad",label:"Cantidad",align:"left",type:"number",sortable:!0,editable:!0}];var ro=K({components:{EssentialSelectableTable:Y,EssentialTable:X},emits:["cerrar-modal","guardado"],setup(e,{emit:o}){const t=h(),f=i([]),p=i(),C=i([]);C.value=t.listadoItems;function g(){f.value=p.value.selected,t.crearPreordenConsolida(f.value),c(!1),o("guardado")}function c(y=!0){o("cerrar-modal",y)}return{listado:C,configuracionColumnasItemsPreorden:lo,seleccionar:g,cerrarModal:c,refListado:p}}});function so(e,o,t,f,p,C){const g=w("essential-selectable-table"),c=w("essential-table");return m(),b(W,null,[l(g,{"configuracion-columnas":e.configuracionColumnasItemsPreorden,datos:e.listado},null,8,["configuracion-columnas","datos"]),l(c,{ref:"refListado",titulo:"Listado de items",configuracionColumnas:e.configuracionColumnasItemsPreorden,datos:e.listado,"tipo-seleccion":"multiple",permitirConsultar:!0,permitirEditar:!1,permitirEliminar:!1,permitirFiltrar:!1,ajustarCeldas:!0},null,8,["configuracionColumnas","datos"]),l(ye,{class:Q(["q-gutter-xs",{"justify-end":!e.$q.screen.xs}])},{default:r(()=>[l(B,{color:"primary",class:Q({"full-width":e.$q.screen.xs}),"no-caps":"",push:"",onClick:e.seleccionar},{default:r(()=>[l(R,{name:"bi-save",size:"xs",class:"q-pr-sm"}),o[0]||(o[0]=s("span",null,"Seleccionar",-1))]),_:1},8,["class","onClick"]),l(B,{color:"negative",class:Q({"full-width":e.$q.screen.xs}),"no-caps":"",push:"",onClick:e.cerrarModal},{default:r(()=>[l(R,{name:"bi-x-lg",size:"xs",class:"q-pr-sm"}),o[1]||(o[1]=s("span",null,"Cancelar",-1))]),_:1},8,["class","onClick"])]),_:1},8,["class"])],64)}var no=Z(ro,[["render",so]]);class io{constructor(){U(this,"ConsolidarPreordenPage");this.ConsolidarPreordenPage=Ve(new he("Consolidar Preordenes de Compras",no))}}class to extends xe{constructor(){super(new io)}}var uo=K({name:"PreordenCompra",components:{TabLayoutFilterTabs2:De,EssentialSelectableTable:Y,EssentialTable:X,ModalesEntidad:Re,EssentialPopupEditableTable:He},setup(){const e=new Ge(We,new ao),{entidad:o,disabled:t,accion:f,listadosAuxiliares:p,listado:C}=e.useReferencias(),{setValidador:g,obtenerListados:c,cargarVista:y,listar:a}=e.useComportamiento(),{onConsultado:x}=e.useHooks(),{confirmar:S,prompt:_,notificarCorrecto:ee,notificarError:oe}=we(),T=new to;Se().setQuasar(H()),Je().setQuasar(H());const I=qe(),q=h(),ae=ke();new Ke;const le=i(0),re=i(0),se=i(0),ne=i(0);let P=i(),M=i(!1),N=i(!1);const O=i(),$=i([]),A=i([]);y(async()=>{await c({empleados:{controller:new Fe,params:{campos:"id,nombres,apellidos,cargo_id",estado:1}},autorizadores:{controller:new _e,params:{roles:["AUTORIZADOR"]}},pedidos:{controller:new Xe,params:{autorizacion_id:2}}})});const D=Ae({autorizador:{required:$e}},o);g(D.value),x(()=>{f.value==G.editar&&(M.value=!0)});function ie(n){P.value=n,n==="PENDIENTE"?N.value=!0:N.value=!1,a({solicitante_id:I.user.id,estado:n})}function te({posicion:n}){S("\xBFEst\xE1 seguro de continuar?",()=>o.listadoProductos.splice(n,1))}const{empleados:j,filtrarEmpleados:de}=Ye(p);async function ue(n){console.log(n),await a({solicitante_id:I.user.id,estado:P.value})}const me={titulo:"Eliminar",icono:"bi-x",color:"negative",accion:({entidad:n,posicion:k})=>{te({posicion:k})}},pe={titulo:"Generar OC",color:"primary",icono:"bi-pencil-square",accion:({entidad:n,posicion:k})=>{q.preorden=n,ae.push("ordenes-compras")},visible:()=>P.value==="PENDIENTE"},ce={titulo:"Anular",color:"negative",icono:"bi-x",accion:async({entidad:n,posicion:k})=>{S("\xBFEst\xE1 seguro de anular la orden de compra?",()=>{_({titulo:"Causa de anulaci\xF3n",mensaje:"Ingresa el motivo de anulaci\xF3n",accion:async fe=>{try{q.idPreorden=n.id,(await q.anularPreorden({motivo:fe})).status==200&&(ee("Se ha anulado correctamente la preorden de compra"),C.value.splice(k,1))}catch{oe("No se pudo anular, debes ingresar un motivo para la anulaci\xF3n")}}})})},visible:({entidad:n})=>P.value==J.pendiente},be={titulo:"Consolidar",tooltip:"Consolida varias preordenes en una sola preorden de compra",icono:"bi-box-arrow-in-down",accion:async()=>{S("\xBFEst\xE1 seguro de consolidar preordenes de compras?",async()=>{S("Esto anular las preordenes existentes y crear\xE1 nuevas preordenes con la sumatoria de los items encontrados. \xBFDesea continuar?",async()=>{await q.consolidarPreordenes(),await T.abrirModalEntidad("ConsolidarPreordenPage")})})},visible:()=>P.value==J.pendiente};return ze(O,()=>{console.log("modificacion"),console.log(O.value)}),j.value=p.empleados,$.value=p.categorias,A.value=JSON.parse(Le.getItem("autorizaciones").toString()),{mixin:e,preorden:o,disabled:t,accion:f,v$:D,acciones:G,configuracionColumnas:eo,accionesTabla:Ie,configuracionColumnasDetallesProductos:oo,configuracionColumnasItemOrdenCompra:Oe,empleados:j,filtrarEmpleados:de,categorias:$,autorizaciones:A,opcionesForma:je,opcionesTiempo:Ue,store:I,modales:T,btnEliminarFila:me,btnHacerOrdenCompra:pe,btnAnularPreorden:ce,btnConsolidarPreordenes:be,tabOptionsPreordenCompra:Be,tabSeleccionado:P,puedeEditar:N,soloLectura:M,filtrarPreordenes:ie,ordenarLista:Ze,guardado:ue,subtotal:le,total:ne,descuento:re,iva:se}}});const mo={class:"row q-col-gutter-sm q-py-md"},po={key:0,class:"col-12 col-md-3"},co={key:1,class:"col-12 col-md-3"},bo={key:2,class:"col-12 col-md-3"},fo={key:3,class:"col-12 col-md-3"},go={class:"col-12 col-md-6"},vo={class:"col-12 col-md-3"},Co={class:"col-12 col-md-3 q-mb-md"},Po={key:4,class:"col-12 col-md-3 q-mb-md"},Eo={key:5,class:"col-12 col-md-9"},yo={class:"col-12"},Vo={class:"col-12"},wo={class:"row q-col-xs-4 q-col-xs-offset-8 flex-end justify-end"};function So(e,o,t,f,p,C){const g=w("essential-popup-editable-table"),c=w("tab-layout-filter-tabs2"),y=w("modales-entidad");return m(),b(W,null,[l(c,{mixin:e.mixin,configuracionColumnas:e.configuracionColumnas,"titulo-pagina":"Preorden de Compra","tab-options":e.tabOptionsPreordenCompra,tabDefecto:"PENDIENTE",filtrar:e.filtrarPreordenes,permitirEditar:e.puedeEditar,accion1:e.btnHacerOrdenCompra,accion2:e.btnAnularPreorden,accion1Header:e.btnConsolidarPreordenes},{formulario:r(()=>[l(Me,{onSubmit:o[10]||(o[10]=Ne(()=>{},["prevent"]))},{default:r(()=>[s("div",mo,[e.preorden.id?(m(),b("div",po,[o[12]||(o[12]=s("label",{class:"q-mb-sm block"},"Orden N\xB0",-1)),l(V,{modelValue:e.preorden.id,"onUpdate:modelValue":o[0]||(o[0]=a=>e.preorden.id=a),placeholder:"Obligatorio",disable:e.disabled||e.soloLectura,readonly:e.disabled||e.soloLectura,outlined:"",dense:""},null,8,["modelValue","disable","readonly"])])):v("",!0),e.preorden.created_at?(m(),b("div",co,[o[13]||(o[13]=s("label",{class:"q-mb-sm block"},"Fecha de creaci\xF3n",-1)),l(V,{modelValue:e.preorden.created_at,"onUpdate:modelValue":o[1]||(o[1]=a=>e.preorden.created_at=a),disable:"",outlined:"",dense:""},null,8,["modelValue"])])):v("",!0),e.preorden.pedido?(m(),b("div",bo,[o[14]||(o[14]=s("label",{class:"q-mb-sm block"},"N\xB0 Pedido",-1)),l(V,{modelValue:e.preorden.pedido,"onUpdate:modelValue":o[2]||(o[2]=a=>e.preorden.pedido=a),placeholder:"Obligatorio",disable:e.disabled||e.soloLectura,readonly:e.disabled||e.soloLectura,outlined:"",dense:""},null,8,["modelValue","disable","readonly"])])):v("",!0),e.preorden.solicitante?(m(),b("div",fo,[o[16]||(o[16]=s("label",{class:"q-mb-sm block"},"Solicitante",-1)),l(L,{modelValue:e.preorden.solicitante,"onUpdate:modelValue":o[3]||(o[3]=a=>e.preorden.solicitante=a),options:e.empleados,"transition-show":"scale","transition-hide":"scale","options-dense":"",dense:"",outlined:"",disable:!0,readonly:e.disabled||e.soloLectura,"option-label":a=>a.apellidos+" "+a.nombres,"option-value":a=>a.id,"emit-value":"","map-options":""},{"no-option":r(()=>[l(E,null,{default:r(()=>[l(u,{class:"text-grey"},{default:r(()=>o[15]||(o[15]=[d(" No hay resultados ")])),_:1})]),_:1})]),_:1},8,["modelValue","options","readonly","option-label","option-value"])])):v("",!0),s("div",go,[o[17]||(o[17]=s("label",{class:"q-mb-sm block"},"Justificaci\xF3n",-1)),l(V,{type:"textarea",autogrow:"",modelValue:e.preorden.justificacion,"onUpdate:modelValue":o[4]||(o[4]=a=>e.preorden.justificacion=a),placeholder:"Obligatorio",disable:e.disabled||e.soloLectura,outlined:"",dense:""},null,8,["modelValue","disable"])]),s("div",vo,[o[18]||(o[18]=s("label",{class:"q-mb-sm block"},"Persona que autoriza",-1)),l(L,{modelValue:e.preorden.autorizador,"onUpdate:modelValue":o[5]||(o[5]=a=>e.preorden.autorizador=a),options:e.empleados,"transition-show":"jump-up","transition-hide":"jump-up","options-dense":"",dense:"",outlined:"",onFilter:e.filtrarEmpleados,onPopupShow:o[6]||(o[6]=a=>e.ordenarLista(e.empleados,"apellidos")),disable:e.disabled||e.soloLectura,"option-label":a=>a.apellidos+" "+a.nombres,"option-value":a=>a.id,"emit-value":"","map-options":""},null,8,["modelValue","options","onFilter","disable","option-label","option-value"])]),s("div",Co,[o[20]||(o[20]=s("label",{class:"q-mb-sm block"},"Autorizacion",-1)),l(L,{modelValue:e.preorden.autorizacion,"onUpdate:modelValue":o[7]||(o[7]=a=>e.preorden.autorizacion=a),options:e.autorizaciones,"transition-show":"jum-up","transition-hide":"jump-down","options-dense":"",dense:"",outlined:"",disable:e.disabled||e.soloLectura,"option-value":a=>a.id,"option-label":a=>a.nombre,"emit-value":"","map-options":""},{"no-option":r(()=>[l(E,null,{default:r(()=>[l(u,{class:"text-grey"},{default:r(()=>o[19]||(o[19]=[d(" No hay resultados ")])),_:1})]),_:1})]),_:1},8,["modelValue","options","disable","option-value","option-label"])]),e.preorden.estado||e.accion===e.acciones.consultar?(m(),b("div",Po,[o[21]||(o[21]=s("label",{class:"q-mb-sm block"},"Estado de la Preorden de Compra",-1)),l(L,{modelValue:e.preorden.estado,"onUpdate:modelValue":o[8]||(o[8]=a=>e.preorden.estado=a),options:e.tabOptionsPreordenCompra,"transition-show":"jum-up","transition-hide":"jump-down","options-dense":"",dense:"",outlined:"",disable:"","option-value":a=>a.value,"option-label":a=>a.value,"emit-value":"","map-options":""},null,8,["modelValue","options","option-value","option-label"])])):v("",!0),e.preorden.causa_anulacion?(m(),b("div",Eo,[o[22]||(o[22]=s("label",{class:"q-mb-sm block"},"Causa de anulaci\xF3n",-1)),l(V,{type:"textarea",autogrow:"",modelValue:e.preorden.causa_anulacion,"onUpdate:modelValue":o[9]||(o[9]=a=>e.preorden.causa_anulacion=a),placeholder:"Obligatorio",disable:e.disabled||e.soloLectura,outlined:"",dense:""},null,8,["modelValue","disable"])])):v("",!0),s("div",yo,[l(g,{ref:"refItems",titulo:"Productos Seleccionados",configuracionColumnas:e.accion==e.acciones.consultar?e.configuracionColumnasDetallesProductos:[...e.configuracionColumnasDetallesProductos,e.accionesTabla],datos:e.preorden.listadoProductos,separador:"cell",permitirEditarCeldas:e.accion==e.acciones.nuevo||e.accion==e.acciones.editar,permitirConsultar:!1,permitirEditar:!1,permitirEliminar:!1,altoFijo:!1,accion1:e.btnEliminarFila},null,8,["configuracionColumnas","datos","permitirEditarCeldas","accion1"])]),s("div",Vo,[s("div",wo,[e.preorden.listadoProductos.length>0?(m(),Qe(Te,{key:0,bordered:"",separator:"",dense:""},{default:r(()=>[l(E,null,{default:r(()=>[l(u,null,{default:r(()=>o[23]||(o[23]=[d("Subtotal: ")])),_:1}),l(F,{vertical:""}),l(u,{avatar:""},{default:r(()=>[d(z(e.subtotal),1)]),_:1})]),_:1}),l(E,null,{default:r(()=>[l(u,{class:"q-mr-md"},{default:r(()=>o[24]||(o[24]=[d("Descuento: ")])),_:1}),l(F,{vertical:""}),l(u,{avatar:""},{default:r(()=>[d(z(e.descuento),1)]),_:1})]),_:1}),l(E,null,{default:r(()=>[l(u,null,{default:r(()=>o[25]||(o[25]=[d("IVA (12%): ")])),_:1}),l(F,{vertical:""}),l(u,{avatar:""},{default:r(()=>[d(z(e.iva),1)]),_:1})]),_:1}),l(E,null,{default:r(()=>[l(u,null,{default:r(()=>o[26]||(o[26]=[d("Total: ")])),_:1}),l(F,{vertical:""}),l(u,{avatar:""},{default:r(()=>[d(z(e.total),1)]),_:1})]),_:1})]),_:1})):v("",!0)])])])]),_:1})]),_:1},8,["mixin","configuracionColumnas","tab-options","filtrar","permitirEditar","accion1","accion2","accion1Header"]),l(y,{comportamiento:e.modales,persistente:!1,onGuardado:o[11]||(o[11]=a=>e.guardado(a))},null,8,["comportamiento"])],64)}var Va=Z(uo,[["render",So]]);export{Va as default};
