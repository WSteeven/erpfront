var to=Object.defineProperty;var co=(o,a,t)=>a in o?to(o,a,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[a]=t;var d=(o,a,t)=>(co(o,typeof a!="symbol"?a+"":a,t),t);import{Q,a as j}from"./QItemSection.ca64420c.js";import{Q as A}from"./QSelect.d8222f79.js";import{Q as I,a as N,C as R}from"./QPopupProxy.7844573b.js";import{bz as mo,t as uo,c as K,bA as V,s as W,v as X,x as q,y as m,S as po,H as n,B as l,z as u,D as s,F as B,M as h,L as P,K as p,k as G,R as L,I as y,J as U,a7 as Z,bi as bo,U as fo,e as Y,E as vo,q as go,G as H,aa as J}from"./index.846478c1.js";import{Q as x}from"./QForm.0a21c4a5.js";import{T as Vo}from"./TabLayoutFilterTabs2.94e4b3e1.js";import{E as $o}from"./EssentialTable.01bbad48.js";import{M as ho}from"./ModalEntidad.5edc5f68.js";import{S as yo}from"./SolicitarFecha.333e91d1.js";import{C as oo}from"./ContenedorSimpleMixin.1a882cca.js";import{V as ko}from"./VacacionController.80b9dc9c.js";import{u as Do}from"./filtrosListadosGenerales.c330183b.js";import{E as ao}from"./entidadAuditable.75a46700.js";import{h as Eo}from"./recursosHumanos.utils.706e72b6.js";import{u as eo}from"./index.15c331c5.js";import{r as _}from"./i18n-validators.06501904.js";import{P as wo}from"./PeriodoController.1fedde87.js";import{c as Fo}from"./configuracionColumnasDetallesVacacion.fceee56a.js";import{C as Co,a as qo}from"./ComponenteModal.domain.3bd8db1f.js";import{B as Uo}from"./buttonSubmits.31738227.js";import{d as _o}from"./dayjs.min.80d1628b.js";import"./QChip.697486c2.js";import"./QMenu.c0bc1e4b.js";import"./position-engine.456d5331.js";import"./format.8ac60962.js";import"./utils.19b149f6.js";import"./QTabs.19bbf6a5.js";import"./QResizeObserver.847ee253.js";import"./QTabPanels.ca44a1cd.js";import"./use-panel.27349585.js";import"./touch.9135741d.js";import"./QPage.b0adedad.js";import"./EssentialTableTabs.d6bee6af.js";import"./QBadge.60ffdb76.js";import"./EssentialTablePagination.3349ebcb.js";import"./QTable.d5868e69.js";import"./use-fullscreen.18eeae01.js";import"./QToolbar.2bb5adc4.js";import"./QBtnGroup.b7cc3fd9.js";import"./QFile.c3222262.js";import"./_commonjsHelpers.8402d862.js";import"./QImg.e43b947c.js";import"./VisorImagen.93b8e0f6.js";import"./seleccionContratacionPersonal.utils.e3e1ed3d.js";import"./ErrorComponent.eba095ef.js";import"./configuracion_general.cac1c388.js";import"./ConfiguracionController.1234694f.js";import"./index.209eea81.js";class Bo extends ao{constructor(){super();d(this,"empleado");d(this,"periodo");d(this,"periodo_id");d(this,"fecha_ingreso");d(this,"dias");d(this,"opto_pago");d(this,"detalles");d(this,"completadas");d(this,"dias_tomados");d(this,"dias_disponibles");d(this,"observacion");d(this,"mes_pago");this.empleado=null,this.periodo=null,this.periodo_id=null,this.fecha_ingreso=null,this.dias=15,this.detalles=[],this.opto_pago=!1,this.completadas=!1,this.dias_tomados=0,this.dias_disponibles=0,this.observacion=null,this.mes_pago=null}}const Po=[{name:"empleado",field:"empleado",label:"Empleado",align:"left",sortable:!0},{name:"periodo",field:"periodo",label:"Per\xEDodo",align:"left",sortable:!0},{name:"dias",field:"dias",label:"D\xEDas Vacaciones",align:"left",sortable:!0},{name:"opto_pago",field:"opto_pago",label:"\xBFOpto pago?",align:"left",sortable:!0},{name:"completadas",field:"completadas",label:"Completadas",align:"left",sortable:!0},{name:"dias_tomados",field:"dias_tomados",label:"D\xEDas Tomados",align:"left",sortable:!0},{name:"dias_disponibles",field:"dias_disponibles",label:"D\xEDas Disponibles",align:"left",sortable:!0}];class So extends ao{constructor(){super();d(this,"vacacion_id");d(this,"fecha_inicio");d(this,"fecha_fin");d(this,"dias_utilizados");d(this,"vacacionable_id");d(this,"vacacionable_type");d(this,"observacion");d(this,"anulado");d(this,"motivo_anulacion");this.vacacion_id=null,this.fecha_inicio=null,this.fecha_fin=null,this.dias_utilizados=null,this.vacacionable_id=null,this.vacacionable_type=null,this.observacion=null,this.anulado=null,this.motivo_anulacion=null}}class Oo extends mo{constructor(){super(uo.detalles_vacaciones)}}var zo=K({components:{ButtonSubmits:Uo},props:{datos:Object},setup(o,{emit:a}){var F,M;const t=new oo(So,new Oo),{entidad:c,accion:k,disabled:D}=t.useReferencias(),{setValidador:f,guardar:i,editar:E}=t.useComportamiento(),{onGuardado:w,onModificado:e}=t.useHooks();c.vacacion_id=(F=o.datos)==null?void 0:F.vacacion_id,((M=o.datos)==null?void 0:M.accion)===V.editar&&c.hydrate(o.datos.entidad),w(($,C)=>{var g;a("guardado",{id:$,response:C,accion:(g=o.datos)==null?void 0:g.accion}),a("cerrar-modal",!1)}),e(($,C)=>{var g;a("guardado",{id:$,response:C,accion:(g=o.datos)==null?void 0:g.accion}),a("cerrar-modal",!1)});const v=eo({fecha_inicio:{required:_},fecha_fin:{required:_},observacion:{required:_}},c);return v.value=f(v.value),{mixin:t,detalle:c,v$:v,accion:k,disabled:D,guardar:i,editar:E,cancelar:()=>{a("cerrar-modal",!1)},maskFecha:W,calcularFechaFin:()=>{c.fecha_fin=c.fecha_inicio,c.dias_utilizados=1},calcularDiasUtilizados:()=>{c.dias_utilizados=_o(c.fecha_fin).diff(c.fecha_inicio,"day")+1}}}});const Mo={class:"row q-col-gutter-sm q-py-md"},Io={key:0,class:"col-12 col-md-12 rounded-card q-py-sm text-center text-accent bg-yellow-2"},No={class:"col-12 col-md-3"},To={class:"row items-center justify-end"},Qo={class:"error-msg"},jo={class:"col-12 col-md-3"},Ao={class:"row items-center justify-end"},Ro={class:"error-msg"},Go={class:"col-12 col-md-3"},Lo={class:"col-12 col-md-3"},Yo={class:"error-msg"},Ho={class:"row justify-end q-pr-md q-pb-md"};function Jo(o,a,t,c,k,D){const f=q("button-submits");return m(),po(x,{onSubmit:a[8]||(a[8]=Z(()=>{},["prevent"]))},{default:n(()=>[l("div",Mo,[o.datos.dias_disponibles<o.detalle.dias_utilizados?(m(),u("div",Io,[s(B,{name:"bi-exclamation-triangle-fill",class:"q-mr-sm",size:"1em"}),a[9]||(a[9]=l("b",null,"\xA0 Advertencia",-1)),l("div",null,"No se puede registrar m\xE1s d\xEDas de los d\xEDas disponibles. D\xEDas disponibles: "+h(o.datos.dias_disponibles),1)])):P("",!0),l("div",No,[a[10]||(a[10]=l("label",{class:"q-mb-sm block"},"Fecha Inicio",-1)),s(p,{modelValue:o.detalle.fecha_inicio,"onUpdate:modelValue":a[1]||(a[1]=i=>o.detalle.fecha_inicio=i),placeholder:"Obligatorio",error:!!o.v$.fecha_inicio.$errors.length,disable:o.disabled,onBlur:o.v$.fecha_inicio.$touch,outlined:"",dense:""},{append:n(()=>[s(B,{name:"event",class:"cursor-pointer"},{default:n(()=>[s(I,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:n(()=>[s(N,{modelValue:o.detalle.fecha_inicio,"onUpdate:modelValue":[a[0]||(a[0]=i=>o.detalle.fecha_inicio=i),o.calcularFechaFin],mask:o.maskFecha,"today-btn":""},{default:n(()=>[l("div",To,[G(s(L,{label:"Cerrar",color:"primary",flat:""},null,512),[[R]])])]),_:1},8,["modelValue","mask","onUpdate:modelValue"])]),_:1})]),_:1})]),error:n(()=>[(m(!0),u(y,null,U(o.v$.fecha_inicio.$errors,i=>(m(),u("div",{key:i.$uid},[l("div",Qo,h(i.$message),1)]))),128))]),_:1},8,["modelValue","error","disable","onBlur"])]),l("div",jo,[a[11]||(a[11]=l("label",{class:"q-mb-sm block"},"Fecha Fin",-1)),s(p,{modelValue:o.detalle.fecha_fin,"onUpdate:modelValue":a[3]||(a[3]=i=>o.detalle.fecha_fin=i),placeholder:"Obligatorio",error:!!o.v$.fecha_fin.$errors.length,disable:o.disabled,onBlur:o.v$.fecha_fin.$touch,outlined:"",dense:""},{append:n(()=>[s(B,{name:"event",class:"cursor-pointer"},{default:n(()=>[s(I,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:n(()=>[s(N,{modelValue:o.detalle.fecha_fin,"onUpdate:modelValue":[a[2]||(a[2]=i=>o.detalle.fecha_fin=i),o.calcularDiasUtilizados],mask:o.maskFecha,"today-btn":""},{default:n(()=>[l("div",Ao,[G(s(L,{label:"Cerrar",color:"primary",flat:""},null,512),[[R]])])]),_:1},8,["modelValue","mask","onUpdate:modelValue"])]),_:1})]),_:1})]),error:n(()=>[(m(!0),u(y,null,U(o.v$.fecha_fin.$errors,i=>(m(),u("div",{key:i.$uid},[l("div",Ro,h(i.$message),1)]))),128))]),_:1},8,["modelValue","error","disable","onBlur"])]),l("div",Go,[a[12]||(a[12]=l("label",{class:"q-mb-sm block"},"D\xEDas utilizados",-1)),s(p,{modelValue:o.detalle.dias_utilizados,"onUpdate:modelValue":a[4]||(a[4]=i=>o.detalle.dias_utilizados=i),placeholder:"Obligatorio",disable:"",outlined:"",dense:""},null,8,["modelValue"])]),l("div",Lo,[a[13]||(a[13]=l("label",{class:"q-mb-sm block"},"Observaciones",-1)),s(p,{modelValue:o.detalle.observacion,"onUpdate:modelValue":a[5]||(a[5]=i=>o.detalle.observacion=i),autogrow:"",placeholder:"Obligatorio",disable:o.disabled,error:!!o.v$.observacion.$errors.length,onBlur:o.v$.observacion.$touch,outlined:"",dense:""},{error:n(()=>[(m(!0),u(y,null,U(o.v$.observacion.$errors,i=>(m(),u("div",{key:i.$uid},[l("div",Yo,h(i.$message),1)]))),128))]),_:1},8,["modelValue","disable","error","onBlur"])])]),l("div",Ho,[s(f,{disabled:o.datos.dias_disponibles<o.detalle.dias_utilizados,accion:o.datos.accion,onEditar:a[6]||(a[6]=i=>o.editar(o.detalle)),onGuardar:a[7]||(a[7]=i=>o.guardar(o.detalle)),onCancelar:o.cancelar},null,8,["disabled","accion","onCancelar"])])]),_:1})}var Ko=X(zo,[["render",Jo]]);class Wo{constructor(){d(this,"DetalleVacacionPage");this.DetalleVacacionPage=bo(new Co("Detalle de Vacaci\xF3n",Ko))}}class Xo extends qo{constructor(){super(new Wo)}}var Zo=K({components:{SolicitarFecha:yo,EssentialTable:$o,TabLayoutFilterTabs2:Vo,ModalesEntidad:ho},setup(){const o=new oo(Bo,new ko),{entidad:a,listadosAuxiliares:t,accion:c,disabled:k}=o.useReferencias(),{setValidador:D,obtenerListados:f,cargarVista:i,listar:E}=o.useComportamiento(),{confirmar:w,prompt:e,notificarInformacion:T}=fo(),v=new Xo,S=Y(!1),O=Y("PENDIENTES"),{empleados:z,periodos:F}=Do(t);i(async()=>{await f({empleados:{controller:new vo,params:{estado:1}},periodos:{controller:new wo,params:{activo:1}}}),z.value=t.empleados,F.value=t.periodos});const $=eo({empleado:{required:_},periodo:{required:_}},a);D($.value);async function C(r){O.value=r,await E({tipo:r})}async function g(r){switch(r.accion){case V.editar:const b=a.detalles.findIndex(ro=>ro.id===r.id);b!==-1&&a.detalles.splice(b,1,r.response.modelo);break;default:a.detalles.push(r.response.modelo)}lo()}function lo(){a.dias_tomados=a.detalles.reduce((r,b)=>r+(Number(b.dias_utilizados)||0),0),a.dias_disponibles=a.dias-a.dias_tomados}const so=r=>{r?io():(a.observacion=null,a.mes_pago=null)};function io(){w("\xBFEst\xE1 seguro de marcar como pagada esta vacaci\xF3n?",async()=>{e({titulo:"Observacion",mensaje:"\xBFTienes alguna observaci\xF3n al respecto?",validacion:b=>b!=null,accion:async b=>{a.observacion=b,a.mes_pago==null&&(S.value=!0)}}),T("Esta opci\xF3n crear\xE1 un registro de pago en rol de pagos del empleado")},()=>a.opto_pago=!1)}function no(r){a.mes_pago=r,console.log("Fecha ingresada: ",r),console.log(r.slice(0,7)),console.log(a)}return{mixin:o,v$:$,disabled:k,accion:c,acciones:V,accionesTabla:go,vacacion:a,tabDefecto:O,configuracionColumnas:Po,configuracionColumnasDetallesVacacion:Fo,tabOptions:Eo,maskFecha:W,modales:v,mostrarSolicitarFecha:S,empleados:z,periodos:F,filtrar:C,guardado:g,checkOptoPago:so,fechaIngresada:no,btnAgregarDetalle:{titulo:"Agregar detalle",icono:"bi-arrow-bar-down",color:"primary",tooltip:"Agregar Registro de Vacaciones",accion:()=>{v.abrirModalEntidad("DetalleVacacionPage",{vacacion_id:a.id,dias_disponibles:a.dias_disponibles,accion:V.nuevo})},visible:()=>c.value===V.editar},btnEditarDetalle:{titulo:"Editar",icono:"bi-pencil-square",color:"secondary",tooltip:"Editar Registro de Vacaciones",accion:({entidad:r})=>{v.abrirModalEntidad("DetalleVacacionPage",{vacacion_id:a.id,dias_disponibles:a.dias_disponibles,accion:V.editar,entidad:r})},visible:()=>c.value===V.editar}}}});const xo={class:"row q-col-gutter-sm q-py-md"},oa={class:"col-12 col-md-3 q-mb-md col-sm-3"},aa={class:"error-msg"},ea={class:"col-12 col-md-3 col-sm-3"},la={class:"col-12 col-md-3 col-sm-3"},sa={class:"col-12 col-md-3"},ia={class:"error-msg"},na={class:"col-12 col-md-3 col-sm-3"},da={class:"col-12 col-md-3 col-sm-3"},ra={class:"col-12 col-md-3 col-sm-3"},ta={class:"col-12 col-md-3 col-sm-3"},ca={key:0,class:"col-12 col-md-3 col-sm-3"},ma={key:1,class:"col-12 col-md-3 col-sm-3"},ua={key:2,class:"col-12"};function pa(o,a,t,c,k,D){const f=q("essential-table"),i=q("tab-layout-filter-tabs2"),E=q("solicitar-fecha"),w=q("modales-entidad");return m(),u(y,null,[s(i,{"configuracion-columnas":o.configuracionColumnas,mixin:o.mixin,"ajustar-celdas":"","tab-defecto":o.tabDefecto,"permitir-editar":o.tabDefecto=="PENDIENTES",filtrar:o.filtrar,"tab-options":o.tabOptions},{formulario:n(()=>[s(x,{onSubmit:a[11]||(a[11]=Z(()=>{},["prevent"]))},{default:n(()=>[l("div",xo,[l("div",oa,[a[14]||(a[14]=l("label",{class:"q-mb-sm block"},"Empleado",-1)),s(A,{modelValue:o.vacacion.empleado,"onUpdate:modelValue":a[0]||(a[0]=e=>o.vacacion.empleado=e),options:o.empleados,"transition-show":"jump-up","transition-hide":"jump-down",disable:"","options-dense":"",dense:"",outlined:"",error:!!o.v$.empleado.$errors.length,onBlur:o.v$.empleado.$touch,"error-message":"Debes seleccionar un empleado","use-input":"","input-debounce":"0","option-value":e=>e.id,"option-label":e=>e.nombres+" "+e.apellidos,"emit-value":"","map-options":""},{error:n(()=>[(m(!0),u(y,null,U(o.v$.empleado.$errors,e=>(m(),u("div",{key:e.$uid},[l("div",aa,h(e.$message),1)]))),128))]),"no-option":n(()=>[s(Q,null,{default:n(()=>[s(j,{class:"text-grey"},{default:n(()=>a[13]||(a[13]=[H(" No hay resultados ")])),_:1})]),_:1})]),_:1},8,["modelValue","options","error","onBlur","option-value","option-label"])]),l("div",ea,[a[15]||(a[15]=l("label",{class:"q-mb-sm block"},"Fecha de Ingreso",-1)),s(p,{modelValue:o.vacacion.fecha_ingreso,"onUpdate:modelValue":a[2]||(a[2]=e=>o.vacacion.fecha_ingreso=e),disable:"",readonly:"",outlined:"",dense:""},{append:n(()=>[s(B,{name:"event",class:"cursor-pointer"},{default:n(()=>[s(I,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:n(()=>[s(N,{modelValue:o.vacacion.fecha_ingreso,"onUpdate:modelValue":a[1]||(a[1]=e=>o.vacacion.fecha_ingreso=e),mask:o.maskFecha,"today-btn":""},null,8,["modelValue","mask"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),l("div",la,[a[16]||(a[16]=l("label",{class:"q-mb-sm block"},"D\xEDas de Vacaciones",-1)),s(p,{modelValue:o.vacacion.dias,"onUpdate:modelValue":a[3]||(a[3]=e=>o.vacacion.dias=e),disable:"",readonly:"",outlined:"",dense:""},null,8,["modelValue"])]),l("div",sa,[a[18]||(a[18]=l("label",{class:"q-mb-sm block"},"Periodo",-1)),s(A,{modelValue:o.vacacion.periodo,"onUpdate:modelValue":a[4]||(a[4]=e=>o.vacacion.periodo=e),options:o.periodos,"transition-show":"jump-up","transition-hide":"jump-down","options-dense":"",dense:"",outlined:"",disable:"",error:!!o.v$.periodo.$errors.length,"error-message":"Debes seleccionar un periodo","option-value":e=>e.id,"option-label":e=>e.nombre,"emit-value":"","map-options":""},{error:n(()=>[(m(!0),u(y,null,U(o.v$.periodo.$errors,e=>(m(),u("div",{key:e.$uid},[l("div",ia,h(e.$message),1)]))),128))]),"no-option":n(()=>[s(Q,null,{default:n(()=>[s(j,{class:"text-grey"},{default:n(()=>a[17]||(a[17]=[H(" No hay resultados ")])),_:1})]),_:1})]),_:1},8,["modelValue","options","error","option-value","option-label"])]),l("div",na,[a[19]||(a[19]=l("label",{class:"q-mb-sm block"},"D\xEDas Tomados",-1)),s(p,{type:"number",modelValue:o.vacacion.dias_tomados,"onUpdate:modelValue":a[5]||(a[5]=e=>o.vacacion.dias_tomados=e),disable:"",readonly:"",outlined:"",dense:""},null,8,["modelValue"])]),l("div",da,[a[20]||(a[20]=l("label",{class:"q-mb-sm block"},"D\xEDas Disponibles",-1)),s(p,{type:"number",modelValue:o.vacacion.dias_disponibles,"onUpdate:modelValue":a[6]||(a[6]=e=>o.vacacion.dias_disponibles=e),disable:"",readonly:"",outlined:"",dense:""},null,8,["modelValue"])]),l("div",ra,[a[21]||(a[21]=l("label",{class:"q-mb-sm block"},"Vacaciones Tomadas",-1)),s(J,{label:o.vacacion.completadas?"SI":"NO",modelValue:o.vacacion.completadas,"onUpdate:modelValue":a[7]||(a[7]=e=>o.vacacion.completadas=e),color:"primary","keep-color":"",icon:"bi-check2-circle","unchecked-icon":"clear",disable:""},null,8,["label","modelValue"])]),l("div",ta,[a[22]||(a[22]=l("label",{class:"q-mb-sm block"},"Opt\xF3 por cobrar vacaciones",-1)),s(J,{label:o.vacacion.opto_pago?"SI":"NO",modelValue:o.vacacion.opto_pago,"onUpdate:modelValue":[a[8]||(a[8]=e=>o.vacacion.opto_pago=e),o.checkOptoPago],color:"primary",disable:o.accion!==o.acciones.editar,"keep-color":"",icon:"bi-check2-circle","unchecked-icon":"clear"},null,8,["label","modelValue","disable","onUpdate:modelValue"])]),o.vacacion.observacion?(m(),u("div",ca,[a[23]||(a[23]=l("label",{class:"q-mb-sm block"},"Observaci\xF3n",-1)),s(p,{modelValue:o.vacacion.observacion,"onUpdate:modelValue":a[9]||(a[9]=e=>o.vacacion.observacion=e),disable:"",outlined:"",dense:""},null,8,["modelValue"])])):P("",!0),o.vacacion.mes_pago?(m(),u("div",ma,[a[24]||(a[24]=l("label",{class:"q-mb-sm block"},"Rol a Pagarse",-1)),s(p,{modelValue:o.vacacion.mes_pago,"onUpdate:modelValue":a[10]||(a[10]=e=>o.vacacion.mes_pago=e),disable:"",outlined:"",dense:""},null,8,["modelValue"])])):P("",!0),o.accion!==o.acciones.nuevo?(m(),u("div",ua,[s(f,{titulo:"Registro de d\xEDas de vacaciones tomados",datos:o.vacacion.detalles,"configuracion-columnas":o.accion===o.acciones.editar?[...o.configuracionColumnasDetallesVacacion,o.accionesTabla]:o.configuracionColumnasDetallesVacacion,"accion1-header":o.btnAgregarDetalle,"alto-fijo":!1,"ajustar-celdas":"","permitir-consultar":!1,"permitir-editar":!1,"permitir-eliminar":!1,accion1:o.btnEditarDetalle},null,8,["datos","configuracion-columnas","accion1-header","accion1"])])):P("",!0)])]),_:1})]),_:1},8,["configuracion-columnas","mixin","tab-defecto","permitir-editar","filtrar","tab-options"]),s(E,{mostrar:o.mostrarSolicitarFecha,reason:"month",mask:"YYYY-MM",label:"Mes de pago",confirmar:o.fechaIngresada,onCerrar:a[12]||(a[12]=e=>o.mostrarSolicitarFecha=!1)},null,8,["mostrar","confirmar"]),s(w,{comportamiento:o.modales,persistente:!1,onGuardado:o.guardado},null,8,["comportamiento","onGuardado"])],64)}var me=X(Zo,[["render",pa]]);export{me as default};
