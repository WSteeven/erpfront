var Z=Object.defineProperty;var x=(o,e,u)=>e in o?Z(o,e,{enumerable:!0,configurable:!0,writable:!0,value:u}):o[e]=u;var i=(o,e,u)=>(x(o,typeof e!="symbol"?e+"":e,u),u);import{Q as j}from"./QSelect.d8222f79.js";import{bz as oo,t as q,c as eo,U as ao,e as E,E as so,bA as g,q as to,s as no,A as O,v as lo,x as C,y as w,S as io,H as l,D as s,a7 as ro,B as t,K as y,F as P,k as T,R as L,z as F,I as uo,J as co,M as mo,aa as po,L as bo}from"./index.846478c1.js";import{Q as N,a as I,C as R}from"./QPopupProxy.7844573b.js";import{Q as fo}from"./QForm.0a21c4a5.js";import{T as vo}from"./TabLayoutFilterTabs2.94e4b3e1.js";import{E as go}from"./EssentialTable.01bbad48.js";import{C as Co}from"./ContenedorSimpleMixin.1a882cca.js";import{E as Vo}from"./entidadAuditable.75a46700.js";import{u as $o}from"./filtrosListadosGenerales.c330183b.js";import{f as ho}from"./recursosHumanos.utils.706e72b6.js";import{u as Eo}from"./index.15c331c5.js";import{r as b}from"./i18n-validators.06501904.js";import{S as wo,s as yo,i as H,n as G}from"./utils.19b149f6.js";import{E as ko}from"./EssentialEditor.aaa2717e.js";import{D as Do}from"./DescuentosGenralesController.79372b16.js";import{M as jo}from"./MultaController.07ff95a2.js";import{E as Fo}from"./ErrorComponent.eba095ef.js";import{N as qo}from"./NoOptionComponent.5e086980.js";import"./QChip.697486c2.js";import"./QItemSection.ca64420c.js";import"./QMenu.c0bc1e4b.js";import"./position-engine.456d5331.js";import"./format.8ac60962.js";import"./QTabs.19bbf6a5.js";import"./QResizeObserver.847ee253.js";import"./QTabPanels.ca44a1cd.js";import"./use-panel.27349585.js";import"./touch.9135741d.js";import"./QPage.b0adedad.js";import"./EssentialTableTabs.d6bee6af.js";import"./QBadge.60ffdb76.js";import"./EssentialTablePagination.3349ebcb.js";import"./QTable.d5868e69.js";import"./use-fullscreen.18eeae01.js";import"./QToolbar.2bb5adc4.js";import"./QBtnGroup.b7cc3fd9.js";import"./buttonSubmits.31738227.js";import"./QFile.c3222262.js";import"./_commonjsHelpers.8402d862.js";import"./QImg.e43b947c.js";import"./VisorImagen.93b8e0f6.js";import"./seleccionContratacionPersonal.utils.e3e1ed3d.js";import"./index.209eea81.js";import"./extend.4a22771d.js";class Bo extends Vo{constructor(){super();i(this,"fecha_descuento");i(this,"empleado");i(this,"tipo_descuento");i(this,"multa");i(this,"descripcion");i(this,"descripcion_corta");i(this,"valor");i(this,"cantidad_cuotas");i(this,"mes_inicia_cobro");i(this,"pendiente_pagar");i(this,"pagado");i(this,"cuotas");this.fecha_descuento=null,this.empleado=null,this.multa=null,this.tipo_descuento=null,this.descripcion="",this.descripcion_corta="",this.valor=null,this.cantidad_cuotas=null,this.mes_inicia_cobro=null,this.pendiente_pagar=null,this.pagado=!1,this.cuotas=[]}}class Uo extends oo{constructor(){super(q.descuentos)}}const Ao=[{name:"empleado",field:"empleado",label:"Empleado",align:"left",sortable:!0},{name:"descripcion_corta",field:"descripcion_corta",label:"Descripci\xF3n",align:"left",sortable:!0},{name:"valor",field:"valor",label:"Monto",align:"left",sortable:!0},{name:"cantidad_cuotas",field:"cantidad_cuotas",label:"Cant. Cuotas",align:"left",sortable:!0},{name:"pendiente_pagar",field:"pendiente_pagar",label:"Pendiente Pagar",align:"left",sortable:!0}],Mo=[{name:"num_cuota",field:"num_cuota",label:"N\xFAmero de Cuota",align:"left",sortable:!0},{name:"mes_vencimiento",field:"mes_vencimiento",label:"Mes de Vencimiento",align:"left",sortable:!0},{name:"valor_cuota",field:"valor_cuota",label:"Valor de Cuota",align:"left",sortable:!0},{name:"pagada",field:"pagada",label:"pagada",align:"center",sortable:!0},{name:"comentario",field:"comentario",label:"Comentario",align:"left",sortable:!0}];var So=eo({components:{NoOptionComponent:qo,ErrorComponent:Fo,EssentialEditor:ko,TabLayoutFilterTabs2:vo,EssentialTable:go},setup(){const o=new Co(Bo,new Uo),{entidad:e,disabled:u,accion:V,listadosAuxiliares:f}=o.useReferencias(),{setValidador:B,obtenerListados:c,cargarVista:v,listar:k}=o.useComportamiento(),{prompt:$,confirmar:D,notificarCorrecto:a}=ao(),U=E("0"),A=E(!1),h=new wo,M=E([]),S=E([]),{empleados:Q,filtrarEmpleados:J}=$o(f);v(async()=>{await c({empleados:{controller:new so,params:{estado:1}},descuentos_generales:{controller:new Do,params:{}},multas:{controller:new jo,params:{}}}),M.value=f.descuentos_generales,Q.value=f.empleados,S.value=f.multas});const _=Eo({empleado:{required:b},fecha_descuento:{required:b},descripcion:{required:b},valor:{required:b},cantidad_cuotas:{required:b},mes_inicia_cobro:{required:b}},e);B(_.value);async function K(n){U.value=n,await k({pagado:n})}function Y(n,r){A.value=r!=="month"}async function W(){try{h.activar();const n=O.getInstance(),r=n.getEndpoint(q.calcular_cuotas_descuento),d=await n.post(r,e);console.log(d),d.status==200&&a("Cuotas calculadas"),e.cuotas=d.data.cuotas}catch(n){if(H(n)){const d=error.erroresValidacion;await G(d,this.notificaciones)}}finally{h.desactivar()}}async function X(n,r,d){try{h.activar();const m=O.getInstance(),z=m.getEndpoint(q.aplazar_cuota_descuento)+n.id,p=await m.post(z,{comentario:d});console.log(p),p.status==200&&(a(p.data.mensaje),e.cuotas[r]=p.data.cuota)}catch(m){if(H(m)){const p=error.erroresValidacion;await G(p,this.notificaciones)}}finally{h.desactivar()}}return{v$:_,mixin:o,descuento:e,accion:V,acciones:g,accionesTabla:to,disabled:u,configuracionColumnas:Ao,configuracionColumnasCuotasDescuento:Mo,maskFecha:no,tabDefecto:U,tabOptions:ho,is_month:A,multas:S,descuentos_generales:M,empleados:Q,filtrarEmpleados:J,filtrar:K,checkMes:Y,calcularCantidadCuotas:W,ordenarLista:yo,btnComentarioCuota:{titulo:"Comentario",icono:"bi-chat-square-text-fill",color:"primary",accion:({entidad:n})=>{const r={titulo:"Comentario",mensaje:"Escribe el comentario",defecto:n.comentario,accion:d=>{n.comentario=d}};$(r)},visible:()=>[g.nuevo,g.editar].includes(V.value)},btnAplazarCuota:{titulo:"Aplazar",icono:"bi-caret-down-fill",color:"warning",accion:({entidad:n,posicion:r})=>{console.log(n,r),D("Se modificar\xE1 el mes de vencimiento hasta el mes siguiente de la ultima cuota. \xA1Esta acci\xF3n es irreversible! \xBFEst\xE1 seguro de continuar?",async()=>{$({titulo:"Comentario",mensaje:"Escribe el motivo por el vas a aplazar la cuota",accion:async m=>{await X(n,r,m)}})})},visible:({entidad:n})=>[g.nuevo,g.editar].includes(V.value)&&!n.pagada},barraDefault:[["bold","italic","strike","underline","subscript","superscript"],["quote","unordered","ordered","outdent","indent"]]}}});const Qo={class:"row q-col-gutter-sm q-py-md"},_o={class:"col-12 col-md-3"},zo={class:"col-12 col-md-3 col-sm-4"},Oo={class:"col-12 col-md-3 col-sm-4"},Po={class:"col-12 col-md-3"},To={class:"row items-center justify-end"},Lo={class:"col-12"},No={class:"col-12 col-md-3"},Io={class:"col-12 col-md-3"},Ro={class:"row items-center justify-end"},Ho={class:"col-12 col-md-3"},Go={class:"col-12 col-md-3 col-sm-3"},Jo={key:0,class:"col-12"};function Ko(o,e,u,V,f,B){const c=C("error-component"),v=C("no-option-component"),k=C("essential-editor"),$=C("essential-table"),D=C("tab-layout-filter-tabs2");return w(),io(D,{mixin:o.mixin,"configuracion-columnas":o.configuracionColumnas,"titulo-pagina":"Descuentos a Empleados","tab-options":o.tabOptions,"ajustar-celdas":"","tab-defecto":o.tabDefecto,filtrar:o.filtrar},{formulario:l(()=>[s(fo,{onSubmit:e[15]||(e[15]=ro(()=>{},["prevent"]))},{default:l(()=>[t("div",Qo,[t("div",_o,[e[16]||(e[16]=t("label",{class:"q-mb-sm block"},"Empleado",-1)),s(j,{modelValue:o.descuento.empleado,"onUpdate:modelValue":e[0]||(e[0]=a=>o.descuento.empleado=a),options:o.empleados,"transition-show":"jump-up","transition-hide":"jump-down","options-dense":"",dense:"",outlined:"",disable:o.disabled,error:!!o.v$.empleado.$errors.length,"error-message":"Debes seleccionar un empleado","use-input":"","input-debounce":"0",onFilter:o.filtrarEmpleados,onPopupShow:e[1]||(e[1]=a=>o.ordenarLista(o.empleados,"apellidos")),"option-value":a=>a.id,"option-label":a=>a.nombres+" "+a.apellidos,"emit-value":"","map-options":""},{error:l(()=>[s(c,{clave:"empleado",v$:o.v$},null,8,["v$"])]),"no-option":l(()=>[s(v)]),_:1},8,["modelValue","options","disable","error","onFilter","option-value","option-label"])]),t("div",zo,[e[17]||(e[17]=t("label",{class:"q-mb-sm block"},"Tipo Descuento",-1)),s(j,{modelValue:o.descuento.tipo_descuento,"onUpdate:modelValue":[e[2]||(e[2]=a=>o.descuento.tipo_descuento=a),e[3]||(e[3]=()=>o.descuento.multa=null)],options:o.descuentos_generales,"transition-show":"jump-up","transition-hide":"jump-down","options-dense":"",dense:"",disable:o.disabled,outlined:"","use-input":"","input-debounce":"0","option-value":a=>a.id,"option-label":a=>a.nombre,"emit-value":"","map-options":""},{"no-option":l(()=>[s(v)]),_:1},8,["modelValue","options","disable","option-value","option-label"])]),t("div",Oo,[e[18]||(e[18]=t("label",{class:"q-mb-sm block"},"Multa",-1)),s(j,{modelValue:o.descuento.multa,"onUpdate:modelValue":[e[4]||(e[4]=a=>o.descuento.multa=a),e[5]||(e[5]=()=>o.descuento.tipo_descuento=null)],options:o.multas,"transition-show":"jump-up","transition-hide":"jump-down","options-dense":"",dense:"",disable:o.disabled,outlined:"","use-input":"","input-debounce":"0","option-value":a=>a.id,"option-label":a=>a.nombre,"emit-value":"","map-options":""},{"no-option":l(()=>[s(v)]),_:1},8,["modelValue","options","disable","option-value","option-label"])]),t("div",Po,[e[19]||(e[19]=t("label",{class:"q-mb-sm block"},"Fecha del descuento",-1)),s(y,{modelValue:o.descuento.fecha_descuento,"onUpdate:modelValue":e[7]||(e[7]=a=>o.descuento.fecha_descuento=a),placeholder:"Obligatorio",error:!!o.v$.fecha_descuento.$errors.length,disable:o.disabled,onBlur:o.v$.fecha_descuento.$touch,outlined:"",dense:""},{append:l(()=>[s(P,{name:"event",class:"cursor-pointer"},{default:l(()=>[s(N,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:l(()=>[s(I,{modelValue:o.descuento.fecha_descuento,"onUpdate:modelValue":e[6]||(e[6]=a=>o.descuento.fecha_descuento=a),mask:o.maskFecha,"today-btn":""},{default:l(()=>[t("div",To,[T(s(L,{label:"Cerrar",color:"primary",flat:""},null,512),[[R]])])]),_:1},8,["modelValue","mask"])]),_:1})]),_:1})]),error:l(()=>[s(c,{clave:"fecha_descuento",v$:o.v$},null,8,["v$"])]),_:1},8,["modelValue","error","disable","onBlur"])]),t("div",Lo,[e[20]||(e[20]=t("div",{class:"row justify-between"},[t("label",{class:"q-mb-sm block"},"Descripci\xF3n")],-1)),s(k,{modelValue:o.descuento.descripcion,"onUpdate:modelValue":e[8]||(e[8]=a=>o.descuento.descripcion=a),disable:o.disabled,"barra-herramientas":o.barraDefault},null,8,["modelValue","disable","barra-herramientas"]),(w(!0),F(uo,null,co(o.v$.descripcion.$errors,a=>(w(),F("div",{key:a.$uid,class:"text-negative text-uppercase"},[t("small",null,mo(a.$message),1)]))),128))]),t("div",No,[e[21]||(e[21]=t("label",{class:"q-mb-sm block"},"Valor ",-1)),s(y,{modelValue:o.descuento.valor,"onUpdate:modelValue":e[9]||(e[9]=a=>o.descuento.valor=a),placeholder:"Obligatorio",type:"number",disable:o.disabled,error:!!o.v$.valor.$errors.length,onBlur:o.v$.valor.$touch,outlined:"",dense:""},{error:l(()=>[s(c,{clave:"valor",v$:o.v$},null,8,["v$"])]),_:1},8,["modelValue","disable","error","onBlur"])]),t("div",Io,[e[22]||(e[22]=t("label",{class:"q-mb-sm block"},"Mes inicia cobro",-1)),s(y,{modelValue:o.descuento.mes_inicia_cobro,"onUpdate:modelValue":e[12]||(e[12]=a=>o.descuento.mes_inicia_cobro=a),mask:"####-##",placeholder:"Obligatorio",error:!!o.v$.mes_inicia_cobro.$errors.length,disable:o.disabled,onBlur:o.v$.mes_inicia_cobro.$touch,outlined:"",dense:""},{append:l(()=>[s(P,{name:"event",class:"cursor-pointer"},{default:l(()=>[s(N,{cover:"","transition-show":"scale","transition-hide":"scale",modelValue:o.is_month,"onUpdate:modelValue":e[11]||(e[11]=a=>o.is_month=a)},{default:l(()=>[s(I,{modelValue:o.descuento.mes_inicia_cobro,"onUpdate:modelValue":[e[10]||(e[10]=a=>o.descuento.mes_inicia_cobro=a),o.checkMes],minimal:"",mask:o.maskFecha,"emit-immediately":"","default-view":"Years"},{default:l(()=>[t("div",Ro,[T(s(L,{label:"Cerrar",color:"primary",flat:""},null,512),[[R]])])]),_:1},8,["modelValue","mask","onUpdate:modelValue"])]),_:1},8,["modelValue"])]),_:1})]),error:l(()=>[s(c,{clave:"mes_inicia_cobro",v$:o.v$},null,8,["v$"])]),_:1},8,["modelValue","error","disable","onBlur"])]),t("div",Ho,[e[23]||(e[23]=t("label",{class:"q-mb-sm block"},"Cantidad Cuotas ",-1)),s(y,{modelValue:o.descuento.cantidad_cuotas,"onUpdate:modelValue":[e[13]||(e[13]=a=>o.descuento.cantidad_cuotas=a),o.calcularCantidadCuotas],placeholder:"Obligatorio",type:"number",disable:o.accion!==o.acciones.nuevo,error:!!o.v$.cantidad_cuotas.$errors.length,onBlur:o.v$.valor.$touch,outlined:"",dense:""},{error:l(()=>[s(c,{clave:"cantidad_cuotas",v$:o.v$},null,8,["v$"])]),_:1},8,["modelValue","disable","error","onBlur","onUpdate:modelValue"])]),t("div",Go,[e[24]||(e[24]=t("label",{class:"q-mb-sm block"},"Pagado",-1)),s(po,{label:o.descuento.pagado?"SI":"NO",modelValue:o.descuento.pagado,"onUpdate:modelValue":e[14]||(e[14]=a=>o.descuento.pagado=a),color:"primary","keep-color":"",icon:"bi-check2-circle","unchecked-icon":"clear",disable:""},null,8,["label","modelValue"])]),o.descuento.cuotas.length>0?(w(),F("div",Jo,[s($,{titulo:"Cuotas a Pagar",datos:o.descuento.cuotas,"configuracion-columnas":o.accion==o.acciones.editar?[...o.configuracionColumnasCuotasDescuento,o.accionesTabla]:o.configuracionColumnasCuotasDescuento,"ajustar-celdas":"","desplegar-desde":3,accion1:o.btnComentarioCuota,accion2:o.btnAplazarCuota,altoFijo:!1,permitirConsultar:!1,permitirEditar:!1,permitirEliminar:!1},null,8,["datos","configuracion-columnas","accion1","accion2"])])):bo("",!0)])]),_:1})]),_:1},8,["mixin","configuracion-columnas","tab-options","tab-defecto","filtrar"])}var Ie=lo(So,[["render",Ko]]);export{Ie as default};
