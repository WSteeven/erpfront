var de=Object.defineProperty;var ce=(a,e,c)=>e in a?de(a,e,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[e]=c;var t=(a,e,c)=>(ce(a,typeof e!="symbol"?e+"":e,c),c);import{Q as me,a as pe}from"./QItemSection.ca64420c.js";import{Q as ue}from"./QSelect.d8222f79.js";import{bz as be,t as Y,c as fe,U as ve,be as ge,p as M,u as he,e as Ee,E as Ce,bA as v,q as we,A as ye,bH as Ae,v as Se,x as U,y as m,S as G,H as d,D as r,a7 as $e,B as n,z as b,I as F,J as I,M as g,G as _,K as J,R as N,F as P,L as K}from"./index.846478c1.js";import{a as Z}from"./QToolbar.2bb5adc4.js";import{Q as ke}from"./QExpansionItem.a87f342e.js";import{Q as Fe}from"./QForm.0a21c4a5.js";import{T as Ie}from"./TabLayoutFilterTabs2.94e4b3e1.js";import{C as _e}from"./ContenedorSimpleMixin.1a882cca.js";import{E as q}from"./entidadAuditable.75a46700.js";import{u as Ne}from"./filtrosListadosGenerales.c330183b.js";import{u as Pe}from"./index.15c331c5.js";import{r as W}from"./i18n-validators.06501904.js";import{i as qe,j as Qe,k as Ve}from"./recursosHumanos.utils.706e72b6.js";import{u as Be,S as Le,s as je,C as X,A as Te}from"./utils.19b149f6.js";import{E as ze}from"./EssentialTable.01bbad48.js";import"./QChip.697486c2.js";import"./QMenu.c0bc1e4b.js";import"./position-engine.456d5331.js";import"./format.8ac60962.js";import"./QTabs.19bbf6a5.js";import"./QResizeObserver.847ee253.js";import"./QTabPanels.ca44a1cd.js";import"./use-panel.27349585.js";import"./touch.9135741d.js";import"./QPopupProxy.7844573b.js";import"./QPage.b0adedad.js";import"./EssentialTableTabs.d6bee6af.js";import"./QBadge.60ffdb76.js";import"./EssentialTablePagination.3349ebcb.js";import"./QTable.d5868e69.js";import"./use-fullscreen.18eeae01.js";import"./QBtnGroup.b7cc3fd9.js";import"./buttonSubmits.31738227.js";import"./index.209eea81.js";import"./QFile.c3222262.js";import"./_commonjsHelpers.8402d862.js";import"./QImg.e43b947c.js";import"./VisorImagen.93b8e0f6.js";import"./seleccionContratacionPersonal.utils.e3e1ed3d.js";import"./ErrorComponent.eba095ef.js";class Oe extends q{constructor(){super();t(this,"empleado");t(this,"nombre");t(this,"completado");t(this,"actividades");this.empleado=null,this.nombre=null,this.completado=0,this.actividades=[]}}class De extends be{constructor(){super(Y.planificadores)}}const Re=[{name:"nombre",field:"nombre",label:"Nombre",align:"left"},{name:"empleado",field:"empleado",label:"Empleado Responsable",align:"left"},{name:"completado",field:"completado",label:"% Completado",align:"center"}];class He extends q{constructor(){super();t(this,"id");t(this,"nombre");t(this,"subactividades");this.nombre=null,this.subactividades=[]}}const w=[{name:"nombre",field:"nombre",label:"Actividades",align:"left",style:"min-width: 200px; overflow: auto;",editable:!0},{name:"responsable",field:"responsable",label:"Responsable",align:"left",type:"select",editable:!0},{name:"fecha_inicio",field:"fecha_inicio",label:"F. Inicio",align:"left",type:"date",editable:!0},{name:"fecha_fin",field:"fecha_fin",label:"F. Fin",align:"left",type:"date",editable:!0},{name:"estado_avance",field:"estado_avance",label:"Estado",align:"left",type:"select",options:qe,style:"min-width: 100px; overflow: auto;",editable:!0},{name:"periodicidad",field:"periodicidad",label:"Periodicidad",align:"left",type:"select",options:Qe,editable:!0},{name:"observaciones",field:"observaciones",label:"Observaciones",style:"min-width: 200px; overflow: auto;",align:"left",editable:!0}];class Me extends q{constructor(){super();t(this,"id");t(this,"nombre");t(this,"responsable");t(this,"fecha_inicio");t(this,"fecha_fin");t(this,"estado_avance");t(this,"periodicidad");t(this,"observaciones");t(this,"actividad_id");this.id=null,this.nombre=null,this.responsable=null,this.fecha_inicio=null,this.fecha_fin=null,this.estado_avance=null,this.periodicidad=null,this.observaciones=null,this.actividad_id=null}}var Ue=fe({components:{TabLayoutFilterTabs2:Ie,EssentialTable:ze},setup(){const a=new _e(Oe,new De),{entidad:e,listadosAuxiliares:c,accion:h,disabled:Q}=a.useReferencias(),{setValidador:V,listar:E,cargarVista:y,obtenerListados:s}=a.useComportamiento(),{onReestablecer:f}=a.useHooks(),{confirmar:p,notificarAdvertencia:A,prompt:B}=ve();ge().setQuasar(M()),Be().setQuasar(M());const L=new Le,S=he(),j="Finalizado",x="No iniciado",ee="Semanal",T=Ee("0"),{empleados:C,filtrarEmpleados:z}=Ne(c);y(async()=>{await s({empleados:{controller:new Ce,params:{estado:1,campos:"id,nombres,apellidos"}}}),C.value=c.empleados,e.empleado=S.user.id,w.find(i=>i.field==="responsable").options=C.value.map(i=>({value:i.id,label:i.nombres+" "+i.apellidos})),w.find(i=>i.field==="responsable").filtro=ie});const O=Pe({nombre:{required:W},empleado:{required:W}},e);V(O.value),f(()=>e.empleado=S.user.id);async function ae(i){switch(T.value=i,i){case"1":await E({completado:100});break;default:await E({"completado[operator]":"<","completado[value]":100})}}function ie(i,o){z(i,o),w.find(l=>l.field==="responsable").options=C.value.map(l=>({value:l.id,label:l.nombres+" "+l.apellidos}))}const oe=()=>{const i=new He;i.id=e.actividades.length?X(e.actividades)+1:1,B({titulo:"Nombre",mensaje:"Ingrese el nombre de la actividad",accion:l=>{i.nombre=l,e.actividades.push(i)}})},se=i=>{const o={titulo:"Nombre",mensaje:"Ingresa el nombre de la actividad",defecto:i.nombre,accion:l=>{i.nombre=l}};B(o)},te=i=>{p("\xBFEst\xE1 seguro de eliminar la actividad? Est\xE1 acci\xF3n borrar\xE1 todas las subactividades",()=>e.actividades.splice(i,1))};function le({posicion:i,identificador:o}){p("\xBFEst\xE1 seguro de continuar?",()=>{e.actividades[o].subactividades.splice(i,1),$(e.actividades[o][0],e.actividades[o])})}const $=(i,o)=>{var R;const l=o.subactividades.filter(k=>k.estado_avance===j);o.completado=(l.length/((R=o.subactividades)==null?void 0:R.length)*100).toFixed(2);let u=0,D=0;e.actividades.forEach(k=>{var H;(H=k.subactividades)==null||H.forEach(re=>{u++,re.estado_avance===j&&D++})}),e.completado=(D/u*100).toFixed(2)};async function ne(i){try{L.activar();const o=ye.getInstance(),l=Ae.URL_BASE+"/"+o.getEndpoint(Y.planificadores)+"/imprimir/"+i.id,u=i.nombre+"_"+Date.now();await Te(l,"GET","blob","pdf",u)}catch(o){A("Error al imprimir el registro "+o)}finally{L.desactivar()}}return{mixin:a,v$:O,accion:h,acciones:v,accionesTabla:we,disabled:Q,planificador:e,store:S,tabDefecto:T,configuracionColumnas:Re,configuracionColumnasSubactividades:w,tabOptions:Ve,empleados:C,filtrarEmpleados:z,filtrar:ae,ordenarLista:je,agregarActividad:oe,eliminarActividad:te,editarNombreActividad:se,calcularPorcentajeCompletado:$,btnEliminar:{titulo:"",icono:"bi-trash",color:"negative",accion:({posicion:i,identificador:o})=>{le({posicion:i,identificador:o})},visible:()=>[v.nuevo,v.editar].includes(h.value)},btnAgregarSubactividad:{titulo:"Agregar Item",icono:"bi-arrow-bar-down",color:"positive",tooltip:"Agregar referencia personal o laboral",accion:i=>{var l,u;const o=new Me;o.actividad_id=e.actividades[i].id,o.responsable=e.empleado,o.estado_avance=x,o.periodicidad=ee,o.fecha_inicio=(l=e.actividades[i].subactividades.at(-1))==null?void 0:l.fecha_inicio,o.fecha_fin=(u=e.actividades[i].subactividades.at(-1))==null?void 0:u.fecha_fin,o.id=e.actividades[i].subactividades.length?X(e.actividades[i].subactividades)+1:1,e.actividades[i].subactividades.push(o),$(o,e.actividades[i])},visible:()=>[v.nuevo,v.editar].includes(h.value)},btnImprimir:{titulo:"Imprimir",color:"secondary",icono:"bi-printer",accion:async({entidad:i})=>{await ne(i)}}}}});const Ge={class:"row q-col-gutter-sm q-pa-sm"},Je={class:"col-12 col-md-4 q-mb-md col-sm-6"},Ke={class:"error-msg"},Ze={class:"col-12 col-md-4 col-sm-6"},We={class:"error-msg"},Xe={class:"col-12 col-md-4 col-sm-6"},Ye={class:"col-12 text-center q-pb-md"},xe={class:"row full-width q-col-gutter-sm"},ea={class:"col-6"},aa={class:"q-pt-sm"},ia={class:"col-5"},oa={key:0,class:"q-pl-md"},sa={key:1},ta={class:"col-12"};function la(a,e,c,h,Q,V){const E=U("essential-table"),y=U("tab-layout-filter-tabs2");return m(),G(y,{"configuracion-columnas":a.configuracionColumnas,mixin:a.mixin,"titulo-pagina":"Planificador","tab-options":a.tabOptions,"tab-defecto":a.tabDefecto,filtrar:a.filtrar,"ajustar-celdas":"",accion1:a.btnImprimir},{formulario:d(()=>[r(Fe,{onSubmit:e[4]||(e[4]=$e(()=>{},["prevent"]))},{default:d(()=>[n("div",Ge,[n("div",Je,[e[6]||(e[6]=n("label",{class:"q-mb-sm block"},"Realizado Por",-1)),r(ue,{modelValue:a.planificador.empleado,"onUpdate:modelValue":e[0]||(e[0]=s=>a.planificador.empleado=s),options:a.empleados,"transition-show":"jump-up","transition-hide":"jump-down",disable:"","options-dense":"",dense:"",outlined:"",error:!!a.v$.empleado.$errors.length,onBlur:a.v$.empleado.$touch,"error-message":"Debes seleccionar un jefe","use-input":"","input-debounce":"0",onFilter:a.filtrarEmpleados,onPopupShow:e[1]||(e[1]=s=>a.ordenarLista(a.empleados,"nombres")),"option-value":s=>s.id,"option-label":s=>s.nombres+" "+s.apellidos,"emit-value":"","map-options":""},{error:d(()=>[(m(!0),b(F,null,I(a.v$.empleado.$errors,s=>(m(),b("div",{key:s.$uid},[n("div",Ke,g(s.$message),1)]))),128))]),"no-option":d(()=>[r(me,null,{default:d(()=>[r(pe,{class:"text-grey"},{default:d(()=>e[5]||(e[5]=[_(" No hay resultados ")])),_:1})]),_:1})]),_:1},8,["modelValue","options","error","onBlur","onFilter","option-value","option-label"])]),n("div",Ze,[e[7]||(e[7]=n("label",{class:"q-mb-sm block"},"Nombre Planificaci\xF3n",-1)),r(J,{modelValue:a.planificador.nombre,"onUpdate:modelValue":e[2]||(e[2]=s=>a.planificador.nombre=s),placeholder:"Obligatorio",disable:a.disabled,error:!!a.v$.nombre.$errors.length,onBlur:a.v$.nombre.$touch,outlined:"",dense:""},{error:d(()=>[(m(!0),b(F,null,I(a.v$.nombre.$errors,s=>(m(),b("div",{key:s.$uid},[n("div",We,g(s.$message),1)]))),128))]),_:1},8,["modelValue","disable","error","onBlur"])]),n("div",Xe,[e[8]||(e[8]=n("label",{class:"q-mb-sm block"},"Porcentaje Cumplimiento",-1)),r(J,{modelValue:a.planificador.completado,"onUpdate:modelValue":e[3]||(e[3]=s=>a.planificador.completado=s),placeholder:"Obligatorio",disable:"",dense:"",outlined:""},null,8,["modelValue"])]),n("div",Ye,[r(N,{color:"primary",class:"full-width","no-caps":"","no-wrap":"",disable:a.disabled,push:"",glossy:"",onClick:a.agregarActividad},{default:d(()=>[r(P,{name:"bi-plus",size:"xs",class:"q-pr-sm"}),e[9]||(e[9]=n("span",null,"Agregar Actividad",-1))]),_:1},8,["disable","onClick"])])]),(m(!0),b(F,null,I(a.planificador.actividades,(s,f)=>(m(),G(ke,{key:s.id,class:"overflow-hidden q-mb-md expansion",label:s.nombre,"header-class":"text-bold bg-header-collapse","default-opened":""},{header:d(p=>[n("div",xe,[n("div",ea,[n("p",aa,g(f+1)+". "+g(s.nombre),1)]),n("div",ia," Completado "+g(s.completado)+"% ",1),p.expanded?(m(),b("div",oa,[r(N,{outline:"",dense:"",disable:a.disabled,onClick:A=>a.editarNombreActividad(s),color:"secondary"},{default:d(()=>[r(Z,{class:"bg-dark"},{default:d(()=>e[10]||(e[10]=[_("Editar")])),_:1}),r(P,{class:"bi-pencil-square",size:"xs"})]),_:2},1032,["disable","onClick"])])):K("",!0),p.expanded?(m(),b("div",sa,[r(N,{outline:"",dense:"",class:"q-pl-sm",disable:a.disabled,onClick:A=>a.eliminarActividad(f),color:"negative"},{default:d(()=>[r(Z,{class:"bg-dark"},{default:d(()=>e[11]||(e[11]=[_("Eliminar")])),_:1}),r(P,{class:"bi-trash",size:"xs"})]),_:2},1032,["disable","onClick"])])):K("",!0)])]),default:d(()=>[n("div",ta,[r(E,{identificador:f,datos:s.subactividades,"configuracion-columnas":[a.acciones.nuevo,a.acciones.editar].includes(a.accion)?[...a.configuracionColumnasSubactividades,a.accionesTabla]:a.configuracionColumnasSubactividades,"ajustar-celdas":"",disable:a.disabled,permitirConsultar:!1,permitirEditarCeldas:!0,permitirEditar:!1,permitirEliminar:!1,altoFijo:!1,accion1Header:a.btnAgregarSubactividad,accion1:a.btnEliminar,mostrarFooter:!1,onFilaModificada:p=>a.calcularPorcentajeCompletado(p,s)},null,8,["identificador","datos","configuracion-columnas","disable","accion1Header","accion1","onFilaModificada"])])]),_:2},1032,["label"]))),128))]),_:1})]),_:1},8,["configuracion-columnas","mixin","tab-options","tab-defecto","filtrar","accion1"])}var Ya=Se(Ue,[["render",la]]);export{Ya as default};
