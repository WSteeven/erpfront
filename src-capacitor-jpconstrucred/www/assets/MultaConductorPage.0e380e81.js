var de=Object.defineProperty;var ie=(e,o,r)=>o in e?de(e,o,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[o]=r;var i=(e,o,r)=>(ie(e,typeof o!="symbol"?o+"":o,r),r);import{Q as F,a as $}from"./QSelect.d8222f79.js";import{Q as E,a as P}from"./QItemSection.ca64420c.js";import{bz as ue,t as ee,m as me,f as oe,e as b,U as pe,A as ce,bH as fe,c as be,u as ge,a3 as ve,s as Ve,E as he,v as Ce,x as ke,y as n,S as ye,H as s,D as l,a7 as we,B as t,z as d,I as S,J as q,M as m,O as z,P as H,G as v,K as p,L as C,F as G,k as J,R as K,aa as W}from"./index.846478c1.js";import{Q as X}from"./QExpansionItem.a87f342e.js";import{Q as Y,a as Z,C as _}from"./QPopupProxy.7844573b.js";import{Q as $e}from"./QForm.0a21c4a5.js";import{r as O,a as Ee}from"./i18n-validators.06501904.js";import{T as Pe}from"./TabLayout.b05b8b79.js";import{C as Se}from"./ContenedorSimpleMixin.1a882cca.js";import{E as qe}from"./entidadAuditable.75a46700.js";import{C as Ue}from"./ConductorController.f5ed7b77.js";import{u as Qe}from"./index.15c331c5.js";import{u as Ie}from"./filtrosListadosGenerales.c330183b.js";import{S as ae}from"./utils.19b149f6.js";import{E as j}from"./Empleado.20234ba0.js";import{V as Le}from"./VehiculoController.8465b13a.js";import{C as x}from"./Conductor.978d1863.js";const Me=[{name:"empleado",field:"empleado",label:"Conductor",align:"left",sortable:!0},{name:"fecha_infraccion",field:"fecha_infraccion",label:"Fecha Infraccion",align:"left",sortable:!0},{name:"placa",field:"placa",label:"Placa",align:"left",sortable:!0,editable:!1},{name:"puntos",field:"puntos",label:"Puntos",align:"left",sortable:!0},{name:"total",field:"total",label:"T. a Pagar",align:"left",sortable:!0},{name:"descontable",field:"descontable",label:"Se descuenta",align:"left",sortable:!0},{name:"estado",field:"estado",label:"Estado",align:"left",sortable:!0},{name:"fecha_pago",field:"fecha_pago",label:"fecha_pago",align:"left",sortable:!0},{name:"comentario",field:"comentario",label:"Comentario",align:"left"}];class Fe extends qe{constructor(){super();i(this,"empleado");i(this,"empleado_id");i(this,"fecha_infraccion");i(this,"placa");i(this,"puntos");i(this,"total");i(this,"estado");i(this,"descontable");i(this,"fecha_pago");i(this,"comentario");this.empleado=null,this.empleado_id=null,this.fecha_infraccion=null,this.placa=null,this.puntos=0,this.total=null,this.estado=!1,this.descontable=!0,this.fecha_pago=null,this.comentario=null}}class Oe extends ue{constructor(){super(ee.multas_conductores)}}const je=me("conductor",()=>{const e=oe(new x),o=b(),r=b(""),c=b("formulario"),k=b(!0),V=b(),u=new ae,{notificarCorrecto:a,notificarAdvertencia:U,notificarError:Q}=pe();async function I(M){try{u.activar();const f=ce.getInstance(),y=fe.URL_BASE+"/"+f.getEndpoint(ee.multas_conductores)+"/marcar-pagada/"+V.value,h=await f.post(y,M);if(h.status=200)return a(h.data.mensaje),!0;U(h.data.mensaje)}catch(f){Q("Error al marcar como pagada la multa. "+f)}finally{u.desactivar()}return!1}function L(){e.hydrate(new x)}return{conductor:e,idConductor:o,accionMulta:r,tabs:c,mostrarListado:k,idMulta:V,resetearConductor:L,pagarMulta:I}});var Ne=be({components:{TabLayout:Pe},setup(e,{emit:o}){const r=new Se(Fe,new Oe),{entidad:c,disabled:k,accion:V,listadosAuxiliares:u}=r.useReferencias(),{setValidador:a,cargarVista:U,obtenerListados:Q}=r.useComportamiento(),{onConsultado:I,onReestablecer:L,onGuardado:M}=r.useHooks();ge();const f=new ae,y=je(),h=b(!0),w=b(!1),g=oe(new j);U(async()=>{y.conductor.info_empleado!=null?(g.hydrate(y.conductor.info_empleado),c.empleado=g.id,w.value=!0):(w.value=!1,c.empleado=null,g.hydrate(new j)),await Q({empleados:new Ue,vehiculos:{controller:new Le,params:{campos:"id,placa,modelo_id"}}}),u.cantones=JSON.parse(ve.getItem("cantones").toString())}),I(()=>{}),L(()=>{g.hydrate(new j),w.value=!1}),M(()=>{o("cerrar-modal",!1),o("guardado","MultaConductorPage")});const le={empleado:{required:O},fecha_infraccion:{required:O},fecha_pago:{requiredIf:Ee(()=>c.estado)},total:{required:O}},N=Qe(le,c);a(N.value);async function se(B){if(B!=null){f.activar();const{result:R}=await new he().consultar(B);console.log(R),g.hydrate(R),f.desactivar()}}const{empleados:A,filtrarEmpleados:te,ordenarEmpleados:ne,vehiculos:D,filtrarVehiculos:re,cantones:T}=Ie(u);return T.value=u.cantones,A.value=u.empleados,D.value=u.vehiculos,{mixin:r,multa:c,disabled:k,v$:N,accion:V,configuracionColumnas:Me,empleado:g,maskFecha:Ve,mostrarListado:h,soloLectura:w,empleados:A,filtrarEmpleados:te,ordenarEmpleados:ne,obtenerEmpleado:se,cantones:T,vehiculos:D,filtrarVehiculos:re}}});const Ae={class:"row q-col-gutter-sm q-pa-sm"},De={class:"col-12 col-md-3"},Te={class:"error-msg"},Be={key:0,class:"col-12 col-md-3"},Re={key:1,class:"col-12 col-md-3"},ze={key:2,class:"col-12 col-md-3"},He={key:3,class:"col-12 col-md-3"},Ge={key:4,class:"col-12 col-md-3"},Je={class:"row q-col-gutter-sm q-pa-sm"},Ke={class:"col-12 col-md-3"},We={class:"row items-center justify-end"},Xe={class:"error-msg"},Ye={class:"col-12 col-md-3"},Ze={class:"col-12 col-md-3"},_e={class:"col-12 col-md-3"},xe={class:"error-msg"},eo={class:"col-12 col-md-3"},oo={class:"col-12 col-md-3"},ao={class:"col-12 col-md-3"},lo={class:"row items-center justify-end"},so={class:"error-msg"},to={class:"col-12 col-md-3"};function no(e,o,r,c,k,V){const u=ke("tab-layout");return n(),ye(u,{mixin:e.mixin,configuracionColumnas:e.configuracionColumnas,"titulo-pagina":"Multas de Conductores",mostrarListado:e.mostrarListado,ajustarCeldas:""},{formulario:s(()=>[l($e,{onSubmit:o[16]||(o[16]=we(()=>{},["prevent"]))},{default:s(()=>[l(X,{class:"overflow-hidden q-mb-md expansion",label:"Informaci\xF3n del conductor","header-class":"text-bold bg-header-collapse","default-opened":""},{default:s(()=>[t("div",Ae,[t("div",De,[o[18]||(o[18]=t("label",{class:"q-mb-sm block"},"Conductor",-1)),l(F,{modelValue:e.multa.empleado,"onUpdate:modelValue":[o[0]||(o[0]=a=>e.multa.empleado=a),e.obtenerEmpleado],options:e.empleados,"transition-show":"jump-up","transition-hide":"jump-down",disable:e.disabled||e.soloLectura,"options-dense":"",dense:"",outlined:"","use-input":"","input-debounce":"0",onFilter:e.filtrarEmpleados,onPopupShow:e.ordenarEmpleados,error:!!e.v$.empleado.$errors.length,"error-message":"Debes seleccionar un empleado para convertirlo en chofer","option-value":a=>a.id,"option-label":a=>a.empleado,"emit-value":"","map-options":""},{error:s(()=>[(n(!0),d(S,null,q(e.v$.empleado.$errors,a=>(n(),d("div",{key:a.$uid},[t("div",Te,m(a.$message),1)]))),128))]),option:s(a=>[l(E,z(H(a.itemProps)),{default:s(()=>[l(P,null,{default:s(()=>[l($,null,{default:s(()=>[v(m(a.opt.empleado),1)]),_:2},1024),l($,{caption:""},{default:s(()=>[v(m(a.opt.identificacion),1)]),_:2},1024)]),_:2},1024)]),_:2},1040)]),"no-option":s(()=>[l(E,null,{default:s(()=>[l(P,{class:"text-grey"},{default:s(()=>o[17]||(o[17]=[v(" No hay resultados ")])),_:1})]),_:1})]),_:1},8,["modelValue","options","disable","onFilter","onPopupShow","onUpdate:modelValue","error","option-value","option-label"])]),e.empleado.identificacion?(n(),d("div",Be,[o[19]||(o[19]=t("label",{class:"q-mb-sm block"},"Identificacion",-1)),l(p,{mask:"#############",modelValue:e.empleado.identificacion,"onUpdate:modelValue":o[1]||(o[1]=a=>e.empleado.identificacion=a),placeholder:"Obligatorio",disable:"",outlined:"",dense:""},null,8,["modelValue"])])):C("",!0),e.empleado.canton?(n(),d("div",Re,[o[20]||(o[20]=t("label",{class:"q-mb-sm block"},"Ciudad",-1)),l(F,{modelValue:e.empleado.canton,"onUpdate:modelValue":o[2]||(o[2]=a=>e.empleado.canton=a),options:e.cantones,disable:"",dense:"",outlined:"","option-value":a=>a.id,"option-label":a=>a.canton,"emit-value":"","map-options":""},null,8,["modelValue","options","option-value","option-label"])])):C("",!0),e.empleado.direccion?(n(),d("div",ze,[o[21]||(o[21]=t("label",{class:"q-mb-sm block"},"Direcci\xF3n",-1)),l(p,{modelValue:e.empleado.direccion,"onUpdate:modelValue":o[3]||(o[3]=a=>e.empleado.direccion=a),autogrow:"",disable:"",outlined:"",dense:""},null,8,["modelValue"])])):C("",!0),e.empleado.celular?(n(),d("div",He,[o[22]||(o[22]=t("label",{class:"q-mb-sm block"},"Celular",-1)),l(p,{modelValue:e.empleado.celular,"onUpdate:modelValue":o[4]||(o[4]=a=>e.empleado.celular=a),disable:"",dense:"",outlined:""},null,8,["modelValue"])])):C("",!0),e.empleado.email?(n(),d("div",Ge,[o[23]||(o[23]=t("label",{class:"q-mb-sm block"},"Correo",-1)),l(p,{modelValue:e.empleado.email,"onUpdate:modelValue":o[5]||(o[5]=a=>e.empleado.email=a),autogrow:"",disable:"",outlined:"",dense:""},null,8,["modelValue"])])):C("",!0)])]),_:1}),l(X,{class:"overflow-hidden q-mb-md expansion",label:"Registro de Multas","header-class":"text-bold bg-header-collapse","default-opened":""},{default:s(()=>[t("div",Je,[t("div",Ke,[o[24]||(o[24]=t("label",{class:"q-mb-sm block"},"Fecha de Infracci\xF3n",-1)),l(p,{modelValue:e.multa.fecha_infraccion,"onUpdate:modelValue":o[7]||(o[7]=a=>e.multa.fecha_infraccion=a),placeholder:"Obligatorio",error:!!e.v$.fecha_infraccion.$errors.length,disable:e.disabled,outlined:"",dense:""},{append:s(()=>[l(G,{name:"event",class:"cursor-pointer"},{default:s(()=>[l(Y,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:s(()=>[l(Z,{modelValue:e.multa.fecha_infraccion,"onUpdate:modelValue":o[6]||(o[6]=a=>e.multa.fecha_infraccion=a),mask:e.maskFecha,"today-btn":""},{default:s(()=>[t("div",We,[J(l(K,{label:"Cerrar",color:"primary",flat:""},null,512),[[_]])])]),_:1},8,["modelValue","mask"])]),_:1})]),_:1})]),error:s(()=>[(n(!0),d(S,null,q(e.v$.fecha_infraccion.$errors,a=>(n(),d("div",{key:a.$uid},[t("div",Xe,m(a.$message),1)]))),128))]),_:1},8,["modelValue","error","disable"])]),t("div",Ye,[o[26]||(o[26]=t("label",{class:"q-mb-sm block"},"Placa",-1)),l(F,{modelValue:e.multa.placa,"onUpdate:modelValue":o[8]||(o[8]=a=>e.multa.placa=a),options:e.vehiculos,"transition-show":"jump-up","transition-hide":"jump-down",disable:e.disabled,"options-dense":"",dense:"",outlined:"",onFilter:e.filtrarVehiculos,"error-message":"Debes seleccionar un numero de placa","use-input":"","input-debounce":"0","option-value":a=>a.placa,"option-label":a=>a.placa,"emit-value":"","map-options":""},{option:s(a=>[l(E,z(H(a.itemProps)),{default:s(()=>[l(P,null,{default:s(()=>[l($,null,{default:s(()=>[v(m(a.opt.placa),1)]),_:2},1024),l($,{caption:""},{default:s(()=>[v(m(a.opt.marca)+": "+m(a.opt.modelo),1)]),_:2},1024)]),_:2},1024)]),_:2},1040)]),"no-option":s(()=>[l(E,null,{default:s(()=>[l(P,{class:"text-grey"},{default:s(()=>o[25]||(o[25]=[v(" No hay resultados ")])),_:1})]),_:1})]),_:1},8,["modelValue","options","disable","onFilter","option-value","option-label"])]),t("div",Ze,[o[27]||(o[27]=t("label",{class:"q-mb-sm block"},"Puntos",-1)),l(p,{modelValue:e.multa.puntos,"onUpdate:modelValue":o[9]||(o[9]=a=>e.multa.puntos=a),type:"number",step:".5",placeholder:"Obligatorio",disable:e.disabled,outlined:"",dense:""},null,8,["modelValue","disable"])]),t("div",_e,[o[28]||(o[28]=t("label",{class:"q-mb-sm block"},"Total a Pagar",-1)),l(p,{modelValue:e.multa.total,"onUpdate:modelValue":o[10]||(o[10]=a=>e.multa.total=a),placeholder:"Obligatorio",disable:e.disabled,error:!!e.v$.total.$errors.length,outlined:"",dense:""},{error:s(()=>[(n(!0),d(S,null,q(e.v$.total.$errors,a=>(n(),d("div",{key:a.$uid},[t("div",xe,m(a.$message),1)]))),128))]),_:1},8,["modelValue","disable","error"])]),t("div",eo,[o[29]||(o[29]=t("label",{class:"q-mb-sm block"},"\xBFSe descuenta valor al Empleado?",-1)),l(W,{modelValue:e.multa.descontable,"onUpdate:modelValue":o[11]||(o[11]=a=>e.multa.descontable=a),label:e.multa.descontable?"SI":"NO",color:"primary","keep-color":"",icon:"bi-check2-circle","unchecked-icon":"clear",disable:e.disabled},null,8,["modelValue","label","disable"])]),t("div",oo,[o[30]||(o[30]=t("label",{class:"q-mb-sm block"},"Estado",-1)),l(W,{modelValue:e.multa.estado,"onUpdate:modelValue":o[12]||(o[12]=a=>e.multa.estado=a),label:e.multa.estado?"PAGADA":"PENDIENTE",color:"primary","keep-color":"",icon:"bi-check2-circle","unchecked-icon":"clear",disable:e.disabled},null,8,["modelValue","label","disable"])]),t("div",ao,[o[31]||(o[31]=t("label",{class:"q-mb-sm block"},"Fecha de Pago",-1)),l(p,{modelValue:e.multa.fecha_pago,"onUpdate:modelValue":o[14]||(o[14]=a=>e.multa.fecha_pago=a),placeholder:"Obligatorio",error:!!e.v$.fecha_pago.$errors.length,disable:e.disabled,outlined:"",dense:""},{append:s(()=>[l(G,{name:"event",class:"cursor-pointer"},{default:s(()=>[l(Y,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:s(()=>[l(Z,{modelValue:e.multa.fecha_pago,"onUpdate:modelValue":o[13]||(o[13]=a=>e.multa.fecha_pago=a),mask:e.maskFecha,"today-btn":""},{default:s(()=>[t("div",lo,[J(l(K,{label:"Cerrar",color:"primary",flat:""},null,512),[[_]])])]),_:1},8,["modelValue","mask"])]),_:1})]),_:1})]),error:s(()=>[(n(!0),d(S,null,q(e.v$.fecha_pago.$errors,a=>(n(),d("div",{key:a.$uid},[t("div",so,m(a.$message),1)]))),128))]),_:1},8,["modelValue","error","disable"])]),t("div",to,[o[32]||(o[32]=t("label",{class:"q-mb-sm block"},"Observaci\xF3n",-1)),l(p,{modelValue:e.multa.comentario,"onUpdate:modelValue":o[15]||(o[15]=a=>e.multa.comentario=a),autogrow:"",placeholder:"Opcional",disable:e.disabled,outlined:"",dense:""},null,8,["modelValue","disable"])])])]),_:1})]),_:1})]),_:1},8,["mixin","configuracionColumnas","mostrarListado"])}var ro=Ce(Ne,[["render",no]]),So=Object.freeze(Object.defineProperty({__proto__:null,default:ro},Symbol.toStringTag,{value:"Module"}));export{ro as M,Oe as a,So as b,je as u};
