import{Q as $,a as P}from"./QSelect.b1759751.js";import{Q as H,a as K}from"./QItemSection.1a41b826.js";import{by as G,s as V,d as J,bc as X,m as B,e as W,c as m,R as Y,h as Z,q as ee,A as E,bH as Q,_ as ae,t as le,v as r,P as _,F as o,y as t,z as s,bd as se,M as oe,N as te,D as k,K as y,I as D,B as b,j as q,O as g,x as n,G as F,H as L,J as C}from"./index.70185135.js";import{Q as T,a as I,C as j}from"./QPopupProxy.c164d2ac.js";import{E as ie,c as re}from"./EssentialTable.c4a035e4.js";import{Q as ne}from"./QPage.f3b97ac0.js";import{D as de}from"./DetalleProductoController.a611786a.js";import{u as ue,S as ce,A}from"./utils.2eab62de.js";import{u as me}from"./index.004ff2d8.js";import{r as N}from"./i18n-validators.ea544161.js";import{c as R}from"./configuracionColumnasItemsPreingreso.b2485163.js";import"./QChip.a6a2afa6.js";import"./QMenu.7527c31d.js";import"./position-engine.f244a0db.js";import"./format.8ac60962.js";import"./QFile.f60a5ba1.js";import"./QToolbar.f2167ded.js";import"./use-fullscreen.ec50b882.js";import"./QBadge.5bb69fff.js";import"./_commonjsHelpers.8402d862.js";import"./QImg.04221389.js";import"./VisorImagen.7aac4fec.js";import"./seleccionContratacionPersonal.utils.e3e1ed3d.js";import"./ErrorComponent.60ce3364.js";import"./index.9f64ebda.js";const fe=[{name:"fecha",field:"fecha",label:"Fecha",align:"left",sortable:!0},{name:"detalle",field:"detalle",label:"Detalle del producto",align:"left",sortable:!0},{name:"sucursal",field:"sucursal",label:"Bodega",align:"left",sortable:!0},{name:"num_transaccion",field:"num_transaccion",label:"N\xB0 transacci\xF3n",align:"left",sortable:!0},{name:"motivo",field:"motivo",label:"Motivo",align:"left",sortable:!0},{name:"tipo",field:"tipo",label:"Tipo",align:"left",sortable:!0},{name:"cant_anterior",field:"cant_anterior",label:"Stock anterior",align:"left",sortable:!0},{name:"cantidad",field:"cantidad",label:"Cantidad",align:"left",sortable:!0},{name:"cant_actual",field:"cant_actual",label:"Stock actual",align:"left",sortable:!0}];class pe extends G{constructor(){super(V.sucursales_detalle)}}const be=[{name:"id",field:"id",label:"Id",align:"left",sortable:!0,visible:!1},{name:"created_at",field:"created_at",label:"Fecha",align:"left"},{name:"transferencia_id",field:"transferencia_id",label:"N\xB0 Transferencia",align:"left"},{name:"empleado_envia",field:"empleado_envia",label:"Envia",align:"left"},{name:"empleado_recibe",field:"empleado_recibe",label:"Recibe",align:"left"},{name:"cantidad",field:"cantidad",label:"Cantidad",type:"number",align:"left",editable:!0,sortable:!0},{name:"producto",field:"producto",label:"Producto",align:"left",sortable:!0},{name:"descripcion",field:"descripcion",label:"Descripci\xF3n",align:"left",type:"textarea",editable:!1,sortable:!0},{name:"unidad_medida",field:"unidad_medida",label:"Medida",align:"left"},{name:"serial",field:"serial",label:"Serial",align:"left",type:"text",editable:!0,sortable:!0}];var ge=J({components:{EssentialTable:ie},setup(){X().setQuasar(B()),ue().setQuasar(B());const e=new ce,a=W({detalle_id:"",fecha_inicio:"",fecha_fin:"",tipo_rpt:"",sucursal_id:""}),v=m([]),f=m([]),h=m([]),w=m([]),u=m([]),l=m([]),{notificarError:U}=Y();async function x(){e.activar();const{result:i}=await new de().listar({tipo_busqueda:"only_inventario"});h.value=i,f.value=i,e.desactivar()}Z(async()=>await x());const O=me({fecha_inicio:{required:N},fecha_fin:{required:N}},a);async function S(){try{e.activar();const i=E.getInstance(),c=Q.URL_BASE+"/"+i.getEndpoint(V.reporte_inventario)+"/kardex",d=await i.post(c,a);d.data.results&&(w.value=d.data.results,u.value=d.data.preingresos,l.value=d.data.transferencias),e.desactivar()}catch{U("Error al obtener los registros del item.")}finally{e.desactivar(),a.tipo_rpt=""}}async function z(i){a.tipo_rpt=i;const c=E.getInstance(),d="reporte_kardex_"+Date.now(),p=Q.URL_BASE+"/"+c.getEndpoint(V.reporte_inventario)+"/kardex";switch(i){case"excel":A(p,"POST","blob","xlsx",d,a);break;case"pdf":A(p,"POST","blob","pdf",d,a);break;default:S();break}}async function M(){a.sucursal_id="",v.value=[];try{e.activar();const i=await new pe().listar({detalle_id:a.detalle_id});v.value=i.result}catch(i){console.log(i)}finally{e.desactivar()}}return R.splice(1,0,{name:"preingreso",field:"preingreso",label:"Preingreso",align:"left",sortable:!0},{name:"created_at",field:"created_at",label:"Fecha",align:"left",sortable:!0}),{kardex:a,v$:O,detalles:f,listado:w,listadoPreingreso:u,listadoTransferencias:l,configuracionColumnasSeguimientoDetalle:fe,columnasPreingresos:R,columnasTransferencias:be,maskFecha:ee,sucursales:v,imprimirReporte:z,obtenerSucursales:M,buscarKardex:S,filtrarDetalle(i,c){if(i===""){c(()=>{f.value=h.value});return}c(()=>{f.value=h.value.filter(d=>{var p;return d.descripcion.toLowerCase().indexOf(i.toLowerCase())>-1||((p=d.serial)!=null?p:"").toLowerCase().indexOf(i.toLowerCase())>-1})})}}}});const ve={class:"column q-mb-md text-start"},he={class:"row q-col-gutter-sm q-pa-sm q-mb-md"},_e={class:"col-12 col-md-4"},ke={class:"col-12 col-md-2"},ye={class:"row items-center justify-end"},Ce={class:"error-msg"},we={class:"col-12 col-md-2"},Ve={class:"row items-center justify-end"},Se={class:"error-msg"},$e={key:0,class:"col-12 col-md-4"},Pe={class:"col-12 col-md-12 q-mt-md"},Be={class:"text-center"},Ee={key:0,class:"row"},Qe={class:"col-12"},De={key:1},qe={key:2,class:"row"},Fe={class:"col-12"},Le={key:3},Te={key:4,class:"row"},Ie={class:"col-12"},je={key:5};function Ae(e,a,v,f,h,w){const u=le("essential-table");return r(),_(ne,{padding:""},{default:o(()=>[t("div",ve,[s(se,{class:"rounded-card custom-shadow"},{default:o(()=>[t("div",he,[t("div",_e,[a[8]||(a[8]=t("label",{class:"q-mb-sm block"},"Seleccione un detalle",-1)),s($,{modelValue:e.kardex.detalle_id,"onUpdate:modelValue":[a[0]||(a[0]=l=>e.kardex.detalle_id=l),e.obtenerSucursales],options:e.detalles,onFilter:e.filtrarDetalle,"transition-show":"scale","transition-hide":"scale","use-input":"","input-debounce":"0","options-dense":"",dense:"",outlined:"","option-label":l=>l.descripcion,"option-value":l=>l.id,"emit-value":"","map-options":""},{option:o(l=>[s(H,oe(te(l.itemProps)),{default:o(()=>[s(K,null,{default:o(()=>[s(P,null,{default:o(()=>[k(y(l.opt.descripcion),1)]),_:2},1024),s(P,{caption:""},{default:o(()=>[k(y(l.opt.serial),1)]),_:2},1024)]),_:2},1024)]),_:2},1040)]),_:1},8,["modelValue","options","onFilter","onUpdate:modelValue","option-label","option-value"])]),t("div",ke,[a[9]||(a[9]=t("label",{class:"q-mb-sm block"},"Fecha de inicio",-1)),s(D,{modelValue:e.kardex.fecha_inicio,"onUpdate:modelValue":a[2]||(a[2]=l=>e.kardex.fecha_inicio=l),placeholder:"Obligatorio",error:!!e.v$.fecha_inicio.$errors.length,onBlur:e.v$.fecha_inicio.$touch,outlined:"",dense:""},{append:o(()=>[s(b,{name:"event",class:"cursor-pointer"},{default:o(()=>[s(T,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:o(()=>[s(I,{modelValue:e.kardex.fecha_inicio,"onUpdate:modelValue":a[1]||(a[1]=l=>e.kardex.fecha_inicio=l),mask:e.maskFecha,"today-btn":""},{default:o(()=>[t("div",ye,[q(s(g,{label:"Cerrar",color:"primary",flat:""},null,512),[[j]])])]),_:1},8,["modelValue","mask"])]),_:1})]),_:1})]),error:o(()=>[(r(!0),n(F,null,L(e.v$.fecha_inicio.$errors,l=>(r(),n("div",{style:{clear:"inherit"},key:l.$uid},[t("div",Ce,y(l.$message),1)]))),128))]),_:1},8,["modelValue","error","onBlur"])]),t("div",we,[a[10]||(a[10]=t("label",{class:"q-mb-sm block"},"Fecha fin ",-1)),s(D,{modelValue:e.kardex.fecha_fin,"onUpdate:modelValue":a[4]||(a[4]=l=>e.kardex.fecha_fin=l),placeholder:"Obligatorio",error:!!e.v$.fecha_fin.$errors.length,onBlur:e.v$.fecha_fin.$touch,outlined:"",dense:""},{append:o(()=>[s(b,{name:"event",class:"cursor-pointer"},{default:o(()=>[s(T,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:o(()=>[s(I,{modelValue:e.kardex.fecha_fin,"onUpdate:modelValue":a[3]||(a[3]=l=>e.kardex.fecha_fin=l),mask:e.maskFecha,"today-btn":""},{default:o(()=>[t("div",Ve,[q(s(g,{label:"Cerrar",color:"primary",flat:""},null,512),[[j]])])]),_:1},8,["modelValue","mask"])]),_:1})]),_:1})]),error:o(()=>[(r(!0),n(F,null,L(e.v$.fecha_fin.$errors,l=>(r(),n("div",{style:{clear:"inherit"},key:l.$uid},[t("div",Se,y(l.$message),1)]))),128))]),_:1},8,["modelValue","error","onBlur"])]),e.sucursales.length?(r(),n("div",$e,[a[11]||(a[11]=t("label",{class:"q-mb-sm block"},"Sucursal",-1)),s($,{modelValue:e.kardex.sucursal_id,"onUpdate:modelValue":a[5]||(a[5]=l=>e.kardex.sucursal_id=l),options:e.sucursales,"transition-show":"scale","transition-hide":"scale","options-dense":"",dense:"",outlined:"","option-label":l=>l.lugar,"option-value":l=>l.id,"emit-value":"","map-options":""},null,8,["modelValue","options","option-label","option-value"])])):C("",!0),t("div",Pe,[t("div",Be,[s(re,{push:""},{default:o(()=>[s(g,{color:"primary",class:"full-width","no-caps":"","no-wrap":"",push:"",glossy:"",onClick:e.buscarKardex},{default:o(()=>[s(b,{name:"bi-search",size:"xs",class:"q-pr-sm"}),a[12]||(a[12]=t("span",null,"Buscar",-1))]),_:1},8,["onClick"]),s(g,{color:"positive",class:"full-width","no-caps":"","no-wrap":"",push:"",glossy:"",onClick:a[6]||(a[6]=l=>e.imprimirReporte("excel"))},{default:o(()=>[s(b,{name:"bi-file-earmark-excel-fill",size:"xs",class:"q-mr-sm"}),a[13]||(a[13]=k("EXCEL"))]),_:1}),s(g,{color:"negative",class:"full-width","no-caps":"","no-wrap":"",push:"",glossy:"",onClick:a[7]||(a[7]=l=>e.imprimirReporte("pdf"))},{default:o(()=>[s(b,{name:"bi-file-earmark-pdf-fill",size:"xs",class:"q-mr-sm"}),a[14]||(a[14]=k(" PDF"))]),_:1})]),_:1})])])]),e.listado.length?(r(),n("div",Ee,[t("div",Qe,[e.listado.length?(r(),_(u,{key:0,titulo:"Listado de movimientos del detalle",configuracionColumnas:e.configuracionColumnasSeguimientoDetalle,datos:e.listado,permitirConsultar:!1,permitirEliminar:!1,permitirEditar:!1,mostrarBotones:!1,"permitir-buscar":!1,"alto-fijo":!1,ajustarCeldas:""},null,8,["configuracionColumnas","datos"])):C("",!0)])])):(r(),n("div",De," \xA0\xA0 A\xFAn no hay movimientos de este detalle en inventarios. ")),e.listadoPreingreso.length?(r(),n("div",qe,[t("div",Fe,[e.listadoPreingreso.length?(r(),_(u,{key:0,titulo:"Listado de movimientos del detalle",configuracionColumnas:e.columnasPreingresos,datos:e.listadoPreingreso,permitirConsultar:!1,permitirEliminar:!1,permitirEditar:!1,mostrarBotones:!1,"permitir-buscar":!1,"alto-fijo":!1,ajustarCeldas:""},null,8,["configuracionColumnas","datos"])):C("",!0)])])):(r(),n("div",Le," \xA0\xA0 A\xFAn no hay movimientos de este detalle en preingresos. ")),e.listadoTransferencias.length?(r(),n("div",Te,[t("div",Ie,[e.listadoTransferencias.length?(r(),_(u,{key:0,titulo:"Listado de transferencias del detalle",configuracionColumnas:e.columnasTransferencias,datos:e.listadoTransferencias,permitirConsultar:!1,permitirEliminar:!1,permitirEditar:!1,mostrarBotones:!1,"permitir-buscar":!1,"alto-fijo":!1,ajustarCeldas:""},null,8,["configuracionColumnas","datos"])):C("",!0)])])):(r(),n("div",je," \xA0\xA0 A\xFAn no hay movimientos de este detalle en transferencias. "))]),_:1})])]),_:1})}var ca=ae(ge,[["render",Ae]]);export{ca as default};
