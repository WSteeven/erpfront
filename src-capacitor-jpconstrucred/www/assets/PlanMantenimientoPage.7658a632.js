var se=Object.defineProperty;var te=(e,o,n)=>o in e?se(e,o,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[o]=n;var u=(e,o,n)=>(te(e,typeof o!="symbol"?o+"":o,n),n);import{Q as re,a as L}from"./QSelect.d8222f79.js";import{Q as T,a as R}from"./QItemSection.ca64420c.js";import{bz as ne,t as de,e as k,bi as ce,c as ue,U as me,be as pe,p as U,u as ve,f as fe,bA as m,q as be,v as ge,x as q,y as p,z as v,D as l,H as t,a7 as Se,B as s,O as Ve,P as he,G as M,M as $,K as P,L as w,I as K,J as Ce,aa as Ee,a5 as ye,R as qe}from"./index.846478c1.js";import{Q as Me}from"./QForm.0a21c4a5.js";import{S as Pe,c as f}from"./ServicioPage.3bbe1802.js";import{r as O}from"./i18n-validators.06501904.js";import{u as we}from"./index.15c331c5.js";import{T as ke}from"./TabLayout.b05b8b79.js";import{E as Be}from"./EssentialTable.01bbad48.js";import{E as Ae}from"./EssentialSelectableTable.57ea1b28.js";import{M as Ne}from"./ModalEntidad.5edc5f68.js";import{C as Qe}from"./ContenedorSimpleMixin.1a882cca.js";import{E as $e}from"./entidadAuditable.75a46700.js";import{V as Fe}from"./VehiculoController.8465b13a.js";import{u as Ie}from"./filtrosListadosGenerales.c330183b.js";import{u as Le}from"./selector.b0f0805f.js";import{C as Te,a as Re}from"./ComponenteModal.domain.3bd8db1f.js";import{u as Ue}from"./utils.19b149f6.js";import{V as j}from"./Vehiculo.34ef9eb5.js";import"./QChip.697486c2.js";import"./QMenu.c0bc1e4b.js";import"./position-engine.456d5331.js";import"./format.8ac60962.js";import"./TabLayoutFilterTabs2.94e4b3e1.js";import"./QTabs.19bbf6a5.js";import"./QResizeObserver.847ee253.js";import"./QTabPanels.ca44a1cd.js";import"./use-panel.27349585.js";import"./touch.9135741d.js";import"./QPopupProxy.7844573b.js";import"./QPage.b0adedad.js";import"./EssentialTableTabs.d6bee6af.js";import"./QBadge.60ffdb76.js";import"./EssentialTablePagination.3349ebcb.js";import"./QTable.d5868e69.js";import"./use-fullscreen.18eeae01.js";import"./QToolbar.2bb5adc4.js";import"./QBtnGroup.b7cc3fd9.js";import"./buttonSubmits.31738227.js";import"./ServicioController.074bdb76.js";import"./vehiculos.utils.c31e027d.js";import"./index.209eea81.js";import"./QFile.c3222262.js";import"./_commonjsHelpers.8402d862.js";import"./QImg.e43b947c.js";import"./VisorImagen.93b8e0f6.js";import"./seleccionContratacionPersonal.utils.e3e1ed3d.js";import"./ErrorComponent.eba095ef.js";import"./configuracion_general.cac1c388.js";import"./ConfiguracionController.1234694f.js";import"./SelectorController.6c5262b2.js";const Ke=[{name:"vehiculo",field:"vehiculo",label:"Placa",align:"left",sortable:!0},{name:"aplicar_desde",field:"aplicar_desde",label:"Aplicar desde (km)",align:"left",sortable:!0},{name:"cantidad_servicios",field:"cantidad_servicios",label:"Cant. Servicios",align:"left",sortable:!0}];class z extends $e{constructor(){super();u(this,"vehiculo");u(this,"aplicar_desde");u(this,"listadoServicios");u(this,"cantidad_servicios");u(this,"activo");this.vehiculo=null,this.aplicar_desde=null,this.listadoServicios=[],this.cantidad_servicios=null,this.activo=!0}}class Oe extends ne{constructor(){super(de.planes_mantenimientos)}}function je(e,o){const n=k(),r=k([]),b=k(),d={refListadoSeleccionable:n,listadoSeleccionable:r,endpoint:o,limpiar:()=>{e.id=null,b.value=null},seleccionar:i=>{e.listadoServicios=[...e.listadoServicios,...i]}},S=Le(d);return{refListadoSeleccionable:n,listado:r,listar:i=>S.listar(b.value,i),limpiar:()=>d.limpiar(),seleccionar:i=>{let y=[];y=e.listadoServicios.map(g=>g.id);const B=i.filter(g=>!y.includes(g.id));d.seleccionar(B)},criterioBusqueda:b}}class ze{constructor(){u(this,"ServicioPage");this.ServicioPage=ce(new Te("Nuevo Servicio",Pe))}}class De extends Re{constructor(){super(new ze)}}var He=ue({components:{TabLayout:ke,EssentialTable:Be,EssentialSelectableTable:Ae,ModalesEntidad:Ne},setup(){const e=new Qe(z,new Oe),{entidad:o,listado:n,accion:r,disabled:b,listadosAuxiliares:d}=e.useReferencias(),{setValidador:S,obtenerListados:h,cargarVista:C}=e.useComportamiento(),{onConsultado:E,onReestablecer:i,onBeforeConsultar:y}=e.useHooks(),{confirmar:B,prompt:g,notificarCorrecto:so,notificarError:to}=me();pe().setQuasar(U()),Ue().setQuasar(U());const A=ve(),D=k(),N=fe(new j),F=new De,{refListadoSeleccionable:H,criterioBusqueda:G,listado:J,listar:W,limpiar:X,seleccionar:Y}=je(o,"servicios");y(()=>{o.hydrate(new z)}),E(()=>{const a=Q.value.filter(c=>c.id===o.vehiculo)[0];console.log(a),N.hydrate(a)}),i(()=>{N.hydrate(new j)});const{vehiculos:Q,filtrarVehiculos:Z}=Ie(d);C(async()=>{await h({vehiculos:{controller:new Fe,params:{campos:"id,placa,modelo_id"}}}),Q.value=d.vehiculos});const I=we({vehiculo:{required:O},aplicar_desde:{required:O}},o);S(I.value);function _({posicion:a}){B("\xBFEst\xE1 seguro de continuar?",()=>o.listadoServicios.splice(a,1))}function x(a){console.log(a),a.formulario=="ServicioPage"&&o.listadoServicios.push(a.modelo)}const ee={titulo:"Eliminar",icono:"bi-trash",color:"negative",accion:({entidad:a,posicion:c})=>{_({posicion:c})},visible:()=>(r.value==m.nuevo||r.value==m.editar)&&(A.esAdministradorVehiculos||A.esAdministrador)},oe={titulo:"Cantidad",icono:"bi-pencil",accion:({posicion:a})=>{const c={titulo:"Modifica",mensaje:"Ingresa cada cu\xE1ntos  KM se aplicar\xE1 este servicio",tipo:"number",defecto:o.listadoServicios[a].intervalo,accion:V=>o.listadoServicios[a].intervalo=V};g(c)},visible:()=>r.value!=m.consultar},ie={titulo:"Notificaci\xF3n",color:"positive",icono:"bi-bell-fill",accion:({posicion:a})=>{const c={titulo:"Modifica",mensaje:"Ingresa los KM faltantes donde se realizar\xE1 la notificaci\xF3n autom\xE1tica",tipo:"number",validacion:V=>Number.isInteger(parseFloat(V)),defecto:o.listadoServicios[a].notificar_antes,accion:V=>o.listadoServicios[a].notificar_antes=V};g(c)},visible:()=>r.value!=m.consultar},ae={titulo:"Agregar Servicio",icono:"bi-plus",tooltip:"Agregar nuevo servicio",accion:()=>{F.abrirModalEntidad("ServicioPage")},visible:()=>r.value==m.nuevo||r.value==m.editar};f.splice(4,1),f.find(a=>a.field=="nombre").editable=!1,f.find(a=>a.field=="intervalo").editable=!0,f.find(a=>a.field=="intervalo").type="number",f.find(a=>a.field=="notificar_antes").editable=!0,f.find(a=>a.field=="notificar_antes").type="number";const le=[...f,{name:"datos_adicionales",field:"datos_adicionales",label:"Datos adicionales",align:"left",editable:!0}];return{mixin:e,v$:I,plan:o,disabled:b,accion:r,acciones:m,configuracionColumnas:Ke,configuracionColumnasServicios:le,accionesTabla:be,modales:F,vehiculo:N,vehiculos:Q,filtrarVehiculos:Z,serviciosSeleccionados:D,adminVehiculos:A.esAdministradorVehiculos,refListado:H,criterioBusqueda:G,listadoServicios:J,listarServicios:W,limpiarServicios:X,seleccionarServicio:Y,guardado:x,btnEditarFila:oe,btnEliminarFila:ee,btnAgregarServicio:ae,btnEditarNotificar:ie}}});const Ge={class:"row q-col-gutter-sm q-py-md"},Je={class:"col-12 col-md-3 q-mb-md"},We={key:0,class:"col-12 col-md-3 q-mb-md"},Xe={key:1,class:"col-12 col-md-3 q-mb-md"},Ye={class:"col-12 col-md-3 q-mb-md"},Ze={class:"error-msg"},_e={key:2,class:"col-12 col-md-3"},xe={class:"col-12 col-md-12"},eo={class:"row q-col-gutter-x-xs"},oo={class:"col-12 col-md-10 q-mb-md"},io={class:"col-12 col-md-2"},ao={key:3,class:"col-12"};function lo(e,o,n,r,b,d){const S=q("essential-table"),h=q("essential-selectable-table"),C=q("tab-layout"),E=q("modales-entidad");return p(),v(K,null,[l(C,{mixin:e.mixin,configuracionColumnas:e.configuracionColumnas,"titulo-pagina":"Control diario de veh\xEDculos"},{formulario:t(()=>[l(Me,{onSubmit:o[9]||(o[9]=Se(()=>{},["prevent"]))},{default:t(()=>[s("div",Ge,[s("div",Je,[o[12]||(o[12]=s("label",{class:"q-mb-sm block"},"Veh\xEDculo",-1)),l(re,{modelValue:e.plan.vehiculo,"onUpdate:modelValue":o[0]||(o[0]=i=>e.plan.vehiculo=i),options:e.vehiculos,hint:"Agregue elementos desde el panel de veh\xEDculos","transition-show":"scale","transition-hide":"scale","options-dense":"",clearable:"",dense:"",outlined:"",readonly:e.disabled,disable:e.disabled,"use-input":"","input-debounce":"0",onFilter:e.filtrarVehiculos,"option-label":i=>i.placa,"option-value":i=>i.id,"emit-value":"","map-options":""},{option:t(i=>[l(T,Ve(he(i.itemProps)),{default:t(()=>[l(R,null,{default:t(()=>[l(L,null,{default:t(()=>[M($(i.opt.placa),1)]),_:2},1024),l(L,{caption:""},{default:t(()=>[M($(i.opt.marca+" "+i.opt.modelo),1)]),_:2},1024)]),_:2},1024)]),_:2},1040)]),"no-option":t(()=>[l(T,null,{default:t(()=>[l(R,{class:"text-grey"},{default:t(()=>o[11]||(o[11]=[M(" No hay resultados ")])),_:1})]),_:1})]),_:1},8,["modelValue","options","readonly","disable","onFilter","option-label","option-value"])]),e.vehiculo.marca?(p(),v("div",We,[o[13]||(o[13]=s("label",{class:"q-mb-sm block"},"Marca",-1)),l(P,{modelValue:e.vehiculo.marca,"onUpdate:modelValue":o[1]||(o[1]=i=>e.vehiculo.marca=i),disable:"",outlined:"",dense:""},null,8,["modelValue"])])):w("",!0),e.vehiculo.modelo?(p(),v("div",Xe,[o[14]||(o[14]=s("label",{class:"q-mb-sm block"},"Modelo",-1)),l(P,{modelValue:e.vehiculo.modelo,"onUpdate:modelValue":o[2]||(o[2]=i=>e.vehiculo.modelo=i),disable:"",outlined:"",dense:""},null,8,["modelValue"])])):w("",!0),s("div",Ye,[o[15]||(o[15]=s("label",{class:"q-mb-sm block"},"Aplicar desde (Km)",-1)),l(P,{modelValue:e.plan.aplicar_desde,"onUpdate:modelValue":o[3]||(o[3]=i=>e.plan.aplicar_desde=i),placeholder:"Obligatorio",type:"number",min:"0",disable:e.disabled,error:!!e.v$.aplicar_desde.$errors.length,outlined:"",dense:""},{error:t(()=>[(p(!0),v(K,null,Ce(e.v$.aplicar_desde.$errors,i=>(p(),v("div",{key:i.$uid},[s("div",Ze,$(i.$message),1)]))),128))]),_:1},8,["modelValue","disable","error"])]),e.accion==e.acciones.editar||e.accion==e.acciones.consultar?(p(),v("div",_e,[o[16]||(o[16]=s("br",null,null,-1)),l(Ee,{modelValue:e.plan.activo,"onUpdate:modelValue":o[4]||(o[4]=i=>e.plan.activo=i),"checked-icon":"check",disable:e.disabled,label:e.plan.activo?"Plan Activo":"Plan Inactivo",color:"positive"},null,8,["modelValue","disable","label"])])):w("",!0),s("div",xe,[o[18]||(o[18]=s("label",{class:"q-mb-sm block"},"Agregar Servicios",-1)),s("div",eo,[s("div",oo,[l(P,{modelValue:e.criterioBusqueda,"onUpdate:modelValue":o[5]||(o[5]=i=>e.criterioBusqueda=i),disable:e.disabled,placeholder:"Nombre del servicio",hint:"Presiona Enter para seleccionar un servicio",onKeydown:o[6]||(o[6]=ye(i=>e.listarServicios({search:e.criterioBusqueda,tipo:"PREVENTIVO",estado:1}),["enter"])),onBlur:o[7]||(o[7]=i=>e.criterioBusqueda===""?e.limpiarServicios():null),outlined:"",dense:""},null,8,["modelValue","disable"])]),s("div",io,[l(qe,{onClick:o[8]||(o[8]=i=>e.listarServicios({search:e.criterioBusqueda,tipo:"PREVENTIVO",estado:1})),icon:"search",unelevated:"",color:"positive",class:"full-width",style:{height:"40px"},disable:e.disabled,"no-caps":"",glossy:""},{default:t(()=>o[17]||(o[17]=[M("Buscar")])),_:1},8,["disable"])])])]),e.plan.listadoServicios.length>0?(p(),v("div",ao,[l(S,{titulo:"Productos Seleccionados",configuracionColumnas:e.accion==e.acciones.nuevo||e.accion==e.acciones.editar?[...e.configuracionColumnasServicios,e.accionesTabla]:e.configuracionColumnasServicios,datos:e.plan.listadoServicios,separador:"cell",desplegarDesde:3,permitirConsultar:!1,permitirEditar:!1,"permitir-editar-celdas":"",disable:e.disabled,permitirEliminar:!1,mostrarBotones:!1,ajustarCeldas:!0,altoFijo:!1,accion1Header:e.btnAgregarServicio,accion1:e.btnEliminarFila},null,8,["configuracionColumnas","datos","disable","accion1Header","accion1"])])):w("",!0)])]),_:1}),l(h,{ref:"refListado","configuracion-columnas":e.configuracionColumnasServicios,datos:e.listadoServicios,"tipo-seleccion":"multiple",onSelected:e.seleccionarServicio},null,8,["configuracion-columnas","datos","onSelected"])]),_:1},8,["mixin","configuracionColumnas"]),l(E,{comportamiento:e.modales,persistente:!1,mostrarListado:!1,onGuardado:o[10]||(o[10]=i=>e.guardado(i))},null,8,["comportamiento"])],64)}var ri=ge(He,[["render",lo]]);export{ri as default};
