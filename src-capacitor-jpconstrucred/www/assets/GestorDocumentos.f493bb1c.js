import{c as V,U as q,e as n,A as w,bH as L,q as M,v as N,x as Q,y as l,z as f,B as A,S as T,aa as z,L as b,D as C,bI as I,I as H}from"./index.846478c1.js";import{Q as J}from"./QUploader.c061fd0f.js";import{h as K,m as P}from"./utils.19b149f6.js";import{E as W}from"./EssentialTable.01bbad48.js";const X=[{name:"nombre",field:"nombre",label:"Nombre",align:"left"},{name:"tamanio_bytes",field:"tamanio_bytes",label:"Tama\xF1o",align:"left",editable:!1}];var Y=V({components:{EssentialTable:W},props:{mixin:{type:Object,required:!0},endpoint:{type:Object,required:!0},entidad:Object,disable:{type:Boolean,default:!1},permitirEliminar:{type:Boolean,default:!0},listarAlGuardar:{type:Boolean,default:!0},permitirSubir:{type:Boolean,default:!0},esObligatorio:{type:Boolean,default:!0},esMultiple:{type:Boolean,default:!0},mostrarListado:{type:Boolean,default:!0}},setup(e){const{listado:t}=e.mixin.useReferencias(),{eliminar:p,listar:v}=e.mixin.useComportamiento(),{notificarCorrecto:y,notificarError:g,notificarAdvertencia:c,confirmar:u}=q();q();function j(o){v(o)}let d;const R={titulo:"Eliminar",icono:"bi-trash3",color:"negative",visible:()=>e.permitirEliminar,accion:async({entidad:o})=>{u("Esta operaci\xF3n es irreversible. El archivo se eliminar\xE1 de forma instant\xE1nea.",()=>p(o))}},k={titulo:"Descargar",icono:"bi-download",color:"secondary",accion:({entidad:o})=>P(o.ruta)},r=n(),h=w.getInstance(),m=n(0),S=`${L.URL_BASE}/${h.getEndpoint(e.endpoint)}`,E=n(e.esObligatorio),$=n(!1);async function x(o){var s;const i=new FormData;i.append("file",o[0]);for(const a in d)i.append(a,d[a]);try{const a=await h.post(S,i);o.value=[],e.listarAlGuardar&&t.value.push(a.data.modelo),y(a.data.mensaje),E.value=e.esObligatorio}catch(a){console.log("error en el catch",a);const F=a;console.log(F),g((s=F.response)==null?void 0:s.data.message)}}async function D(o){try{d=o,r.value&&(r.value.upload(),r.value.reset(),r.value.removeUploadedFiles(),r.value.removeQueuedFiles())}catch(i){console.log(i)}}function _(o){c("El tama\xF1o total de los archivos no deben exceder los 10mb.")}function G(o){m.value+=B(o)}function O(o){m.value-=B(o)}function B(o){return o.reduce((s,a)=>s+a.size,0)}function U(){t.value=[]}return{listado:t,refGestor:r,extraerExtension:o=>o.split(".").at(-1),formatBytes:K,onFileAdded:G,onFileRemoved:O,quiero_subir_archivos:E,esConsultado:$,columnas:[...X,M],onRejected:_,btnEliminar:R,btnDescargar:k,factoryFn:x,subir:D,listarArchivos:j,limpiarListado:U,tamanioListado:m}}});const Z={class:"col-12 col-md-3 q-mb-lg"},ee={key:0,class:"col-12 q-mb-sm"},oe={key:1,class:"col-12 q-mb-sm"};function ae(e,t,p,v,y,g){const c=Q("essential-table");return l(),f(H,null,[A("div",Z,[t[1]||(t[1]=A("br",null,null,-1)),e.permitirSubir?(l(),T(z,{key:0,modelValue:e.quiero_subir_archivos,"onUpdate:modelValue":t[0]||(t[0]=u=>e.quiero_subir_archivos=u),label:"Quiero compartir archivos",disable:e.disable,"checked-icon":"bi-eye",color:"positive",outlined:"",dense:""},null,8,["modelValue","disable"])):b("",!0)]),e.quiero_subir_archivos?(l(),f("div",ee,[C(J,{ref:"refGestor",label:e.esMultiple?"Selecciona o arrastra tus archivos aqu\xED (M\xE1ximo 10mb)":"Selecciona o arrastra el archivo aqu\xED (M\xE1ximo 10mb)",multiple:e.esMultiple,style:{width:"100%"},flat:"",factory:e.factoryFn,class:"bg-header-collapse expansion",color:"white","text-color":"black","max-total-size":"10485760",onRejected:e.onRejected,onAdded:e.onFileAdded,onRemoved:e.onFileRemoved,"hide-upload-btn":""},null,8,["label","multiple","factory","onRejected","onAdded","onRemoved"])])):b("",!0),I(e.$slots,"boton-subir"),e.listado.length?(l(),f("div",oe,[C(c,{titulo:`Existen ${e.listado.length} archivos compartidos hasta el momento`,configuracionColumnas:e.columnas,datos:e.listado,"alto-fijo":!1,permitirConsultar:!1,permitirEditar:!1,permitirEliminar:!1,"mostrar-footer":!1,"mostrar-botones":!1,"permitir-buscar":!1,ajustarCeldas:"",accion1:e.btnDescargar},null,8,["titulo","configuracionColumnas","datos","accion1"])])):b("",!0)],64)}var ne=N(Y,[["render",ae]]);export{ne as G};
