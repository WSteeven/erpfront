var ne=Object.defineProperty;var se=(m,p,r)=>p in m?ne(m,p,{enumerable:!0,configurable:!0,writable:!0,value:r}):m[p]=r;var y=(m,p,r)=>(se(m,typeof p!="symbol"?p+"":p,r),r);import{bi as re,c as ce,U as de,e as ue,i as me,bp as pe,y as d,S,H as l,B as n,D as i,K as x,Y as e,z as u,I as M,J as V,M as _,O as fe,P as ge,G as k,aa as ve,Q as _e,L as F,F as Q,s as w,k as T,R as P,bA as C,q as be}from"./index.846478c1.js";import{Q as he,a as Ce}from"./QSelect.d8222f79.js";import{Q as D,a as I}from"./QItemSection.ca64420c.js";import{Q as ye}from"./QChip.697486c2.js";import{Q as N,a as O,C as A}from"./QPopupProxy.7844573b.js";import{a as Me}from"./QToolbar.2bb5adc4.js";import{Q as Ve}from"./QExpansionItem.a87f342e.js";import{M as $e}from"./ModalEntidad.5edc5f68.js";import{S as qe}from"./SolicitarFecha.333e91d1.js";import{E as ke}from"./EssentialTable.01bbad48.js";import{t as we}from"./vehiculos.utils.c31e027d.js";import{a as g,d as Ee,c as xe}from"./i18n-validators.06501904.js";import{u as R}from"./index.15c331c5.js";import{C as Fe,a as Qe}from"./ComponenteModal.domain.3bd8db1f.js";import{M as Pe,u as Ie,a as Be}from"./MultaConductorPage.0e380e81.js";import{E as Le}from"./entidadAuditable.75a46700.js";import{f as z}from"./index.209eea81.js";import{L as G,O as Ue,M as je}from"./utils.19b149f6.js";const H=[{name:"fecha_infraccion",field:"fecha_infraccion",label:"Fecha Infraccion",align:"left",sortable:!0},{name:"placa",field:"placa",label:"Placa",align:"left",sortable:!0,editable:!1},{name:"puntos",field:"puntos",label:"Puntos",align:"left",sortable:!0},{name:"total",field:"total",label:"T. a Pagar",align:"left",sortable:!0},{name:"estado",field:"estado",label:"Estado",align:"left",type:"toggle",sortable:!0},{name:"fecha_pago",field:"fecha_pago",label:"Fecha pago",align:"left",sortable:!0},{name:"comentario",field:"comentario",label:"Comentario",align:"left"}];class Se{constructor(){y(this,"MultaConductorPage");this.MultaConductorPage=re(new Fe("Multas",Pe))}}class Te extends Qe{constructor(){super(new Se)}}class De extends Le{constructor(){super();y(this,"tipo_licencia");y(this,"inicio_vigencia");y(this,"fin_vigencia");this.tipo_licencia=null,this.inicio_vigencia=null,this.fin_vigencia=null}}const Ne={class:"row q-col-gutter-sm q-pa-sm"},Oe={class:"col-12 col-md-3"},Ae={class:"col-12 col-md-12"},Re={class:"error-msg"},ze={class:"col-12 col-md-12 q-mt-lg"},Ge={class:"error-msg"},He={class:"col-12 col-md-8"},We={key:0,class:"col-12 col-md-12"},Ye={class:"col-2 col-md-2"},Je={class:"col-6 col-md-4"},Ke={class:"row items-center justify-end"},Xe={class:"error-msg"},Ze={class:"col-6 col-md-4"},ea={class:"row items-center justify-end"},aa={class:"error-msg"},oa={class:"col-12 col-md-12"},ia={key:1,class:"col-12 col-md-12"},la=ce({__name:"InformacionLicencia",props:{mixin:{type:Object,required:!0},conductor:{type:Object,required:!0},identificacion:{type:String,required:!1},consultarMultas:{type:Boolean,default:!0},validar:{type:Boolean,default:!1}},emits:["guardado"],setup(m,{emit:p}){const r=m,W=p,{disabled:$,accion:b}=r.mixin.useReferencias(),{setValidador:B}=r.mixin.useComportamiento(),{confirmar:Y,prompt:J}=de(),L=new Te,U=Ie(),s=r.conductor,E=ue(!1),h={fecha_pago:null,comentario:null};let q;me(()=>console.log("InformacionLicencia -> Montado")),pe(()=>{console.log("InformacionLicencia -> Desmontado"),q={tipo_licencia:{required:g(!1)},puntos:{required:g(!1)},licencias:{$each:z.forEach({tipo_licencia:{required:g(()=>!1)},inicio_vigencia:{required:g(()=>!1)},fin_vigencia:{required:g(()=>!1)}})}};const t=R(q,s);B(t.value)}),q={tipo_licencia:{required:g(()=>r.validar)},puntos:{required:g(()=>r.validar),maximo:Ee(30),minimo:xe(0)},licencias:{$each:z.forEach({tipo_licencia:{required:g(()=>r.validar)},inicio_vigencia:{required:g(()=>r.validar)},fin_vigencia:{required:g(()=>r.validar)}})}};const f=R(q,s);B(f.value);async function K(t){switch(t){case"MultaConductorPage":r.consultarMultas&&await j(),W("guardado","MultaConductorPage");break;default:console.log("No se recibio data")}}function X(t){s.licencias[t].fin_vigencia=G(Ue(s.licencias[t].inicio_vigencia,5),w),s.licencias[t].fin_vigencia=G(je(s.licencias[t].fin_vigencia,-1),w)}function Z(){r.identificacion?window.open(`https://consultaweb.ant.gob.ec/PortalWEB/paginas/clientes/clp_grid_citaciones.jsp?ps_tipo_identificacion=CED&ps_identificacion=${r.identificacion}&ps_placa=`,"_blank"):window.open("https://consultaweb.ant.gob.ec/PortalWEB/paginas/clientes/clp_criterio_consulta.jsp","_blank")}async function j(){const{result:t}=await new Be().listar({empleado_id:s.empleado});s.multas=t}async function ee(t){h.fecha_pago=t,await U.pagarMulta(h)&&await j()}function ae(t){console.log(t);const o=new De;o.tipo_licencia=t.value,s.licencias.push(o)}function oe(t){s.licencias.splice(t.index,1)}const ie={titulo:"Agregar multa",icono:"bi-file-text",color:"positive",tooltip:"Agregar multa asociado al conductor",accion:()=>{L.abrirModalEntidad("MultaConductorPage")},visible:()=>b.value==C.editar},le={titulo:"Editar",icono:"bi-pencil-square",color:"secondary",tooltip:"Editar",accion:({entidad:t})=>{Y("\xBFEst\xE1 seguro de marcar como pagada la multa?",async()=>{J({titulo:"Fecha de pago",mensaje:"\xBFTienes alguna observaci\xF3n al respecto?",validacion:a=>a!=null,accion:async a=>{U.idMulta=t.id,h.comentario=a,h.fecha_pago==null&&(E.value=!0)}})}),h.comentario=null,h.fecha_pago=null},visible:({entidad:t})=>(b.value==C.nuevo||b.value==C.editar)&&!t.estado};return(t,o)=>(d(),S(Ve,{class:"overflow-hidden q-mb-md expansion",label:"Informaci\xF3n de Licencia","header-class":"text-bold bg-header-collapse","default-opened":""},{default:l(()=>[n("div",Ne,[n("div",Oe,[n("div",Ae,[o[4]||(o[4]=n("label",{class:"q-mb-sm block"},"Puntos",-1)),i(x,{modelValue:e(s).puntos,"onUpdate:modelValue":o[0]||(o[0]=a=>e(s).puntos=a),type:"number",step:".5",disable:e($),error:!!e(f).puntos.$errors.length,hint:"Todo conductor debe tener un puntaje mayor o igual a 20 pts","error-message":"Debe ingresar un valor entre 0 y 30",onBlur:e(f).puntos.$touch,outlined:"",dense:""},{error:l(()=>[(d(!0),u(M,null,V(e(f).puntos.$errors,a=>(d(),u("div",{key:a.$uid},[n("div",Re,_(a.$message),1)]))),128))]),_:1},8,["modelValue","disable","error","onBlur"])]),n("div",ze,[o[6]||(o[6]=n("label",{class:"q-mb-sm block"},"Tipo de Licencia",-1)),i(he,{modelValue:e(s).tipo_licencia,"onUpdate:modelValue":o[1]||(o[1]=a=>e(s).tipo_licencia=a),options:e(we),"transition-show":"jump-up","transition-hide":"jump-down",hint:"Obligatorio",disable:e($),"options-dense":"",dense:"",outlined:"","use-chips":"",multiple:"",error:!!e(f).tipo_licencia.$errors.length,"error-message":"Debes seleccionar un tipo de licencia",onAdd:ae,onRemove:oe,"option-value":a=>a.value,"option-label":a=>a.label,"emit-value":"","map-options":""},{option:l(({itemProps:a,opt:v,selected:c,toggleOption:te})=>[i(D,fe(ge(a)),{default:l(()=>[i(I,null,{default:l(()=>[i(Ce,null,{default:l(()=>[n("strong",null,_(v.label),1),k(" - "+_(v.caption),1)]),_:2},1024)]),_:2},1024),i(I,{side:""},{default:l(()=>[i(ve,{"model-value":c,"onUpdate:modelValue":ta=>te(v)},null,8,["model-value","onUpdate:modelValue"])]),_:2},1024)]),_:2},1040)]),error:l(()=>[(d(!0),u(M,null,V(e(f).tipo_licencia.$errors,a=>(d(),u("div",{key:a.$uid},[n("div",Ge,_(a.$message),1)]))),128))]),"no-option":l(()=>[i(D,null,{default:l(()=>[i(I,{class:"text-grey"},{default:l(()=>o[5]||(o[5]=[k(" No hay resultados ")])),_:1})]),_:1})]),_:1},8,["modelValue","options","disable","error","option-value","option-label"])])]),e(s).licencias!==void 0?(d(),S(_e,{key:0,class:"q-mx-sm block",vertical:""})):F("",!0),n("div",He,[e(s).licencias!==void 0?(d(),u("div",We,[(d(!0),u(M,null,V(e(s).licencias,(a,v)=>(d(),u("div",{class:"row q-col-gutter-sm",key:a.tipo_licencia},[n("div",Ye,[o[7]||(o[7]=n("label",{class:"q-mb-sm block"},"Tipo",-1)),i(ye,null,{default:l(()=>[k(_(a.tipo_licencia),1)]),_:2},1024)]),n("div",Je,[o[8]||(o[8]=n("label",{class:"q-mb-sm block"},"Fecha Inicial Vigencia",-1)),i(x,{modelValue:a.inicio_vigencia,"onUpdate:modelValue":c=>a.inicio_vigencia=c,placeholder:"Obligatorio",disable:e($),error:!!e(f).licencias.$each.$response.$errors[v].inicio_vigencia.length,outlined:"",dense:""},{append:l(()=>[i(Q,{name:"event",class:"cursor-pointer"},{default:l(()=>[i(N,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:l(()=>[i(O,{modelValue:a.inicio_vigencia,"onUpdate:modelValue":[c=>a.inicio_vigencia=c,c=>X(v)],mask:e(w),"today-btn":""},{default:l(()=>[n("div",Ke,[T(i(P,{label:"Cerrar",color:"primary",flat:""},null,512),[[A]])])]),_:2},1032,["modelValue","onUpdate:modelValue","mask"])]),_:2},1024)]),_:2},1024)]),error:l(()=>[(d(!0),u(M,null,V(e(f).licencias.$each.$response.$errors[v].inicio_vigencia,c=>(d(),u("div",{key:c.$uid},[n("div",Xe,_(c.$message),1)]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","disable","error"])]),n("div",Ze,[o[9]||(o[9]=n("label",{class:"q-mb-sm block"},"Fecha Final Vigencia",-1)),i(x,{modelValue:a.fin_vigencia,"onUpdate:modelValue":c=>a.fin_vigencia=c,placeholder:"Obligatorio",error:!!e(f).licencias.$each.$response.$errors[v].fin_vigencia.length,disable:e($),outlined:"",dense:""},{append:l(()=>[i(Q,{name:"event",class:"cursor-pointer"},{default:l(()=>[i(N,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:l(()=>[i(O,{modelValue:a.fin_vigencia,"onUpdate:modelValue":c=>a.fin_vigencia=c,mask:e(w),"today-btn":""},{default:l(()=>[n("div",ea,[T(i(P,{label:"Cerrar",color:"primary",flat:""},null,512),[[A]])])]),_:2},1032,["modelValue","onUpdate:modelValue","mask"])]),_:2},1024)]),_:2},1024)]),error:l(()=>[(d(!0),u(M,null,V(e(f).licencias.$each.$response.$errors[v].fin_vigencia,c=>(d(),u("div",{key:c.$uid},[n("div",aa,_(c.$message),1)]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","error","disable"])])]))),128))])):F("",!0)]),n("div",oa,[i(P,{color:"primary",dense:"",rounded:"","no-caps":"","no-wrap":"",unelevated:"",class:"q-px-sm",onClick:Z},{default:l(()=>[i(Q,{name:"bi-search",size:"xs",class:"q-mr-xs"}),o[11]||(o[11]=n("span",null,"Consultar multas ",-1)),i(Me,null,{default:l(()=>o[10]||(o[10]=[k("Consultar puntos y vigencia de licencia del chofer")])),_:1})]),_:1})]),e(b)==e(C).editar||e(b)==e(C).consultar?(d(),u("div",ia,[i(ke,{ref:"refMultas",titulo:"Multas del Conductor",configuracionColumnas:e(b)==e(C).editar?[...e(H),e(be)]:e(H),datos:e(s).multas,accion1Header:ie,permitirBuscar:!1,permitirConsultar:!1,permitirEditar:!1,permitirEliminar:!1,mostrarBotones:!1,mostrarCantidadElementos:!1,permitirEditarModal:!0,modalMaximized:!1,"alto-fijo":!1,ajustarCeldas:"",mostrarFooter:!1,accion1:le},null,8,["configuracionColumnas","datos"])])):F("",!0)]),i(qe,{mostrar:E.value,reason:"mask",label:"Fecha de pago",confirmar:ee,onCerrar:o[2]||(o[2]=a=>E.value=!1)},null,8,["mostrar"]),i($e,{comportamiento:e(L),persistente:!1,onGuardado:o[3]||(o[3]=a=>K(a))},null,8,["comportamiento"])]),_:1}))}});var qa=la;export{Te as C,qa as I,H as c};
