var eo=Object.defineProperty;var so=(o,e,n)=>e in o?eo(o,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):o[e]=n;var S=(o,e,n)=>(so(o,typeof e!="symbol"?e+"":e,n),n);import{bz as O,t as w,c as ao,be as ro,p as I,u as lo,U as to,e as y,a1 as io,E as L,dr as no,A as uo,bH as U,v as po,y as i,S as R,H as r,D as a,bf as mo,bg as N,B as c,z as u,I as q,J as z,M as $,G as v,L as b,a9 as co,N as B,Q as fo,c8 as vo,R as k,F as V}from"./index.846478c1.js";import{Q as T,a as F}from"./QItemSection.ca64420c.js";import{Q as j}from"./QSelect.d8222f79.js";import{Q as bo}from"./QChip.697486c2.js";import{Q as go}from"./QPage.b0adedad.js";import{T as yo}from"./TabLayout.b05b8b79.js";import{u as Co}from"./index.15c331c5.js";import{C as _o}from"./ContenedorSimpleMixin.1a882cca.js";import{u as wo,V as So,A as D,i as $o,n as ko}from"./utils.19b149f6.js";import{E as Vo}from"./entidadAuditable.75a46700.js";import"./QMenu.c0bc1e4b.js";import"./position-engine.456d5331.js";import"./format.8ac60962.js";import"./QTabs.19bbf6a5.js";import"./QResizeObserver.847ee253.js";import"./QTabPanels.ca44a1cd.js";import"./use-panel.27349585.js";import"./touch.9135741d.js";import"./QPopupProxy.7844573b.js";import"./buttonSubmits.31738227.js";import"./EssentialTable.01bbad48.js";import"./QFile.c3222262.js";import"./QTable.d5868e69.js";import"./use-fullscreen.18eeae01.js";import"./QToolbar.2bb5adc4.js";import"./QBtnGroup.b7cc3fd9.js";import"./QBadge.60ffdb76.js";import"./_commonjsHelpers.8402d862.js";import"./QImg.e43b947c.js";import"./VisorImagen.93b8e0f6.js";import"./seleccionContratacionPersonal.utils.e3e1ed3d.js";import"./ErrorComponent.eba095ef.js";import"./i18n-validators.06501904.js";import"./index.209eea81.js";import"./EssentialTablePagination.3349ebcb.js";class Qo extends Vo{constructor(){super();S(this,"usuario");S(this,"saldo_anterior");this.usuario=null,this.saldo_anterior=0}}class Ao extends O{constructor(){super(w.reporte_saldo_actual_pdf)}}class Eo extends O{constructor(){super(w.cortar_saldo)}}var Io=ao({components:{TabLayout:yo},setup(){ro().setQuasar(I()),wo().setQuasar(I());const o=lo(),e=to(),n=new _o(Qo,new Ao),C=y(!1),{entidad:d,disabled:Q,accion:s,listadosAuxiliares:f}=n.useReferencias(),{setValidador:P,obtenerListados:H,cargarVista:M}=n.useComportamiento(),G=io(),A=Co({usuario:{required:!0,minLength:3,maxLength:50}},d);P(A.value);const g=y(),_=y(),J=y("false"),K=y("false");M(async()=>{await H({usuarios:{controller:new L,params:{estado:1}},usuariosInactivos:{controller:new L,params:{estado:0}}}),g.value=So(f.usuarios),f.usuarios=g.value,_.value=f.usuariosInactivos});function W(l,t){if(l===""){t(()=>{g.value=f.usuarios});return}t(()=>{const p=l.toLowerCase();g.value=f.usuarios.filter(m=>m.nombres.toLowerCase().indexOf(p)>-1||m.apellidos.toLowerCase().indexOf(p)>-1)})}function X(l,t){if(l===""){t(()=>{_.value=f.usuariosInactivos});return}t(()=>{const p=l.toLowerCase();_.value=f.usuariosInactivos.filter(m=>m.nombres.toLowerCase().indexOf(p)>-1||m.apellidos.toLowerCase().indexOf(p)>-1)})}function Y(){d.usuario=null}async function Z(l,t){const p=uo.getInstance(),m="reporte_saldo_actual"+new Date().getTime();switch(t){case"excel":const h=U.URL_BASE+"/"+p.getEndpoint(w.reporte_saldo_actual_excel);D(h,"POST","blob","xlsx",m,l);break;case"pdf":const oo=U.URL_BASE+"/"+p.getEndpoint(w.reporte_saldo_actual_pdf);D(oo,"POST","blob","pdf",m,l);break}}o.can("puede.buscar.saldo.usuarios")==!1&&(d.usuario=o.user.id,C.value=!0,E());async function E(){const l=new no;if(d.usuario){const{response:t}=await l.consultar(d.usuario);C.value=!0,d.saldo_anterior=t.data.saldo_actual}}async function x(){try{await new Eo().listar(),G.push("acreditacion-semana")}catch(l){if($o(l)){const t=l.erroresValidacion;await ko(t,e)}}}return{mixin:n,store:o,reporte_saldo_actual:d,cortar_saldo:x,saldoAnterior:E,disabled:Q,accion:s,v$:A,usuarios:g,usuariosInactivos:_,is_all_users:J,is_inactivo:K,mostrarUsuarios:Y,generar_reporte:Z,filtrarUsuarios:W,filtrarUsuariosInactivos:X,visualizar_saldo_usuario:C}}});const Lo={key:0,class:"col-12 col-md-3"},Uo={class:"error-msg"},Ro={key:1,class:"col-12 col-md-3"},No={class:"error-msg"},qo={key:2,class:"col-12 col-md-3"},zo={key:3,class:"col-12 col-md-3"},Bo={key:4,class:"col-12 col-md-3"};function To(o,e,n,C,d,Q){return i(),R(go,{class:"flex flex-center"},{default:r(()=>[a(mo,{flat:"",bordered:"",class:"my-card bg-grey-1"},{default:r(()=>[a(N,null,{default:r(()=>e[10]||(e[10]=[c("div",{class:"row items-center no-wrap"},[c("div",{class:"col"},[c("div",{class:"text-h6"},"Generar Reporte Saldo Actual")])],-1)])),_:1}),a(N,null,{default:r(()=>[o.is_all_users=="false"&&o.store.can("puede.buscar.saldo.usuarios")&&o.is_inactivo=="false"?(i(),u("div",Lo,[e[12]||(e[12]=c("label",{class:"q-mb-sm block"},"Empleado",-1)),a(j,{modelValue:o.reporte_saldo_actual.usuario,"onUpdate:modelValue":[e[0]||(e[0]=s=>o.reporte_saldo_actual.usuario=s),e[1]||(e[1]=s=>o.saldoAnterior())],options:o.usuarios,"transition-show":"jump-up","transition-hide":"jump-down","options-dense":"",dense:"",outlined:"",disable:o.disabled,readonly:o.disabled,error:!!o.v$.usuario.$errors.length,"error-message":"Debes seleccionar un empleado","use-input":"","input-debounce":"0",onFilter:o.filtrarUsuarios,"option-value":s=>s.id,"option-label":s=>s.nombres+" "+s.apellidos,"emit-value":"","map-options":""},{error:r(()=>[(i(!0),u(q,null,z(o.v$.usuario.$errors,s=>(i(),u("div",{key:s.$uid},[c("div",Uo,$(s.$message),1)]))),128))]),"no-option":r(()=>[a(T,null,{default:r(()=>[a(F,{class:"text-grey"},{default:r(()=>e[11]||(e[11]=[v(" No hay resultados ")])),_:1})]),_:1})]),_:1},8,["modelValue","options","disable","readonly","error","onFilter","option-value","option-label"])])):b("",!0),o.is_all_users=="false"&&o.store.can("puede.buscar.saldo.usuarios")&&o.is_inactivo=="true"?(i(),u("div",Ro,[e[14]||(e[14]=c("label",{class:"q-mb-sm block"},"Empleado",-1)),a(j,{modelValue:o.reporte_saldo_actual.usuario,"onUpdate:modelValue":[e[2]||(e[2]=s=>o.reporte_saldo_actual.usuario=s),e[3]||(e[3]=s=>o.saldoAnterior())],options:o.usuariosInactivos,"transition-show":"jump-up","transition-hide":"jump-down","options-dense":"",dense:"",outlined:"",disable:o.disabled,readonly:o.disabled,error:!!o.v$.usuario.$errors.length,"error-message":"Debes seleccionar un empleado","use-input":"","input-debounce":"0",onFilter:o.filtrarUsuariosInactivos,"option-value":s=>s.id,"option-label":s=>s.nombres+" "+s.apellidos,"emit-value":"","map-options":""},{error:r(()=>[(i(!0),u(q,null,z(o.v$.usuario.$errors,s=>(i(),u("div",{key:s.$uid},[c("div",No,$(s.$message),1)]))),128))]),"no-option":r(()=>[a(T,null,{default:r(()=>[a(F,{class:"text-grey"},{default:r(()=>e[13]||(e[13]=[v(" No hay resultados ")])),_:1})]),_:1})]),_:1},8,["modelValue","options","disable","readonly","error","onFilter","option-value","option-label"])])):b("",!0),o.visualizar_saldo_usuario==!0&&o.is_all_users=="false"?(i(),u("div",qo,[e[15]||(e[15]=c("label",{class:"q-mb-sm block"},"Saldo:",-1)),a(bo,{square:""},{default:r(()=>[a(co,{icon:"bi-currency-dollar",color:"green","text-color":"white"}),v(" "+$(o.reporte_saldo_actual.saldo_anterior),1)]),_:1})])):b("",!0),o.store.can("puede.buscar.saldo.usuarios")?(i(),u("div",zo,[a(B,{modelValue:o.is_all_users,"onUpdate:modelValue":[e[4]||(e[4]=s=>o.is_all_users=s),e[5]||(e[5]=s=>o.mostrarUsuarios())],color:"secondary",label:"Todos los empleados","true-value":"true","false-value":"false"},null,8,["modelValue"])])):b("",!0),o.store.can("puede.buscar.saldo.usuarios")?(i(),u("div",Bo,[a(B,{modelValue:o.is_inactivo,"onUpdate:modelValue":e[6]||(e[6]=s=>o.is_inactivo=s),color:"secondary",label:"Inactivo","true-value":"true","false-value":"false"},null,8,["modelValue"])])):b("",!0)]),_:1}),a(fo),a(vo,{align:"around"},{default:r(()=>[a(k,{color:"positive",onClick:e[7]||(e[7]=s=>o.generar_reporte(o.reporte_saldo_actual,"excel"))},{default:r(()=>[a(V,{name:"bi-file-earmark-excel-fill",size:"xs",class:"q-mr-sm"}),e[16]||(e[16]=v("Excel"))]),_:1}),a(k,{color:"negative",onClick:e[8]||(e[8]=s=>o.generar_reporte(o.reporte_saldo_actual,"pdf"))},{default:r(()=>[a(V,{name:"bi-file-earmark-pdf-fill",size:"xs",class:"q-mr-sm"}),e[17]||(e[17]=v("PDF"))]),_:1}),o.store.can("puede.ver.acreditacion_semana")?(i(),R(k,{key:0,color:"warning",onClick:e[9]||(e[9]=s=>o.cortar_saldo())},{default:r(()=>[a(V,{name:"bi-scissors",size:"xs",class:"q-mr-sm"}),e[18]||(e[18]=v("Cortar Saldo "))]),_:1})):b("",!0)]),_:1})]),_:1})]),_:1})}var we=po(Io,[["render",To]]);export{we as default};
