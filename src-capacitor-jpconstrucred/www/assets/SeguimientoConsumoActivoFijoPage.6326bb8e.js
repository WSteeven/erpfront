var lo=Object.defineProperty;var ro=(o,e,s)=>e in o?lo(o,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):o[e]=s;var R=(o,e,s)=>(ro(o,typeof e!="symbol"?e+"":e,s),s);import{a as uo,Q as mo}from"./QTabs.19bbf6a5.js";import{a as co,Q as po}from"./QTabPanels.ca44a1cd.js";import{Q as vo}from"./QPage.b0adedad.js";import{bz as H,t as Y,c as K,u as W,f as go,e as _,a3 as bo,dc as D,v as X,x as w,y as n,S as Z,H as l,B as u,M as F,D as t,G as T,z as r,L as c,K as z,I as j,J as N,bi as fo,U as Co,q as So,a6 as J}from"./index.846478c1.js";import{E as Ao}from"./EssentialTable.01bbad48.js";import{M as Fo}from"./ModalEntidad.5edc5f68.js";import{S as Mo}from"./SolicitarArchivo.183a613d.js";import{C as $o,a as jo}from"./ComponenteModal.domain.3bd8db1f.js";import{Q as h,a as q}from"./QItemSection.ca64420c.js";import{Q as M}from"./QSelect.d8222f79.js";import{r as $,h as _o}from"./i18n-validators.06501904.js";import{u as ko}from"./index.15c331c5.js";import{S as yo}from"./SimpleLayout.8d9b09cb.js";import{F as Vo,u as Eo}from"./FiltroMiBodegaEmpleado.0f616ef0.js";import{S as x,a as Uo}from"./SeguimientoConsumoActivoFijoController.e866f104.js";import{u as Oo}from"./filtrosListadosGenerales.c330183b.js";import{s as No,v as wo}from"./utils.19b149f6.js";import{A as Io}from"./ArchivoController.689a40cd.js";import{C as To}from"./ContenedorSimpleMixin.1a882cca.js";import"./QResizeObserver.847ee253.js";import"./use-panel.27349585.js";import"./touch.9135741d.js";import"./position-engine.456d5331.js";import"./QPopupProxy.7844573b.js";import"./format.8ac60962.js";import"./QMenu.c0bc1e4b.js";import"./QFile.c3222262.js";import"./QChip.697486c2.js";import"./QTable.d5868e69.js";import"./use-fullscreen.18eeae01.js";import"./QToolbar.2bb5adc4.js";import"./QBtnGroup.b7cc3fd9.js";import"./QBadge.60ffdb76.js";import"./_commonjsHelpers.8402d862.js";import"./QImg.e43b947c.js";import"./VisorImagen.93b8e0f6.js";import"./seleccionContratacionPersonal.utils.e3e1ed3d.js";import"./ErrorComponent.eba095ef.js";import"./configuracion_general.cac1c388.js";import"./ConfiguracionController.1234694f.js";import"./GestorArchivos.33ade07b.js";import"./QUploader.c061fd0f.js";import"./QCircularProgress.b5ba4a87.js";import"./configuracionColumnasArchivoSubtarea.215f4ffd.js";import"./index.209eea81.js";import"./buttonSubmits.31738227.js";import"./ClienteMaterialEmpleadoController.24905e1f.js";import"./listadoMaterialesDevolucion.71dfd77c.js";import"./entidadAuditable.75a46700.js";const zo=[{name:"created_at",field:"created_at",label:"Fecha y hora de registro",align:"left",sortable:!0},{name:"cantidad_utilizada",field:"cantidad_utilizada",label:"Cantidad utilizada",align:"left",sortable:!0},{name:"detalle_producto",field:"detalle_producto",label:"Detalle de producto",align:"left",sortable:!0},{name:"serie",field:"serie",label:"Serie",align:"left",sortable:!0},{name:"canton",field:"canton",label:"Cant\xF3n",align:"left",sortable:!0},{name:"categoria_motivo_consumo",field:"categoria_motivo_consumo",label:"Categor\xEDa motivo consumo",align:"left",sortable:!0},{name:"motivo_consumo",field:"motivo_consumo",label:"Motivo de consumo",align:"left",sortable:!0},{name:"se_reporto_sicosep",field:"se_reporto_sicosep",label:"Se report\xF3 sicosep",align:"left",sortable:!0},{name:"observacion",field:"observacion",label:"Observaci\xF3n",align:"left",sortable:!0}];class ho extends H{constructor(){super(Y.categorias_motivos_consumo_activos_fijos)}}class qo extends H{constructor(){super(Y.motivos_consumo_activos_fijos)}}var Bo=K({components:{SimpleLayout:yo},props:{mixinModal:{type:Object,required:!0}},setup(o){const e=W(),{entidad:s,listado:b,listadosAuxiliares:f}=o.mixinModal.useReferencias(),{listar:C,cargarVista:m,obtenerListados:i,setValidador:p}=o.mixinModal.useComportamiento(),{onBeforeGuardar:d,onBeforeModificar:k}=o.mixinModal.useHooks(),g=go(new Vo),S=_(0),y=_(0),A=_(!1),V=(()=>{switch("JPCONSTRUCRED"){case D.JPCONSTRUCRED:return"Seleccione un cliente";case D.JPCUSTODY:return"Cliente"}})();m(async()=>{await i({categoriasMotivosConsumoActivosFijos:new ho,motivosConsumoActivosFijos:new qo,cantones:JSON.parse(bo.getItem("cantones").toString())})});const{categoriasMotivosConsumoActivosFijos:I,filtrarCategoriasMotivosConsumoActivosFijos:E,motivosConsumoActivosFijos:U,filtrarMotivosConsumoActivosFijos:oo,cantones:eo,filtrarCantones:io}=Oo(f),{clientesMaterialesStock:O,consultarClientesMaterialesStock:to,consultarActivosFijosAsignados:B,activosFijosAsignados:P}=Eo(g),Q=v=>{g.cliente_id=v,B()},ao=v=>{const G=P.value.find(no=>no.detalle_producto_id===v);S.value=G?G.stock_actual:0},so={cantidad_utilizada:{required:$,maxima:_o.withMessage("La cantidad utilizada no puede ser mayor a la cantidad en stock actual",v=>v<=S.value)},categoria_motivo_consumo:{required:$},motivo_consumo:{required:$},cliente:{required:$},canton:{required:$}},L=ko(so,s);return p(L.value),d(()=>s.cantidad_anterior=y.value),k(()=>s.cantidad_anterior=y.value),g.empleado_id=e.user.id,s.hydrate(new x),s.cliente=void 0,to().then(()=>{O.value=O.value.filter(v=>!!v.cliente_id),A.value=O.value.length==1,A.value&&(s.cliente=1,Q(s.cliente))}),{v$:L,seguimiento:s,clientesMaterialesStock:O,activosFijosAsignados:P,obtenerActivosFijoPorCliente:Q,consultarActivosFijosAsignados:B,filtro:g,seleccionarActivoFijo:ao,stockActual:S,categoriasMotivosConsumoActivosFijos:I,filtrarCategoriasMotivosConsumoActivosFijos:E,motivosConsumoActivosFijos:U,filtrarMotivosConsumoActivosFijos:oo,cantones:eo,filtrarCantones:io,ordenarLista:No,labelCliente:V,deshabilitadoCliente:A}}});const Po={class:"row q-col-gutter-sm q-pa-md"},Qo={class:"col-12 col-md-3"},Lo={class:"q-mb-sm block"},Go={key:0,class:"col-12 col-md-9"},Ro={key:1,class:"col-12 col-md-3"},Do={key:2,class:"col-12 col-md-3"},Jo={key:3,class:"col-12 col-md-3 col-sm-3"},Ho={class:"error-msg"},Yo={key:4,class:"col-12 col-md-3"},Ko={class:"error-msg"},Wo={key:5,class:"col-12 col-md-3"},Xo={class:"error-msg"},Zo={key:6,class:"col-12 col-md-3"};function xo(o,e,s,b,f,C){const m=w("simple-layout");return n(),Z(m,{mixin:o.mixinModal},{formulario:l(()=>[u("div",Po,[u("div",Qo,[u("label",Lo,F(o.labelCliente),1),t(M,{modelValue:o.seguimiento.cliente,"onUpdate:modelValue":[e[0]||(e[0]=i=>o.seguimiento.cliente=i),e[1]||(e[1]=i=>o.obtenerActivosFijoPorCliente(o.seguimiento.cliente))],options:o.clientesMaterialesStock,"transition-show":"scale","transition-hide":"scale","options-dense":"",dense:"",outlined:"",disable:o.deshabilitadoCliente,"option-label":i=>i.razon_social,"option-value":i=>i.cliente_id,"emit-value":"","map-options":""},{"no-option":l(()=>[t(h,null,{default:l(()=>[t(q,{class:"text-grey"},{default:l(()=>e[12]||(e[12]=[T(" No hay activos fijos asignados o el stock de los activos est\xE1 en cero ")])),_:1})]),_:1})]),_:1},8,["modelValue","options","disable","option-label","option-value"])]),o.seguimiento.cliente?(n(),r("div",Go,[e[14]||(e[14]=u("label",{class:"q-mb-sm block"},"Seleccione un activo fijo",-1)),t(M,{modelValue:o.seguimiento.detalle_producto,"onUpdate:modelValue":[e[2]||(e[2]=i=>o.seguimiento.detalle_producto=i),e[3]||(e[3]=i=>o.seleccionarActivoFijo(o.seguimiento.detalle_producto))],options:o.activosFijosAsignados,"transition-show":"scale","transition-hide":"scale","options-dense":"",dense:"",outlined:"","option-label":i=>i.detalle_producto+" | "+i.serial,"option-value":i=>i.detalle_producto_id,"emit-value":"","map-options":""},{"no-option":l(()=>[t(h,null,{default:l(()=>[t(q,{class:"text-grey"},{default:l(()=>e[13]||(e[13]=[T(" No hay activos fijos asignados o el stock de los activos est\xE1 en cero ")])),_:1})]),_:1})]),_:1},8,["modelValue","options","option-label","option-value"])])):c("",!0),o.seguimiento.detalle_producto?(n(),r("div",Ro,[e[15]||(e[15]=u("label",{class:"q-mb-sm block"},"Stock actual",-1)),t(z,{modelValue:o.stockActual,"onUpdate:modelValue":e[4]||(e[4]=i=>o.stockActual=i),outlined:"",disable:"",dense:""},null,8,["modelValue"])])):c("",!0),o.seguimiento.detalle_producto?(n(),r("div",Do,[e[16]||(e[16]=u("label",{class:"q-mb-sm block"},"Cantidad a utilizar",-1)),t(z,{modelValue:o.seguimiento.cantidad_utilizada,"onUpdate:modelValue":e[5]||(e[5]=i=>o.seguimiento.cantidad_utilizada=i),type:"number",outlined:"",dense:"",error:!!o.v$.cantidad_utilizada.$errors.length,onBlur:o.v$.cantidad_utilizada.$touch},{error:l(()=>[(n(!0),r(j,null,N(o.v$.cantidad_utilizada.$errors,i=>(n(),r("div",{key:i.$uid},[u("div",null,F(i.$message),1)]))),128))]),_:1},8,["modelValue","error","onBlur"])])):c("",!0),o.seguimiento.detalle_producto?(n(),r("div",Jo,[e[18]||(e[18]=u("label",{class:"q-mb-sm block"},"Canton",-1)),t(M,{modelValue:o.seguimiento.canton,"onUpdate:modelValue":e[6]||(e[6]=i=>o.seguimiento.canton=i),options:o.cantones,"transition-show":"jump-up","transition-hide":"jump-down","options-dense":"",dense:"",outlined:"","input-debounce":0,"use-input":"",onFilter:o.filtrarCantones,onPopupShow:e[7]||(e[7]=i=>o.ordenarLista(o.cantones,"canton")),"option-value":i=>i.id,"option-label":i=>i.canton,"emit-value":"","map-options":"",error:!!o.v$.canton.$errors.length,onBlur:o.v$.canton.$touch},{error:l(()=>[(n(!0),r(j,null,N(o.v$.canton.$errors,i=>(n(),r("div",{key:i.$uid},[u("div",Ho,F(i.$message),1)]))),128))]),"no-option":l(()=>[t(h,null,{default:l(()=>[t(q,{class:"text-grey"},{default:l(()=>e[17]||(e[17]=[T(" No hay resultados ")])),_:1})]),_:1})]),_:1},8,["modelValue","options","onFilter","option-value","option-label","error","onBlur"])])):c("",!0),o.seguimiento.detalle_producto?(n(),r("div",Yo,[e[19]||(e[19]=u("label",{class:"q-mb-sm block"},"Categoria de motivo consumo de activo fijo",-1)),t(M,{modelValue:o.seguimiento.categoria_motivo_consumo,"onUpdate:modelValue":[e[8]||(e[8]=i=>o.seguimiento.categoria_motivo_consumo=i),e[9]||(e[9]=i=>o.seleccionarActivoFijo(o.seguimiento.detalle_producto))],options:o.categoriasMotivosConsumoActivosFijos,onFilter:o.filtrarCategoriasMotivosConsumoActivosFijos,"transition-show":"scale","transition-hide":"scale","options-dense":"",dense:"",outlined:"","option-label":i=>i.nombre,"option-value":i=>i.id,"use-input":"","input-debounce":"0","emit-value":"","map-options":"",error:!!o.v$.categoria_motivo_consumo.$errors.length,onBlur:o.v$.categoria_motivo_consumo.$touch},{error:l(()=>[(n(!0),r(j,null,N(o.v$.categoria_motivo_consumo.$errors,i=>(n(),r("div",{key:i.$uid},[u("div",Ko,F(i.$message),1)]))),128))]),_:1},8,["modelValue","options","onFilter","option-label","option-value","error","onBlur"])])):c("",!0),o.seguimiento.detalle_producto?(n(),r("div",Wo,[e[20]||(e[20]=u("label",{class:"q-mb-sm block"},"Motivo consumo de activo fijo",-1)),t(M,{modelValue:o.seguimiento.motivo_consumo,"onUpdate:modelValue":e[10]||(e[10]=i=>o.seguimiento.motivo_consumo=i),options:o.motivosConsumoActivosFijos,onFilter:o.filtrarMotivosConsumoActivosFijos,"transition-show":"scale","transition-hide":"scale","options-dense":"",dense:"",outlined:"","option-label":i=>i.nombre,"option-value":i=>i.id,"use-input":"","input-debounce":"0","emit-value":"","map-options":"",error:!!o.v$.motivo_consumo.$errors.length,onBlur:o.v$.motivo_consumo.$touch},{error:l(()=>[(n(!0),r(j,null,N(o.v$.motivo_consumo.$errors,i=>(n(),r("div",{key:i.$uid},[u("div",Xo,F(i.$message),1)]))),128))]),_:1},8,["modelValue","options","onFilter","option-label","option-value","error","onBlur"])])):c("",!0),o.seguimiento.detalle_producto?(n(),r("div",Zo,[e[21]||(e[21]=u("label",{class:"q-mb-sm block"},"Observaci\xF3n",-1)),t(z,{modelValue:o.seguimiento.observacion,"onUpdate:modelValue":e[11]||(e[11]=i=>o.seguimiento.observacion=i),outlined:"",dense:""},null,8,["modelValue"])])):c("",!0)])]),_:1},8,["mixin"])}var oe=X(Bo,[["render",xo]]);class ee{constructor(){R(this,"AgregarSeguimientoConsumoActivoFijoPage");this.AgregarSeguimientoConsumoActivoFijoPage=fo(new $o("Agregar seguimiento consumo activo fijo",oe))}}class ie extends jo{constructor(){super(new ee)}}var te=K({components:{EssentialTable:Ao,ModalEntidad:Fo,SolicitarArchivo:Mo},setup(){const o=W(),e={SEGUIMIENTO_CONSUMO:"Seguimiento de consumo",HISTORIAL_SEGUIMIENTO:"Historial del seguimiento de consumo"},s=_(e.SEGUIMIENTO_CONSUMO),b=new ie,{prompt:f}=Co(),C=_(!1),m=new To(x,new Uo,new Io),{entidad:i,listado:p}=m.useReferencias(),{listar:d,editarParcial:k}=m.useComportamiento(),g={titulo:"Agregar seguimiento",icono:"bi-plus",color:"primary",accion:()=>b.abrirModalEntidad("AgregarSeguimientoConsumoActivoFijoPage")},S={titulo:"Editar cantidad",icono:"bi-pencil",color:"primary",visible:({entidad:a})=>wo("YYYY-MM-DD")===a.created_at.split(" ")[0],accion:async({entidad:a,posicion:V})=>{const I={titulo:"Editar cantidad",mensaje:"Ingresa la cantidad",tipo:"number",defecto:p.value[V].cantidad_utilizada,accion:async E=>{var U;i.hydrate(a),await k(a.id,{detalle_producto_id:a.detalle_producto_id,cliente_id:a.cliente_id,cantidad_anterior:(U=a.cantidad_utilizada)!=null?U:0,cantidad_utilizada:E}),p.value[V].cantidad_utilizada=E}};f(I)}},y={titulo:"Justificativo uso",icono:"bi-upload",color:"blue-grey",accion:async({entidad:a})=>{i.hydrate(a),C.value=!0}},A={titulo:({entidad:a})=>a.se_reporto_sicosep?"No se report\xF3 Sicosep":"Se report\xF3 Sicosep",icono:({entidad:a})=>a.se_reporto_sicosep?"bi-toggle2-on":"bi-toggle2-off",color:({entidad:a})=>a.se_reporto_sicosep?"negative":"positive",accion:({entidad:a})=>k(a.id,{se_reporto_sicosep:!a.se_reporto_sicosep})};return d({empleado_id:o.user.id}),{tab:s,listado:p,mixin:m,opcionesSeguimientoConsumo:e,configuracionColumnasSeguimientoConsumoActivoFijo:zo,accionesTabla:So,btnAgregar:g,btnEditar:S,btnJustificativoUso:y,btnSeReportoSicosep:A,modales:b,mostrarSolicitarArchivo:C,seguimiento:i}}});function ae(o,e,s,b,f,C){const m=w("essential-table"),i=w("solicitar-archivo"),p=w("modal-entidad");return n(),r(j,null,[t(vo,{padding:""},{default:l(()=>[t(uo,{modelValue:o.tab,"onUpdate:modelValue":e[0]||(e[0]=d=>o.tab=d),align:"left","switch-indicator":"","active-class":"tab-active","indicator-color":"transparent",dense:""},{default:l(()=>[t(mo,{name:o.opcionesSeguimientoConsumo.SEGUIMIENTO_CONSUMO,label:o.opcionesSeguimientoConsumo.SEGUIMIENTO_CONSUMO,class:J({"tab-inactive":o.tab!==o.opcionesSeguimientoConsumo.SEGUIMIENTO_CONSUMO}),"no-caps":""},null,8,["name","label","class"])]),_:1},8,["modelValue"]),t(co,{modelValue:o.tab,"onUpdate:modelValue":e[1]||(e[1]=d=>o.tab=d),animated:"","transition-prev":"scale","transition-next":"scale",class:J(["bg-desenfoque border-white q-mb-md",{"rounded-tabpanel":!o.$q.screen.xs}]),"keep-alive":""},{default:l(()=>[t(po,{name:o.opcionesSeguimientoConsumo.SEGUIMIENTO_CONSUMO},{default:l(()=>[t(m,{titulo:o.opcionesSeguimientoConsumo.SEGUIMIENTO_CONSUMO,configuracionColumnas:[...o.configuracionColumnasSeguimientoConsumoActivoFijo,o.accionesTabla],datos:o.listado,permitirConsultar:!1,permitirEditar:!1,permitirEliminar:!1,permitirFiltrar:!1,mostrarExportar:!0,ajustarCeldas:!0,accion1Header:o.btnAgregar,accion1:o.btnEditar,accion2:o.btnJustificativoUso,accion3:o.btnSeReportoSicosep},null,8,["titulo","configuracionColumnas","datos","accion1Header","accion1","accion2","accion3"])]),_:1},8,["name"])]),_:1},8,["modelValue","class"])]),_:1}),o.mostrarSolicitarArchivo?(n(),Z(i,{key:0,mostrar:o.mostrarSolicitarArchivo,onCerrar:e[2]||(e[2]=d=>o.mostrarSolicitarArchivo=!1),mixin:o.mixin},null,8,["mostrar","mixin"])):c("",!0),t(p,{comportamiento:o.modales,"mixin-modal":o.mixin,"confirmar-cerrar":!1,persistente:!1},null,8,["comportamiento","mixin-modal"])],64)}var ei=X(te,[["render",ae]]);export{ei as default};
