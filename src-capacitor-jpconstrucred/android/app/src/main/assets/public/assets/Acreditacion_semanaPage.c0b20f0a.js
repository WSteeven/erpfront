var Ro=Object.defineProperty;var Bo=(o,e,c)=>e in o?Ro(o,e,{enumerable:!0,configurable:!0,writable:!0,value:c}):o[e]=c;var s=(o,e,c)=>(Bo(o,typeof e!="symbol"?e+"":e,c),c);import{Q as so}from"./QPage.f3b97ac0.js";import{T as lo}from"./TabLayout.dfee7537.js";import{by as x,s as w,l as No,e as co,c as y,d as mo,bc as uo,m as K,u as po,R as fo,E as ko,f as Io,h as ro,p as bo,dl as To,_ as vo,t as L,v as u,P as W,F as f,y as l,K as B,a5 as qo,z as b,x as g,G as q,H as Q,D as Qo,I as H,J as Fo,bh as Lo,q as Do,a2 as Uo,A as z,bH as X}from"./index.70185135.js";import{u as _o}from"./index.004ff2d8.js";import{C as Y}from"./ContenedorSimpleMixin.0ef3239b.js";import{E as go}from"./entidadAuditable.75a46700.js";import{E as Ao}from"./EssentialTable.c4a035e4.js";import{C as Oo,a as Po}from"./ComponenteModal.domain.9bc16b73.js";import{Q as Go,a as jo}from"./QItemSection.1a41b826.js";import{Q as Ho}from"./QSelect.b1759751.js";import{Q as zo}from"./QForm.0c8c3b68.js";import{T as Xo}from"./TabLayoutFilterTabs2.0c89493b.js";import{B as Jo}from"./buttonSubmits.f728eedc.js";import{r as J,c as Ko,a as Wo}from"./i18n-validators.ea544161.js";import{u as Yo}from"./filtrosListadosGenerales.6ad178d9.js";import{M as Zo}from"./ModalEntidad.7d323d29.js";import{u as xo,A as io}from"./utils.2eab62de.js";import"./QTabs.4ee0c65d.js";import"./QResizeObserver.721a0e6c.js";import"./QTabPanels.0148950e.js";import"./touch.9135741d.js";import"./position-engine.f244a0db.js";import"./QPopupProxy.c164d2ac.js";import"./format.8ac60962.js";import"./QMenu.7527c31d.js";import"./EssentialTablePagination.959d4e60.js";import"./QChip.a6a2afa6.js";import"./QToolbar.f2167ded.js";import"./use-fullscreen.ec50b882.js";import"./QBadge.5bb69fff.js";import"./QFile.f60a5ba1.js";import"./_commonjsHelpers.8402d862.js";import"./QImg.04221389.js";import"./VisorImagen.7aac4fec.js";import"./seleccionContratacionPersonal.utils.e3e1ed3d.js";import"./ErrorComponent.60ce3364.js";import"./EssentialTableTabs.a1f1bc4b.js";import"./index.9f64ebda.js";import"./configuracion_general.27135600.js";import"./ConfiguracionController.40960b9d.js";class Eo extends go{constructor(){super();s(this,"semana");this.semana=null}}class to extends x{constructor(){super(w.acreditacion_semana)}}const oa=[{name:"semana",field:"semana",label:"Semana",align:"left",sortable:!0}],$o=No("acreditaciones",()=>{const o=co(new Eo);return{esta_acreditado:y(),acreditacion_semana:o}});class F extends go{constructor(){super();s(this,"id");s(this,"empleado");s(this,"empleado_info");s(this,"acreditacion_semana");s(this,"acreditacion_semana_info");s(this,"monto_generado");s(this,"monto_modificado");s(this,"saldo_empleado");s(this,"umbral_empleado");s(this,"es_acreditado");s(this,"estado");s(this,"motivo");this.id=null,this.empleado=null,this.empleado_info=null,this.acreditacion_semana=null,this.acreditacion_semana_info=null,this.monto_generado=null,this.monto_modificado=null,this.saldo_empleado=null,this.umbral_empleado=null,this.es_acreditado=null,this.estado=!0,this.motivo=null}}class Z extends x{constructor(){super(w.valor_acreditar)}}const no=[{name:"empleado_info",field:"empleado_info",label:"Empleado",align:"left",sortable:!0},{name:"umbral_empleado",field:"umbral_empleado",label:"Umbral Empleado",align:"left",sortable:!0},{name:"saldo_empleado",field:"saldo_empleado",label:"Saldo Empleado",align:"left",sortable:!0},{name:"monto_generado",field:"monto_generado",label:"Monto Generado",align:"left",sortable:!0},{name:"monto_modificado",field:"monto_modificado",label:"Monto Modificado",align:"left",sortable:!0},{name:"motivo",field:"motivo",label:"Motivo",align:"left",sortable:!0}];class aa extends x{constructor(){super(w.monto_acreditar_usuario)}}var ea=mo({components:{TabLayout:lo,TabLayoutFilterTabs2:Xo,EssentialTable:Ao,ButtonSubmits:Jo},setup(){uo().setQuasar(K());const o=$o(),e=new Y(F,new Z),{setValidador:c,guardar:A,editar:_,reestablecer:V,listar:E}=e.useComportamiento(),{entidad:r,disabled:i,accion:p}=e.useReferencias(),$=po(),{prompt:N,notificarCorrecto:S,notificarError:k}=fo(),M=y(!0),v=y(!1),D=y(o.acreditacion_semana),U={empleado:{required:J},acreditacion_semana:{required:J},monto_generado:{required:J},monto_modificado:{minimo:Ko(1)},motivo:{required:Wo(()=>r.estado)}},h=_o(U,r);c(h.value);const{cargarVista:O,obtenerListados:P}=e.useComportamiento(),{listado:C,listadosAuxiliares:I}=e.useReferencias(),{empleados:T,filtrarEmpleados:t}=Yo(I);O(async()=>{await P({empleados:{controller:new ko,params:{campos:"id,nombres,apellidos",estado:1}}}),T.value=I.empleados,C.value=(await new Z().listar({acreditacion_semana_id:o.acreditacion_semana.id})).result});async function m(a){try{let n=new F;p.value=="NUEVO"?await h.value.$validate()&&(n=await A(a),new F().hydrate(n)):await h.value.$validate()&&await _(a,!0),v.value=!1}catch(n){console.log(n)}}function d(){V(),v.value=!1}const R={titulo:"Eliminar",icono:"bi-trash",color:"secondary",visible:({entidad:a})=>$.can("puede.eliminar.valor_acreditar")&&!o.esta_acreditado&&a.estado,accion:({entidad:a,posicion:n})=>{p.value="ELIMINAR",Vo({entidad:a,posicion:n})}},G={titulo:"Activar",icono:"bi-toggle2-on",color:"positive",visible:({entidad:a})=>$.can("puede.eliminar.valor_acreditar")&&!o.esta_acreditado&&!a.estado,accion:({entidad:a,posicion:n})=>{p.value="ELIMINAR",Co({entidad:a,posicion:n})}};async function Co({entidad:a}){try{a.estado=!0,a.motivo=" ",r.id=a.id,r.empleado=a.empleado,r.acreditacion_semana=a.acreditacion_semana,r.monto_generado=a.monto_generado,r.monto_modificado=a.monto_modificado,r.estado=!1,r.motivo=" ",await _(a,!0),S("Se ha activado empleado"),j.value="1",oo("1")}catch(n){console.log(n.message),k("No se pudo anular, debes ingresar un motivo para la anulacion")}}async function Vo({entidad:a,posicion:n}){try{N({titulo:"Anular Acreditacion",mensaje:"Ingrese motivo de anulacion",accion:async eo=>{a.estado=!1,a.motivo=eo,r.id=a.id,r.empleado=a.empleado,r.acreditacion_semana=a.acreditacion_semana,r.monto_generado=a.monto_generado,r.monto_modificado=a.monto_modificado,r.estado=!1,r.motivo=eo,await _(a,!0),S("Se ha anulado Acreditacion"),C.value.splice(n,1)}})}catch{k("No se pudo anular, debes ingresar un motivo para la anulacion")}}const ho={titulo:"Editar",icono:"bi-pencil",color:"warning",visible:()=>$.can("puede.editar.valor_acreditar")&&!o.esta_acreditado,accion:({entidad:a})=>{M.value=!0,p.value="EDITAR",r.id=a.id,r.empleado=a.empleado,r.acreditacion_semana=a.acreditacion_semana,r.monto_generado=a.monto_generado,r.monto_modificado=a.monto_modificado,v.value=!0}},yo={titulo:"Consultar",icono:"bi-eye",color:"primary",visible:()=>$.can("puede.ver.valor_acreditar"),accion:({entidad:a})=>{p.value="CONSULTAR",r.id=a.id,r.empleado=a.empleado,r.acreditacion_semana=a.acreditacion_semana,r.monto_generado=a.monto_generado,r.monto_modificado=a.monto_modificado,v.value=!0}},wo={titulo:"Agregar",icono:"bi-plus",color:"positive",visible:()=>$.can("puede.crear.valor_acreditar")&&o.esta_acreditado==!1,accion:()=>{p.value="NUEVO",r.acreditacion_semana=o.acreditacion_semana.id,v.value=!0,M.value=!1}},So=Io(()=>C.value.filter(a=>a.estado===!0).reduce((a,n)=>a+parseFloat(n.monto_modificado.replace(/,/g,"")),0));async function Mo(){if(p.value=="NUEVO"){const a=new aa;if(r.empleado){const{response:n}=await a.consultar(r.empleado);r.monto_generado=n.data.monto_acreditar,r.monto_modificado=n.data.monto_acreditar}}}ro(()=>{C.value.forEach(a=>{console.log(a)})});const j=y("1");function oo(a){E({estado:a,acreditacion_semana_id:o.acreditacion_semana.id},!1),j.value=a}return{mixin:e,disabled:i,accion:p,guardarDatos:m,reestablecerDatos:d,v$:h,valorAcreditar:r,filtrarEmpleados:t,filtrarValoresAcreditar:oo,saldo_anterior:Mo,onMounted:ro,totalAcreditar:So,empleados:T,deshabilitar_empleado:M,listado:C,configuracionColumnasValorAcreditar:no,btnNevoEmpleadoAcreditar:wo,btnEditarAcreditacionEmpleado:ho,btnEliminarAcreditacionEmpleado:R,btnVerAcreditacionEmpleado:yo,btnActivarAcreditacionEmpleado:G,mostrar_formulario:v,accionesTabla:bo,tabOptionsValoresAcreditar:To,configuracionColumnas:no,tabValorAcreditar:j,acreditacion_semana:D}}});const ra={class:"text-h5 q-py-sm text-right"},ia={class:"row q-col-gutter-sm q-mb-md"},ta={class:"col-12 col-md-3"},na={class:"error-msg"},sa={class:"col-12 col-md-3"},la={class:"error-msg"},da={class:"col-12 col-md-3"},ca={class:"error-msg"},ma={class:"col-12 col-md-3"},ua={class:"error-msg"},pa={class:"row justify-end q-col-gutter-x-xs"};function fa(o,e,c,A,_,V){const E=L("button-submits"),r=L("tab-layout-filter-tabs2");return u(),W(so,{padding:""},{default:f(()=>[l("div",ra," Total a Acreditar: $"+B(o.totalAcreditar.toFixed(2)),1),o.mostrar_formulario?(u(),W(zo,{key:0,onSubmit:e[8]||(e[8]=qo(()=>{},["prevent"]))},{default:f(()=>[l("div",ia,[l("div",ta,[e[10]||(e[10]=l("label",{class:"q-mb-sm block"},"Empleado",-1)),b(Ho,{modelValue:o.valorAcreditar.empleado,"onUpdate:modelValue":[e[0]||(e[0]=i=>o.valorAcreditar.empleado=i),e[1]||(e[1]=i=>o.saldo_anterior())],options:o.empleados,"transition-show":"jump-up","transition-hide":"jump-down","options-dense":"",dense:"",outlined:"",disable:o.deshabilitar_empleado,readonly:o.disabled,error:!!o.v$.empleado.$errors.length,onBlur:o.v$.empleado.$touch,"error-message":"Debes seleccionar un empleado","use-input":"","input-debounce":"0",onFilter:o.filtrarEmpleados,"option-value":i=>i.id,"option-label":i=>i.nombres+" "+i.apellidos,"emit-value":"","map-options":""},{error:f(()=>[(u(!0),g(q,null,Q(o.v$.empleado.$errors,i=>(u(),g("div",{key:i.$uid},[l("div",na,B(i.$message),1)]))),128))]),"no-option":f(()=>[b(Go,null,{default:f(()=>[b(jo,{class:"text-grey"},{default:f(()=>e[9]||(e[9]=[Qo(" No hay resultados ")])),_:1})]),_:1})]),_:1},8,["modelValue","options","disable","readonly","error","onBlur","onFilter","option-value","option-label"])]),l("div",sa,[e[11]||(e[11]=l("label",{class:"q-mb-sm block"},"Monto Generado",-1)),b(H,{modelValue:o.valorAcreditar.monto_generado,"onUpdate:modelValue":e[2]||(e[2]=i=>o.valorAcreditar.monto_generado=i),placeholder:"Obligatorio",disable:"",error:!!o.v$.monto_generado.$errors.length,onBlur:o.v$.monto_generado.$touch,outlined:"",dense:""},{error:f(()=>[(u(!0),g(q,null,Q(o.v$.monto_generado.$errors,i=>(u(),g("div",{key:i.$uid},[l("div",la,B(i.$message),1)]))),128))]),_:1},8,["modelValue","error","onBlur"])]),l("div",da,[e[12]||(e[12]=l("label",{class:"q-mb-sm block"},"Monto Modificado",-1)),b(H,{modelValue:o.valorAcreditar.monto_modificado,"onUpdate:modelValue":e[3]||(e[3]=i=>o.valorAcreditar.monto_modificado=i),placeholder:"Obligatorio",disable:o.disabled,"error-message":"Ingrese monto mayor a 0",error:!!o.v$.monto_modificado.$errors.length,onBlur:o.v$.monto_modificado.$touch,outlined:"",dense:""},{error:f(()=>[(u(!0),g(q,null,Q(o.v$.monto_modificado.$errors,i=>(u(),g("div",{key:i.$uid},[l("div",ca,B(i.$message),1)]))),128))]),_:1},8,["modelValue","disable","error","onBlur"])]),l("div",ma,[e[13]||(e[13]=l("label",{class:"q-mb-sm block"},"Motivo",-1)),b(H,{modelValue:o.valorAcreditar.motivo,"onUpdate:modelValue":e[4]||(e[4]=i=>o.valorAcreditar.motivo=i),placeholder:"Obligatorio",disable:o.disabled,error:!!o.v$.motivo.$errors.length,onBlur:o.v$.motivo.$touch,outlined:"",dense:""},{error:f(()=>[(u(!0),g(q,null,Q(o.v$.motivo.$errors,i=>(u(),g("div",{key:i.$uid},[l("div",ua,B(i.$message),1)]))),128))]),_:1},8,["modelValue","disable","error","onBlur"])])]),l("div",pa,[b(E,{accion:o.accion,"label-guardar":"Guardar",permitirCancelar:!0,onCancelar:e[5]||(e[5]=i=>o.reestablecerDatos()),onEditar:e[6]||(e[6]=i=>o.guardarDatos(o.valorAcreditar)),onGuardar:e[7]||(e[7]=i=>o.guardarDatos(o.valorAcreditar))},null,8,["accion"])])]),_:1})):Fo("",!0),b(r,{mixin:o.mixin,configuracionColumnas:o.configuracionColumnas,full:!0,permitirEditar:!1,permitirEliminar:!1,mostrarButtonSubmits:!1,permitirConsultar:!1,tabOptions:o.tabOptionsValoresAcreditar,subtituloPagina:o.acreditacion_semana.semana,accion1Header:o.btnNevoEmpleadoAcreditar,accion1:o.btnVerAcreditacionEmpleado,accion2:o.btnEditarAcreditacionEmpleado,accion3:o.btnEliminarAcreditacionEmpleado,accion4:o.btnActivarAcreditacionEmpleado,filtrar:o.filtrarValoresAcreditar,tabDefecto:o.tabValorAcreditar,ajustarCeldas:!0,mostrarFormulario:!1},null,8,["mixin","configuracionColumnas","tabOptions","subtituloPagina","accion1Header","accion1","accion2","accion3","accion4","filtrar","tabDefecto"])]),_:1})}var ba=vo(ea,[["render",fa]]);class va{constructor(){s(this,"ValorAcreditarPage");this.ValorAcreditarPage=Lo(new Oo("ValorAcreditarPage",ba))}}class _a extends Po{constructor(){super(new va)}}var ga=mo({name:"AcreditacionSemana",components:{TabLayout:lo,EssentialTable:Ao,ModalesEntidad:Zo},setup(){uo().setQuasar(K());const o=$o(),{notificarCorrecto:e,promptItems:c}=fo(),A=new Y(Eo,new to),_=new Y(F,new Z);_.useReferencias();const{entidad:V,disabled:E,accion:r,listado:i}=A.useReferencias(),{setValidador:p,cargarVista:$}=A.useComportamiento(),N=po();xo().setQuasar(K());const S=new _a,k={semana:{required:!0}},M=y(!1),v=_o(k,V);p(v.value),$(async()=>{i.value=(await new to().listar()).result});const D=[{id:"pdf",name:"PDF"},{id:"xlsx",name:"EXCEL"}],U={titulo:"Consultar",icono:"bi-eye",color:"primary",accion:({entidad:t})=>{o.acreditacion_semana=t,o.esta_acreditado=t.acreditar,S.abrirModalEntidad("ValorAcreditarPage")}},h={titulo:"Acreditar",icono:"bi-check-all",color:"positive",visible:({entidad:t})=>N.can("puede.ver.campo.acreditar_saldo_masivo")&&!t.acreditar,accion:({entidad:t})=>{t.acreditar=!0,C(t)}},O={titulo:"Cash",icono:"bi-cash-stack",color:"warning",visible:()=>N.can("puede.ver.campo.cash_acreditacion_saldo"),accion:({entidad:t})=>{P(t)}};async function P(t){const m="cash_rol_pago",d=z.getInstance(),R=X.URL_BASE+"/"+d.getEndpoint(w.crear_cash_acreditacion_saldo)+t.id;io(R,"GET","blob","xlsx",m,null)}async function C(t){const m=z.getInstance(),d=X.URL_BASE+"/"+m.getEndpoint(w.acreditacion_saldo_semana)+t.id;return await m.get(d),e("El rol de pago ha sido Finalizado.")}const I={titulo:"Reporte General",icono:"bi-printer",color:"primary",visible:({entidad:t})=>!0,accion:({entidad:t})=>{const m=co({mensaje:"Confirme el tipo de reporte",accion:d=>{T(t.id,d)},requerido:!1,defecto:"EXCEL",tipo:"radio",items:D.map(d=>({label:d.name,value:d.id}))});c(m)}};async function T(t,m){const d=z.getInstance(),R="acreditacion_semana",G=X.URL_BASE+"/"+d.getEndpoint(w.reporte_acreditacion_semanal)+t+"?tipo="+m;io(G,"GET","blob",m,R,null)}return{mixin:A,mixinAcreditacion:_,fondo_rotativo_contabilidad:V,ConfiguracionColumnasAcreditacionSemana:oa,disabled:E,accion:r,v$:v,maskFecha:Do,opened:M,modalesAcreditacionSemana:S,botonReporte:I,watchEffect:Uo,listado:i,botonVerModalValorAcreditar:U,botonCash:O,botonAcreditar:h,accionesTabla:bo}}});function Aa(o,e,c,A,_,V){const E=L("essential-table"),r=L("modales-entidad");return u(),W(so,{padding:""},{default:f(()=>[b(E,{titulo:"Acreditaciones Semanales",configuracionColumnas:[...o.ConfiguracionColumnasAcreditacionSemana,o.accionesTabla],datos:o.listado,permitirConsultar:!1,permitirEditar:!1,permitirEliminar:!1,accion1:o.botonVerModalValorAcreditar,accion2:o.botonAcreditar,accion3:o.botonCash,accion4:o.botonReporte},null,8,["configuracionColumnas","datos","accion1","accion2","accion3","accion4"]),b(r,{comportamiento:o.modalesAcreditacionSemana,"mixin-modal":o.mixinAcreditacion},null,8,["comportamiento","mixin-modal"])]),_:1})}var se=vo(ga,[["render",Aa]]);export{se as default};
