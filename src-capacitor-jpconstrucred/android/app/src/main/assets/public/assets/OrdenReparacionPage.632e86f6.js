var bo=Object.defineProperty;var fo=(o,e,t)=>e in o?bo(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t;var n=(o,e,t)=>(fo(o,typeof e!="symbol"?e+"":e,t),t);import{Q as w,a as $}from"./QSelect.b1759751.js";import{Q as j,a as G}from"./QItemSection.1a41b826.js";import{by as ho,s as oo,d as Vo,R as go,bc as Co,m as H,u as wo,f as $o,c as q,bz as J,q as K,d9 as qo,A as Ao,bH as zo,_ as ko,t as A,v as E,P as yo,F as r,z as i,a5 as Oo,y as l,x as W,J as P,M as X,N as Y,D as V,K as z,O as Z,B as _,I as g,j as Ro}from"./index.70185135.js";import{Q as So,a as Qo,C as Fo}from"./QPopupProxy.c164d2ac.js";import{Q as Eo}from"./QChip.a6a2afa6.js";import{Q as Po}from"./QForm.0c8c3b68.js";import{T as To}from"./TabLayoutFilterTabs2.0c89493b.js";import{G as Bo}from"./GestorArchivos.86e356d7.js";import{N as Io}from"./NoOptionComponent.4eefbc12.js";import{E as No}from"./ErrorComponent.60ce3364.js";import{C as Uo}from"./ContenedorSimpleMixin.0ef3239b.js";import{E as Do}from"./entidadAuditable.75a46700.js";import{p as Lo}from"./vehiculos.utils.c31e027d.js";import{u as Mo,S as jo,v as Go,s as Ho}from"./utils.2eab62de.js";import{S as Jo}from"./ServicioController.1320570d.js";import{u as Ko}from"./filtrosListadosGenerales.6ad178d9.js";import{r as v,a as Wo}from"./i18n-validators.ea544161.js";import{u as Xo}from"./index.004ff2d8.js";import{A as Yo}from"./AsignacionVehiculoController.deebe30c.js";import{T as Zo}from"./TransferenciaVehiculoController.cd033e1b.js";import{r as _o}from"./funcionesActualizacionListados.1eec2929.js";import{V as x}from"./VehiculoController.656ab648.js";import{C as xo}from"./ConductorController.806dbb9f.js";import"./QMenu.7527c31d.js";import"./position-engine.f244a0db.js";import"./format.8ac60962.js";import"./QTabs.4ee0c65d.js";import"./QResizeObserver.721a0e6c.js";import"./QTabPanels.0148950e.js";import"./touch.9135741d.js";import"./QPage.f3b97ac0.js";import"./EssentialTableTabs.a1f1bc4b.js";import"./QBadge.5bb69fff.js";import"./EssentialTablePagination.959d4e60.js";import"./EssentialTable.c4a035e4.js";import"./QFile.f60a5ba1.js";import"./QToolbar.f2167ded.js";import"./use-fullscreen.ec50b882.js";import"./_commonjsHelpers.8402d862.js";import"./QImg.04221389.js";import"./VisorImagen.7aac4fec.js";import"./seleccionContratacionPersonal.utils.e3e1ed3d.js";import"./buttonSubmits.f728eedc.js";import"./QUploader.128864d5.js";import"./QCircularProgress.d0f86e92.js";import"./configuracionColumnasArchivoSubtarea.215f4ffd.js";import"./index.9f64ebda.js";const oe=[{name:"fecha",field:"fecha",label:"Fecha",align:"left",sortable:!0},{name:"vehiculo",field:"vehiculo",label:"Placa",align:"left",sortable:!0},{name:"solicitante",field:"solicitante",label:"Solicitante",align:"left",sortable:!0},{name:"autorizacion",field:"autorizacion",label:"Estado",align:"left",sortable:!0},{name:"valor_reparacion",field:"valor_reparacion",label:"Valor Reparaci\xF3n",align:"left",sortable:!0},{name:"motivo",field:"motivo",label:"Motivo",align:"left",sortable:!0}];class ee extends Do{constructor(){super();n(this,"solicitante");n(this,"solicitante_id");n(this,"autorizador");n(this,"vehiculo");n(this,"fecha");n(this,"autorizacion");n(this,"servicios");n(this,"observacion");n(this,"valor_reparacion");n(this,"motivo");n(this,"num_factura");this.solicitante=null,this.solicitante_id=null,this.autorizador=null,this.vehiculo=null,this.fecha=null,this.autorizacion=null,this.servicios=null,this.observacion=null,this.valor_reparacion=null,this.motivo=null,this.num_factura=null}}class ae extends ho{constructor(){super(oo.ordenes_reparaciones)}}var ie=Vo({components:{ErrorComponent:No,NoOptionComponent:Io,TabLayoutFilterTabs2:To,GestorArchivos:Bo},setup(){const o=new Uo(ee,new ae),{entidad:e,disabled:t,listadosAuxiliares:m,accion:k}=o.useReferencias(),{setValidador:T,cargarVista:u,obtenerListados:p,listar:y}=o.useComportamiento(),{onReestablecer:O,onConsultado:a,onGuardado:eo,onModificado:ao}=o.useHooks(),{prompt:io,notificarCorrecto:ro,notificarAdvertencia:lo}=go();Co().setQuasar(H()),Mo().setQuasar(H());const B=new jo,c=wo(),I=$o(()=>["1","2"].includes(S.value)&&c.esAdministradorVehiculos),b=q(),R=q(),S=q("1"),f=q(),{empleados:N,filtrarEmpleados:so,servicios:U,filtrarServicios:no,vehiculos:Q,filtrarVehiculos:to}=Ko(m);u(async()=>{f.value=await mo(),await p({empleados:new xo,servicios:{controller:new Jo,params:{tipo:"CORRECTIVO",estado:1}},vehiculos:new x}),N.value=m.empleados,U.value=m.servicios,Q.value=m.vehiculos,M()});const uo={solicitante:{required:v},vehiculo:{required:v},fecha:{required:v},autorizacion:{required:v},num_factura:{required:Wo(()=>J.editar==k.value)},servicios:{required:v},observacion:{required:v}},D=Xo(uo,e);T(D.value),O(()=>{setTimeout(()=>{b.value.limpiarListado(),b.value.quiero_subir_archivos=!1},300),M()}),a(()=>{setTimeout(()=>{b.value.listarArchivosAlmacenados(e.id)},1)}),eo(s=>{R.value=s,setTimeout(()=>L(),1)}),ao(s=>{R.value=s,setTimeout(()=>L(),1)});async function co(s){S.value=s,await y({autorizacion_id:s})}async function L(){await b.value.subir()}async function mo(){const s=await new Yo().listar({filtro:1,responsable_id:c.user.id,estado:"ACEPTADO"});return s.result.length==0?(await new Zo().listar({filtro:1,responsable_id:c.user.id,estado:"ACEPTADO"})).result[0]:s.result[0]}function M(){f.value?(e.vehiculo=f.value.vehiculo,e.solicitante_id=f.value.responsable_id,e.solicitante=f.value.responsable,e.autorizacion=1):(c.esMecanicoGeneral&&(e.solicitante_id=c.user.id,e.solicitante=c.nombreUsuario),e.autorizacion=1),e.fecha=Go(K)}async function po(){await _o(m,"vehiculos",Q,new x)}async function vo(s,F){try{B.activar();const d=Ao.getInstance(),h=zo.URL_BASE+"/"+d.getEndpoint(oo.ordenes_reparaciones)+"/registrar-valor-reparacion/"+s,C=await d.post(h,{valor_reparacion:F});if(C.status===200)return ro(C.data.mensaje),C.data.modelo;lo(C.data.mensaje)}catch(d){console.error(d)}finally{B.desactivar()}}return{mixin:o,orden:e,disabled:t,v$:D,accion:k,acciones:J,tabOptionsOrdenesReparaciones:Lo,configuracionColumnas:oe,tabActual:S,store:c,refArchivo:b,idOrden:R,maskFecha:K,visibleParaAdmin:I,empleados:N,filtrarEmpleados:so,servicios:U,filtrarServicios:no,vehiculos:Q,filtrarVehiculos:to,autorizaciones:qo,ordenarLista:Ho,filtrarOrdenesReparaciones:co,recargarVehiculos:po,btnValorReparacion:{titulo:"Valor Reparaci\xF3n",icono:"bi-cash",accion:({entidad:s})=>{io({titulo:"Valor de la reparaci\xF3n",mensaje:"Ingrese el valor de la reparaci\xF3n",validacion:d=>/^(\d{1,3}(?:,\d{3})*(?:\.\d+)?|\d+)?$/.test(d),requerido:!0,accion:async d=>{const h=await vo(s.id,d);console.log(h),s.valor_reparacion=h.valor_reparacion}})},visible:()=>I.value}}}});const re={class:"row q-col-gutter-sm q-py-md"},le={key:0,class:"col-12 col-md-4 q-mb-md"},se={class:"col-12 col-md-4 q-mb-md"},ne={class:"col-12 col-md-4 q-mb-md"},te={class:"row items-center justify-end"},de={key:1,class:"col-12 col-md-4 q-mb-md q-pt-none"},ue={class:"col-12 col-md-4 q-mb-md"},ce={class:"col-12 col-md-4 q-mb-md"},me={class:"col-12 col-md-4 q-mb-md"},pe={class:"col-12 col-md-8 q-mb-md"},ve={class:"col-12"},be={class:"col-12 q-mb-md"};function fe(o,e,t,m,k,T){const u=A("error-component"),p=A("no-option-component"),y=A("gestor-archivos"),O=A("tab-layout-filter-tabs2");return E(),yo(O,{mixin:o.mixin,configuracionColumnas:o.configuracionColumnas,ajustarCeldas:!0,"tab-options":o.tabOptionsOrdenesReparaciones,tabDefecto:o.tabActual,permitirEditar:o.visibleParaAdmin,accion1:o.btnValorReparacion,filtrar:o.filtrarOrdenesReparaciones,"titulo-pagina":"Matriculas de Veh\xEDculos"},{formulario:r(()=>[i(Po,{onSubmit:e[12]||(e[12]=Oo(()=>{},["prevent"]))},{default:r(()=>[l("div",re,[o.accion==o.acciones.nuevo||o.orden.solicitante?(E(),W("div",le,[e[13]||(e[13]=l("label",{class:"q-mb-sm block"},"Chofer que solicita",-1)),i(w,{modelValue:o.orden.solicitante,"onUpdate:modelValue":e[0]||(e[0]=a=>o.orden.solicitante=a),options:o.empleados,"transition-show":"scale","transition-hide":"scale","options-dense":"",clearable:"",dense:"",outlined:"",disable:o.disabled,error:!!o.v$.solicitante.$errors.length,"use-input":"","input-debounce":"0",onPopupShow:e[1]||(e[1]=a=>o.ordenarLista(o.empleados,"apellidos")),onFilter:o.filtrarEmpleados,"option-label":a=>a.apellidos+" "+a.nombres,"option-value":a=>a.id,"emit-value":"","map-options":""},{error:r(()=>[i(u,{clave:"solicitante",v$:o.v$},null,8,["v$"])]),"no-option":r(()=>[i(p)]),_:1},8,["modelValue","options","disable","error","onFilter","option-label","option-value"])])):P("",!0),l("div",se,[e[14]||(e[14]=l("label",{class:"q-mb-sm block"},"Veh\xEDculo",-1)),i(w,{modelValue:o.orden.vehiculo,"onUpdate:modelValue":e[2]||(e[2]=a=>o.orden.vehiculo=a),options:o.vehiculos,hint:"Agregue elementos desde el panel de veh\xEDculos","transition-show":"scale","transition-hide":"scale","options-dense":"",clearable:"",dense:"",outlined:"",disable:o.disabled,"use-input":"","input-debounce":"0",onFilter:o.filtrarVehiculos,"option-label":a=>a.placa,"option-value":a=>a.id,error:!!o.v$.vehiculo.$errors.length,onBlur:o.v$.vehiculo.$touch,"emit-value":"","map-options":""},{option:r(a=>[i(j,X(Y(a.itemProps)),{default:r(()=>[i(G,null,{default:r(()=>[i($,null,{default:r(()=>[V(z(a.opt.placa),1)]),_:2},1024),i($,{caption:""},{default:r(()=>[V(z(a.opt.marca+" "+a.opt.modelo),1)]),_:2},1024)]),_:2},1024)]),_:2},1040)]),"no-option":r(()=>[i(p)]),error:r(()=>[i(u,{clave:"vehiculo",v$:o.v$},null,8,["v$"])]),after:r(()=>[i(Z,{color:"positive",onClick:o.recargarVehiculos},{default:r(()=>[i(_,{size:"xs",class:"q-mr-sm",name:"bi-arrow-clockwise"})]),_:1},8,["onClick"])]),_:1},8,["modelValue","options","disable","onFilter","option-label","option-value","error","onBlur"])]),l("div",ne,[e[15]||(e[15]=l("label",{class:"q-mb-sm block"},"Fecha",-1)),i(g,{modelValue:o.orden.fecha,"onUpdate:modelValue":e[4]||(e[4]=a=>o.orden.fecha=a),autogrow:"",disable:o.disabled,outlined:"",dense:""},{append:r(()=>[i(_,{name:"event",class:"cursor-pointer"},{default:r(()=>[i(So,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:r(()=>[i(Qo,{modelValue:o.orden.fecha,"onUpdate:modelValue":e[3]||(e[3]=a=>o.orden.fecha=a),mask:o.maskFecha,"today-btn":""},{default:r(()=>[l("div",te,[Ro(i(Z,{label:"Cerrar",color:"primary",flat:""},null,512),[[Fo]])])]),_:1},8,["modelValue","mask"])]),_:1})]),_:1})]),_:1},8,["modelValue","disable"])]),o.orden.autorizacion?(E(),W("div",de,[i(Eo,{color:"light-green-2",class:"text-positive text-bold q-mb-xs"},{default:r(()=>e[16]||(e[16]=[V("Autorizaci\xF3n ")])),_:1}),i(w,{modelValue:o.orden.autorizacion,"onUpdate:modelValue":e[5]||(e[5]=a=>o.orden.autorizacion=a),options:o.autorizaciones,"transition-show":"jum-up","transition-hide":"jump-down","options-dense":"",dense:"",outlined:"",disable:o.disabled||o.orden.autorizador!==o.store.user.id,"option-value":a=>a.id,"option-label":a=>a.nombre,"emit-value":"","map-options":""},{"no-option":r(()=>[i(p)]),_:1},8,["modelValue","options","disable","option-value","option-label"])])):P("",!0),l("div",ue,[e[17]||(e[17]=l("label",{class:"q-mb-sm block"},"Valor de Reparaci\xF3n",-1)),i(g,{type:"number",modelValue:o.orden.valor_reparacion,"onUpdate:modelValue":e[6]||(e[6]=a=>o.orden.valor_reparacion=a),placeholder:"Opcional",hint:"Puedes completar este valor luego de la aprobaci\xF3n del registro",outlined:"",disable:o.disabled,dense:""},null,8,["modelValue","disable"])]),l("div",ce,[e[18]||(e[18]=l("label",{class:"q-mb-sm block"},"Comentario o motivo de retraso",-1)),i(g,{autogrow:"",modelValue:o.orden.motivo,"onUpdate:modelValue":e[7]||(e[7]=a=>o.orden.motivo=a),placeholder:"Opcional",hint:"Llena este campo en caso de tener algun comentario",outlined:"",disable:o.disabled,dense:""},null,8,["modelValue","disable"])]),l("div",me,[e[19]||(e[19]=l("label",{class:"q-mb-sm block"},"N\xB0 Factura ",-1)),i(g,{autogrow:"",modelValue:o.orden.num_factura,"onUpdate:modelValue":e[8]||(e[8]=a=>o.orden.num_factura=a),placeholder:[o.acciones.nuevo,o.acciones.consultar].includes(o.accion)?"Opcional":"Obligatorio",hint:"Llena este campo con el n\xFAmero de factura correspondiente a la reparaci\xF3n realizada",outlined:"",disable:o.disabled,error:!!o.v$.num_factura.$errors.length,dense:""},{error:r(()=>[i(u,{clave:"num_factura",v$:o.v$},null,8,["v$"])]),_:1},8,["modelValue","placeholder","disable","error"])]),l("div",pe,[e[20]||(e[20]=l("label",{class:"q-mb-sm block"},"Servicios a realizar",-1)),i(w,{modelValue:o.orden.servicios,"onUpdate:modelValue":e[9]||(e[9]=a=>o.orden.servicios=a),options:o.servicios,"options-dense":"",clearable:"",dense:"",disable:o.disabled,error:!!o.v$.servicios.$errors.length,outlined:"","use-input":"","use-chips":"",hint:"Si el servicio a realizar no est\xE1 en esta lista, por favor escribirlo en la observaci\xF3n","input-debounce":"0",onFilter:o.filtrarServicios,multiple:"","option-label":a=>a.nombre,"option-value":a=>a.id,"emit-value":"","map-options":""},{option:r(a=>[i(j,X(Y(a.itemProps)),{default:r(()=>[i(G,null,{default:r(()=>[i($,null,{default:r(()=>[V(z(a.opt.nombre),1)]),_:2},1024),i($,{caption:""},{default:r(()=>[V(z(a.opt.tipo),1)]),_:2},1024)]),_:2},1024)]),_:2},1040)]),"no-option":r(()=>[i(p)]),error:r(()=>[i(u,{clave:"servicios",v$:o.v$},null,8,["v$"])]),_:1},8,["modelValue","options","disable","error","onFilter","option-label","option-value"])]),l("div",ve,[e[21]||(e[21]=l("label",{class:"q-mb-sm block"},"Observaci\xF3n",-1)),i(g,{autogrow:"",modelValue:o.orden.observacion,"onUpdate:modelValue":e[10]||(e[10]=a=>o.orden.observacion=a),error:!!o.v$.observacion.$errors.length,placeholder:"Obligatorio",hint:"Ingresa alguna observaci\xF3n o novedad presentada en el interior del veh\xEDculo",outlined:"",disable:o.disabled,dense:""},{error:r(()=>[i(u,{clave:"observacion",v$:o.v$},null,8,["v$"])]),_:1},8,["modelValue","error","disable"])]),l("div",be,[i(y,{ref:"refArchivo",label:"Evidencia fotogr\xE1fica",mixin:o.mixin,disable:o.disabled,listarAlGuardar:!1,"permitir-eliminar":o.accion==o.acciones.nuevo||o.accion==o.acciones.editar,idModelo:o.idOrden},{"boton-subir":r(()=>[P("",!0)]),_:1},8,["mixin","disable","permitir-eliminar","idModelo"])])])]),_:1})]),_:1},8,["mixin","configuracionColumnas","tab-options","tabDefecto","permitirEditar","accion1","filtrar"])}var ma=ko(ie,[["render",fe]]);export{ma as default};
