var ho=Object.defineProperty;var $o=(o,e,c)=>e in o?ho(o,e,{enumerable:!0,configurable:!0,writable:!0,value:c}):o[e]=c;var t=(o,e,c)=>($o(o,typeof e!="symbol"?e+"":e,c),c);import{by as X,s as S,A as yo,bG as wo,d as Ao,bc as Vo,m as Co,c as k,R as Fo,u as _o,E as ko,a2 as G,bz as H,q as So,dp as qo,dq as Eo,_ as Do,t as D,v as n,P as J,F as r,z as l,a5 as Bo,y as s,x as d,I as A,B,j as Qo,O as Q,G as h,H as $,K as g,D as f,J as V,a7 as Io}from"./index.70185135.js";import{Q as Lo,a as Oo,C as To}from"./QPopupProxy.c164d2ac.js";import{Q as I,a as L}from"./QItemSection.1a41b826.js";import{Q as O}from"./QSelect.b1759751.js";import{Q as No}from"./QChip.a6a2afa6.js";import{a as Uo}from"./QToolbar.f2167ded.js";import{Q as Mo}from"./QForm.0c8c3b68.js";import{E as jo}from"./entidadAuditable.75a46700.js";import{T as Po}from"./TabLayoutFilterTabs2.0c89493b.js";import{u as Ro}from"./index.004ff2d8.js";import{r as y,d as Yo}from"./i18n-validators.ea544161.js";import{C as K}from"./ContenedorSimpleMixin.0ef3239b.js";import{T as zo}from"./TipoFonfoController.def192fb.js";import{S as Go,s as Ho,Q as Jo,v as Z}from"./utils.2eab62de.js";import{u as Ko}from"./filtrosListadosGenerales.6ad178d9.js";import{O as Zo}from"./OptionGroupComponent.36fba493.js";import{G as Wo}from"./GestorDocumentos.560daaa0.js";import"./format.8ac60962.js";import"./QMenu.7527c31d.js";import"./position-engine.f244a0db.js";import"./QTabs.4ee0c65d.js";import"./QResizeObserver.721a0e6c.js";import"./QTabPanels.0148950e.js";import"./touch.9135741d.js";import"./QPage.f3b97ac0.js";import"./EssentialTableTabs.a1f1bc4b.js";import"./QBadge.5bb69fff.js";import"./EssentialTablePagination.959d4e60.js";import"./EssentialTable.c4a035e4.js";import"./QFile.f60a5ba1.js";import"./use-fullscreen.ec50b882.js";import"./_commonjsHelpers.8402d862.js";import"./QImg.04221389.js";import"./VisorImagen.7aac4fec.js";import"./seleccionContratacionPersonal.utils.e3e1ed3d.js";import"./ErrorComponent.60ce3364.js";import"./buttonSubmits.f728eedc.js";import"./index.9f64ebda.js";import"./QUploader.128864d5.js";import"./QCircularProgress.d0f86e92.js";class T extends jo{constructor(){super();t(this,"id_tipo_saldo");t(this,"tipo_saldo");t(this,"id_saldo");t(this,"tipo_saldo_info");t(this,"id_tipo_fondo");t(this,"tipo_fondo_info");t(this,"tipo_fondo");t(this,"estado");t(this,"descripcion_acreditacion");t(this,"saldo_anterior");t(this,"saldo_depositado");t(this,"monto");t(this,"motivo");t(this,"saldo_actual");t(this,"fecha_inicio");t(this,"fecha_fin");t(this,"id_usuario");t(this,"usuario");t(this,"empleado_info");t(this,"id_estatus");t(this,"estatus");t(this,"estatus_info");t(this,"transcriptor");t(this,"fecha_trans");t(this,"fecha");this.id_tipo_saldo=null,this.id_saldo=null,this.tipo_saldo_info=null,this.tipo_saldo=null,this.id_tipo_fondo=null,this.tipo_fondo_info=null,this.estado=null,this.tipo_fondo=null,this.descripcion_acreditacion=null,this.saldo_anterior=null,this.saldo_depositado=null,this.saldo_actual=null,this.motivo=null,this.monto=null,this.fecha_inicio=null,this.fecha_fin=null,this.id_usuario=null,this.usuario=null,this.empleado_info=null,this.id_estatus=null,this.estatus_info=null,this.estatus=null,this.transcriptor=null,this.fecha_trans=null,this.fecha=null}}class W extends X{constructor(){super(S.acreditacion)}}const Xo=[{name:"fecha",field:"fecha",label:"Fecha Fondo",align:"left",sortable:!0},{name:"descripcion_acreditacion",field:"descripcion_acreditacion",label:"Descripcion",align:"left",sortable:!0},{name:"estado",field:"estado",label:"Estado",align:"left",sortable:!0},{name:"motivo",field:"motivo",label:"Motivo Anulacion",align:"left",sortable:!0},{name:"monto",field:"monto",label:"Monto",align:"left",sortable:!0},{name:"empleado_info",field:"empleado_info",label:"Usuario",align:"left",sortable:!0}];class xo extends X{constructor(){super(S.tipo_saldo)}}class oe{constructor(){t(this,"axios");this.axios=yo.getInstance()}async anularAcreditacion(e){try{await this.axios.post(this.axios.getEndpoint(S.anular_acreditacion),e)}catch(c){const C=c;throw new wo(C)}}}var ee=Ao({components:{GestorDocumentos:Wo,OptionGroupComponent:Zo,TabLayoutFilterTabs2:Po},setup(){Vo().setQuasar(Co());const o=new Go,e=k(),c=new K(T,new W),C=new K(T,new W),{entidad:m,disabled:N,accion:w,listadosAuxiliares:p,listado:q,tabs:i,filtros:U}=c.useReferencias(),{setValidador:x,obtenerListados:oo,cargarVista:eo,listar:io}=c.useComportamiento(),{confirmar:ao,prompt:M,notificarCorrecto:so,notificarAdvertencia:to,notificarError:j}=Fo(),lo={usuario:{required:y},tipo_fondo:{required:y},tipo_saldo:{required:y},id_saldo:{required:y},descripcion_acreditacion:{required:y},monto:{maxValue:Yo(9999),required:y}},P=Ro(lo,m);x(P.value);const R=k(!0),{empleados:Y,filtrarEmpleados:ro}=Ko(p),F=k([]),_=k([]),no=_o(),z=new oe;eo(async()=>{await oo({empleados:{controller:new ko,params:{campos:"id,nombres,apellidos",estado:1}},tiposFondos:{controller:new zo,params:{campos:"id,descripcion"}},tiposSaldos:{controller:new xo,params:{campos:"id,descripcion"}}}),Y.value=p.empleados,F.value=p.tiposFondos,_.value=p.tiposSaldos});function uo(a,u){if(a===""){u(()=>{F.value=p.tiposFondos});return}u(()=>{const b=a.toLowerCase();F.value=p.tiposFondos.filter(v=>v.descripcion.toLowerCase().indexOf(b)>-1)})}function co(a,u){if(a===""){u(()=>{_.value=p.tiposSaldos});return}u(()=>{const b=a.toLowerCase();_.value=p.tiposSaldos.filter(v=>v.descripcion.toLowerCase().indexOf(b)>-1)})}async function mo(){const a=new Eo;if(m.usuario){const{response:u}=await a.consultar(parseInt(m.usuario));m.saldo_anterior=u.data.saldo_actual}}function po(a){ao("\xBFEst\xE1 seguro de anular la acreditacion?",()=>{M({titulo:"Anular Acreditacion",mensaje:"Ingrese motivo de anulacion",accion:async b=>{try{o.activar(),a.descripcion_acreditacion=b,await z.anularAcreditacion(a),to("Se anulado Acreditacion Exitosamente"),await E("2"),w.value=H.nuevo,m.hydrate(new T),o.desactivar()}catch{j("No se pudo anular, debes ingresar un motivo para la anulaci\xF3n")}}})})}function fo(a){const u=Jo(Z(),0,0,-15,"YYYY/MM/DD");return a>=u&&a<=Z("YYYY/MM/DD")}async function bo(){try{await e.value.subir(),e.value.quiero_subir_archivos=!1,R.value=!0,setTimeout(async()=>{var a;(a=e.value)==null||a.limpiarListado(),i.value="listado",await E("1")},1e3)}catch(a){console.error(`Error es: ${a}`)}}const vo={titulo:"",icono:"bi-trash",color:"negative",visible:()=>no.can("puede.eliminar.acreditacion"),accion:({entidad:a,posicion:u})=>{w.value="ELIMINAR",go({entidad:a,posicion:u})}};async function go({entidad:a,posicion:u}){try{M({titulo:"Eliminar Acreditacion",mensaje:"Ingrese motivo de eliminacion",accion:async v=>{a.estado=!1,a.motivo=v,a.descripcion_acreditacion=v,await z.anularAcreditacion(a),so("Se ha eliminado Acreditacion"),q.value.splice(u,1)}})}catch{j("No se pudo anular, debes ingresar un motivo para la anulacion")}}async function E(a){await io({id_estado:a,paginate:!0},!1),U.fields={id_estado:a}}return G(()=>m.saldo_actual=parseFloat(m.saldo_anterior!==null?m.saldo_anterior.toString():"0")+parseFloat(m.monto!==null?m.monto.toString():"0")),{mixin:c,mixin2:C,acreditacion:m,options:[{label:"INDIVIDUAL",value:!0},{label:"POR LOTES",value:!1}],disabled:N,accion:w,acciones:H,refArchivo:e,v$:P,tiposFondos:F,tiposSaldos:_,maskFecha:So,modoIndividual:R,endpoint:S.acreditaciones_lotes,ordenarLista:Ho,optionsFecha:fo,saldo_anterior:mo,empleados:Y,filtrarEmpleados:ro,filtrarTiposFondos:uo,filtrarTiposSaldos:co,filtrarAcreditacion:E,btnEliminarAcreditacion:vo,tabAcreditacion:qo,anularAcreditacion:po,subirArchivos:bo,watchEffect:G,configuracionColumnas:Xo}}});const ie={class:"row q-col-gutter-sm q-mb-md"},ae={class:"col-12 col-md-4"},se={key:0,class:"row q-col-gutter-sm q-mb-md"},te={class:"col-12 col-md-3"},le={class:"row items-center justify-end"},re={class:"col-12 col-md-3 q-mb-md"},ne={class:"error-msg"},de={class:"col-12 col-md-3 q-mb-md"},ue={class:"error-msg"},ce={class:"col-12 col-md-3 q-mb-md"},me={class:"error-msg"},pe={class:"col-12 col-md-3"},fe={class:"error-msg"},be={class:"col-12 col-md-3"},ve={class:"error-msg"},ge={key:0,class:"col-12 col-md-3"},he={class:"col-12 col-md-3"},$e={class:"error-msg"},ye={key:1,class:"col-12 col-md-3"},we={key:1,class:"row q-col-gutter-sm q-mb-md"},Ae={key:0,class:"col-12 col-md-12"},Ve={class:"q-mb-sm block"},Ce={key:0,class:"q-pa-md q-gutter-sm flex flex-center"};function Fe(o,e,c,C,m,N){const w=D("option-group-component"),p=D("gestor-documentos"),q=D("tab-layout-filter-tabs2");return n(),J(q,{mixin:o.mixin,configuracionColumnas:o.configuracionColumnas,accion1:o.btnEliminarAcreditacion,permitirEliminar:!1,tabOptions:o.tabAcreditacion,filtrar:o.filtrarAcreditacion,tabDefecto:"1",forzarListar:!0,paginate:"",ajustarCeldas:""},{formulario:r(()=>[l(Mo,{onSubmit:e[13]||(e[13]=Bo(()=>{},["prevent"]))},{default:r(()=>[s("div",ie,[s("div",ae,[e[15]||(e[15]=s("label",{class:"q-mb-sm block"},"Modo de carga",-1)),l(w,{modelValue:o.modoIndividual,"onUpdate:modelValue":e[0]||(e[0]=i=>o.modoIndividual=i),disable:o.disabled,options:o.options},null,8,["modelValue","disable","options"])])]),o.modoIndividual?(n(),d("div",se,[s("div",te,[e[16]||(e[16]=s("label",{class:"q-mb-sm block"},"Fecha",-1)),l(A,{modelValue:o.acreditacion.fecha,"onUpdate:modelValue":e[2]||(e[2]=i=>o.acreditacion.fecha=i),placeholder:"Opcional",disable:o.disabled,outlined:"",dense:""},{append:r(()=>[l(B,{name:"event",class:"cursor-pointer"},{default:r(()=>[l(Lo,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:r(()=>[l(Oo,{modelValue:o.acreditacion.fecha,"onUpdate:modelValue":e[1]||(e[1]=i=>o.acreditacion.fecha=i),mask:o.maskFecha,options:o.optionsFecha,"today-btn":""},{default:r(()=>[s("div",le,[Qo(l(Q,{label:"Cerrar",color:"primary",flat:""},null,512),[[To]])])]),_:1},8,["modelValue","mask","options"])]),_:1})]),_:1})]),_:1},8,["modelValue","disable"])]),s("div",re,[e[18]||(e[18]=s("label",{class:"q-mb-sm block"},"Empleado",-1)),l(O,{autogrow:"",modelValue:o.acreditacion.usuario,"onUpdate:modelValue":[e[3]||(e[3]=i=>o.acreditacion.usuario=i),e[5]||(e[5]=i=>o.saldo_anterior())],options:o.empleados,"transition-show":"jump-up","transition-hide":"jump-down","options-dense":"",dense:"",outlined:"",disable:o.disabled,readonly:o.disabled,error:!!o.v$.usuario.$errors.length,onBlur:o.v$.usuario.$touch,"error-message":"Debes seleccionar un empleado","use-input":"","input-debounce":"0",onPopupShow:e[4]||(e[4]=i=>o.ordenarLista(o.empleados,"apellidos")),onFilter:o.filtrarEmpleados,"option-value":i=>i.id,"option-label":i=>i.apellidos+" "+i.nombres,"emit-value":"","map-options":""},{error:r(()=>[(n(!0),d(h,null,$(o.v$.usuario.$errors,i=>(n(),d("div",{key:i.$uid},[s("div",ne,g(i.$message),1)]))),128))]),"no-option":r(()=>[l(I,null,{default:r(()=>[l(L,{class:"text-grey"},{default:r(()=>e[17]||(e[17]=[f(" No hay resultados ")])),_:1})]),_:1})]),_:1},8,["modelValue","options","disable","readonly","error","onBlur","onFilter","option-value","option-label"])]),s("div",de,[e[20]||(e[20]=s("label",{class:"q-mb-sm block"},"Tipo Fondo",-1)),l(O,{modelValue:o.acreditacion.tipo_fondo,"onUpdate:modelValue":e[6]||(e[6]=i=>o.acreditacion.tipo_fondo=i),options:o.tiposFondos,"transition-show":"jump-up","transition-hide":"jump-down","options-dense":"",dense:"",outlined:"",disable:o.disabled,readonly:o.disabled,error:!!o.v$.tipo_fondo.$errors.length,"error-message":"Debes seleccionar un tipo de fondo","use-input":"","input-debounce":"0",onFilter:o.filtrarTiposFondos,"option-value":i=>i.id,onBlur:o.v$.tipo_fondo.$touch,"option-label":i=>i.descripcion,"emit-value":"","map-options":""},{error:r(()=>[(n(!0),d(h,null,$(o.v$.tipo_fondo.$errors,i=>(n(),d("div",{key:i.$uid},[s("div",ue,g(i.$message),1)]))),128))]),"no-option":r(()=>[l(I,null,{default:r(()=>[l(L,{class:"text-grey"},{default:r(()=>e[19]||(e[19]=[f(" No hay resultados ")])),_:1})]),_:1})]),_:1},8,["modelValue","options","disable","readonly","error","onFilter","option-value","onBlur","option-label"])]),s("div",ce,[e[22]||(e[22]=s("label",{class:"q-mb-sm block"},"Tipo Saldo",-1)),l(O,{modelValue:o.acreditacion.tipo_saldo,"onUpdate:modelValue":e[7]||(e[7]=i=>o.acreditacion.tipo_saldo=i),options:o.tiposSaldos,"transition-show":"jump-up","transition-hide":"jump-down","options-dense":"",dense:"",outlined:"",disable:o.disabled,readonly:o.disabled,error:!!o.v$.tipo_saldo.$errors.length,"error-message":"Debes seleccionar un tipo de saldo","use-input":"",onBlur:o.v$.tipo_saldo.$touch,"input-debounce":"0",onFilter:o.filtrarTiposSaldos,"option-value":i=>i.id,"option-label":i=>i.descripcion,"emit-value":"","map-options":""},{error:r(()=>[(n(!0),d(h,null,$(o.v$.tipo_saldo.$errors,i=>(n(),d("div",{key:i.$uid},[s("div",me,g(i.$message),1)]))),128))]),"no-option":r(()=>[l(I,null,{default:r(()=>[l(L,{class:"text-grey"},{default:r(()=>e[21]||(e[21]=[f(" No hay resultados ")])),_:1})]),_:1})]),_:1},8,["modelValue","options","disable","readonly","error","onBlur","onFilter","option-value","option-label"])]),s("div",pe,[e[23]||(e[23]=s("label",{class:"q-mb-sm block"},"Referencia:",-1)),l(A,{autogrow:"",modelValue:o.acreditacion.id_saldo,"onUpdate:modelValue":e[8]||(e[8]=i=>o.acreditacion.id_saldo=i),placeholder:"Obligatorio",disable:o.disabled,error:!!o.v$.id_saldo.$errors.length,onBlur:o.v$.id_saldo.$touch,outlined:"",dense:""},{error:r(()=>[(n(!0),d(h,null,$(o.v$.id_saldo.$errors,i=>(n(),d("div",{key:i.$uid},[s("div",fe,g(i.$message),1)]))),128))]),_:1},8,["modelValue","disable","error","onBlur"])]),s("div",be,[e[24]||(e[24]=s("label",{class:"q-mb-sm block"},"Descripci\xF3n del Saldo:",-1)),l(A,{modelValue:o.acreditacion.descripcion_acreditacion,"onUpdate:modelValue":e[9]||(e[9]=i=>o.acreditacion.descripcion_acreditacion=i),placeholder:"Obligatorio",disable:o.disabled,error:!!o.v$.descripcion_acreditacion.$errors.length,onBlur:o.v$.descripcion_acreditacion.$touch,outlined:"",dense:""},{error:r(()=>[(n(!0),d(h,null,$(o.v$.descripcion_acreditacion.$errors,i=>(n(),d("div",{key:i.$uid},[s("div",ve,g(i.$message),1)]))),128))]),_:1},8,["modelValue","disable","error","onBlur"])]),o.accion!==o.acciones.consultar?(n(),d("div",ge,[e[25]||(e[25]=s("label",{class:"q-mb-sm block"},"Saldo Anterior(*):",-1)),l(A,{modelValue:o.acreditacion.saldo_anterior,"onUpdate:modelValue":e[10]||(e[10]=i=>o.acreditacion.saldo_anterior=i),placeholder:"Obligatorio",disable:"",outlined:"",dense:"",type:"number"},null,8,["modelValue"])])):V("",!0),s("div",he,[e[26]||(e[26]=s("label",{class:"q-mb-sm block"},"Monto:",-1)),l(A,{modelValue:o.acreditacion.monto,"onUpdate:modelValue":e[11]||(e[11]=i=>o.acreditacion.monto=i),placeholder:"Obligatorio",disable:o.disabled,error:!!o.v$.monto.$errors.length,onBlur:o.v$.monto.$touch,outlined:"",dense:"",type:"number"},{error:r(()=>[(n(!0),d(h,null,$(o.v$.monto.$errors,i=>(n(),d("div",{key:i.$uid},[s("div",$e,g(i.$message),1)]))),128))]),_:1},8,["modelValue","disable","error","onBlur"])]),o.accion!==o.acciones.consultar?(n(),d("div",ye,[e[27]||(e[27]=s("label",{class:"q-mb-sm block"},"Saldo Disponible:",-1)),l(No,{square:""},{default:r(()=>[l(Io,{icon:"bi-currency-dollar",color:"green","text-color":"white"}),f(" "+g(o.acreditacion.saldo_actual.toFixed(2)),1)]),_:1})])):V("",!0)])):(n(),d("div",we,[o.accion==o.acciones.nuevo?(n(),d("div",Ae,[s("label",Ve,[e[29]||(e[29]=f("Reporte de Produbanco ")),e[30]||(e[30]=s("i",{class:"bi bi-info-circle"},null,-1)),l(Uo,{class:"bg-light-blue-7"},{default:r(()=>e[28]||(e[28]=[f("Suba el reporte emitido por PRODUBANCO")])),_:1})]),l(p,{ref:"refArchivo",mixin:o.mixin2,endpoint:o.endpoint,disable:o.disabled,"permitir-eliminar":!1,"mostrar-listado":!1,"listar-al-guardar":!1,esMultiple:!1},{"boton-subir":r(()=>{var i;return[(i=o.refArchivo)!=null&&i.quiero_subir_archivos?(n(),J(Q,{key:0,color:"positive",push:"","no-caps":"",class:"full-width q-mb-lg",onClick:e[12]||(e[12]=U=>o.subirArchivos())},{default:r(()=>[l(B,{name:"bi-upload",class:"q-mr-sm",size:"xs"}),e[31]||(e[31]=f(" Subir archivos seleccionados"))]),_:1})):V("",!0)]}),_:1},8,["mixin","endpoint","disable"])])):V("",!0)]))]),_:1}),o.accion===o.acciones.consultar&&o.acreditacion.estado=="REALIZADO"?(n(),d("div",Ce,[l(Q,{color:"negative",onClick:e[14]||(e[14]=i=>o.anularAcreditacion(o.acreditacion))},{default:r(()=>[l(B,{class:"q-pr-sm",name:"bi-x-circle",size:"xs"}),e[32]||(e[32]=f("Anular"))]),_:1})])):V("",!0)]),_:1},8,["mixin","configuracionColumnas","accion1","tabOptions","filtrar"])}var fi=Do(ee,[["render",Fe]]);export{fi as default};
