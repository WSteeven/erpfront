var lo=Object.defineProperty;var ro=(o,e,s)=>e in o?lo(o,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):o[e]=s;var L=(o,e,s)=>(ro(o,typeof e!="symbol"?e+"":e,s),s);import{a as uo,Q as mo}from"./QTabs.4ee0c65d.js";import{a as co,Q as po}from"./QTabPanels.0148950e.js";import{Q as vo}from"./QPage.f3b97ac0.js";import{by as H,s as Y,d as K,u as W,e as go,c as _,a1 as bo,db as D,_ as X,t as w,v as n,P as Z,F as l,y as u,K as F,z as t,D as T,x as r,J as c,I as z,G as j,H as N,bh as fo,R as Co,p as So,a4 as J}from"./index.70185135.js";import{E as Ao}from"./EssentialTable.c4a035e4.js";import{M as Fo}from"./ModalEntidad.7d323d29.js";import{S as $o}from"./SolicitarArchivo.dd24414c.js";import{C as Mo,a as jo}from"./ComponenteModal.domain.9bc16b73.js";import{Q as h,a as P}from"./QItemSection.1a41b826.js";import{Q as $}from"./QSelect.b1759751.js";import{r as M,h as _o}from"./i18n-validators.ea544161.js";import{u as yo}from"./index.004ff2d8.js";import{S as ko}from"./SimpleLayout.f041788f.js";import{F as Vo,u as Eo}from"./FiltroMiBodegaEmpleado.222d4551.js";import{S as x,a as Oo}from"./SeguimientoConsumoActivoFijoController.27fe5875.js";import{u as Uo}from"./filtrosListadosGenerales.6ad178d9.js";import{s as No,v as wo}from"./utils.2eab62de.js";import{A as Io}from"./ArchivoController.b46f2c35.js";import{C as To}from"./ContenedorSimpleMixin.0ef3239b.js";import"./QResizeObserver.721a0e6c.js";import"./touch.9135741d.js";import"./position-engine.f244a0db.js";import"./QPopupProxy.c164d2ac.js";import"./format.8ac60962.js";import"./QMenu.7527c31d.js";import"./QFile.f60a5ba1.js";import"./QChip.a6a2afa6.js";import"./QToolbar.f2167ded.js";import"./use-fullscreen.ec50b882.js";import"./QBadge.5bb69fff.js";import"./_commonjsHelpers.8402d862.js";import"./QImg.04221389.js";import"./VisorImagen.7aac4fec.js";import"./seleccionContratacionPersonal.utils.e3e1ed3d.js";import"./ErrorComponent.60ce3364.js";import"./configuracion_general.27135600.js";import"./ConfiguracionController.40960b9d.js";import"./GestorArchivos.86e356d7.js";import"./QUploader.128864d5.js";import"./QCircularProgress.d0f86e92.js";import"./configuracionColumnasArchivoSubtarea.215f4ffd.js";import"./index.9f64ebda.js";import"./buttonSubmits.f728eedc.js";import"./ClienteMaterialEmpleadoController.96a728b1.js";import"./listadoMaterialesDevolucion.faceceb0.js";import"./entidadAuditable.75a46700.js";const zo=[{name:"created_at",field:"created_at",label:"Fecha y hora de registro",align:"left",sortable:!0},{name:"cantidad_utilizada",field:"cantidad_utilizada",label:"Cantidad utilizada",align:"left",sortable:!0},{name:"detalle_producto",field:"detalle_producto",label:"Detalle de producto",align:"left",sortable:!0},{name:"serie",field:"serie",label:"Serie",align:"left",sortable:!0},{name:"canton",field:"canton",label:"Cant\xF3n",align:"left",sortable:!0},{name:"categoria_motivo_consumo",field:"categoria_motivo_consumo",label:"Categor\xEDa motivo consumo",align:"left",sortable:!0},{name:"motivo_consumo",field:"motivo_consumo",label:"Motivo de consumo",align:"left",sortable:!0},{name:"se_reporto_sicosep",field:"se_reporto_sicosep",label:"Se report\xF3 sicosep",align:"left",sortable:!0},{name:"observacion",field:"observacion",label:"Observaci\xF3n",align:"left",sortable:!0}];class ho extends H{constructor(){super(Y.categorias_motivos_consumo_activos_fijos)}}class Po extends H{constructor(){super(Y.motivos_consumo_activos_fijos)}}var qo=K({components:{SimpleLayout:ko},props:{mixinModal:{type:Object,required:!0}},setup(o){const e=W(),{entidad:s,listado:b,listadosAuxiliares:f}=o.mixinModal.useReferencias(),{listar:C,cargarVista:m,obtenerListados:i,setValidador:p}=o.mixinModal.useComportamiento(),{onBeforeGuardar:d,onBeforeModificar:y}=o.mixinModal.useHooks(),g=go(new Vo),S=_(0),k=_(0),A=_(!1),V=(()=>{switch("JPCONSTRUCRED"){case D.JPCONSTRUCRED:return"Seleccione un cliente";case D.JPCUSTODY:return"Cliente"}})();m(async()=>{await i({categoriasMotivosConsumoActivosFijos:new ho,motivosConsumoActivosFijos:new Po,cantones:JSON.parse(bo.getItem("cantones").toString())})});const{categoriasMotivosConsumoActivosFijos:I,filtrarCategoriasMotivosConsumoActivosFijos:E,motivosConsumoActivosFijos:O,filtrarMotivosConsumoActivosFijos:oo,cantones:eo,filtrarCantones:io}=Uo(f),{clientesMaterialesStock:U,consultarClientesMaterialesStock:to,consultarActivosFijosAsignados:q,activosFijosAsignados:B}=Eo(g),Q=v=>{g.cliente_id=v,q()},ao=v=>{const G=B.value.find(no=>no.detalle_producto_id===v);S.value=G?G.stock_actual:0},so={cantidad_utilizada:{required:M,maxima:_o.withMessage("La cantidad utilizada no puede ser mayor a la cantidad en stock actual",v=>v<=S.value)},categoria_motivo_consumo:{required:M},motivo_consumo:{required:M},cliente:{required:M},canton:{required:M}},R=yo(so,s);return p(R.value),d(()=>s.cantidad_anterior=k.value),y(()=>s.cantidad_anterior=k.value),g.empleado_id=e.user.id,s.hydrate(new x),s.cliente=void 0,to().then(()=>{U.value=U.value.filter(v=>!!v.cliente_id),A.value=U.value.length==1,A.value&&(s.cliente=1,Q(s.cliente))}),{v$:R,seguimiento:s,clientesMaterialesStock:U,activosFijosAsignados:B,obtenerActivosFijoPorCliente:Q,consultarActivosFijosAsignados:q,filtro:g,seleccionarActivoFijo:ao,stockActual:S,categoriasMotivosConsumoActivosFijos:I,filtrarCategoriasMotivosConsumoActivosFijos:E,motivosConsumoActivosFijos:O,filtrarMotivosConsumoActivosFijos:oo,cantones:eo,filtrarCantones:io,ordenarLista:No,labelCliente:V,deshabilitadoCliente:A}}});const Bo={class:"row q-col-gutter-sm q-pa-md"},Qo={class:"col-12 col-md-3"},Ro={class:"q-mb-sm block"},Go={key:0,class:"col-12 col-md-9"},Lo={key:1,class:"col-12 col-md-3"},Do={key:2,class:"col-12 col-md-3"},Jo={key:3,class:"col-12 col-md-3 col-sm-3"},Ho={class:"error-msg"},Yo={key:4,class:"col-12 col-md-3"},Ko={class:"error-msg"},Wo={key:5,class:"col-12 col-md-3"},Xo={class:"error-msg"},Zo={key:6,class:"col-12 col-md-3"};function xo(o,e,s,b,f,C){const m=w("simple-layout");return n(),Z(m,{mixin:o.mixinModal},{formulario:l(()=>[u("div",Bo,[u("div",Qo,[u("label",Ro,F(o.labelCliente),1),t($,{modelValue:o.seguimiento.cliente,"onUpdate:modelValue":[e[0]||(e[0]=i=>o.seguimiento.cliente=i),e[1]||(e[1]=i=>o.obtenerActivosFijoPorCliente(o.seguimiento.cliente))],options:o.clientesMaterialesStock,"transition-show":"scale","transition-hide":"scale","options-dense":"",dense:"",outlined:"",disable:o.deshabilitadoCliente,"option-label":i=>i.razon_social,"option-value":i=>i.cliente_id,"emit-value":"","map-options":""},{"no-option":l(()=>[t(h,null,{default:l(()=>[t(P,{class:"text-grey"},{default:l(()=>e[12]||(e[12]=[T(" No hay activos fijos asignados o el stock de los activos est\xE1 en cero ")])),_:1})]),_:1})]),_:1},8,["modelValue","options","disable","option-label","option-value"])]),o.seguimiento.cliente?(n(),r("div",Go,[e[14]||(e[14]=u("label",{class:"q-mb-sm block"},"Seleccione un activo fijo",-1)),t($,{modelValue:o.seguimiento.detalle_producto,"onUpdate:modelValue":[e[2]||(e[2]=i=>o.seguimiento.detalle_producto=i),e[3]||(e[3]=i=>o.seleccionarActivoFijo(o.seguimiento.detalle_producto))],options:o.activosFijosAsignados,"transition-show":"scale","transition-hide":"scale","options-dense":"",dense:"",outlined:"","option-label":i=>i.detalle_producto+" | "+i.serial,"option-value":i=>i.detalle_producto_id,"emit-value":"","map-options":""},{"no-option":l(()=>[t(h,null,{default:l(()=>[t(P,{class:"text-grey"},{default:l(()=>e[13]||(e[13]=[T(" No hay activos fijos asignados o el stock de los activos est\xE1 en cero ")])),_:1})]),_:1})]),_:1},8,["modelValue","options","option-label","option-value"])])):c("",!0),o.seguimiento.detalle_producto?(n(),r("div",Lo,[e[15]||(e[15]=u("label",{class:"q-mb-sm block"},"Stock actual",-1)),t(z,{modelValue:o.stockActual,"onUpdate:modelValue":e[4]||(e[4]=i=>o.stockActual=i),outlined:"",disable:"",dense:""},null,8,["modelValue"])])):c("",!0),o.seguimiento.detalle_producto?(n(),r("div",Do,[e[16]||(e[16]=u("label",{class:"q-mb-sm block"},"Cantidad a utilizar",-1)),t(z,{modelValue:o.seguimiento.cantidad_utilizada,"onUpdate:modelValue":e[5]||(e[5]=i=>o.seguimiento.cantidad_utilizada=i),type:"number",outlined:"",dense:"",error:!!o.v$.cantidad_utilizada.$errors.length,onBlur:o.v$.cantidad_utilizada.$touch},{error:l(()=>[(n(!0),r(j,null,N(o.v$.cantidad_utilizada.$errors,i=>(n(),r("div",{key:i.$uid},[u("div",null,F(i.$message),1)]))),128))]),_:1},8,["modelValue","error","onBlur"])])):c("",!0),o.seguimiento.detalle_producto?(n(),r("div",Jo,[e[18]||(e[18]=u("label",{class:"q-mb-sm block"},"Canton",-1)),t($,{modelValue:o.seguimiento.canton,"onUpdate:modelValue":e[6]||(e[6]=i=>o.seguimiento.canton=i),options:o.cantones,"transition-show":"jump-up","transition-hide":"jump-down","options-dense":"",dense:"",outlined:"","input-debounce":0,"use-input":"",onFilter:o.filtrarCantones,onPopupShow:e[7]||(e[7]=i=>o.ordenarLista(o.cantones,"canton")),"option-value":i=>i.id,"option-label":i=>i.canton,"emit-value":"","map-options":"",error:!!o.v$.canton.$errors.length,onBlur:o.v$.canton.$touch},{error:l(()=>[(n(!0),r(j,null,N(o.v$.canton.$errors,i=>(n(),r("div",{key:i.$uid},[u("div",Ho,F(i.$message),1)]))),128))]),"no-option":l(()=>[t(h,null,{default:l(()=>[t(P,{class:"text-grey"},{default:l(()=>e[17]||(e[17]=[T(" No hay resultados ")])),_:1})]),_:1})]),_:1},8,["modelValue","options","onFilter","option-value","option-label","error","onBlur"])])):c("",!0),o.seguimiento.detalle_producto?(n(),r("div",Yo,[e[19]||(e[19]=u("label",{class:"q-mb-sm block"},"Categoria de motivo consumo de activo fijo",-1)),t($,{modelValue:o.seguimiento.categoria_motivo_consumo,"onUpdate:modelValue":[e[8]||(e[8]=i=>o.seguimiento.categoria_motivo_consumo=i),e[9]||(e[9]=i=>o.seleccionarActivoFijo(o.seguimiento.detalle_producto))],options:o.categoriasMotivosConsumoActivosFijos,onFilter:o.filtrarCategoriasMotivosConsumoActivosFijos,"transition-show":"scale","transition-hide":"scale","options-dense":"",dense:"",outlined:"","option-label":i=>i.nombre,"option-value":i=>i.id,"use-input":"","input-debounce":"0","emit-value":"","map-options":"",error:!!o.v$.categoria_motivo_consumo.$errors.length,onBlur:o.v$.categoria_motivo_consumo.$touch},{error:l(()=>[(n(!0),r(j,null,N(o.v$.categoria_motivo_consumo.$errors,i=>(n(),r("div",{key:i.$uid},[u("div",Ko,F(i.$message),1)]))),128))]),_:1},8,["modelValue","options","onFilter","option-label","option-value","error","onBlur"])])):c("",!0),o.seguimiento.detalle_producto?(n(),r("div",Wo,[e[20]||(e[20]=u("label",{class:"q-mb-sm block"},"Motivo consumo de activo fijo",-1)),t($,{modelValue:o.seguimiento.motivo_consumo,"onUpdate:modelValue":e[10]||(e[10]=i=>o.seguimiento.motivo_consumo=i),options:o.motivosConsumoActivosFijos,onFilter:o.filtrarMotivosConsumoActivosFijos,"transition-show":"scale","transition-hide":"scale","options-dense":"",dense:"",outlined:"","option-label":i=>i.nombre,"option-value":i=>i.id,"use-input":"","input-debounce":"0","emit-value":"","map-options":"",error:!!o.v$.motivo_consumo.$errors.length,onBlur:o.v$.motivo_consumo.$touch},{error:l(()=>[(n(!0),r(j,null,N(o.v$.motivo_consumo.$errors,i=>(n(),r("div",{key:i.$uid},[u("div",Xo,F(i.$message),1)]))),128))]),_:1},8,["modelValue","options","onFilter","option-label","option-value","error","onBlur"])])):c("",!0),o.seguimiento.detalle_producto?(n(),r("div",Zo,[e[21]||(e[21]=u("label",{class:"q-mb-sm block"},"Observaci\xF3n",-1)),t(z,{modelValue:o.seguimiento.observacion,"onUpdate:modelValue":e[11]||(e[11]=i=>o.seguimiento.observacion=i),outlined:"",dense:""},null,8,["modelValue"])])):c("",!0)])]),_:1},8,["mixin"])}var oe=X(qo,[["render",xo]]);class ee{constructor(){L(this,"AgregarSeguimientoConsumoActivoFijoPage");this.AgregarSeguimientoConsumoActivoFijoPage=fo(new Mo("Agregar seguimiento consumo activo fijo",oe))}}class ie extends jo{constructor(){super(new ee)}}var te=K({components:{EssentialTable:Ao,ModalEntidad:Fo,SolicitarArchivo:$o},setup(){const o=W(),e={SEGUIMIENTO_CONSUMO:"Seguimiento de consumo",HISTORIAL_SEGUIMIENTO:"Historial del seguimiento de consumo"},s=_(e.SEGUIMIENTO_CONSUMO),b=new ie,{prompt:f}=Co(),C=_(!1),m=new To(x,new Oo,new Io),{entidad:i,listado:p}=m.useReferencias(),{listar:d,editarParcial:y}=m.useComportamiento(),g={titulo:"Agregar seguimiento",icono:"bi-plus",color:"primary",accion:()=>b.abrirModalEntidad("AgregarSeguimientoConsumoActivoFijoPage")},S={titulo:"Editar cantidad",icono:"bi-pencil",color:"primary",visible:({entidad:a})=>wo("YYYY-MM-DD")===a.created_at.split(" ")[0],accion:async({entidad:a,posicion:V})=>{const I={titulo:"Editar cantidad",mensaje:"Ingresa la cantidad",tipo:"number",defecto:p.value[V].cantidad_utilizada,accion:async E=>{var O;i.hydrate(a),await y(a.id,{detalle_producto_id:a.detalle_producto_id,cliente_id:a.cliente_id,cantidad_anterior:(O=a.cantidad_utilizada)!=null?O:0,cantidad_utilizada:E}),p.value[V].cantidad_utilizada=E}};f(I)}},k={titulo:"Justificativo uso",icono:"bi-upload",color:"blue-grey",accion:async({entidad:a})=>{i.hydrate(a),C.value=!0}},A={titulo:({entidad:a})=>a.se_reporto_sicosep?"No se report\xF3 Sicosep":"Se report\xF3 Sicosep",icono:({entidad:a})=>a.se_reporto_sicosep?"bi-toggle2-on":"bi-toggle2-off",color:({entidad:a})=>a.se_reporto_sicosep?"negative":"positive",accion:({entidad:a})=>y(a.id,{se_reporto_sicosep:!a.se_reporto_sicosep})};return d({empleado_id:o.user.id}),{tab:s,listado:p,mixin:m,opcionesSeguimientoConsumo:e,configuracionColumnasSeguimientoConsumoActivoFijo:zo,accionesTabla:So,btnAgregar:g,btnEditar:S,btnJustificativoUso:k,btnSeReportoSicosep:A,modales:b,mostrarSolicitarArchivo:C,seguimiento:i}}});function ae(o,e,s,b,f,C){const m=w("essential-table"),i=w("solicitar-archivo"),p=w("modal-entidad");return n(),r(j,null,[t(vo,{padding:""},{default:l(()=>[t(uo,{modelValue:o.tab,"onUpdate:modelValue":e[0]||(e[0]=d=>o.tab=d),align:"left","switch-indicator":"","active-class":"tab-active","indicator-color":"transparent",dense:""},{default:l(()=>[t(mo,{name:o.opcionesSeguimientoConsumo.SEGUIMIENTO_CONSUMO,label:o.opcionesSeguimientoConsumo.SEGUIMIENTO_CONSUMO,class:J({"tab-inactive":o.tab!==o.opcionesSeguimientoConsumo.SEGUIMIENTO_CONSUMO}),"no-caps":""},null,8,["name","label","class"])]),_:1},8,["modelValue"]),t(co,{modelValue:o.tab,"onUpdate:modelValue":e[1]||(e[1]=d=>o.tab=d),animated:"","transition-prev":"scale","transition-next":"scale",class:J(["bg-desenfoque border-white q-mb-md",{"rounded-tabpanel":!o.$q.screen.xs}]),"keep-alive":""},{default:l(()=>[t(po,{name:o.opcionesSeguimientoConsumo.SEGUIMIENTO_CONSUMO},{default:l(()=>[t(m,{titulo:o.opcionesSeguimientoConsumo.SEGUIMIENTO_CONSUMO,configuracionColumnas:[...o.configuracionColumnasSeguimientoConsumoActivoFijo,o.accionesTabla],datos:o.listado,permitirConsultar:!1,permitirEditar:!1,permitirEliminar:!1,permitirFiltrar:!1,mostrarExportar:!0,ajustarCeldas:!0,accion1Header:o.btnAgregar,accion1:o.btnEditar,accion2:o.btnJustificativoUso,accion3:o.btnSeReportoSicosep},null,8,["titulo","configuracionColumnas","datos","accion1Header","accion1","accion2","accion3"])]),_:1},8,["name"])]),_:1},8,["modelValue","class"])]),_:1}),o.mostrarSolicitarArchivo?(n(),Z(i,{key:0,mostrar:o.mostrarSolicitarArchivo,onCerrar:e[2]||(e[2]=d=>o.mostrarSolicitarArchivo=!1),mixin:o.mixin},null,8,["mostrar","mixin"])):c("",!0),t(p,{comportamiento:o.modales,"mixin-modal":o.mixin,"confirmar-cerrar":!1,persistente:!1},null,8,["comportamiento","mixin-modal"])],64)}var Ze=X(te,[["render",ae]]);export{Ze as default};
