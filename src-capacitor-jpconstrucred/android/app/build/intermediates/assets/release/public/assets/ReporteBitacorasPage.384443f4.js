import{Q as D,a as S}from"./QSelect.b1759751.js";import{Q as ae,a as le}from"./QItemSection.1a41b826.js";import{d as se,R as re,bc as ie,m as E,e as te,c as w,h as ne,a1 as R,bo as ue,q as y,p as me,A as de,bH as ce,s as pe,_ as fe,t as C,v as _,P as F,F as s,z as a,y as r,bd as A,x as be,M as ve,N as he,D as L,K as N,J as U,I as $,B as c,j as O,O as p}from"./index.70185135.js";import{Q as T,a as M,C as j}from"./QPopupProxy.c164d2ac.js";import{E as ge,c as Ve}from"./EssentialTable.c4a035e4.js";import{Q as ke}from"./QPage.f3b97ac0.js";import{Q as we,a as ye}from"./QLayout.3c96c6fd.js";import{u as Ce,S as _e,W as z,M as $e,L as K,A as H}from"./utils.2eab62de.js";import{u as qe}from"./index.004ff2d8.js";import{E as Qe}from"./ErrorComponent.60ce3364.js";import{N as Be}from"./NoOptionComponent.4eefbc12.js";import{B as Ie,a as Pe,u as De}from"./Functions.3e789c89.js";import{V as Se}from"./VehiculoController.656ab648.js";import{C as Ee}from"./ContenedorSimpleMixin.0ef3239b.js";import{u as Re}from"./filtrosListadosGenerales.6ad178d9.js";import{r as G,a as Fe}from"./i18n-validators.ea544161.js";import"./QChip.a6a2afa6.js";import"./QMenu.7527c31d.js";import"./position-engine.f244a0db.js";import"./format.8ac60962.js";import"./QFile.f60a5ba1.js";import"./QToolbar.f2167ded.js";import"./use-fullscreen.ec50b882.js";import"./QBadge.5bb69fff.js";import"./_commonjsHelpers.8402d862.js";import"./QImg.04221389.js";import"./VisorImagen.7aac4fec.js";import"./seleccionContratacionPersonal.utils.e3e1ed3d.js";import"./QScrollObserver.0842fd40.js";import"./QResizeObserver.721a0e6c.js";import"./entidadAuditable.75a46700.js";import"./index.9f64ebda.js";const Ae=[{name:"id",field:"id",label:"Bit\xE1cora",align:"left",sortable:!0},{name:"vehiculo",field:"vehiculo",label:"Placa",align:"left",sortable:!0},{name:"chofer",field:"chofer",label:"Chofer",align:"left",sortable:!0},{name:"fecha",field:"fecha",label:"fecha",align:"left",sortable:!0},{name:"hora_salida",field:"hora_salida",label:"H Salida",align:"left",sortable:!0},{name:"hora_llegada",field:"hora_llegada",label:"H. Llegada",align:"left",sortable:!0},{name:"km_inicial",field:"km_inicial",label:"Km Inicio",align:"left",sortable:!0},{name:"km_final",field:"km_final",label:"Km Final",align:"left",sortable:!0},{name:"km_recorridos",field:"km_recorridos",label:"Km Recorridos",align:"left",sortable:!0},{name:"tareas",field:"tareas",label:"Tareas",align:"left",sortable:!0}];var Le=se({name:"ReporteBitacorasPage",components:{EssentialTable:ge,ErrorComponent:Qe,NoOptionComponent:Be},setup(){const o=new Ee(Ie,new Pe),{listadosAuxiliares:e}=o.useReferencias(),{cargarVista:q,obtenerListados:v}=o.useComportamiento(),{notificarError:Q,notificarAdvertencia:B}=re();ie().setQuasar(E()),Ce().setQuasar(E());const u=new _e,n=te({tipo:null,fecha_inicio:"",fecha_fin:"",vehiculo:null,todos:!1}),h="todos",l="individual",J=[h,l],m=w(),f=w([]),{vehiculos:g,filtrarVehiculos:W}=Re(e),{imprimirPdf:X}=De();q(async()=>{await v({vehiculos:[]}),g.value=e.vehiculos;const t=z(new Date),i=$e(t,-1),d=z(i);n.fecha_inicio=K(d,y),n.fecha_fin=K(i,y)});const Y={tipo:{required:G},vehiculo:{required:Fe(()=>n.tipo==l)},fecha_inicio:{required:G}},I=qe(Y,n);ne(()=>{var t;m.value=(t=R.getItem("umbral_km_consumidos"))!=null?t:5200}),ue(()=>{R.set("umbral_km_consumidos",m.value)});async function Z(t){t==l&&(await v({vehiculos:{controller:new Se,params:{estado:1}}}),g.value=e.vehiculos)}async function x(t,i,d){if(await I.value.$validate())try{u.activar();const b=de.getInstance(),V=ce.URL_BASE+"/"+b.getEndpoint(pe.reporte_bitacoras),P="reporte_bitacoras";switch(t){case"excel":return i.accion="excel",i.umbral=m.value,await H(V,"POST","blob","xlsx",P,i),d;case"pdf":return i.accion="pdf",i.umbral=m.value,await H(V,"POST","blob","pdf",P,i),d;default:i.accion="";const k=await b.post(V,i);return k.data.results?(k.data.results.length<1&&B("No se obtuvieron resultados"),k.data.results):d}}catch(b){console.log(b),Q("Error al obtener el reporte")}finally{u.desactivar()}}async function ee(t){const i=w([]);i.value=await x(t,n,f.value),f.value=i.value,console.log(i.value),console.log(f.value)}const oe={titulo:"Imprimir",icono:"bi-printer",color:"secondary",accion:async({entidad:t})=>{await X(t.id)}};return{v$:I,listado:f,listadosAuxiliares:e,mixin:o,reporte:n,maskFecha:y,INDIVIDUAL:l,configuracionColumnas:[...Ae,me],umbral_km_consumidos:m,vehiculos:g,filtrarVehiculos:W,opciones:J,btnImprimir:oe,buscarReporte:ee,consultarListado:Z}}});const Ne={class:"col"},Ue={class:"row q-col-gutter-sm q-pa-sm q-py-md"},Oe={class:"col-12 col-md-3"},Te={key:0,class:"col-12 col-md-3 q-mb-md"},Me={class:"col-12 col-md-3"},je={class:"row items-center justify-end"},ze={class:"col-12 col-md-3"},Ke={class:"row items-center justify-end"},He={class:"col-12 col-md-3"},Ge={class:"col-12 col-md-12 q-mt-md"},Je={class:"text-center"},We={class:"row q-col-gutter-sm q-py-md q-mb-lg"},Xe={class:"col-12"};function Ye(o,e,q,v,Q,B){const u=C("error-component"),n=C("no-option-component"),h=C("essential-table");return _(),F(ye,null,{default:s(()=>[a(we,null,{default:s(()=>[a(ke,{padding:""},{default:s(()=>[r("div",Ne,[a(A,{class:"col rounded no-border q-pb-md"},{default:s(()=>[r("div",Ue,[r("div",Oe,[e[11]||(e[11]=r("label",{class:"q-mb-sm block"},"Tipo de reporte",-1)),a(D,{modelValue:o.reporte.tipo,"onUpdate:modelValue":[e[0]||(e[0]=l=>o.reporte.tipo=l),e[1]||(e[1]=l=>o.consultarListado(o.reporte.tipo))],options:o.opciones,"transition-show":"scale","transition-hide":"scale","options-dense":"",dense:"",outlined:"",error:!!o.v$.tipo.$errors.length,"emit-value":"","map-options":""},{error:s(()=>[a(u,{clave:"tipo",v$:o.v$},null,8,["v$"])]),_:1},8,["modelValue","options","error"])]),o.reporte.tipo==o.INDIVIDUAL?(_(),be("div",Te,[e[12]||(e[12]=r("label",{class:"q-mb-sm block"},"Veh\xEDculo",-1)),a(D,{modelValue:o.reporte.vehiculo,"onUpdate:modelValue":e[2]||(e[2]=l=>o.reporte.vehiculo=l),options:o.vehiculos,hint:"Agregue elementos desde el panel de veh\xEDculos","transition-show":"scale","transition-hide":"scale","options-dense":"",clearable:"",dense:"",outlined:"","use-input":"","input-debounce":"0",onFilter:o.filtrarVehiculos,"option-label":l=>l.placa,"option-value":l=>l.id,error:!!o.v$.vehiculo.$errors.length,onBlur:o.v$.vehiculo.$touch,"emit-value":"","map-options":""},{option:s(l=>[a(ae,ve(he(l.itemProps)),{default:s(()=>[a(le,null,{default:s(()=>[a(S,null,{default:s(()=>[L(N(l.opt.placa),1)]),_:2},1024),a(S,{caption:""},{default:s(()=>[L(N(l.opt.marca+" "+l.opt.modelo),1)]),_:2},1024)]),_:2},1024)]),_:2},1040)]),"no-option":s(()=>[a(n)]),error:s(()=>[a(u,{clave:"vehiculo",v$:o.v$},null,8,["v$"])]),_:1},8,["modelValue","options","onFilter","option-label","option-value","error","onBlur"])])):U("",!0),r("div",Me,[e[13]||(e[13]=r("label",{class:"q-mb-sm block"},"Fecha de inicio",-1)),a($,{modelValue:o.reporte.fecha_inicio,"onUpdate:modelValue":e[4]||(e[4]=l=>o.reporte.fecha_inicio=l),error:!!o.v$.fecha_inicio.$errors.length,placeholder:"Opcional",outlined:"",dense:""},{append:s(()=>[a(c,{name:"event",class:"cursor-pointer"},{default:s(()=>[a(T,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:s(()=>[a(M,{modelValue:o.reporte.fecha_inicio,"onUpdate:modelValue":e[3]||(e[3]=l=>o.reporte.fecha_inicio=l),mask:o.maskFecha,"today-btn":""},{default:s(()=>[r("div",je,[O(a(p,{label:"Cerrar",color:"primary",flat:""},null,512),[[j]])])]),_:1},8,["modelValue","mask"])]),_:1})]),_:1})]),error:s(()=>[a(u,{clave:"fecha_inicio",v$:o.v$},null,8,["v$"])]),_:1},8,["modelValue","error"])]),r("div",ze,[e[14]||(e[14]=r("label",{class:"q-mb-sm block"},"Fecha fin ",-1)),a($,{modelValue:o.reporte.fecha_fin,"onUpdate:modelValue":e[6]||(e[6]=l=>o.reporte.fecha_fin=l),placeholder:"Opcional",outlined:"",dense:""},{append:s(()=>[a(c,{name:"event",class:"cursor-pointer"},{default:s(()=>[a(T,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:s(()=>[a(M,{modelValue:o.reporte.fecha_fin,"onUpdate:modelValue":e[5]||(e[5]=l=>o.reporte.fecha_fin=l),mask:o.maskFecha,"today-btn":""},{default:s(()=>[r("div",Ke,[O(a(p,{label:"Cerrar",color:"primary",flat:""},null,512),[[j]])])]),_:1},8,["modelValue","mask"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),r("div",He,[e[15]||(e[15]=r("label",{class:"q-mb-sm block"},"Umbral Kilometraje ",-1)),a($,{modelValue:o.umbral_km_consumidos,"onUpdate:modelValue":e[7]||(e[7]=l=>o.umbral_km_consumidos=l),type:"number",placeholder:"Opcional",outlined:"",dense:""},null,8,["modelValue"])]),r("div",Ge,[r("div",Je,[a(Ve,{push:""},{default:s(()=>[a(p,{color:"primary",class:"full-width","no-caps":"","no-wrap":"",push:"",glossy:"",onClick:e[8]||(e[8]=l=>o.buscarReporte("consulta"))},{default:s(()=>[a(c,{name:"bi-search",size:"xs",class:"q-pr-sm"}),e[16]||(e[16]=r("span",null,"Buscar",-1))]),_:1}),a(p,{color:"positive",class:"full-width","no-caps":"","no-wrap":"",push:"",glossy:"",onClick:e[9]||(e[9]=l=>o.buscarReporte("excel"))},{default:s(()=>[a(c,{name:"bi-file-earmark-excel-fill",size:"xs",class:"q-mr-sm"}),e[17]||(e[17]=r("span",null,"Excel",-1))]),_:1}),a(p,{color:"negative",class:"full-width","no-caps":"","no-wrap":"",push:"",glossy:"",onClick:e[10]||(e[10]=l=>o.buscarReporte("pdf"))},{default:s(()=>[a(c,{name:"bi-file-earmark-pdf-fill",size:"xs",class:"q-mr-sm"}),e[18]||(e[18]=r("span",null,"PDF",-1))]),_:1})]),_:1})])])])]),_:1}),e[19]||(e[19]=r("br",null,null,-1)),o.listado?(_(),F(A,{key:0,class:"q-mb-md q-mt-sm rounded no-border custom-shadow"},{default:s(()=>[r("div",We,[r("div",Xe,[a(h,{titulo:"Bit\xE1coras de veh\xEDculos",configuracionColumnas:o.configuracionColumnas,datos:o.listado,altoFijo:!1,accion1:o.btnImprimir,permitirConsultar:!1,permitirEditar:!1,permitirEliminar:!1,permitirBuscar:!0,"ajustar-celdas":""},null,8,["configuracionColumnas","datos","accion1"])])])]),_:1})):U("",!0)])]),_:1})]),_:1})]),_:1})}var Do=fe(Le,[["render",Ye]]);export{Do as default};
