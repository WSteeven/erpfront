var z=Object.defineProperty;var G=(e,o,u)=>o in e?z(e,o,{enumerable:!0,configurable:!0,writable:!0,value:u}):e[o]=u;var i=(e,o,u)=>(G(e,typeof o!="symbol"?o+"":o,u),u);import{Q as B,a as F}from"./QSelect.b1759751.js";import{by as H,s as J,d as K,bc as W,m as X,u as Y,c as v,E as Z,bg as x,q as ee,_ as oe,t as y,v as p,P as ae,F as s,z as r,a5 as re,y as n,x as $,J as E,I as w,B as se,j as ne,O as ie,bf as le,D as N,K as k,G as te,H as ue,L as de}from"./index.70185135.js";import{Q as me,a as pe,C as ce}from"./QPopupProxy.c164d2ac.js";import{Q as fe,a as be}from"./QItemSection.1a41b826.js";import{Q as ve}from"./QForm.0c8c3b68.js";import{E as $e}from"./entidadAuditable.75a46700.js";import{T as ge}from"./TabLayout.dfee7537.js";import{S as he}from"./EssentialTable.c4a035e4.js";import{u as Ve}from"./index.004ff2d8.js";import{a as T,r as g,d as Ce,m as L}from"./i18n-validators.ea544161.js";import{C as ye}from"./ContenedorSimpleMixin.0ef3239b.js";import{u as we,c as Se}from"./transferenciaSaldo.49f792f3.js";import{E as qe}from"./EmpleadoPermisosController.2089223f.js";import{I as Be,s as Ee}from"./utils.2eab62de.js";import{N as ke}from"./NoOptionComponent.4eefbc12.js";import{E as Te}from"./ErrorComponent.60ce3364.js";import"./QChip.a6a2afa6.js";import"./QMenu.7527c31d.js";import"./position-engine.f244a0db.js";import"./format.8ac60962.js";import"./QTabs.4ee0c65d.js";import"./QResizeObserver.721a0e6c.js";import"./QTabPanels.0148950e.js";import"./touch.9135741d.js";import"./QPage.f3b97ac0.js";import"./buttonSubmits.f728eedc.js";import"./EssentialTablePagination.959d4e60.js";import"./QToolbar.f2167ded.js";import"./use-fullscreen.ec50b882.js";import"./QBadge.5bb69fff.js";import"./QFile.f60a5ba1.js";import"./_commonjsHelpers.8402d862.js";import"./QImg.04221389.js";import"./VisorImagen.7aac4fec.js";import"./seleccionContratacionPersonal.utils.e3e1ed3d.js";import"./index.9f64ebda.js";class Le extends $e{constructor(){super();i(this,"fecha");i(this,"usuario_envia_info");i(this,"usuario_recibe_info");i(this,"usuario_envia");i(this,"usuario_recibe");i(this,"monto");i(this,"motivo");i(this,"observacion");i(this,"cuenta");i(this,"tarea");i(this,"tarea_info");i(this,"comprobante");i(this,"estado_info");i(this,"es_devolucion");this.fecha=null,this.usuario_envia_info=null,this.usuario_recibe_info=null,this.usuario_envia=null,this.usuario_recibe=null,this.monto=null,this.motivo="TRANSFERENCIA ENTRE USUARIOS",this.observacion=null,this.cuenta=null,this.tarea=null,this.tarea_info=null,this.comprobante=null,this.estado_info=null,this.es_devolucion=!1}}class Qe extends H{constructor(){super(J.transferencia)}}var Ue=K({components:{ErrorComponent:Te,NoOptionComponent:ke,TabLayout:ge,SelectorImagen:he},emits:["guardado","cerrar-modal"],setup(){W().setQuasar(X());const e=Y(),o=e.user,u=we(),h=new ye(Le,new Qe),{entidad:l,disabled:Q,accion:d,listadosAuxiliares:t}=h.useReferencias(),{setValidador:S,obtenerListados:q,cargarVista:a,consultar:D}=h.useComportamiento(),V=v([]),C=v([]),U=v(!0),A=v(!1),I=v([]),j={usuario_envia:{required:T(()=>e.can("puede.registrar.fondos_terceros"))},usuario_recibe:{requiredIf:T(()=>!l.es_devolucion)},monto:{required:g,maxValue:Ce(9999),maxLength:L(50)},cuenta:{required:g,maxLength:L(50)},tarea:{requiredIf:T(()=>!l.es_devolucion)},fecha:{required:g},comprobante:{required:g},observacion:{required:g,maxLength:L(150)}},O=Ve(j,l);S(O.value),u.id_transferencia&&(D({id:u.id_transferencia}),U.value=!1,A.value=!0),a(async()=>{await q({usuarios:{controller:new Z,params:{campos:"id,nombres,apellidos",estado:1}},tareas:{controller:new x,params:{campos:"id,codigo_tarea,titulo,cliente_id,proyecto_id","f_params[orderBy][field]":"id","f_params[orderBy][type]":"DESC","f_params[limit]":100}}}),t.tareas.unshift({id:0,titulo:"Sin Tarea",codigo_tarea:" "}),C.value=t.tareas,V.value=t.usuarios,e.can("puede.registrar.fondos_terceros")&&await P()});async function P(){const m=await new qe().listar({permisos:["puede.delegar.registro_fondos"]});I.value=m.result}function R(m,c){if(m===""){c(()=>{V.value=t.usuarios});return}c(()=>{const f=m.toLowerCase();V.value=t.usuarios.filter(b=>b.nombres.toLowerCase().indexOf(f)>-1||b.apellidos.toLowerCase().indexOf(f)>-1)})}function _(m,c){if(m===""){c(()=>{C.value=t.tareas});return}c(()=>{const f=m.toLowerCase();C.value=t.tareas.filter(b=>b.codigo_tarea.toLowerCase().indexOf(f)>-1||b.titulo.toLowerCase().indexOf(f)>-1)})}function M(){l.es_devolucion?(l.usuario_recibe=null,l.tarea=0,l.motivo="DEVOLUCION"):(l.motivo="TRANSFERENCIA ENTRE USUARIOS",l.tarea=null)}return{mixin:h,transferencia:l,disabled:Q,accion:d,maskFecha:ee,v$:O,store:e,empleados_delegadores:I,optionsFecha:Be,usuarios:V,usuario:o,tareas:C,ordenarLista:Ee,filtrarUsuarios:R,filtrarTareas:_,existeDevolucion:M,mostrarListado:U,configuracionColumnas:Se}}});const Ie={class:"row q-col-gutter-sm q-mb-md"},Oe={key:0,class:"col-12 col-md-3 q-mb-md col-sm-3"},Fe={key:1,class:"col-12 col-md-3 q-mb-md"},Ne={class:"col-12 col-md-3 col-sm-3"},De={class:"row items-center justify-end"},Ae={class:"col-12 col-md-3"},je={class:"col-12 col-md-3"},Pe={key:2,class:"col-12 col-md-3"},Re={class:"col-12 col-md-3"},_e={class:"error-msg"},Me={class:"col-12 col-md-3 q-mb-xl"},ze={class:"col-12 col-md-3"};function Ge(e,o,u,h,l,Q){const d=y("error-component"),t=y("no-option-component"),S=y("selector-imagen"),q=y("tab-layout");return p(),ae(q,{mixin:e.mixin,configuracionColumnas:e.configuracionColumnas,ajustarCeldas:""},{formulario:s(()=>[r(ve,{onSubmit:o[12]||(o[12]=re(()=>{},["prevent"]))},{default:s(()=>[n("div",Ie,[e.store.can("puede.registrar.fondos_terceros")?(p(),$("div",Oe,[o[13]||(o[13]=n("label",{class:"q-mb-sm block"},"Empleado Solicitante",-1)),r(B,{modelValue:e.transferencia.usuario_envia,"onUpdate:modelValue":o[0]||(o[0]=a=>e.transferencia.usuario_envia=a),options:e.empleados_delegadores,"transition-show":"jump-up","transition-hide":"jump-down",disable:e.disabled,"options-dense":"",dense:"",outlined:"",error:!!e.v$.usuario_envia.$errors.length,onBlur:e.v$.usuario_envia.$touch,"error-message":"Debes seleccionar un empleado al que se carga el gasto","use-input":"","input-debounce":"0",onPopupShow:o[1]||(o[1]=a=>e.ordenarLista(e.empleados_delegadores,"nombres")),"option-value":a=>a.id,"option-label":a=>a.nombres+" "+a.apellidos,"emit-value":"","map-options":""},{error:s(()=>[r(d,{clave:"usuario_envia",v$:e.v$},null,8,["v$"])]),"no-option":s(()=>[r(t)]),_:1},8,["modelValue","options","disable","error","onBlur","option-value","option-label"])])):E("",!0),e.transferencia.es_devolucion?E("",!0):(p(),$("div",Fe,[o[14]||(o[14]=n("label",{class:"q-mb-sm block"},"Destinatario:",-1)),r(B,{modelValue:e.transferencia.usuario_recibe,"onUpdate:modelValue":o[2]||(o[2]=a=>e.transferencia.usuario_recibe=a),options:e.usuarios,"transition-show":"jump-up","transition-hide":"jump-down","options-dense":"",dense:"",outlined:"",disable:e.disabled,readonly:e.disabled,error:!!e.v$.usuario_recibe.$errors.length,"error-message":"Debes seleccionar un usuario","use-input":"",onBlur:e.v$.usuario_recibe.$touch,"input-debounce":"0",onFilter:e.filtrarUsuarios,"option-value":a=>a.id,"option-label":a=>a.nombres+" "+a.apellidos,"emit-value":"","map-options":""},{error:s(()=>[r(d,{clave:"usuario_recibe",v$:e.v$},null,8,["v$"])]),"no-option":s(()=>[r(t)]),_:1},8,["modelValue","options","disable","readonly","error","onBlur","onFilter","option-value","option-label"])])),n("div",Ne,[o[15]||(o[15]=n("label",{class:"q-mb-sm block"},"Fecha de Transferencia",-1)),r(w,{modelValue:e.transferencia.fecha,"onUpdate:modelValue":o[4]||(o[4]=a=>e.transferencia.fecha=a),placeholder:"Obligatorio",error:!!e.v$.fecha.$errors.length,onBlur:e.v$.fecha.$touch,disable:e.disabled,readonly:"",outlined:"",dense:""},{append:s(()=>[r(se,{name:"event",class:"cursor-pointer"},{default:s(()=>[r(me,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:s(()=>[r(pe,{modelValue:e.transferencia.fecha,"onUpdate:modelValue":o[3]||(o[3]=a=>e.transferencia.fecha=a),options:e.optionsFecha,mask:e.maskFecha,"today-btn":""},{default:s(()=>[n("div",De,[ne(r(ie,{label:"Cerrar",color:"primary",flat:""},null,512),[[ce]])])]),_:1},8,["modelValue","options","mask"])]),_:1})]),_:1})]),error:s(()=>[r(d,{clave:"fecha",v$:e.v$},null,8,["v$"])]),_:1},8,["modelValue","error","onBlur","disable"])]),n("div",Ae,[o[16]||(o[16]=n("label",{class:"q-mb-sm block"},"Monto:",-1)),r(w,{modelValue:e.transferencia.monto,"onUpdate:modelValue":o[5]||(o[5]=a=>e.transferencia.monto=a),placeholder:"Obligatorio",disable:e.disabled,type:"number",error:!!e.v$.monto.$errors.length,onBlur:e.v$.monto.$touch,outlined:"",dense:""},{error:s(()=>[r(d,{clave:"monto",v$:e.v$},null,8,["v$"])]),_:1},8,["modelValue","disable","error","onBlur"])]),n("div",je,[o[17]||(o[17]=n("label",{class:"q-mb-sm block"},"Cuenta:",-1)),r(w,{modelValue:e.transferencia.cuenta,"onUpdate:modelValue":o[6]||(o[6]=a=>e.transferencia.cuenta=a),placeholder:"Obligatorio",disable:e.disabled,error:!!e.v$.cuenta.$errors.length,onBlur:e.v$.cuenta.$touch,outlined:"",dense:""},{error:s(()=>[r(d,{clave:"cuenta",v$:e.v$},null,8,["v$"])]),_:1},8,["modelValue","disable","error","onBlur"])]),e.transferencia.es_devolucion?E("",!0):(p(),$("div",Pe,[o[18]||(o[18]=n("label",{class:"q-mb-sm block"},"Tareas",-1)),r(B,{modelValue:e.transferencia.tarea,"onUpdate:modelValue":o[7]||(o[7]=a=>e.transferencia.tarea=a),options:e.tareas,"transition-show":"jump-up","transition-hide":"jump-down","options-dense":"",dense:"",outlined:"",disable:e.disabled,readonly:e.disabled,error:!!e.v$.tarea.$errors.length,onFilter:e.filtrarTareas,onBlur:e.v$.tarea.$touch,"error-message":"Debes seleccionar una Tarea","use-input":"","input-debounce":"0","option-value":a=>a.id,"option-label":a=>a.titulo,"emit-value":"","map-options":""},{error:s(()=>[r(d,{clave:"tarea",v$:e.v$},null,8,["v$"])]),option:s(a=>[r(fe,le(a.itemProps,{class:"q-my-sm"}),{default:s(()=>[r(be,null,{default:s(()=>[r(F,{class:"text-bold text-primary"},{default:s(()=>[N(k(a.opt.codigo_tarea),1)]),_:2},1024),r(F,{caption:""},{default:s(()=>[N(k(a.opt.titulo),1)]),_:2},1024)]),_:2},1024)]),_:2},1040)]),"no-option":s(()=>[r(t)]),_:1},8,["modelValue","options","disable","readonly","error","onFilter","onBlur","option-value","option-label"])])),n("div",Re,[o[19]||(o[19]=n("label",{class:"q-mb-sm block"},"Comprobante ",-1)),r(S,{placeholder:"Obligatorio",imagen:e.transferencia.comprobante,error:!!e.v$.comprobante.$errors.length,"onUpdate:modelValue":o[8]||(o[8]=a=>e.transferencia.comprobante=a)},{error:s(()=>[(p(!0),$(te,null,ue(e.v$.comprobante.$errors,a=>(p(),$("div",{key:a.$uid},[n("div",_e,k(a.$message),1)]))),128))]),_:1},8,["imagen","error"])]),n("div",Me,[r(de,{class:"q-mt-lg q-pt-md",modelValue:e.transferencia.es_devolucion,"onUpdate:modelValue":[o[9]||(o[9]=a=>e.transferencia.es_devolucion=a),o[10]||(o[10]=a=>e.existeDevolucion())],label:"\xBFEs devolucion a la cuenta de la empresa?",disable:e.disabled,outlined:"",dense:""},null,8,["modelValue","disable"])]),n("div",ze,[o[20]||(o[20]=n("label",{class:"q-mb-sm block"},"Observaci\xF3n",-1)),r(w,{modelValue:e.transferencia.observacion,"onUpdate:modelValue":o[11]||(o[11]=a=>e.transferencia.observacion=a),placeholder:"obligatorio",type:"textarea",disable:e.disabled,error:!!e.v$.observacion.$errors.length,autogrow:"",onBlur:e.v$.observacion.$touch,outlined:"",dense:""},{error:s(()=>[r(d,{clave:"observacion",v$:e.v$},null,8,["v$"])]),_:1},8,["modelValue","disable","error","onBlur"])])])]),_:1})]),_:1},8,["mixin","configuracionColumnas"])}var Lo=oe(Ue,[["render",Ge]]);export{Lo as default};
