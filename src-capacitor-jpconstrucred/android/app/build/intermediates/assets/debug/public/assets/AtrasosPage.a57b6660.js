var aa=Object.defineProperty;var oa=(a,o,r)=>o in a?aa(a,o,{enumerable:!0,configurable:!0,writable:!0,value:r}):a[o]=r;var i=(a,o,r)=>(oa(a,typeof o!="symbol"?o+"":o,r),r);import{Q as ea}from"./QSelect.b1759751.js";import{by as sa,s as R,d as B,c as _,v as l,P as E,F as d,be as F,x as u,K as I,J as g,z as s,V as N,y as t,bd as T,D as ta,G as S,bh as ia,R as ra,u as na,f as U,E as la,bz as z,q as da,A as ma,bH as ca,_ as ua,t as v,a5 as pa,I as $,B as fa,j as ba,O as va,H as ga}from"./index.70185135.js";import{Q as ja,a as ha,C as _a}from"./QPopupProxy.c164d2ac.js";import{Q as ya}from"./QForm.0c8c3b68.js";import{u as Va}from"./index.004ff2d8.js";import{T as Ca}from"./TabLayoutFilterTabs2.0c89493b.js";import{E as Ea}from"./EssentialEditor.ca19f1f6.js";import{C as Aa}from"./ContenedorSimpleMixin.0ef3239b.js";import{E as ka}from"./entidadAuditable.75a46700.js";import{u as wa}from"./filtrosListadosGenerales.6ad178d9.js";import{S as H,s as $a}from"./utils.2eab62de.js";import{r as qa,a as L}from"./i18n-validators.ea544161.js";import{E as Ma}from"./ErrorComponent.60ce3364.js";import{N as Pa}from"./NoOptionComponent.4eefbc12.js";import{O as Fa}from"./OptionGroupComponent.36fba493.js";import{E as G,S as Sa}from"./EssentialTable.c4a035e4.js";import{M as Ba}from"./ModalEntidad.7d323d29.js";import{C as Ia,a as Ja}from"./ComponenteModal.domain.9bc16b73.js";import{c as Qa,A as Da}from"./AsistenciaController.d7163317.js";import{c as Oa,P as Ua}from"./PermisoEmpleadoController.57859a76.js";import{C as za}from"./CalloutComponent.f323646d.js";import"./QChip.a6a2afa6.js";import"./QItemSection.1a41b826.js";import"./QMenu.7527c31d.js";import"./position-engine.f244a0db.js";import"./format.8ac60962.js";import"./QTabs.4ee0c65d.js";import"./QResizeObserver.721a0e6c.js";import"./QTabPanels.0148950e.js";import"./touch.9135741d.js";import"./QPage.f3b97ac0.js";import"./EssentialTableTabs.a1f1bc4b.js";import"./QBadge.5bb69fff.js";import"./EssentialTablePagination.959d4e60.js";import"./QToolbar.f2167ded.js";import"./use-fullscreen.ec50b882.js";import"./buttonSubmits.f728eedc.js";import"./extend.4a22771d.js";import"./index.9f64ebda.js";import"./QFile.f60a5ba1.js";import"./_commonjsHelpers.8402d862.js";import"./QImg.04221389.js";import"./VisorImagen.7aac4fec.js";import"./seleccionContratacionPersonal.utils.e3e1ed3d.js";import"./configuracion_general.27135600.js";import"./ConfiguracionController.40960b9d.js";const La=[{name:"empleado",field:"empleado",label:"Empleado",align:"left",sortable:!0},{name:"fecha_atraso",field:"fecha_atraso",label:"Fecha",align:"left",sortable:!0},{name:"ocurrencia",field:"ocurrencia",label:"Ocurrencia",align:"right",sortable:!0},{name:"tiempo_atraso",field:"tiempo_atraso",label:"Tiempo Atraso",align:"right",sortable:!0},{name:"segundos_atraso",field:"segundos_atraso",label:"Segundos",align:"right",sortable:!0},{name:"revisado",field:"revisado",label:"\xBFRevisado?",align:"right",sortable:!0},{name:"justificacion",field:"justificacion",label:"Justificaci\xF3n Atraso (J.I.)",align:"left",sortable:!1},{name:"justificacion_atrasado",field:"justificacion_atrasado",label:"Justificaci\xF3n de Atraso (E.A.)",align:"left",sortable:!1},{name:"justificado_por_atrasado",field:"justificado_por_atrasado",label:"Justificado por Atrasado",align:"left",sortable:!1}];class Ra extends sa{constructor(){super(R.atrasos)}}class Na extends ka{constructor(){super();i(this,"empleado");i(this,"fecha_atraso");i(this,"minutos_atraso");i(this,"tiempo_atraso");i(this,"segundos_atraso");i(this,"justificacion");i(this,"jefe");i(this,"justificador");i(this,"justificacion_atrasado");i(this,"justificado_por_atrasado");i(this,"marcacion");i(this,"ocurrencia");i(this,"justificado");i(this,"imagen_evidencia");i(this,"revisado");this.empleado=null,this.fecha_atraso=null,this.minutos_atraso=null,this.tiempo_atraso=null,this.segundos_atraso=null,this.justificacion="",this.jefe=null,this.justificador=null,this.justificacion_atrasado=null,this.justificado_por_atrasado=null,this.marcacion=null,this.ocurrencia=null,this.justificado=!1,this.imagen_evidencia=null,this.revisado=!1}}const Ta={key:0,class:"text-h6 q-pb-md"},Ha={class:"row justify-center"},Ga={class:"text-h6 col-12 text-center"},Ka=B({__name:"PermisoPage",props:{mostrarEncabezado:{type:Boolean,default:!0},empleado_id:{type:Number,required:!0},fecha:{type:String,required:!0}},setup(a){const o=a,r=new H,m=_(),p=_([]);async function j(){try{r.activar();const{result:c}=await new Ua().listar({"or[empleado_id]":o.empleado_id,fecha_hora_inicio:o.fecha});m.value=c[0],p.value.push(m.value)}catch(c){console.error(c)}finally{r.desactivar()}}return j(),(c,f)=>(l(),E(T,null,{default:d(()=>[m.value?(l(),E(F,{key:0},{default:d(()=>{var n;return[a.mostrarEncabezado?(l(),u("div",Ta," Permisos solicitados por el empleado: "+I((n=m.value)==null?void 0:n.empleado_info),1)):g("",!0),s(G,{datos:p.value,"alto-fijo":!1,mostrarHeader:!1,mostrarFooter:!1,"configuracion-columnas":N(Oa)},null,8,["datos","configuracion-columnas"])]}),_:1})):(l(),E(F,{key:1},{default:d(()=>[t("div",Ha,[t("div",Ga,[s(za,{mensaje:"No hay permisos registrados para este d\xEDa",tipo:"warning"})])])]),_:1}))]),_:1}))}}),Wa={key:0,class:"text-h6 q-pb-md"},Xa=B({__name:"MarcacionPage",props:{mostrarEncabezado:{type:Boolean,default:!0},datos:Object},setup(a){const o=a,r=new H,m=_(),p=_([]),j=_(!1);async function c(){var f;try{r.activar();const{result:n}=await new Da().consultar((f=o.datos)==null?void 0:f.marcacion_id);m.value=n,p.value.push(m.value),j.value=!0}catch(n){console.error(n)}finally{r.desactivar()}}return c(),(f,n)=>{var h,y;return l(),u(S,null,[s(T,null,{default:d(()=>[s(F,null,{default:d(()=>{var V;return[a.mostrarEncabezado?(l(),u("div",Wa," Registro de marcaciones del empleado: "+I((V=m.value)==null?void 0:V.empleado),1)):g("",!0),s(G,{datos:p.value,"alto-fijo":!1,mostrarHeader:!1,mostrarFooter:!1,"configuracion-columnas":N(Qa)},null,8,["datos","configuracion-columnas"])]}),_:1})]),_:1}),n[0]||(n[0]=ta()),n[1]||(n[1]=t("hr",null,null,-1)),j.value?(l(),E(Ka,{key:0,empleado_id:(h=m.value)==null?void 0:h.empleado_id,fecha:(y=m.value)==null?void 0:y.fecha},null,8,["empleado_id","fecha"])):g("",!0)],64)}}});var K=Xa;class Ya{constructor(){i(this,"MarcacionPage");this.MarcacionPage=ia(new Ia("Registro de Marcaciones en biom\xE9trico",K))}}class Za extends Ja{constructor(){super(new Ya)}}var xa=B({name:"JustificacionPage",components:{MarcacionPage:K,ModalEntidad:Ba,NoOptionComponent:Pa,SelectorImagen:Sa,ErrorComponent:Ma,TabLayoutFilterTabs2:Ca,OptionGroupComponent:Fa,EssentialEditor:Ea},setup(){const a=new Aa(Na,new Ra),{entidad:o,accion:r,listado:m,listadosAuxiliares:p,disabled:j}=a.useReferencias(),{setValidador:c,listar:f,cargarVista:n,obtenerListados:h}=a.useComportamiento(),{onBeforeConsultar:y,onConsultado:V,onModificado:q}=a.useHooks(),A=_("0"),{notificarCorrecto:k}=ra(),C=new Za,e=na(),W=U(()=>e.user.id==o.jefe),J=U(()=>e.user.id==o.empleado),M=_(!1),{empleados:Q,filtrarEmpleados:X}=wa(p);n(async()=>{await h({empleados:{controller:new la,params:{estado:1}}}),Q.value=p.empleados});const Y={empleado:{required:qa},justificacion:{required:L(()=>o.justificado)},justificacion_atrasado:{required:L(()=>r.value==z.editar&&J.value)}},D=Va(Y,o);c(D.value),y(async()=>{M.value=!1}),V(()=>{M.value=!0}),q((b,P)=>{P.modelo.justificado&&O("1")});const Z=[{value:"0",label:"Injustificados"},{value:"1",label:"Justificados"}];async function O(b){A.value=b,await f({justificado:b})}async function x(){const b=ma.getInstance(),P=ca.URL_BASE+"/"+b.getEndpoint(R.sincronizar_atrasos);try{const w=await b.get(P);w.status===200&&k(w.data.message)}catch(w){console.error("Error al sincronizar atrasos:",w),m.value=[]}}return x(),{mixin:a,atraso:o,v$:D,disabled:j,accion:r,acciones:z,configuracionColumnas:La,tabDefecto:A,tabOptions:Z,maskFecha:da,esJefeInmediato:W,esEmpleadoAtrasado:J,modales:C,mostrarMarcacionPage:M,empleados:Q,filtrarEmpleados:X,filtrarListadoAtrasos:O,ordenarLista:$a,btnVerMarcaciones:{titulo:"Ver asistencias",icono:"bi-calendar-check",color:"secondary",accion:({entidad:b})=>{C.abrirModalEntidad("MarcacionPage",{marcacion_id:b.marcacion})}}}}});const ao={key:0,class:"row border-grey rounded q-pa-sm q-mb-md"},oo={class:"col-12"},eo={class:"row q-col-gutter-md"},so={class:"col-12 col-md-3"},to={class:"col-12 col-md-3"},io={class:"row items-center justify-end"},ro={class:"col-12 col-md-3"},no={class:"col-12 col-md-3"},lo={class:"col-12 col-md-3"},mo={class:"col-12 col-md-3"},co={key:0,class:"col-6 col-md-3 col-sm-12"},uo={key:1,class:"col-12 col-md-3"},po={key:2,class:"col-12"};function fo(a,o,r,m,p,j){const c=v("marcacion-page"),f=v("error-component"),n=v("no-option-component"),h=v("option-group-component"),y=v("selector-imagen"),V=v("essential-editor"),q=v("tab-layout-filter-tabs2"),A=v("modal-entidad");return l(),u(S,null,[s(q,{mixin:a.mixin,configuracionColumnas:a.configuracionColumnas,"titulo-pagina":"Atrasos de Empleados","tab-options":a.tabOptions,tabDefecto:a.tabDefecto,filtrar:a.filtrarListadoAtrasos,"permitir-editar":a.tabDefecto=="0",accion1:a.btnVerMarcaciones,"ajustar-celdas":""},{formulario:d(()=>[s(ya,{onSubmit:o[11]||(o[11]=pa(()=>{},["prevent"]))},{default:d(()=>{var k,C;return[[a.acciones.consultar,a.acciones.editar].includes(a.accion)&&a.atraso.marcacion!=null?(l(),u("div",ao,[t("div",oo,[o[12]||(o[12]=t("label",{class:"text-h6 q-mb-sm block"},"Registro de marcaci\xF3n",-1)),a.mostrarMarcacionPage?(l(),E(c,{key:0,class:"bg-desenfoque rounded shadow-0","mostrar-encabezado":!1,datos:{marcacion_id:(k=a.atraso)==null?void 0:k.marcacion}},null,8,["datos"])):g("",!0)])])):g("",!0),t("div",eo,[t("div",so,[o[13]||(o[13]=t("label",{class:"q-mb-sm block"},"Empleado",-1)),s(ea,{modelValue:a.atraso.empleado,"onUpdate:modelValue":o[0]||(o[0]=e=>a.atraso.empleado=e),options:a.empleados,"transition-show":"jump-up","transition-hide":"jump-down",disable:"","options-dense":"",dense:"",outlined:"",error:!!a.v$.empleado.$errors.length,onBlur:a.v$.empleado.$touch,"error-message":"Debes seleccionar un empleado","use-input":"","input-debounce":"0",onFilter:a.filtrarEmpleados,onPopupShow:o[1]||(o[1]=e=>a.ordenarLista(a.empleados,"nombres")),"option-value":e=>e.id,"option-label":e=>e.nombres+" "+e.apellidos,"emit-value":"","map-options":""},{error:d(()=>[s(f,{clave:"empleado",v$:a.v$},null,8,["v$"])]),"no-option":d(()=>[s(n)]),_:1},8,["modelValue","options","error","onBlur","onFilter","option-value","option-label"])]),t("div",to,[o[14]||(o[14]=t("label",{class:"q-mb-sm block"},"Fecha de Atraso",-1)),s($,{modelValue:a.atraso.fecha_atraso,"onUpdate:modelValue":o[3]||(o[3]=e=>a.atraso.fecha_atraso=e),outlined:"",dense:"",disable:"",hint:"Fecha de atraso"},{append:d(()=>[s(fa,{name:"event",class:"cursor-pointer"},{default:d(()=>[s(ja,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:d(()=>[s(ha,{modelValue:a.atraso.fecha_atraso,"onUpdate:modelValue":o[2]||(o[2]=e=>a.atraso.fecha_atraso=e),mask:a.maskFecha,"today-btn":"",disable:""},{default:d(()=>[t("div",io,[ba(s(va,{label:"Cerrar",color:"primary",flat:""},null,512),[[_a]])])]),_:1},8,["modelValue","mask"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),t("div",ro,[o[15]||(o[15]=t("label",{class:"q-mb-sm block"},"Tiempo de Atraso",-1)),s($,{modelValue:a.atraso.tiempo_atraso,"onUpdate:modelValue":o[4]||(o[4]=e=>a.atraso.tiempo_atraso=e),outlined:"",autogrow:"",dense:"",disable:"",hint:"Tiempo de atraso calculados"},null,8,["modelValue"])]),t("div",no,[o[16]||(o[16]=t("label",{class:"q-mb-sm block"},"Ocurrencia del Atraso",-1)),s($,{modelValue:a.atraso.ocurrencia,"onUpdate:modelValue":o[5]||(o[5]=e=>a.atraso.ocurrencia=e),outlined:"",dense:"",disable:"",hint:"Ocurrencia del atraso"},null,8,["modelValue"])]),t("div",lo,[o[17]||(o[17]=t("label",{class:"q-mb-sm block"},"\xBFJustificar?",-1)),s(h,{modelValue:a.atraso.justificado,"onUpdate:modelValue":o[6]||(o[6]=e=>a.atraso.justificado=e),disable:a.disabled||!a.esJefeInmediato},null,8,["modelValue","disable"])]),t("div",mo,[o[18]||(o[18]=t("label",{class:"q-mb-sm block"},"\xBFRevisado?",-1)),s(h,{modelValue:a.atraso.revisado,"onUpdate:modelValue":o[7]||(o[7]=e=>a.atraso.revisado=e),disable:""},null,8,["modelValue"])]),a.esEmpleadoAtrasado||a.esJefeInmediato||a.atraso.imagen_evidencia!=null?(l(),u("div",co,[o[19]||(o[19]=t("label",{for:"q-mb-xl block"},"Imagen Evidencia",-1)),s(y,{file_extensiones:".jpg, image/*",imagen:a.atraso.imagen_evidencia,disable:a.disabled,alto:"300px","onUpdate:modelValue":o[8]||(o[8]=e=>a.atraso.imagen_evidencia=e)},null,8,["imagen","disable"])])):g("",!0),a.atraso.justificacion_atrasado||a.esEmpleadoAtrasado?(l(),u("div",uo,[o[20]||(o[20]=t("label",{class:"q-mb-sm block"},"Justificaci\xF3n (E. Atrasado)",-1)),s($,{modelValue:a.atraso.justificacion_atrasado,"onUpdate:modelValue":o[9]||(o[9]=e=>a.atraso.justificacion_atrasado=e),outlined:"",dense:"",autogrow:"",disable:a.disabled||!a.esEmpleadoAtrasado,placeholder:"Opcional",hint:"Ingresa tu justificaci\xF3n del atraso",error:!!a.v$.justificacion_atrasado.$errors.length,onBlur:a.v$.justificacion_atrasado.$touch},{error:d(()=>[s(f,{clave:"justificacion_atrasado",v$:a.v$},null,8,["v$"])]),_:1},8,["modelValue","disable","error","onBlur"])])):g("",!0),a.esJefeInmediato||((C=a.atraso.justificacion)==null?void 0:C.length)>1?(l(),u("div",po,[o[21]||(o[21]=t("label",{class:"q-mb-sm block"},"Justificaci\xF3n del atraso",-1)),s(V,{modelValue:a.atraso.justificacion,"onUpdate:modelValue":o[10]||(o[10]=e=>a.atraso.justificacion=e),disable:a.disabled},null,8,["modelValue","disable"]),(l(!0),u(S,null,ga(a.v$.justificacion.$errors,e=>(l(),u("div",{class:"text-negative text-uppercase",key:e.$uid},[t("small",null,I(e.$message),1)]))),128))])):g("",!0)])]}),_:1})]),_:1},8,["mixin","configuracionColumnas","tab-options","tabDefecto","filtrar","permitir-editar","accion1"]),s(A,{persistente:!1,comportamiento:a.modales},null,8,["comportamiento"])],64)}var de=ua(xa,[["render",fo]]);export{de as default};
