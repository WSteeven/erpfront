var oo=Object.defineProperty;var ao=(o,a,n)=>a in o?oo(o,a,{enumerable:!0,configurable:!0,writable:!0,value:n}):o[a]=n;var f=(o,a,n)=>(ao(o,typeof a!="symbol"?a+"":a,n),n);import{by as eo,s as S,l as io,e as so,c as y,R as H,A as w,bH as _,d as no,bc as to,m as j,f as B,bz as ro,p as lo,q as co,_ as mo,t as q,v as l,P as uo,F as b,z as c,y as u,x as d,O as D,j as M,J as g,I as E,G as O,H as Q,a5 as po,K as U}from"./index.70185135.js";import{Q as fo,a as bo,C as L}from"./QPopupProxy.c164d2ac.js";import{Q as go}from"./QForm.0c8c3b68.js";import{r as G}from"./i18n-validators.ea544161.js";import{u as vo}from"./index.004ff2d8.js";import{T as ho}from"./TabLayoutFilterTabs2.0c89493b.js";import{S as Co,E as Eo}from"./EssentialTable.c4a035e4.js";import{E as yo}from"./EssentialTableTabs.a1f1bc4b.js";import{M as ko}from"./ModalEntidad.7d323d29.js";import{C as Vo}from"./ContenedorSimpleMixin.0ef3239b.js";import{S as Po,A as wo,u as _o}from"./utils.2eab62de.js";import{E as So}from"./entidadAuditable.75a46700.js";import{b as $o}from"./ventas.utils.b757673b.js";import"./format.8ac60962.js";import"./QMenu.7527c31d.js";import"./position-engine.f244a0db.js";import"./index.9f64ebda.js";import"./QTabs.4ee0c65d.js";import"./QResizeObserver.721a0e6c.js";import"./QSelect.b1759751.js";import"./QChip.a6a2afa6.js";import"./QItemSection.1a41b826.js";import"./QTabPanels.0148950e.js";import"./touch.9135741d.js";import"./QPage.f3b97ac0.js";import"./buttonSubmits.f728eedc.js";import"./QFile.f60a5ba1.js";import"./QToolbar.f2167ded.js";import"./use-fullscreen.ec50b882.js";import"./QBadge.5bb69fff.js";import"./_commonjsHelpers.8402d862.js";import"./QImg.04221389.js";import"./VisorImagen.7aac4fec.js";import"./seleccionContratacionPersonal.utils.e3e1ed3d.js";import"./ErrorComponent.60ce3364.js";import"./EssentialTablePagination.959d4e60.js";import"./configuracion_general.27135600.js";import"./ConfiguracionController.40960b9d.js";const Fo=[{name:"nombre",field:"nombre",label:"Corte",align:"left",sortable:!1},{name:"fecha_inicio",field:"fecha_inicio",label:"Fecha de Inicio",align:"left",sortable:!0},{name:"fecha_fin",field:"fecha_fin",label:"Fecha de Inicio",align:"left",sortable:!0},{name:"estado",field:"estado",label:"Estado",align:"left",sortable:!0}],Bo=[{name:"vendedor_info",field:"vendedor_info",label:"Vendedor",align:"left",sortable:!1},{name:"tipo_vendedor",field:"tipo_vendedor",label:"Modalidad",align:"left",sortable:!0},{name:"fecha_inicio",field:"fecha_inicio",label:"Fecha de Inicio",align:"left",sortable:!0},{name:"fecha_fin",field:"fecha_fin",label:"Fecha de Inicio",align:"left",sortable:!0},{name:"ventas",field:"ventas",label:"Ventas",align:"left",sortable:!0},{name:"chargeback",field:"chargeback",label:"Chargeback",align:"left",sortable:!0},{name:"valor",field:"valor",label:"Valor Comisi\xF3n",align:"left",sortable:!0},{name:"pagado",field:"pagado",label:"Pagado",align:"left",sortable:!0}];class A extends So{constructor(){super();f(this,"id");f(this,"nombre");f(this,"fecha_inicio");f(this,"fecha_fin");f(this,"estado");f(this,"causa_anulacion");f(this,"listadoEmpleados");this.id=null,this.nombre=null,this.fecha_inicio=null,this.fecha_fin=null,this.estado=null,this.causa_anulacion=null,this.listadoEmpleados=[]}}class Do extends eo{constructor(){super(S.cortes_pagos_comisiones)}}const Ao=io("cortes-comisiones",()=>{const o=so(new A),a=new A,n=y(),{notificarCorrecto:k,notificarAdvertencia:V,notificarError:v}=H(),r=new Po;async function C(){try{r.activar();const s=w.getInstance(),t=_.URL_BASE+"/api/ventas-claro/obtener-fechas-disponibles-cortes";return(await s.get(t)).data.results}catch(s){v(s)}finally{r.desactivar()}}async function e(){r.activar();const s=w.getInstance(),t=_.URL_BASE+"/"+s.getEndpoint(S.cortes_pagos_comisiones)+"/imprimir-excel/"+n.value;await wo(t,"GET","blob","xlsx",o.nombre+"_"+Date.now()),r.desactivar()}async function $(s){try{r.activar();const t=w.getInstance(),p=_.URL_BASE+"/"+t.getEndpoint(S.cortes_pagos_comisiones)+"/anular/"+n.value;return await t.post(p,s)}catch(t){v(t)}finally{r.desactivar()}}async function F(){try{r.activar();const s=w.getInstance(),t=_.URL_BASE+"/"+s.getEndpoint(S.cortes_pagos_comisiones)+"/marcar-completada/"+n.value,p=await s.get(t);p.status===200?k(p.data.mensaje):V(p.data.mensaje)}catch(s){v("Error al marcar como completado el corte de pago de comisiones "+s)}finally{r.desactivar()}}return{corte:o,idCorte:n,corteReset:a,obtenerFechasDisponiblesCortes:C,marcarCompletada:F,imprimirExcel:e,anularCorte:$}});var Io=no({components:{TabLayoutFilterTabs2:ho,ModalesEntidad:ko,SelectorImagen:Co,EssentialTable:Eo,EssentialTableTabs:yo},setup(){const o=new Vo(A,new Do),{entidad:a,accion:n,disabled:k,listado:V}=o.useReferencias(),{setValidador:v,cargarVista:r,listar:C}=o.useComportamiento(),{onGuardado:e,onReestablecer:$}=o.useHooks(),{notificarCorrecto:F,notificarError:s,confirmar:t,prompt:p}=H();to().setQuasar(j()),_o().setQuasar(j());const m=Ao(),I=y("PENDIENTE"),h=y();y();const P=y(),z=B(()=>h.value.from),K=B(()=>h.value.to),J=B(()=>"Pago de comisiones desde "+h.value.from+" al "+h.value.to);r(async()=>{const i=Object.values(await m.obtenerFechasDisponiblesCortes());P.value=i});const T=vo({fecha_inicio:{required:G},fecha_fin:{required:G}},a);v(T.value),e(()=>{console.log("guardado")}),$(async()=>{const i=Object.values(await m.obtenerFechasDisponiblesCortes());P.value=i});function N(i){I.value=i,C({estado:i})}function W(i){return P.value.includes(i)}function X(){h.value=P.value[0]}function Y(){a.nombre=J.value,a.fecha_inicio=z.value,a.fecha_fin=K.value}return{mixin:o,v$:T,pago:a,accion:n,acciones:ro,accionesTabla:lo,disabled:k,fecha:h,maskFecha:co,configuracionColumnas:Fo,configuracionColumnasPagoComisionEmpleado:Bo,tabDefecto:I,tabOptionsPagosComisiones:$o,btnAnular:{titulo:"Anular",color:"negative",icono:"bi-x",accion:async({entidad:i,posicion:R})=>{t("\xBFEst\xE1 seguro de anular el corte?",()=>{p({titulo:"Causa de anulaci\xF3n",mensaje:"Ingresa el motivo de anulaci\xF3n",accion:async Z=>{try{m.idCorte=i.id,(await m.anularCorte({causa_anulacion:Z})).status==200&&(F("Se ha anulado correctamente el corte de pagos"),V.value.splice(R,1))}catch{s("No se pudo anular, debes ingresar un motivo para la anulaci\xF3n")}}})})},visible:({entidad:i})=>i.estado=="PENDIENTE"},btnMarcarPagado:{titulo:"Completada",color:"primary",icono:"bi-check-circle-fill",accion:async({entidad:i})=>{t("\xBFEst\xE1 seguro de marcar como completado el corte de pago de comisiones?",async()=>{m.idCorte=i.id,await m.marcarCompletada(),await N("COMPLETA")})},visible:({entidad:i})=>i.estado=="PENDIENTE"},btnGenerarReporteExcel:{titulo:"Generar Reporte",color:"positive",icono:"bi-file-earmark-excel-fill",accion:async({entidad:i,posicion:R})=>{m.corte.nombre=i.nombre,m.idCorte=i.id,await m.imprimirExcel()}},options:W,updateProxy:X,save:Y,filtrarCortesComisiones:N}}});const To={class:"row q-col-gutter-sm"},No={key:0,class:"col-12 col-md-4"},Ro={class:"row items-center justify-end q-gutter-sm"},jo={key:1,class:"col-12 col-md-4"},qo={key:2,class:"col-12 col-md-4"},Mo={class:"error-msg"},Oo={key:3,class:"col-12 col-md-4"},Qo={class:"error-msg"},Uo={key:4,class:"col-12 col-md-4"},Lo={key:5,class:"col-12 col-md-4"},Go={key:6,class:"col-12 col-md-12"};function Ho(o,a,n,k,V,v){const r=q("essential-table"),C=q("tab-layout-filter-tabs2");return l(),uo(C,{mixin:o.mixin,configuracionColumnas:o.configuracionColumnas,ajustarCeldas:"","tab-options":o.tabOptionsPagosComisiones,tabDefecto:o.tabDefecto,permitirEditar:!1,filtrar:o.filtrarCortesComisiones,accion1:o.btnAnular,accion2:o.btnGenerarReporteExcel,accion3:o.btnMarcarPagado},{formulario:b(()=>[c(go,{onSubmit:a[6]||(a[6]=po(()=>{},["prevent"]))},{default:b(()=>[u("div",To,[o.accion==o.acciones.nuevo?(l(),d("div",No,[a[7]||(a[7]=u("label",{class:"q-mb-sm block"},"Selecciona un rango de fechas",-1)),c(D,{icon:"event",round:"",color:"primary"},{default:b(()=>[c(fo,{onBeforeShow:o.updateProxy,cover:"","transition-show":"scale","transition-hide":"scale"},{default:b(()=>[c(bo,{modelValue:o.fecha,"onUpdate:modelValue":a[0]||(a[0]=e=>o.fecha=e),mask:o.maskFecha,range:"",options:o.options},{default:b(()=>[u("div",Ro,[M(c(D,{label:"Cancel",color:"primary",flat:""},null,512),[[L]]),M(c(D,{label:"OK",color:"primary",flat:"",onClick:o.save},null,8,["onClick"]),[[L]])])]),_:1},8,["modelValue","mask","options"])]),_:1},8,["onBeforeShow"])]),_:1})])):g("",!0),o.accion!=o.acciones.nuevo?(l(),d("div",jo,[a[8]||(a[8]=u("label",{class:"q-mb-sm block"},"Nombre",-1)),c(E,{modelValue:o.pago.nombre,"onUpdate:modelValue":a[1]||(a[1]=e=>o.pago.nombre=e),placeholder:"Obligatorio",autogrow:"",disable:"",outlined:"",dense:""},null,8,["modelValue"])])):g("",!0),o.pago.fecha_inicio?(l(),d("div",qo,[a[9]||(a[9]=u("label",{class:"q-mb-sm block"},"Desde",-1)),c(E,{modelValue:o.pago.fecha_inicio,"onUpdate:modelValue":a[2]||(a[2]=e=>o.pago.fecha_inicio=e),placeholder:"Obligatorio",error:!!o.v$.fecha_inicio.$errors.length,disable:"",onBlur:o.v$.fecha_inicio.$touch,outlined:"",dense:"","emit-value":""},{error:b(()=>[(l(!0),d(O,null,Q(o.v$.fecha_inicio.$errors,e=>(l(),d("div",{key:e.$uid},[u("div",Mo,U(e.$message),1)]))),128))]),_:1},8,["modelValue","error","onBlur"])])):g("",!0),o.pago.fecha_fin?(l(),d("div",Oo,[a[10]||(a[10]=u("label",{class:"q-mb-sm block"},"Hasta",-1)),c(E,{modelValue:o.pago.fecha_fin,"onUpdate:modelValue":a[3]||(a[3]=e=>o.pago.fecha_fin=e),placeholder:"Obligatorio",error:!!o.v$.fecha_fin.$errors.length,disable:"",onBlur:o.v$.fecha_fin.$touch,outlined:"",dense:"","emit-value":""},{error:b(()=>[(l(!0),d(O,null,Q(o.v$.fecha_fin.$errors,e=>(l(),d("div",{key:e.$uid},[u("div",Qo,U(e.$message),1)]))),128))]),_:1},8,["modelValue","error","onBlur"])])):g("",!0),o.accion!=o.acciones.nuevo?(l(),d("div",Uo,[a[11]||(a[11]=u("label",{class:"q-mb-sm block"},"Estado",-1)),c(E,{modelValue:o.pago.estado,"onUpdate:modelValue":a[4]||(a[4]=e=>o.pago.estado=e),disable:"",outlined:"",dense:""},null,8,["modelValue"])])):g("",!0),o.accion!=o.acciones.nuevo&&o.pago.causa_anulacion?(l(),d("div",Lo,[a[12]||(a[12]=u("label",{class:"q-mb-sm block"},"Causa anulaci\xF3n",-1)),c(E,{modelValue:o.pago.causa_anulacion,"onUpdate:modelValue":a[5]||(a[5]=e=>o.pago.causa_anulacion=e),disable:"",outlined:"",dense:""},null,8,["modelValue"])])):g("",!0),o.accion!==o.acciones.nuevo&&o.pago.listadoEmpleados.length>0?(l(),d("div",Go,[c(r,{titulo:"Comisiones de Empleados",configuracionColumnas:o.accion===o.acciones.editar?[...o.configuracionColumnasPagoComisionEmpleado,o.accionesTabla]:o.configuracionColumnasPagoComisionEmpleado,datos:o.pago.listadoEmpleados,permitirConsultar:!1,permitirEditar:!1,permitirEliminar:!1,mostrarBotones:!1,ajustarCeldas:!0,altoFijo:!1},null,8,["configuracionColumnas","datos"])])):g("",!0)])]),_:1})]),_:1},8,["mixin","configuracionColumnas","tab-options","tabDefecto","filtrar","accion1","accion2","accion3"])}var Ra=mo(Io,[["render",Ho]]);export{Ra as default};
