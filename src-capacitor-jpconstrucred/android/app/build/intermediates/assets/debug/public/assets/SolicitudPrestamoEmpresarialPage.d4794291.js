var Z=Object.defineProperty;var _=(o,e,n)=>e in o?Z(o,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):o[e]=n;var t=(o,e,n)=>(_(o,typeof e!="symbol"?e+"":e,n),n);import{by as x,s as oo,d as eo,c as y,u as ao,f as g,bz as h,d1 as w,ct as io,w as lo,b$ as N,q as so,d7 as ro,_ as to,t as B,v as m,P as no,F as r,z as i,a5 as uo,y as s,x as b,I as u,J as v,B as mo,j as po,O as co,L as bo,D as vo,K as fo}from"./index.70185135.js";import{Q as Vo,a as $o,C as Po}from"./QPopupProxy.c164d2ac.js";import{Q as F}from"./QSelect.b1759751.js";import{Q as go}from"./QForm.0c8c3b68.js";import{r as O,d as L,a as C}from"./i18n-validators.ea544161.js";import{u as Co}from"./index.004ff2d8.js";import{N as So}from"./NoOptionComponent.4eefbc12.js";import{S as zo}from"./EssentialTable.c4a035e4.js";import{E as yo}from"./ErrorComponent.60ce3364.js";import{C as ho}from"./ContenedorSimpleMixin.0ef3239b.js";import{u as ko}from"./recursosHumanos.f9a6c67e.js";import{E as qo}from"./entidadAuditable.75a46700.js";import{T as Ao}from"./TabLayoutFilterTabs2.0c89493b.js";import{P as wo}from"./PeriodoController.6a0888d3.js";import{u as Bo}from"./filtrosListadosGenerales.6ad178d9.js";import"./utils.2eab62de.js";import"./format.8ac60962.js";import"./QMenu.7527c31d.js";import"./position-engine.f244a0db.js";import"./QChip.a6a2afa6.js";import"./QItemSection.1a41b826.js";import"./index.9f64ebda.js";import"./QFile.f60a5ba1.js";import"./QToolbar.f2167ded.js";import"./use-fullscreen.ec50b882.js";import"./QBadge.5bb69fff.js";import"./_commonjsHelpers.8402d862.js";import"./QImg.04221389.js";import"./VisorImagen.7aac4fec.js";import"./seleccionContratacionPersonal.utils.e3e1ed3d.js";import"./QTabs.4ee0c65d.js";import"./QResizeObserver.721a0e6c.js";import"./QTabPanels.0148950e.js";import"./touch.9135741d.js";import"./QPage.f3b97ac0.js";import"./EssentialTableTabs.a1f1bc4b.js";import"./EssentialTablePagination.959d4e60.js";import"./buttonSubmits.f728eedc.js";class Oo extends qo{constructor(){super();t(this,"id");t(this,"solicitante");t(this,"solicitante_info");t(this,"fecha");t(this,"monto");t(this,"plazo");t(this,"periodo");t(this,"valor_utilidad");t(this,"estado");t(this,"estado_info");t(this,"motivo");t(this,"observacion");t(this,"cargo_utilidad");this.id=null,this.solicitante=null,this.solicitante_info=null,this.fecha=null,this.monto=null,this.plazo=null,this.periodo=null,this.valor_utilidad=null,this.estado=null,this.estado_info=null,this.motivo=null,this.observacion=null,this.cargo_utilidad=!1}}class Do extends x{constructor(){super(oo.solicitud_prestamo_empresarial)}}const Eo=[{name:"fecha",field:"fecha",label:"Fecha",align:"left",sortable:!0},{name:"solicitante_info",field:"solicitante_info",label:"Solicitante",align:"left",sortable:!0},{name:"monto",field:"monto",label:"Monto",align:"left",sortable:!0},{name:"plazo",field:"plazo",label:"Plazo",align:"left",sortable:!0},{name:"observacion",field:"observacion",label:"Observaci\xF3n",align:"left",sortable:!0},{name:"estado_info",field:"estado_info",label:"Estado",align:"left",sortable:!0}];var Uo=eo({components:{ErrorComponent:yo,NoOptionComponent:So,TabLayoutFilterTabs2:Ao,SelectorImagen:zo},setup(){const o=new ho(Oo,new Do),{entidad:e,disabled:n,accion:f,listadosAuxiliares:p}=o.useReferencias(),{setValidador:D,cargarVista:d,obtenerListados:S,listar:k}=o.useComportamiento(),{onConsultado:a}=o.useHooks(),j=y(!0),c=ko(),$=ao(),P=y(),Q=g(()=>{let l=!1;return V.value&&(l=z.value==="1"),q.value&&(l=z.value==="4"),l}),H=g(()=>f.value===h.editar?e.estado===w.CANCELADO||$.user.id!==e.solicitante:n.value),E=y(0),M=[l=>l<=parseInt(c.sueldo_basico)*2||"Solo se permite prestamo menor o igual a 2 SBU ($ "+parseInt(c.sueldo_basico)*2+")"],z=y("1"),V=g(()=>$.can("puede.ver.campo.validado")),q=g(()=>$.can("puede.autorizar.solicitud_prestamo_empresarial")),{periodos:U,filtrarPeriodos:T}=Bo(p);d(async()=>{var l;await c.obtenerSueldoBasico(),await c.nivelEndeudamiento((l=e.solicitante)!=null?l:$.user.id),await S({periodos:{controller:new wo,params:{campos:"id,nombre",activo:1}},autorizaciones:{controller:new io,params:{campos:"id,nombre",es_validado:!1,es_modulo_rhh:!0}}}),P.value=p.autorizaciones,U.value=p.periodos,E.value=parseInt(c.sueldo_basico)*2}),a(async()=>{var l;j.value=!1,await c.nivelEndeudamiento((l=e.solicitante)!=null?l:$.user.id)});const R=g(()=>({fecha:{required:O},monto:{required:O,maxValue:L(E)},motivo:{required:O},estado:{required:C(()=>V.value)},observacion:{required:C(()=>V.value)},periodo:{requiredIf:C(()=>e.cargo_utilidad)},valor_utilidad:{required:C(()=>e.cargo_utilidad)},plazo:{maxValue:L(12),required:C(()=>V.value&&e.estado!==w.CANCELADO)}})),I=Co(R,e);D(I.value),lo(f,()=>{P.value=p.autorizaciones,f.value===h.editar&&V&&(P.value=p.autorizaciones.filter(l=>l.nombre!==N.aprobado)),f.value===h.editar&&q.value&&(P.value=p.autorizaciones.filter(l=>l.nombre!==N.pendiente))});function J(l){const A=new Date,Y=A.getFullYear(),G=String(A.getMonth()+1).padStart(2,"0"),W=String(A.getDate()).padStart(2,"0"),X=`${Y}/${G}/${W}`;return l>=X}async function K(l){await k({estado:l}),z.value=l}return{mixin:o,solicitudPrestamo:e,periodos:U,filtrarPeriodos:T,esValidador:V,esAutorizador:q,optionsSolicitudPrestamo:J,filtrarSolicitudPrestamo:K,maximoValorsolicitudPrestamo:M,autorizaciones:P,autorizacionesId:w,maskFecha:so,v$:I,disabled:n,recursosHumanosStore:c,tabOptionsSolicitudPedido:ro,accion:f,configuracionColumnas:Eo,tabSolicitudPrestamo:z,ver_boton_editar:Q,acciones:h,restringirMotivo:H}}});const Io={class:"row q-col-gutter-sm q-mb-md q-mt-md q-mx-md q-py-sm"},No={key:0,class:"col-12 col-md-3"},Fo={class:"col-12 col-md-3"},Lo={class:"row items-center justify-end"},jo={class:"col-12 col-md-3"},Qo={key:1,class:"col-12 col-md-3"},Ho={class:"col-12 col-md-3"},Mo={key:2,class:"col-12 col-md-3"},To={class:"col-12 col-md-3"},Ro={key:3,class:"col-12 col-md-3"},Jo={key:4,class:"col-12 col-md-3"},Ko={key:5,class:"col-12 col-md-3"},Yo={class:"col-12 col-md-3"},Go={class:"col-12 col-md-3"},Wo={class:"col-12 col-md-3"},Xo={key:0,class:"q-mb-sm text-red text-h6 block"};function Zo(o,e,n,f,p,D){const d=B("error-component"),S=B("no-option-component"),k=B("tab-layout-filter-tabs2");return m(),no(k,{mixin:o.mixin,configuracionColumnas:o.configuracionColumnas,tabOptions:o.tabOptionsSolicitudPedido,permitirEditar:(o.esValidador||o.esAutorizador)&&o.ver_boton_editar,permitirEliminar:!1,filtrar:o.filtrarSolicitudPrestamo,tabDefecto:o.tabSolicitudPrestamo},{formulario:r(()=>[i(go,{onSubmit:e[13]||(e[13]=uo(()=>{},["prevent"]))},{default:r(()=>[s("div",Io,[[o.acciones.consultar,o.acciones.editar].includes(o.accion)?(m(),b("div",No,[e[14]||(e[14]=s("label",{class:"q-mb-sm block"},"Solicitante",-1)),i(u,{modelValue:o.solicitudPrestamo.solicitante_info,"onUpdate:modelValue":e[0]||(e[0]=a=>o.solicitudPrestamo.solicitante_info=a),placeholder:"Obligatorio",disable:"",outlined:"",dense:""},null,8,["modelValue"])])):v("",!0),s("div",Fo,[e[15]||(e[15]=s("label",{class:"q-mb-sm block"},"Fecha",-1)),i(u,{modelValue:o.solicitudPrestamo.fecha,"onUpdate:modelValue":e[2]||(e[2]=a=>o.solicitudPrestamo.fecha=a),placeholder:"Obligatorio",error:!!o.v$.fecha.$errors.length,disable:!(o.accion.value!==o.acciones.nuevo&&o.solicitudPrestamo.estado!==o.autorizacionesId.CANCELADO)||o.disabled,onBlur:o.v$.fecha.$touch,outlined:"",dense:""},{append:r(()=>[i(mo,{name:"event",class:"cursor-pointer"},{default:r(()=>[i(Vo,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:r(()=>[i($o,{modelValue:o.solicitudPrestamo.fecha,"onUpdate:modelValue":e[1]||(e[1]=a=>o.solicitudPrestamo.fecha=a),mask:o.maskFecha,options:o.optionsSolicitudPrestamo,"today-btn":""},{default:r(()=>[s("div",Lo,[po(i(co,{label:"Cerrar",color:"primary",flat:""},null,512),[[Po]])])]),_:1},8,["modelValue","mask","options"])]),_:1})]),_:1})]),error:r(()=>[i(d,{clave:"fecha",v$:o.v$},null,8,["v$"])]),_:1},8,["modelValue","error","disable","onBlur"])]),s("div",jo,[e[16]||(e[16]=s("label",{class:"q-mb-sm block"},"Valor ",-1)),i(u,{modelValue:o.solicitudPrestamo.monto,"onUpdate:modelValue":e[3]||(e[3]=a=>o.solicitudPrestamo.monto=a),placeholder:"Obligatorio",type:"number",disable:!(o.accion.value!==o.acciones.nuevo&&o.solicitudPrestamo.estado!==o.autorizacionesId.CANCELADO)||o.disabled,error:!!o.v$.monto.$errors.length,"lazy-rules":"",rules:o.maximoValorsolicitudPrestamo,onBlur:o.v$.monto.$touch,outlined:"",dense:""},{error:r(()=>[i(d,{clave:"monto",v$:o.v$},null,8,["v$"])]),_:1},8,["modelValue","disable","error","rules","onBlur"])]),o.esValidador||o.esAutorizador?(m(),b("div",Qo,[e[17]||(e[17]=s("label",{class:"q-mb-sm block"},"Plazo (Meses) ",-1)),i(u,{modelValue:o.solicitudPrestamo.plazo,"onUpdate:modelValue":e[4]||(e[4]=a=>o.solicitudPrestamo.plazo=a),type:"number",disable:!(o.accion.value!==o.acciones.nuevo&&o.solicitudPrestamo.estado!==o.autorizacionesId.CANCELADO)||o.disabled,error:!!o.v$.plazo.$errors.length,placeholder:"Obligatorio",onBlur:o.v$.plazo.$touch,outlined:"",dense:""},{error:r(()=>[i(d,{clave:"plazo",v$:o.v$},null,8,["v$"])]),_:1},8,["modelValue","disable","error","onBlur"])])):v("",!0),s("div",Ho,[e[18]||(e[18]=s("label",{class:"q-mb-sm block"},"Motivo ",-1)),i(u,{modelValue:o.solicitudPrestamo.motivo,"onUpdate:modelValue":e[5]||(e[5]=a=>o.solicitudPrestamo.motivo=a),placeholder:"Obligatorio",disable:o.restringirMotivo,type:"textarea",error:!!o.v$.motivo.$errors.length,onBlur:o.v$.motivo.$touch,autogrow:"",outlined:"",dense:""},{error:r(()=>[i(d,{clave:"motivo",v$:o.v$},null,8,["v$"])]),_:1},8,["modelValue","disable","error","onBlur"])]),o.esValidador||o.esAutorizador?(m(),b("div",Mo,[e[19]||(e[19]=s("label",{class:"q-mb-sm block"},"Observacion ",-1)),i(u,{modelValue:o.solicitudPrestamo.observacion,"onUpdate:modelValue":e[6]||(e[6]=a=>o.solicitudPrestamo.observacion=a),placeholder:"Obligatorio",disable:!o.esValidador||o.disabled,type:"textarea",error:!!o.v$.observacion.$errors.length,onBlur:o.v$.observacion.$touch,autogrow:"",outlined:"",dense:""},{error:r(()=>[i(d,{clave:"observacion",v$:o.v$},null,8,["v$"])]),_:1},8,["modelValue","disable","error","onBlur"])])):v("",!0),s("div",To,[i(bo,{class:"q-mt-lg q-pt-md",modelValue:o.solicitudPrestamo.cargo_utilidad,"onUpdate:modelValue":e[7]||(e[7]=a=>o.solicitudPrestamo.cargo_utilidad=a),label:"Cargo a Utilidades",disable:!(o.accion.value!==o.acciones.nuevo&&o.solicitudPrestamo.estado!==o.autorizacionesId.CANCELADO)||o.disabled,outlined:"",dense:""},null,8,["modelValue","disable"])]),o.solicitudPrestamo.cargo_utilidad?(m(),b("div",Ro,[e[20]||(e[20]=s("label",{class:"q-mb-sm block"},"Periodo",-1)),i(F,{modelValue:o.solicitudPrestamo.periodo,"onUpdate:modelValue":e[8]||(e[8]=a=>o.solicitudPrestamo.periodo=a),options:o.periodos,"transition-show":"jump-up","transition-hide":"jump-down","options-dense":"",dense:"",outlined:"",disable:!(o.accion.value!==o.acciones.nuevo&&o.solicitudPrestamo.estado!==o.autorizacionesId.CANCELADO)||o.disabled,readonly:o.disabled,"use-input":"","input-debounce":"0",onFilter:o.filtrarPeriodos,error:!!o.v$.periodo.$errors.length,onBlur:o.v$.periodo.$touch,"option-value":a=>a.id,"option-label":a=>a.nombre,"emit-value":"","map-options":""},{"no-option":r(()=>[i(S)]),error:r(()=>[i(d,{clave:"periodo",v$:o.v$},null,8,["v$"])]),_:1},8,["modelValue","options","disable","readonly","onFilter","error","onBlur","option-value","option-label"])])):v("",!0),o.solicitudPrestamo.periodo!=null?(m(),b("div",Jo,[e[21]||(e[21]=s("label",{class:"q-mb-sm block"},"Valor Utilidades ",-1)),i(u,{modelValue:o.solicitudPrestamo.valor_utilidad,"onUpdate:modelValue":e[9]||(e[9]=a=>o.solicitudPrestamo.valor_utilidad=a),placeholder:"Obligatorio",type:"number",disable:!(o.accion.value!==o.acciones.nuevo&&o.solicitudPrestamo.estado!==o.autorizacionesId.CANCELADO)||o.disabled,error:!!o.v$.valor_utilidad.$errors.length,onBlur:o.v$.valor_utilidad.$touch,outlined:"",dense:""},{error:r(()=>[i(d,{clave:"valor_utilidad",v$:o.v$},null,8,["v$"])]),_:1},8,["modelValue","disable","error","onBlur"])])):v("",!0),o.accion==o.acciones.editar&&(o.esValidador||o.esAutorizador)?(m(),b("div",Ko,[e[22]||(e[22]=s("label",{class:"q-mb-sm block"},"Autorizacion",-1)),i(F,{modelValue:o.solicitudPrestamo.estado,"onUpdate:modelValue":e[10]||(e[10]=a=>o.solicitudPrestamo.estado=a),options:o.autorizaciones,"transition-show":"jump-up","transition-hide":"jump-down","options-dense":"",dense:"",outlined:"",disable:o.disabled,readonly:o.disabled,"use-input":"","input-debounce":"0","option-value":a=>a.id,"option-label":a=>a.nombre,"emit-value":"","map-options":""},{"no-option":r(()=>[i(S)]),_:1},8,["modelValue","options","disable","readonly","option-value","option-label"])])):v("",!0),s("div",Yo,[e[23]||(e[23]=s("label",{class:"q-mb-sm block"},"Total de Descuentos ",-1)),i(u,{modelValue:o.recursosHumanosStore.total_descuento,"onUpdate:modelValue":e[11]||(e[11]=a=>o.recursosHumanosStore.total_descuento=a),type:"number",disable:"",outlined:"",dense:""},null,8,["modelValue"])]),s("div",Go,[e[25]||(e[25]=s("label",{class:"q-mb-sm block"},"Porcentaje de Descuentos ",-1)),i(u,{modelValue:o.recursosHumanosStore.porcentaje_endeudamiento,"onUpdate:modelValue":e[12]||(e[12]=a=>o.recursosHumanosStore.porcentaje_endeudamiento=a),disable:"",outlined:"",dense:""},{after:r(()=>e[24]||(e[24]=[vo(" % ")])),_:1},8,["modelValue"])]),s("div",Wo,[o.recursosHumanosStore.mensaje?(m(),b("label",Xo,fo(o.recursosHumanosStore.mensaje),1)):v("",!0)])])]),_:1})]),_:1},8,["mixin","configuracionColumnas","tabOptions","permitirEditar","filtrar","tabDefecto"])}var Fe=to(Uo,[["render",Zo]]);export{Fe as default};
