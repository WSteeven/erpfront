var ea=Object.defineProperty;var sa=(a,o,r)=>o in a?ea(a,o,{enumerable:!0,configurable:!0,writable:!0,value:r}):a[o]=r;var i=(a,o,r)=>(sa(a,typeof o!="symbol"?o+"":o,r),r);import{Q as ta}from"./QSelect.a8f2bfb2.js";import{bz as ia,t as O,c as J,e as _,y as l,S as E,H as d,bg as S,z as c,M as R,L as v,D as s,Y as T,B as t,bf as G,G as ra,I as B,bi as na,U as la,u as da,g as $,E as ma,bA as z,s as ua,A as ca,bH as pa,v as fa,x as g,a7 as ba,K as M,F as ga,k as va,R as ja,J as ha}from"./index.976e8f3c.js";import{Q as _a,a as ya,C as Va}from"./QPopupProxy.d8ef7a42.js";import{Q as Ca}from"./QForm.ed6f6690.js";import{u as Ea}from"./index.ed676411.js";import{T as Aa}from"./TabLayoutFilterTabs2.f1a01a4e.js";import{E as ka}from"./EssentialEditor.265a8636.js";import{C as wa}from"./ContenedorSimpleMixin.5a0b06ab.js";import{E as $a}from"./entidadAuditable.75a46700.js";import{u as Ma}from"./filtrosListadosGenerales.31e9eb2c.js";import{S as K,s as qa}from"./utils.30e08aa2.js";import{r as Pa,a as N}from"./i18n-validators.06eef631.js";import{E as Fa}from"./ErrorComponent.b482e77d.js";import{N as Sa}from"./NoOptionComponent.ffe820c8.js";import{O as Ba}from"./OptionGroupComponent.fd35e5c8.js";import{E as Y,S as Ja}from"./EssentialTable.d8e6954a.js";import{M as Ra}from"./ModalEntidad.84100166.js";import{C as Ia,a as Qa}from"./ComponenteModal.domain.22ea4557.js";import{c as Ua,A as Da}from"./AsistenciaController.e47ad90d.js";import{c as Ha,P as La}from"./PermisoEmpleadoController.04ad7ad1.js";import{C as za}from"./CalloutComponent.aad0ab14.js";import"./QChip.334d746c.js";import"./QItemSection.c6f2640c.js";import"./QMenu.410ae527.js";import"./position-engine.2f1d750c.js";import"./format.8ac60962.js";import"./QTabs.3c726b04.js";import"./QResizeObserver.6ec10d95.js";import"./QTabPanels.1c8c4baa.js";import"./touch.9135741d.js";import"./QPage.ed5d79ca.js";import"./EssentialTableTabs.c7e98bba.js";import"./QBadge.1ddeabfd.js";import"./EssentialTablePagination.f449a738.js";import"./QTable.048b8be8.js";import"./use-fullscreen.0ccd26e6.js";import"./QToolbar.cff7174f.js";import"./QBtnGroup.7d0835e4.js";import"./buttonSubmits.2eb37d38.js";import"./extend.4a22771d.js";import"./index.95f5a0db.js";import"./QFile.e27868da.js";import"./_commonjsHelpers.8402d862.js";import"./QImg.e0fb285c.js";import"./VisorImagen.e7965569.js";import"./seleccionContratacionPersonal.utils.e3e1ed3d.js";import"./configuracion_general.ef04b031.js";import"./ConfiguracionController.65de3fc5.js";const Na=[{name:"id",field:"id",label:"N\xB0",align:"left",sortable:!0},{name:"empleado",field:"empleado",label:"Empleado",align:"left",sortable:!0},{name:"fecha_atraso",field:"fecha_atraso",label:"Fecha",align:"left",sortable:!0},{name:"ocurrencia",field:"ocurrencia",label:"Ocurrencia",align:"right",sortable:!0},{name:"tiempo_atraso",field:"tiempo_atraso",label:"Tiempo Atraso",align:"right",sortable:!0},{name:"segundos_atraso",field:"segundos_atraso",label:"Segundos",align:"right",sortable:!0},{name:"revisado",field:"revisado",label:"\xBFRevisado?",align:"right",sortable:!0},{name:"justificacion",field:"justificacion",label:"Justificaci\xF3n Atraso (J.I. o R.H.)",align:"left",sortable:!1},{name:"justificacion_atrasado",field:"justificacion_atrasado",label:"Justificaci\xF3n de Atraso (E.A.)",align:"left",sortable:!1},{name:"justificado_por_atrasado",field:"justificado_por_atrasado",label:"Justificado por Atrasado",align:"left",sortable:!1}];class Oa extends ia{constructor(){super(O.atrasos)}}class Ta extends $a{constructor(){super();i(this,"empleado");i(this,"fecha_atraso");i(this,"minutos_atraso");i(this,"tiempo_atraso");i(this,"segundos_atraso");i(this,"justificacion");i(this,"jefe");i(this,"justificador");i(this,"justificacion_atrasado");i(this,"justificado_por_atrasado");i(this,"marcacion");i(this,"ocurrencia");i(this,"justificado");i(this,"imagen_evidencia");i(this,"revisado");this.empleado=null,this.fecha_atraso=null,this.minutos_atraso=null,this.tiempo_atraso=null,this.segundos_atraso=null,this.justificacion="",this.jefe=null,this.justificador=null,this.justificacion_atrasado=null,this.justificado_por_atrasado=null,this.marcacion=null,this.ocurrencia=null,this.justificado=!1,this.imagen_evidencia=null,this.revisado=!1}}const Ga={key:0,class:"text-h6 q-pb-md"},Ka={class:"row justify-center"},Ya={class:"text-h6 col-12 text-center"},Wa=J({__name:"PermisoPage",props:{mostrarEncabezado:{type:Boolean,default:!0},empleado_id:{type:Number,required:!0},fecha:{type:String,required:!0}},setup(a){const o=a,r=new K,m=_(),p=_([]);async function j(){try{r.activar();const{result:u}=await new La().listar({"or[empleado_id]":o.empleado_id,fecha_hora_inicio:o.fecha});m.value=u[0],p.value.push(m.value)}catch(u){console.error(u)}finally{r.desactivar()}}return j(),(u,f)=>(l(),E(G,null,{default:d(()=>[m.value?(l(),E(S,{key:0},{default:d(()=>{var n;return[a.mostrarEncabezado?(l(),c("div",Ga," Permisos solicitados por el empleado: "+R((n=m.value)==null?void 0:n.empleado_info),1)):v("",!0),s(Y,{datos:p.value,"alto-fijo":!1,mostrarHeader:!1,mostrarFooter:!1,"configuracion-columnas":T(Ha)},null,8,["datos","configuracion-columnas"])]}),_:1})):(l(),E(S,{key:1},{default:d(()=>[t("div",Ka,[t("div",Ya,[s(za,{mensaje:"No hay permisos registrados para este d\xEDa",tipo:"warning"})])])]),_:1}))]),_:1}))}}),Xa={key:0,class:"text-h6 q-pb-md"},Za=J({__name:"MarcacionPage",props:{mostrarEncabezado:{type:Boolean,default:!0},datos:Object},setup(a){const o=a,r=new K,m=_(),p=_([]),j=_(!1);async function u(){var f;try{r.activar();const{result:n}=await new Da().consultar((f=o.datos)==null?void 0:f.marcacion_id);m.value=n,p.value.push(m.value),j.value=!0}catch(n){console.error(n)}finally{r.desactivar()}}return u(),(f,n)=>{var h,y;return l(),c(B,null,[s(G,null,{default:d(()=>[s(S,null,{default:d(()=>{var V;return[a.mostrarEncabezado?(l(),c("div",Xa," Registro de marcaciones del empleado: "+R((V=m.value)==null?void 0:V.empleado),1)):v("",!0),s(Y,{datos:p.value,"alto-fijo":!1,mostrarHeader:!1,mostrarFooter:!1,"configuracion-columnas":T(Ua)},null,8,["datos","configuracion-columnas"])]}),_:1})]),_:1}),n[0]||(n[0]=ra()),n[1]||(n[1]=t("hr",null,null,-1)),j.value?(l(),E(Wa,{key:0,empleado_id:(h=m.value)==null?void 0:h.empleado_id,fecha:(y=m.value)==null?void 0:y.fecha},null,8,["empleado_id","fecha"])):v("",!0)],64)}}});var W=Za;class xa{constructor(){i(this,"MarcacionPage");this.MarcacionPage=na(new Ia("Registro de Marcaciones en biom\xE9trico",W))}}class ao extends Qa{constructor(){super(new xa)}}var oo=J({name:"JustificacionPage",components:{MarcacionPage:W,ModalEntidad:Ra,NoOptionComponent:Sa,SelectorImagen:Ja,ErrorComponent:Fa,TabLayoutFilterTabs2:Aa,OptionGroupComponent:Ba,EssentialEditor:ka},setup(){const a=new wa(Ta,new Oa),{entidad:o,accion:r,listado:m,listadosAuxiliares:p,disabled:j}=a.useReferencias(),{setValidador:u,listar:f,cargarVista:n,obtenerListados:h}=a.useComportamiento(),{onBeforeConsultar:y,onConsultado:V,onModificado:q}=a.useHooks(),A=_("0"),{notificarCorrecto:k}=la(),C=new ao,e=da(),I=$(()=>e.esRecursosHumanos),Q=$(()=>e.user.id==o.jefe),X=$(()=>I.value||Q.value),U=$(()=>e.user.id==o.empleado),P=_(!1),{empleados:D,filtrarEmpleados:Z}=Ma(p);n(async()=>{await h({empleados:{controller:new ma,params:{estado:1}}}),D.value=p.empleados});const x={empleado:{required:Pa},justificacion:{required:N(()=>o.justificado)},justificacion_atrasado:{required:N(()=>r.value==z.editar&&U.value)}},H=Ea(x,o);u(H.value),y(async()=>{P.value=!1}),V(()=>{P.value=!0}),q((b,F)=>{F.modelo.justificado&&L("1")});const aa=[{value:"0",label:"Injustificados"},{value:"1",label:"Justificados"}];async function L(b){A.value=b,await f({justificado:b})}async function oa(){const b=ca.getInstance(),F=pa.URL_BASE+"/"+b.getEndpoint(O.sincronizar_atrasos);try{const w=await b.get(F);w.status===200&&k(w.data.message)}catch(w){console.error("Error al sincronizar atrasos:",w),m.value=[]}}return oa(),{mixin:a,atraso:o,v$:H,disabled:j,accion:r,acciones:z,configuracionColumnas:Na,tabDefecto:A,tabOptions:aa,maskFecha:ua,puedeJustificar:X,esRecursosHumanos:I,esJefeInmediato:Q,esEmpleadoAtrasado:U,modales:C,mostrarMarcacionPage:P,empleados:D,filtrarEmpleados:Z,filtrarListadoAtrasos:L,ordenarLista:qa,btnVerMarcaciones:{titulo:"Ver asistencias",icono:"bi-calendar-check",color:"secondary",accion:({entidad:b})=>{C.abrirModalEntidad("MarcacionPage",{marcacion_id:b.marcacion})}}}}});const eo={key:0,class:"row border-grey rounded q-pa-sm q-mb-md"},so={class:"col-12"},to={class:"row q-col-gutter-md"},io={class:"col-12 col-md-3"},ro={class:"col-12 col-md-3"},no={class:"row items-center justify-end"},lo={class:"col-12 col-md-3"},mo={class:"col-12 col-md-3"},uo={class:"col-12 col-md-3"},co={class:"col-12 col-md-3"},po={key:0,class:"col-6 col-md-3 col-sm-12"},fo={key:1,class:"col-12 col-md-3"},bo={key:2,class:"col-12"};function go(a,o,r,m,p,j){const u=g("marcacion-page"),f=g("error-component"),n=g("no-option-component"),h=g("option-group-component"),y=g("selector-imagen"),V=g("essential-editor"),q=g("tab-layout-filter-tabs2"),A=g("modal-entidad");return l(),c(B,null,[s(q,{mixin:a.mixin,configuracionColumnas:a.configuracionColumnas,"titulo-pagina":"Atrasos de Empleados","tab-options":a.tabOptions,tabDefecto:a.tabDefecto,filtrar:a.filtrarListadoAtrasos,"permitir-editar":a.tabDefecto=="0",accion1:a.btnVerMarcaciones,"ajustar-celdas":""},{formulario:d(()=>[s(Ca,{onSubmit:o[11]||(o[11]=ba(()=>{},["prevent"]))},{default:d(()=>{var k,C;return[[a.acciones.consultar,a.acciones.editar].includes(a.accion)&&a.atraso.marcacion!=null?(l(),c("div",eo,[t("div",so,[o[12]||(o[12]=t("label",{class:"text-h6 q-mb-sm block"},"Registro de marcaci\xF3n",-1)),a.mostrarMarcacionPage?(l(),E(u,{key:0,class:"bg-desenfoque rounded shadow-0","mostrar-encabezado":!1,datos:{marcacion_id:(k=a.atraso)==null?void 0:k.marcacion}},null,8,["datos"])):v("",!0)])])):v("",!0),t("div",to,[t("div",io,[o[13]||(o[13]=t("label",{class:"q-mb-sm block"},"Empleado",-1)),s(ta,{modelValue:a.atraso.empleado,"onUpdate:modelValue":o[0]||(o[0]=e=>a.atraso.empleado=e),options:a.empleados,"transition-show":"jump-up","transition-hide":"jump-down",disable:"","options-dense":"",dense:"",outlined:"",error:!!a.v$.empleado.$errors.length,onBlur:a.v$.empleado.$touch,"error-message":"Debes seleccionar un empleado","use-input":"","input-debounce":"0",onFilter:a.filtrarEmpleados,onPopupShow:o[1]||(o[1]=e=>a.ordenarLista(a.empleados,"nombres")),"option-value":e=>e.id,"option-label":e=>e.nombres+" "+e.apellidos,"emit-value":"","map-options":""},{error:d(()=>[s(f,{clave:"empleado",v$:a.v$},null,8,["v$"])]),"no-option":d(()=>[s(n)]),_:1},8,["modelValue","options","error","onBlur","onFilter","option-value","option-label"])]),t("div",ro,[o[14]||(o[14]=t("label",{class:"q-mb-sm block"},"Fecha de Atraso",-1)),s(M,{modelValue:a.atraso.fecha_atraso,"onUpdate:modelValue":o[3]||(o[3]=e=>a.atraso.fecha_atraso=e),outlined:"",dense:"",disable:"",hint:"Fecha de atraso"},{append:d(()=>[s(ga,{name:"event",class:"cursor-pointer"},{default:d(()=>[s(_a,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:d(()=>[s(ya,{modelValue:a.atraso.fecha_atraso,"onUpdate:modelValue":o[2]||(o[2]=e=>a.atraso.fecha_atraso=e),mask:a.maskFecha,"today-btn":"",disable:""},{default:d(()=>[t("div",no,[va(s(ja,{label:"Cerrar",color:"primary",flat:""},null,512),[[Va]])])]),_:1},8,["modelValue","mask"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),t("div",lo,[o[15]||(o[15]=t("label",{class:"q-mb-sm block"},"Tiempo de Atraso",-1)),s(M,{modelValue:a.atraso.tiempo_atraso,"onUpdate:modelValue":o[4]||(o[4]=e=>a.atraso.tiempo_atraso=e),outlined:"",autogrow:"",dense:"",disable:"",hint:"Tiempo de atraso calculados"},null,8,["modelValue"])]),t("div",mo,[o[16]||(o[16]=t("label",{class:"q-mb-sm block"},"Ocurrencia del Atraso",-1)),s(M,{modelValue:a.atraso.ocurrencia,"onUpdate:modelValue":o[5]||(o[5]=e=>a.atraso.ocurrencia=e),outlined:"",dense:"",disable:"",hint:"Ocurrencia del atraso"},null,8,["modelValue"])]),t("div",uo,[o[17]||(o[17]=t("label",{class:"q-mb-sm block"},"\xBFJustificar?",-1)),s(h,{modelValue:a.atraso.justificado,"onUpdate:modelValue":o[6]||(o[6]=e=>a.atraso.justificado=e),disable:a.disabled||!a.puedeJustificar},null,8,["modelValue","disable"])]),t("div",co,[o[18]||(o[18]=t("label",{class:"q-mb-sm block"},"\xBFRevisado?",-1)),s(h,{modelValue:a.atraso.revisado,"onUpdate:modelValue":o[7]||(o[7]=e=>a.atraso.revisado=e),disable:""},null,8,["modelValue"])]),a.esEmpleadoAtrasado||a.esJefeInmediato||a.esRecursosHumanos||a.atraso.imagen_evidencia!=null?(l(),c("div",po,[o[19]||(o[19]=t("label",{for:"q-mb-xl block"},"Imagen Evidencia",-1)),s(y,{file_extensiones:".jpg, image/*",imagen:a.atraso.imagen_evidencia,disable:a.disabled,alto:"300px","onUpdate:modelValue":o[8]||(o[8]=e=>a.atraso.imagen_evidencia=e)},null,8,["imagen","disable"])])):v("",!0),a.atraso.justificacion_atrasado||a.esEmpleadoAtrasado?(l(),c("div",fo,[o[20]||(o[20]=t("label",{class:"q-mb-sm block"},"Justificaci\xF3n (E. Atrasado)",-1)),s(M,{modelValue:a.atraso.justificacion_atrasado,"onUpdate:modelValue":o[9]||(o[9]=e=>a.atraso.justificacion_atrasado=e),outlined:"",dense:"",autogrow:"",disable:a.disabled||!a.esEmpleadoAtrasado,placeholder:"Opcional",hint:"Ingresa tu justificaci\xF3n del atraso",error:!!a.v$.justificacion_atrasado.$errors.length,onBlur:a.v$.justificacion_atrasado.$touch},{error:d(()=>[s(f,{clave:"justificacion_atrasado",v$:a.v$},null,8,["v$"])]),_:1},8,["modelValue","disable","error","onBlur"])])):v("",!0),a.esJefeInmediato||a.esRecursosHumanos||((C=a.atraso.justificacion)==null?void 0:C.length)>1?(l(),c("div",bo,[o[21]||(o[21]=t("label",{class:"q-mb-sm block"},"Justificaci\xF3n del atraso",-1)),s(V,{modelValue:a.atraso.justificacion,"onUpdate:modelValue":o[10]||(o[10]=e=>a.atraso.justificacion=e),disable:a.disabled},null,8,["modelValue","disable"]),(l(!0),c(B,null,ha(a.v$.justificacion.$errors,e=>(l(),c("div",{class:"text-negative text-uppercase",key:e.$uid},[t("small",null,R(e.$message),1)]))),128))])):v("",!0)])]}),_:1})]),_:1},8,["mixin","configuracionColumnas","tab-options","tabDefecto","filtrar","permitir-editar","accion1"]),s(A,{persistente:!1,comportamiento:a.modales},null,8,["comportamiento"])],64)}var pe=fa(oo,[["render",go]]);export{pe as default};
