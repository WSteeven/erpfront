var oe=Object.defineProperty;var ae=(e,o,m)=>o in e?oe(e,o,{enumerable:!0,configurable:!0,writable:!0,value:m}):e[o]=m;var i=(e,o,m)=>(ae(e,typeof o!="symbol"?o+"":o,m),m);import{Q as S,a as j}from"./QItemSection.9a955ec6.js";import{Q as q}from"./QSelect.6ce302d7.js";import{bw as se,s as te,d as le,c as w,E as ne,bx as u,p as ie,q as re,_ as de,t as B,v as r,P as ue,F as l,z as t,a4 as me,y as s,x as d,G as C,H as V,K as h,D as P,I as D,B as G,j as R,O as H,a7 as ce,J as pe}from"./index.6449c167.js";import{Q as J,a as K,C as Y}from"./QPopupProxy.72ff1d6d.js";import{Q as be}from"./QForm.ca56f146.js";import{T as fe}from"./TabLayoutFilterTabs2.5e702525.js";import{E as ve}from"./EssentialTable.00c17e97.js";import{C as ge}from"./ContenedorSimpleMixin.09c9bed5.js";import{E as W}from"./entidadAuditable.75a46700.js";import{u as Ce}from"./filtrosListadosGenerales.c3aa2da3.js";import{f as Ve}from"./recursosHumanos.utils.f01cf672.js";import{u as he}from"./index.490dde02.js";import{r as $}from"./i18n-validators.29e2545c.js";import{a as $e,w as ye,D as ke}from"./utils.521b98f3.js";import{E as we}from"./EssentialEditor.3e49b578.js";import{D as De}from"./DescuentosGenralesController.2c9da057.js";import{M as Ee}from"./MultaController.569cdb40.js";import"./QChip.95469f73.js";import"./position-engine.70d0a89f.js";import"./format.8ac60962.js";import"./QTabs.6c234f27.js";import"./QResizeObserver.9af84680.js";import"./QTabPanels.49d2362a.js";import"./touch.9135741d.js";import"./QPage.5d173a8a.js";import"./EssentialTableTabs.586dbdfc.js";import"./QBadge.e6f320cd.js";import"./EssentialTablePagination.d5c1010a.js";import"./QToolbar.8dbe891b.js";import"./use-fullscreen.a7661f85.js";import"./buttonSubmits.fe817da3.js";import"./_commonjsHelpers.8402d862.js";import"./QImg.fd079679.js";import"./QFile.90d9394a.js";import"./VisorImagen.75b3c53f.js";import"./logo.4781eea2.js";import"./seleccionContratacionPersonal.utils.e3e1ed3d.js";import"./index.0198dd12.js";import"./extend.4a22771d.js";class _e extends W{constructor(){super();i(this,"fecha_descuento");i(this,"empleado");i(this,"tipo_descuento");i(this,"multa");i(this,"descripcion");i(this,"valor");i(this,"cantidad_cuotas");i(this,"mes_inicia_cobro");i(this,"pendiente_pagar");i(this,"pagado");i(this,"cuotas");this.fecha_descuento=null,this.empleado=null,this.multa=null,this.tipo_descuento=null,this.descripcion="",this.valor=null,this.cantidad_cuotas=null,this.mes_inicia_cobro=null,this.pendiente_pagar=null,this.pagado=!1,this.cuotas=[]}}class Fe extends se{constructor(){super(te.descuentos)}}const Me=[{name:"empleado",field:"empleado",label:"Empleado",align:"left",sortable:!0},{name:"valor",field:"valor",label:"Monto",align:"left",sortable:!0},{name:"cantidad_cuotas",field:"cantidad_cuotas",label:"Cant. Cuotas",align:"left",sortable:!0},{name:"pendiente_pagar",field:"pendiente_pagar",label:"Pendiente Pagar",align:"left",sortable:!0}],Se=[{name:"num_cuota",field:"num_cuota",label:"N\xFAmero de Cuota",align:"left",sortable:!0},{name:"mes_vencimiento",field:"mes_vencimiento",label:"Mes de Vencimiento",align:"left",sortable:!0},{name:"valor_cuota",field:"valor_cuota",label:"Valor de Cuota",align:"left",sortable:!0},{name:"pagada",field:"pagada",label:"pagada",align:"center",sortable:!0},{name:"comentario",field:"comentario",label:"Comentario",align:"left",sortable:!0}];class je extends W{constructor(){super();i(this,"num_cuota");i(this,"mes_vencimiento");i(this,"valor_cuota");i(this,"pagada");i(this,"comentario");this.num_cuota=null,this.mes_vencimiento=null,this.valor_cuota=null,this.pagada=!1,this.comentario=null}}var qe=le({components:{EssentialEditor:we,TabLayoutFilterTabs2:fe,EssentialTable:ve},setup(){const e=new ge(_e,new Fe),{entidad:o,disabled:m,accion:b,listadosAuxiliares:y}=e.useReferencias(),{setValidador:U,obtenerListados:E,cargarVista:_,listar:F}=e.useComportamiento(),{prompt:a,confirmar:O,notificarCorrecto:Q}=$e(),N=w("0"),T=w(!1),I=w([]),A=w([]),{empleados:L,filtrarEmpleados:X}=Ce(y);_(async()=>{await E({empleados:{controller:new ne,params:{estado:1}},descuentos_generales:{controller:new De,params:{}},multas:{controller:new Ee,params:{}}}),I.value=y.descuentos_generales,L.value=y.empleados,A.value=y.multas});const z=he({empleado:{required:$},fecha_descuento:{required:$},descripcion:{required:$},valor:{required:$},cantidad_cuotas:{required:$},mes_inicia_cobro:{required:$}},o);U(z.value);async function Z(n){N.value=n,await F({pagado:n})}function x(n,c){T.value=c!=="month"}function ee(){o.cuotas=[];const n=Number(o.valor),c=Number(o.cantidad_cuotas),p=Math.floor(n/c*100)/100,M=p*o.cantidad_cuotas,f=parseFloat((n-M).toFixed(2)),v=new Date(o.mes_inicia_cobro+"-01");for(let k=0;k<o.cantidad_cuotas;k++){const g=new je;g.num_cuota=k+1,g.id=o.cuotas.length?ke(o.cuotas)+1:1,g.valor_cuota=k===0?parseFloat((p+Math.abs(f)).toFixed(2)):p,g.mes_vencimiento=v.toISOString().slice(0,7),v.setMonth(v.getMonth()+1),g.pagada=!1,o.cuotas.push(g)}}return{v$:z,mixin:e,descuento:o,accion:b,acciones:u,accionesTabla:ie,disabled:m,configuracionColumnas:Me,configuracionColumnasCuotasDescuento:Se,maskFecha:re,tabDefecto:N,tabOptions:Ve,is_month:T,multas:A,descuentos_generales:I,empleados:L,filtrarEmpleados:X,filtrar:Z,checkMes:x,calcularCantidadCuotas:ee,ordenarLista:ye,btnEditarValorCuota:{titulo:"Editar",icono:"bi-pencil-square",color:"secondary",accion:()=>{},visible:()=>[u.nuevo,u.editar].includes(b.value)},btnComentarioCuota:{titulo:"Comentario",icono:"bi-chat-square-text-fill",color:"primary",accion:({entidad:n})=>{const c={titulo:"Comentario",mensaje:"Escribe el comentario",defecto:n.comentario,accion:p=>{n.comentario=p}};a(c)},visible:()=>[u.nuevo,u.editar].includes(b.value)},btnAplazarCuota:{titulo:"Aplazar",icono:"bi-caret-down-fill",color:"warning",accion:({entidad:n})=>{O("Se modificar\xE1 el mes de vencimiento hasta el mes siguiente de la ultima cuota. \xBFEst\xE1 seguro de continuar?",()=>{const c=o.cuotas.at(-1),[p,M]=c.mes_vencimiento.split("-").map(Number),f=new Date(p,M-1,1);console.log("Fecha antes de modificar:",f.toISOString().slice(0,7)),f.setMonth(f.getMonth()+1);const v=f.toISOString().slice(0,7);console.log("Fecha luego de modificar:",v),n.mes_vencimiento=v,Q("\xA1Se aplaz\xF3 correctamente la cuota!")})},visible:({entidad:n})=>[u.nuevo,u.editar].includes(b.value)&&!n.pagada},btnPagarCuota:{titulo:"Pagar",icono:"bi-cash",color:"secondary",accion:({entidad:n})=>{O("\xBFEst\xE1 seguro de marcar esta cuota como pagada?",()=>{n.pagada=!n.pagada,Q("\xA1Cuota marcada como pagada exitosamente!")})},visible:({entidad:n})=>[u.nuevo,u.editar].includes(b.value)&&!n.pagada},barraDefault:[["bold","italic","strike","underline","subscript","superscript"],["quote","unordered","ordered","outdent","indent"]]}}});const Be={class:"row q-col-gutter-sm q-py-md"},Pe={class:"col-12 col-md-4"},Ue={class:"error-msg"},Oe={class:"col-12 col-md-3 col-sm-4"},Qe={class:"col-12 col-md-3 col-sm-4"},Ne={class:"col-12 col-md-4"},Te={class:"row items-center justify-end"},Ie={class:"error-msg"},Ae={class:"col-12 col-md-4"},Le={class:"error-msg"},ze={class:"col-12"},Ge={class:"col-12 col-md-4"},Re={class:"row items-center justify-end"},He={class:"error-msg"},Je={class:"col-12 col-md-4"},Ke={class:"error-msg"},Ye={class:"col-12 col-md-4 col-sm-3"},We={key:0,class:"col-12"};function Xe(e,o,m,b,y,U){const E=B("essential-editor"),_=B("essential-table"),F=B("tab-layout-filter-tabs2");return r(),ue(F,{mixin:e.mixin,"configuracion-columnas":e.configuracionColumnas,"titulo-pagina":"Descuentos a Empleados","tab-options":e.tabOptions,"ajustar-celdas":"","tab-defecto":e.tabDefecto,filtrar:e.filtrar},{formulario:l(()=>[t(be,{onSubmit:o[15]||(o[15]=me(()=>{},["prevent"]))},{default:l(()=>[s("div",Be,[s("div",Pe,[o[17]||(o[17]=s("label",{class:"q-mb-sm block"},"Empleado",-1)),t(q,{modelValue:e.descuento.empleado,"onUpdate:modelValue":o[0]||(o[0]=a=>e.descuento.empleado=a),options:e.empleados,"transition-show":"jump-up","transition-hide":"jump-down","options-dense":"",dense:"",outlined:"",disable:e.disabled,error:!!e.v$.empleado.$errors.length,"error-message":"Debes seleccionar un empleado","use-input":"","input-debounce":"0",onFilter:e.filtrarEmpleados,onPopupShow:o[1]||(o[1]=a=>e.ordenarLista(e.empleados,"apellidos")),"option-value":a=>a.id,"option-label":a=>a.nombres+" "+a.apellidos,"emit-value":"","map-options":""},{error:l(()=>[(r(!0),d(C,null,V(e.v$.empleado.$errors,a=>(r(),d("div",{key:a.$uid},[s("div",Ue,h(a.$message),1)]))),128))]),"no-option":l(()=>[t(S,null,{default:l(()=>[t(j,{class:"text-grey"},{default:l(()=>o[16]||(o[16]=[P(" No hay resultados ")])),_:1})]),_:1})]),_:1},8,["modelValue","options","disable","error","onFilter","option-value","option-label"])]),s("div",Oe,[o[19]||(o[19]=s("label",{class:"q-mb-sm block"},"Tipo Descuento",-1)),t(q,{modelValue:e.descuento.tipo_descuento,"onUpdate:modelValue":[o[2]||(o[2]=a=>e.descuento.tipo_descuento=a),o[3]||(o[3]=()=>e.descuento.multa=null)],options:e.descuentos_generales,"transition-show":"jump-up","transition-hide":"jump-down","options-dense":"",dense:"",disable:e.disabled,outlined:"","use-input":"","input-debounce":"0","option-value":a=>a.id,"option-label":a=>a.nombre,"emit-value":"","map-options":""},{"no-option":l(()=>[t(S,null,{default:l(()=>[t(j,{class:"text-grey"},{default:l(()=>o[18]||(o[18]=[P(" No hay resultados ")])),_:1})]),_:1})]),_:1},8,["modelValue","options","disable","option-value","option-label"])]),s("div",Qe,[o[21]||(o[21]=s("label",{class:"q-mb-sm block"},"Multa",-1)),t(q,{modelValue:e.descuento.multa,"onUpdate:modelValue":[o[4]||(o[4]=a=>e.descuento.multa=a),o[5]||(o[5]=()=>e.descuento.tipo_descuento=null)],options:e.multas,"transition-show":"jump-up","transition-hide":"jump-down","options-dense":"",dense:"",disable:e.disabled,outlined:"","use-input":"","input-debounce":"0","option-value":a=>a.id,"option-label":a=>a.nombre,"emit-value":"","map-options":""},{"no-option":l(()=>[t(S,null,{default:l(()=>[t(j,{class:"text-grey"},{default:l(()=>o[20]||(o[20]=[P(" No hay resultados ")])),_:1})]),_:1})]),_:1},8,["modelValue","options","disable","option-value","option-label"])]),s("div",Ne,[o[22]||(o[22]=s("label",{class:"q-mb-sm block"},"Fecha del descuento",-1)),t(D,{modelValue:e.descuento.fecha_descuento,"onUpdate:modelValue":o[7]||(o[7]=a=>e.descuento.fecha_descuento=a),placeholder:"Obligatorio",error:!!e.v$.fecha_descuento.$errors.length,disable:e.disabled,onBlur:e.v$.fecha_descuento.$touch,outlined:"",dense:""},{append:l(()=>[t(G,{name:"event",class:"cursor-pointer"},{default:l(()=>[t(J,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:l(()=>[t(K,{modelValue:e.descuento.fecha_descuento,"onUpdate:modelValue":o[6]||(o[6]=a=>e.descuento.fecha_descuento=a),mask:e.maskFecha,"today-btn":""},{default:l(()=>[s("div",Te,[R(t(H,{label:"Cerrar",color:"primary",flat:""},null,512),[[Y]])])]),_:1},8,["modelValue","mask"])]),_:1})]),_:1})]),error:l(()=>[(r(!0),d(C,null,V(e.v$.fecha_descuento.$errors,a=>(r(),d("div",{key:a.$uid},[s("div",Ie,h(a.$message),1)]))),128))]),_:1},8,["modelValue","error","disable","onBlur"])]),s("div",Ae,[o[23]||(o[23]=s("label",{class:"q-mb-sm block"},"Valor ",-1)),t(D,{modelValue:e.descuento.valor,"onUpdate:modelValue":o[8]||(o[8]=a=>e.descuento.valor=a),placeholder:"Obligatorio",type:"number",disable:e.disabled,error:!!e.v$.valor.$errors.length,onBlur:e.v$.valor.$touch,outlined:"",dense:""},{error:l(()=>[(r(!0),d(C,null,V(e.v$.valor.$errors,a=>(r(),d("div",{key:a.$uid},[s("div",Le,h(a.$message),1)]))),128))]),_:1},8,["modelValue","disable","error","onBlur"])]),s("div",ze,[o[24]||(o[24]=s("div",{class:"row justify-between"},[s("label",{class:"q-mb-sm block"},"Descripci\xF3n")],-1)),t(E,{modelValue:e.descuento.descripcion,"onUpdate:modelValue":o[9]||(o[9]=a=>e.descuento.descripcion=a),disable:e.disabled,"barra-herramientas":e.barraDefault},null,8,["modelValue","disable","barra-herramientas"]),(r(!0),d(C,null,V(e.v$.descripcion.$errors,a=>(r(),d("div",{key:a.$uid,class:"text-negative text-uppercase"},[s("small",null,h(a.$message),1)]))),128))]),s("div",Ge,[o[25]||(o[25]=s("label",{class:"q-mb-sm block"},"Mes inicia cobro",-1)),t(D,{modelValue:e.descuento.mes_inicia_cobro,"onUpdate:modelValue":o[12]||(o[12]=a=>e.descuento.mes_inicia_cobro=a),mask:"####-##",placeholder:"Obligatorio",error:!!e.v$.mes_inicia_cobro.$errors.length,disable:e.disabled,onBlur:e.v$.mes_inicia_cobro.$touch,outlined:"",dense:""},{append:l(()=>[t(G,{name:"event",class:"cursor-pointer"},{default:l(()=>[t(J,{cover:"","transition-show":"scale","transition-hide":"scale",modelValue:e.is_month,"onUpdate:modelValue":o[11]||(o[11]=a=>e.is_month=a)},{default:l(()=>[t(K,{modelValue:e.descuento.mes_inicia_cobro,"onUpdate:modelValue":[o[10]||(o[10]=a=>e.descuento.mes_inicia_cobro=a),e.checkMes],minimal:"",mask:e.maskFecha,"emit-immediately":"","default-view":"Years"},{default:l(()=>[s("div",Re,[R(t(H,{label:"Cerrar",color:"primary",flat:""},null,512),[[Y]])])]),_:1},8,["modelValue","mask","onUpdate:modelValue"])]),_:1},8,["modelValue"])]),_:1})]),error:l(()=>[(r(!0),d(C,null,V(e.v$.mes_inicia_cobro.$errors,a=>(r(),d("div",{key:a.$uid},[s("div",He,h(a.$message),1)]))),128))]),_:1},8,["modelValue","error","disable","onBlur"])]),s("div",Je,[o[26]||(o[26]=s("label",{class:"q-mb-sm block"},"Cantidad Cuotas ",-1)),t(D,{modelValue:e.descuento.cantidad_cuotas,"onUpdate:modelValue":[o[13]||(o[13]=a=>e.descuento.cantidad_cuotas=a),e.calcularCantidadCuotas],placeholder:"Obligatorio",type:"number",disable:e.accion!==e.acciones.nuevo,error:!!e.v$.cantidad_cuotas.$errors.length,onBlur:e.v$.valor.$touch,outlined:"",dense:""},{error:l(()=>[(r(!0),d(C,null,V(e.v$.cantidad_cuotas.$errors,a=>(r(),d("div",{key:a.$uid},[s("div",Ke,h(a.$message),1)]))),128))]),_:1},8,["modelValue","disable","error","onBlur","onUpdate:modelValue"])]),s("div",Ye,[o[27]||(o[27]=s("label",{class:"q-mb-sm block"},"Pagado",-1)),t(ce,{label:e.descuento.pagado?"SI":"NO",modelValue:e.descuento.pagado,"onUpdate:modelValue":o[14]||(o[14]=a=>e.descuento.pagado=a),color:"primary","keep-color":"",icon:"bi-check2-circle","unchecked-icon":"clear",disable:""},null,8,["label","modelValue"])]),e.descuento.cuotas.length>0?(r(),d("div",We,[t(_,{titulo:"Cuotas a Pagar",datos:e.descuento.cuotas,"configuracion-columnas":e.accion==e.acciones.editar?[...e.configuracionColumnasCuotasDescuento,e.accionesTabla]:e.configuracionColumnasCuotasDescuento,"ajustar-celdas":"","desplegar-desde":3,accion1:e.btnPagarCuota,accion2:e.btnComentarioCuota,accion3:e.btnAplazarCuota,altoFijo:!1,permitirConsultar:!1,permitirEditar:!1,permitirEliminar:!1},null,8,["datos","configuracion-columnas","accion1","accion2","accion3"])])):pe("",!0)])]),_:1})]),_:1},8,["mixin","configuracion-columnas","tab-options","tab-defecto","filtrar"])}var Go=de(qe,[["render",Xe]]);export{Go as default};
