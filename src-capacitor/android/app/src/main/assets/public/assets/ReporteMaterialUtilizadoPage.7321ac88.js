var M=Object.defineProperty;var Q=(e,o,i)=>o in e?M(e,o,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[o]=i;var u=(e,o,i)=>(Q(e,typeof o!="symbol"?o+"":o,i),i);import{Q as y,a as m}from"./QSelect.6ce302d7.js";import{Q as c,a as f}from"./QItemSection.9a955ec6.js";import{bw as S,s as D,d as F,be as L,bE as N,A as h,_ as O,v as l,P as j,F as r,y as s,z as a,x as d,G as w,H as R,K as p,bd as V,D as n,J as C,O as I}from"./index.6449c167.js";import{Q as G}from"./QPage.5d173a8a.js";import{g as H,o as J}from"./tareas.utils.309e0dff.js";import{u as K}from"./filtrosListadosGenerales.c3aa2da3.js";import{r as b}from"./i18n-validators.29e2545c.js";import{u as Y}from"./index.490dde02.js";import{C as W}from"./ContenedorSimpleMixin.09c9bed5.js";import{P as X}from"./ProyectoController.fd7b11f8.js";import{E as Z}from"./entidadAuditable.75a46700.js";import{B as x}from"./utils.521b98f3.js";import"./QChip.95469f73.js";import"./position-engine.70d0a89f.js";import"./format.8ac60962.js";import"./index.0198dd12.js";class oo extends S{constructor(){super(D.reporte_materiales_utilizados)}}class eo extends Z{constructor(){super();u(this,"tipo_reporte");u(this,"proyecto_id");u(this,"tarea_id");this.tipo_reporte=null,this.proyecto_id=null,this.tarea_id=null}}var to=F({setup(){const e=new W(eo,new oo),{entidad:o,listadosAuxiliares:i}=e.useReferencias(),{obtenerListados:g,cargarVista:_,setValidador:v,listar:t}=e.useComportamiento();_(async()=>{await g({proyectos:{controller:new X,params:{campos:"id,nombre,codigo_proyecto"}},tareas:{controller:new L,params:{campos:"id,codigo_tarea,titulo,cliente_id,proyecto_id"}}})});const{tareas:P,filtrarTareas:T,proyectos:k,filtrarProyectos:z}=K(i);async function U(){const q=new Date,B="reporte_material_utilizado_"+q.toLocaleString(),E=e.getController().getEndpoint(),A=N.URL_BASE+"/"+h.getInstance().getEndpoint(E,o);x(A,"GET","blob","xlsx",B)}const $=Y({tipo_reporte:{required:b},tarea_id:{required:b},proyecto_id:{required:b}},o);return v($.value),{v$:$,filtro:o,tiposReportesMaterialUtilizado:H,opcionesTipoReporteMaterialUtilizado:J,tareas:P,filtrarTareas:T,proyectos:k,filtrarProyectos:z,consultarDescargar:U}}});const ro={class:"row q-col-gutter-sm q-pa-sm bg-desenfoque rounded border-white"},ao={class:"col-12 col-md-3"},so={key:0,class:"col-12 col-md-6"},io={class:"error-msg"},lo={key:1,class:"col-12 col-md-6"},no={class:"error-msg"},po={class:"col-12 col-md-3"};function uo(e,o,i,g,_,v){return l(),j(G,{padding:""},{default:r(()=>[s("div",ro,[o[11]||(o[11]=s("div",{class:"col-12 text-primary q-mb-sm"}," Reporte de materiales utilizados ",-1)),s("div",ao,[o[4]||(o[4]=s("label",{class:"q-mb-sm block"},"Tipo de reporte",-1)),a(y,{modelValue:e.filtro.tipo_reporte,"onUpdate:modelValue":o[0]||(o[0]=t=>e.filtro.tipo_reporte=t),options:e.opcionesTipoReporteMaterialUtilizado,"transition-show":"scale","transition-hide":"scale","options-dense":"",dense:"",outlined:""},null,8,["modelValue","options"])]),e.filtro.tipo_reporte===e.tiposReportesMaterialUtilizado.POR_TAREA?(l(),d("div",so,[o[6]||(o[6]=s("label",{class:"q-mb-sm block"},"Tareas",-1)),a(y,{modelValue:e.filtro.tarea_id,"onUpdate:modelValue":o[1]||(o[1]=t=>e.filtro.tarea_id=t),options:e.tareas,onFilter:e.filtrarTareas,"transition-show":"jump-up","transition-hide":"jump-down","options-dense":"",dense:"",outlined:"",error:!!e.v$.tarea_id.$errors.length,onBlur:e.v$.tarea_id.$touch,"error-message":"Debes seleccionar una Tarea","use-input":"","input-debounce":"0","option-value":t=>t.id,"option-label":t=>t.codigo_tarea+" - "+t.titulo,"emit-value":"","map-options":""},{error:r(()=>[(l(!0),d(w,null,R(e.v$.tarea_id.$errors,t=>(l(),d("div",{key:t.$uid},[s("div",io,p(t.$message),1)]))),128))]),option:r(t=>[a(c,V(t.itemProps,{class:"q-my-sm"}),{default:r(()=>[a(f,null,{default:r(()=>[a(m,{class:"text-bold text-primary"},{default:r(()=>[n(p(t.opt.codigo_tarea),1)]),_:2},1024),a(m,{caption:""},{default:r(()=>[n(p(t.opt.titulo),1)]),_:2},1024)]),_:2},1024)]),_:2},1040)]),"no-option":r(()=>[a(c,null,{default:r(()=>[a(f,{class:"text-grey"},{default:r(()=>o[5]||(o[5]=[n(" No hay resultados ")])),_:1})]),_:1})]),_:1},8,["modelValue","options","onFilter","error","onBlur","option-value","option-label"])])):C("",!0),e.filtro.tipo_reporte===e.tiposReportesMaterialUtilizado.POR_PROYECTO?(l(),d("div",lo,[o[8]||(o[8]=s("label",{class:"q-mb-sm block"},"Proyectos",-1)),a(y,{modelValue:e.filtro.proyecto_id,"onUpdate:modelValue":o[2]||(o[2]=t=>e.filtro.proyecto_id=t),options:e.proyectos,onFilter:e.filtrarProyectos,"transition-show":"jump-up","transition-hide":"jump-down","options-dense":"",dense:"",outlined:"",error:!!e.v$.proyecto_id.$errors.length,onBlur:e.v$.proyecto_id.$touch,"error-message":"Debes seleccionar un proyecto","use-input":"","input-debounce":"0","option-value":t=>t.id,"option-label":t=>t.nombre,"emit-value":"","map-options":""},{error:r(()=>[(l(!0),d(w,null,R(e.v$.proyecto_id.$errors,t=>(l(),d("div",{key:t.$uid},[s("div",no,p(t.$message),1)]))),128))]),option:r(t=>[a(c,V(t.itemProps,{class:"q-my-sm"}),{default:r(()=>[a(f,null,{default:r(()=>[a(m,{class:"text-bold text-primary"},{default:r(()=>[n(p(t.opt.codigo_proyecto),1)]),_:2},1024),a(m,{caption:""},{default:r(()=>[n(p(t.opt.nombre),1)]),_:2},1024)]),_:2},1024)]),_:2},1040)]),"no-option":r(()=>[a(c,null,{default:r(()=>[a(f,{class:"text-grey"},{default:r(()=>o[7]||(o[7]=[n(" No hay resultados ")])),_:1})]),_:1})]),_:1},8,["modelValue","options","onFilter","error","onBlur","option-value","option-label"])])):C("",!0),s("div",po,[o[10]||(o[10]=s("label",{class:"block q-mb-sm"},"\xA0",-1)),a(I,{color:"primary",class:"full-width",icon:"bi-search","no-caps":"",unelevated:"",onClick:o[3]||(o[3]=t=>e.consultarDescargar())},{default:r(()=>o[9]||(o[9]=[n("Consultar y descargar")])),_:1})])])]),_:1})}var Bo=O(to,[["render",uo]]);export{Bo as default};
