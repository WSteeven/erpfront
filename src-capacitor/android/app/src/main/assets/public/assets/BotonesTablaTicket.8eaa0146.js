var oa=Object.defineProperty;var sa=(e,a,i)=>a in e?oa(e,a,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[a]=i;var n=(e,a,i)=>(sa(e,typeof a!="symbol"?a+"":a,i),i);import{C as de}from"./ComponenteModal.domain.22ea4557.js";import{Q as Pe,a as je}from"./QItemSection.c6f2640c.js";import{Q as we}from"./QSelect.a8f2bfb2.js";import{c as le,e as C,U as me,y as m,S as j,Y as ke,q as la,m as na,f as pe,z as _,B as t,M as q,L as P,D as s,F as $,u as he,E as De,A as _e,t as G,v as Te,H as g,bg as Ce,G as L,I as K,J as X,N as ra,R as ae,bf as be,ad as He,g as D,l as I,bP as ca,bz as qe,w as Ge,bQ as da,bR as ua,x as se,Q as oe,a6 as ze,a7 as ma,K as Ie,a5 as pa,i as Ze,bL as ba,aj as fa,h as va,bG as ga,p as ka,a8 as ha,bi as ue}from"./index.976e8f3c.js";import{r as Fe}from"./i18n-validators.06eef631.js";import{u as Me}from"./index.ed676411.js";import{E as fe,a as Je,e as f,S as _a,b as Ta}from"./EssentialTable.d8e6954a.js";import{D as Ke}from"./DepartamentoController.6b5e308b.js";import{u as Xe}from"./FiltrosListadosTicket.4901916f.js";import{S as Ne,u as Ca,i as xe,n as Ee}from"./utils.30e08aa2.js";import{u as qa}from"./filtrosListadosGenerales.31e9eb2c.js";import{Q as ya}from"./QBadge.1ddeabfd.js";import{Q as Aa}from"./QImg.e0fb285c.js";import{Q as $a}from"./QScrollArea.f0584ddf.js";import{Q as Sa}from"./QPage.ed5d79ca.js";import{r as wa,e as xa}from"./es.5c829d48.js";import{d as Oe}from"./dayjs.min.7780de8a.js";import{A as Re}from"./ArchivoSeguimiento.c473f5d7.js";import{E as ye}from"./entidadAuditable.75a46700.js";import{_ as Ea}from"./TablaFilasDinamicas.262857b3.js";import{B as Oa}from"./buttonSubmits.2eb37d38.js";import{V as Da}from"./VisorImagen.e7965569.js";import{C as ne}from"./ContenedorSimpleMixin.5a0b06ab.js";import{A as Ve}from"./Archivo.c26f5472.js";import{u as za,a as Fa,b as Ia,k as Ma}from"./use-slider.d34561e4.js";import{b as Ue}from"./format.8ac60962.js";import{Q as Na}from"./QChip.334d746c.js";import{M as Ra}from"./ModalEntidad.84100166.js";import{T as Va}from"./TicketController.af9c2ba9.js";import{C as Ba}from"./CategoriaTipoTicketController.76f1a755.js";import{T as La}from"./TipoTicketController.d5ce7c3f.js";import{M as Pa}from"./MotivoCanceladoTicketController.b353f34a.js";const ja=[{name:"fecha_hora_pausa",field:"fecha_hora_pausa",label:"Fecha hora pausa",align:"left"},{name:"fecha_hora_retorno",field:"fecha_hora_retorno",label:"Fecha hora retorno",align:"left"},{name:"tiempo_pausado",field:"tiempo_pausado",label:"Tiempo pausado",align:"left"},{name:"motivo",field:"motivo",label:"Motivo",align:"left"}],Ua=[{name:"observacion",field:"observacion",label:"Observaci\xF3n",align:"left",hint:"Obligatorio",requerido:!0}];class Qa extends ye{constructor(){super();n(this,"observacion");this.observacion=null}}const Ha=le({__name:"TablaObservacion",props:{listado:{type:Object,required:!0}},emits:["actualizar"],setup(e,{emit:a}){const i=e,r=a,u=C(),p=C(i.listado),{confirmar:l}=me(),d=[...Ua,la],v={titulo:"Agregar observaci\xF3n",icono:"bi-arrow-bar-down",color:"positive",accion:()=>{u.value.abrirModalEditar(),r("actualizar",p.value)}},c=({posicion:b})=>{l("\xBFEst\xE1 seguro de que desea eliminar?",()=>{p.value.splice(b,1)})};return(b,h)=>(m(),j(fe,{ref_key:"refObservaciones",ref:u,titulo:"Observaciones / Mejoras / Pendientes",configuracionColumnas:d,datos:p.value,"alto-fijo":!1,permitirConsultar:!1,"permitir-buscar":!0,permitirEditarModal:!0,mostrarFooter:!p.value.length,separador:"cell",accion1Header:v,onEliminar:c,modalMaximized:b.$q.screen.xs,entidad:ke(Qa)},null,8,["datos","mostrarFooter","modalMaximized","entidad"]))}});class Ye extends ye{constructor(){super();n(this,"codigo");n(this,"asunto");n(this,"descripcion");n(this,"prioridad");n(this,"fecha_hora_limite");n(this,"estado");n(this,"observaciones_solicitante");n(this,"calificacion_solicitante");n(this,"solicitante");n(this,"solicitante_id");n(this,"responsable");n(this,"responsable_id");n(this,"departamento_responsable");n(this,"departamento_solicitante");n(this,"tipo_ticket");n(this,"categoria_tipo_ticket");n(this,"establecer_hora_limite");n(this,"fecha_hora_solicitud");n(this,"calificaciones");n(this,"pendiente_calificar");n(this,"ticket_interno");n(this,"ticket_para_mi");n(this,"calificado_solicitante");n(this,"calificado_responsable");n(this,"tiempo_hasta_finalizar");n(this,"tiempo_ocupado_pausas");n(this,"destinatarios");n(this,"es_solicitud_ats");n(this,"subtarea_id");n(this,"fotografia");n(this,"para_sso");n(this,"cc");n(this,"is_recurring",!1);n(this,"recurrence_active",!0);n(this,"recurrence_frequency","");n(this,"recurrence_time","08:00:00");n(this,"recurrence_day_of_week","");n(this,"recurrence_day_of_month","");this.codigo=null,this.asunto=null,this.descripcion="",this.prioridad=null,this.fecha_hora_limite=null,this.estado=null,this.observaciones_solicitante=null,this.calificacion_solicitante=null,this.solicitante=null,this.solicitante_id=null,this.responsable=[],this.responsable_id=null,this.departamento_responsable=[],this.departamento_solicitante=null,this.tipo_ticket=null,this.categoria_tipo_ticket=null,this.establecer_hora_limite=!1,this.fecha_hora_solicitud=null,this.calificaciones=[],this.pendiente_calificar=!1,this.ticket_interno=!1,this.ticket_para_mi=!1,this.calificado_solicitante=!1,this.calificado_responsable=!1,this.tiempo_hasta_finalizar=null,this.tiempo_ocupado_pausas=null,this.destinatarios=[],this.es_solicitud_ats=!1,this.subtarea_id=null,this.fotografia=null,this.para_sso=!1,this.cc=[]}}const re=na("ticket",()=>{const e=pe(new Ye),a=C();return{filaTicket:e,posicionFilaTicket:a}}),Ga={class:"row q-col-gutter-sm"},Za={class:"col-12 col-md-3 q-mb-md"},Ja={class:"col-12 col-md-3 q-mb-md"},Ka={class:"col-12 col-md-3 q-mb-md"},Xa={key:0,class:"col-12 col-md-3 q-mb-md"},Ya={class:"col-12 col-md-3 q-mb-md"},Wa={key:1,class:"col-12 col-md-3 q-mb-md"},et={key:2,class:"col-12 col-md-3 q-mb-md"},at={class:"col-12 col-md-3 q-mb-md"},tt={class:"col-12 col-md-3 q-mb-md"},it={key:3,class:"col-12 col-md-3 q-mb-md"},ot={key:4,class:"col-12 col-md-3 q-mb-md"},st={key:5,class:"col-12 col-md-3 q-mb-md"},lt={key:6,class:"col-12 col-md-3 q-mb-md"},nt={class:"col-12 q-mb-md"},rt=["innerHTML"],ve=le({__name:"DetalleTicket",props:{ticket:{type:Object,required:!0}},setup(e){return(a,i)=>(m(),_("div",Ga,[t("div",Za,[i[0]||(i[0]=t("label",{class:"q-mb-sm text-bold block"},"C\xF3digo del ticket",-1)),t("span",null,q(e.ticket.codigo),1)]),t("div",Ja,[i[1]||(i[1]=t("label",{class:"q-mb-sm text-bold block"},"Asunto",-1)),t("span",null,q(e.ticket.asunto),1)]),t("div",Ka,[i[2]||(i[2]=t("label",{class:"q-mb-sm text-bold block"},"Prioridad",-1)),t("span",null,q(e.ticket.prioridad),1)]),e.ticket.fecha_hora_limite?(m(),_("div",Xa,[i[3]||(i[3]=t("label",{class:"q-mb-sm text-bold block"},"Fecha y hora l\xEDmite",-1)),t("span",null,q(e.ticket.fecha_hora_limite),1)])):P("",!0),t("div",Ya,[i[4]||(i[4]=t("label",{class:"q-mb-sm text-bold block"},"Estado actual",-1)),s(Je,{propsTable:{value:e.ticket.estado}},null,8,["propsTable"])]),e.ticket.tiempo_hasta_finalizar?(m(),_("div",Wa,[i[5]||(i[5]=t("label",{class:"q-mb-sm text-bold block"},"Tiempo total hasta finalizar",-1)),s($,{name:"bi-star-fill",color:"orange-3",class:"q-mr-sm"}),t("span",null,q(e.ticket.tiempo_hasta_finalizar),1)])):P("",!0),e.ticket.tiempo_ocupado_pausas?(m(),_("div",et,[i[6]||(i[6]=t("label",{class:"q-mb-sm text-bold block"},"Tiempo total pausado",-1)),s($,{name:"bi-pause-circle",color:"pink-8",class:"q-mr-sm"}),t("span",null,q(e.ticket.tiempo_ocupado_pausas),1)])):P("",!0),t("div",at,[i[7]||(i[7]=t("label",{class:"q-mb-sm text-bold block"},"Categoria tipo de ticket",-1)),t("span",null,q(e.ticket.categoria_tipo_ticket),1)]),t("div",tt,[i[8]||(i[8]=t("label",{class:"q-mb-sm text-bold block"},"Tipo de ticket",-1)),t("span",null,q(e.ticket.tipo_ticket),1)]),e.ticket.solicitante?(m(),_("div",it,[i[9]||(i[9]=t("label",{class:"q-mb-sm text-bold block"},"Solicitante",-1)),t("span",null,q(e.ticket.solicitante),1)])):P("",!0),e.ticket.departamento_responsable?(m(),_("div",ot,[i[10]||(i[10]=t("label",{class:"q-mb-sm text-bold block"},"Actual departamento responsable",-1)),t("span",null,q(e.ticket.departamento_responsable),1)])):P("",!0),e.ticket.responsable?(m(),_("div",st,[i[11]||(i[11]=t("label",{class:"q-mb-sm text-bold block"},"Actual empleado responsable",-1)),t("span",null,q(e.ticket.responsable),1)])):P("",!0),e.ticket.fecha_hora_solicitud?(m(),_("div",lt,[i[12]||(i[12]=t("label",{class:"q-mb-sm text-bold block"},"Fecha hora solicitud",-1)),t("span",null,q(e.ticket.fecha_hora_solicitud),1)])):P("",!0),t("div",nt,[i[13]||(i[13]=t("label",{class:"q-mb-sm text-bold block"},"Descripci\xF3n",-1)),t("div",{innerHTML:e.ticket.descripcion,class:"border-grey bg-grey-1 rounded q-pa-sm"},null,8,rt)])]))}});var ct=le({components:{EssentialTable:fe,DetalleTicket:ve},props:{mixinModal:{type:Object,required:!0},accion:{type:Function,required:!0}},emits:["cerrar-modal","guardado"],setup(e,{emit:a}){const i=re(),r=he(),{entidad:u,listadosAuxiliares:p,listado:l}=e.mixinModal.useReferencias(),{cargarVista:d,obtenerListados:v,consultar:c}=e.mixinModal.useComportamiento();d(async()=>{await v({empleados:[],departamentos:new Ke,empleadosOrigen:{controller:new De,params:{campos:"id,nombres,apellidos",estado:1}}})});const{confirmar:b,notificarCorrecto:h,notificarAdvertencia:T}=me(),k=pe({responsable:null,departamento_responsable:null}),M=Me({responsable:{required:Fe},departamento_responsable:{required:Fe}},k),{empleadosOrigen:U,filtrarEmpleadosOrigen:N}=qa(p),{empleados:Q,filtrarEmpleados:w,departamentos:R,filtrarDepartamentos:A}=Xe(p);async function te(V){await v({empleados:{controller:new De,params:{campos:"id,nombres,apellidos",departamento_id:V,estado:1}}}),Q.value=p.empleados}const Z=new Ne;async function Y(){if(await M.value.$validate())try{b("\xBFEst\xE1 seguro de continuar?",async()=>{Z.activar();const V=_e.getInstance(),W=V.getEndpoint(G.cambiar_responsable_ticket)+"/"+u.id,x=await V.post(W,{departamento_responsable:k.departamento_responsable,responsable:k.responsable,cc:u.cc});r.user.id===i.filaTicket.solicitante_id?e.accion(f.ASIGNADO):l.value.splice(i.posicionFilaTicket,1),h(x.data.mensaje),Z.desactivar(),a("cerrar-modal",!1)})}catch(V){T(V)}finally{Z.desactivar()}}function H(){a("cerrar-modal",!1)}return i.filaTicket.id&&c({id:i.filaTicket.id}),{v$:M,reagendar:k,ticket:u,cambiar:Y,cancelar:H,empleados:Q,filtrarEmpleados:w,departamentos:R,filtrarDepartamentos:A,obtenerResponsables:te,modificarCc:C(!1),empleadosOrigen:U,filtrarEmpleadosOrigen:N}}});const dt={class:"row q-col-gutter-xs"},ut={class:"col-12 col-md-3"},mt={class:"error-msg"},pt={class:"col-12 col-md-3"},bt={class:"error-msg"},ft={class:"col-12 col-md-3"},vt={key:0,class:"col-12"},gt={class:"q-mb-sm block"},kt={class:"row q-gutter-sm justify-end"};function ht(e,a,i,r,u,p){return m(),_(K,null,[a[15]||(a[15]=t("div",{class:"text-center text-bold q-mb-md"}," Selecciona al nuevo responsable ",-1)),s(be,{class:"rounded-card"},{default:g(()=>[s(Ce,null,{default:g(()=>[t("div",dt,[t("div",ut,[a[8]||(a[8]=t("label",{class:"q-mb-sm block"},"Nuevo departamento responsable",-1)),s(we,{modelValue:e.reagendar.departamento_responsable,"onUpdate:modelValue":[a[0]||(a[0]=l=>e.reagendar.departamento_responsable=l),a[1]||(a[1]=()=>{e.reagendar.responsable=null,e.obtenerResponsables(e.reagendar.departamento_responsable)})],options:e.departamentos,onFilter:e.filtrarDepartamentos,"transition-show":"scale","transition-hide":"scale",hint:"Obligatorio","options-dense":"",dense:"",outlined:"","option-label":l=>l.nombre,"option-value":l=>l.id,"use-input":"","input-debounce":"0","emit-value":"","map-options":"",error:!!e.v$.departamento_responsable.$errors.length,onBlur:e.v$.departamento_responsable.$touch},{"no-option":g(()=>[s(Pe,null,{default:g(()=>[s(je,{class:"text-grey"},{default:g(()=>a[7]||(a[7]=[L(" No hay resultados ")])),_:1})]),_:1})]),error:g(()=>[(m(!0),_(K,null,X(e.v$.departamento_responsable.$errors,l=>(m(),_("div",{key:l.$uid},[t("div",mt,q(l.$message),1)]))),128))]),_:1},8,["modelValue","options","onFilter","option-label","option-value","error","onBlur"])]),t("div",pt,[a[10]||(a[10]=t("label",{class:"q-mb-sm block"},"Nuevo empleado responsable",-1)),s(we,{modelValue:e.reagendar.responsable,"onUpdate:modelValue":a[2]||(a[2]=l=>e.reagendar.responsable=l),options:e.empleados,onFilter:e.filtrarEmpleados,"transition-show":"scale","transition-hide":"scale",hint:"Obligatorio","options-dense":"",dense:"",outlined:"","option-label":l=>`${l.nombres} ${l.apellidos}`,"option-value":l=>l.id,"use-input":"","input-debounce":"0","emit-value":"","map-options":"",error:!!e.v$.responsable.$errors.length,onBlur:e.v$.responsable.$touch},{"no-option":g(()=>[s(Pe,null,{default:g(()=>[s(je,{class:"text-grey"},{default:g(()=>a[9]||(a[9]=[L(" Primero seleccione un departamento ")])),_:1})]),_:1})]),error:g(()=>[(m(!0),_(K,null,X(e.v$.responsable.$errors,l=>(m(),_("div",{key:l.$uid},[t("div",bt,q(l.$message),1)]))),128))]),_:1},8,["modelValue","options","onFilter","option-label","option-value","error","onBlur"])]),t("div",ft,[a[11]||(a[11]=t("br",null,null,-1)),s(ra,{modelValue:e.modificarCc,"onUpdate:modelValue":a[3]||(a[3]=l=>e.modificarCc=l),label:"Modificar Cc",outlined:"",dense:""},null,8,["modelValue"])]),e.modificarCc?(m(),_("div",vt,[t("label",gt,[s($,{name:"bi-people",class:"q-mr-sm"}),a[12]||(a[12]=L("Cc - Las personas especificadas aqui podr\xE1n agregar y leer comentarios en el seguimiento del ticket"))]),s(we,{modelValue:e.ticket.cc,"onUpdate:modelValue":a[4]||(a[4]=l=>e.ticket.cc=l),options:e.empleadosOrigen,onFilter:e.filtrarEmpleadosOrigen,"transition-show":"scale","transition-hide":"scale",hint:"Opcional","options-dense":"",dense:"",outlined:"",disable:e.disabled,"option-label":l=>`${l.nombres} ${l.apellidos}`,"option-value":l=>l.id,"use-input":"","input-debounce":"0","emit-value":"","map-options":"","use-chips":"",multiple:""},null,8,["modelValue","options","onFilter","disable","option-label","option-value"])])):P("",!0)]),t("div",kt,[s(ae,{color:"primary","no-caps":"",push:"",onClick:a[5]||(a[5]=l=>e.cambiar())},{default:g(()=>[s($,{name:"bi-arrow-left-right",size:"xs",class:"q-pr-sm"}),a[13]||(a[13]=t("span",null,"Cambiar responsable",-1))]),_:1}),s(ae,{color:"negative","no-caps":"",push:"",onClick:a[6]||(a[6]=l=>e.cancelar())},{default:g(()=>[s($,{name:"bi-x",size:"xs",class:"q-pr-sm"}),a[14]||(a[14]=t("span",null,"Cancelar",-1))]),_:1})])]),_:1})]),_:1})],64)}var _t=Te(ct,[["render",ht]]),Tt=He({name:"QChatMessage",props:{sent:Boolean,label:String,bgColor:String,textColor:String,name:String,avatar:String,text:Array,stamp:String,size:String,labelHtml:Boolean,nameHtml:Boolean,textHtml:Boolean,stampHtml:Boolean},setup(e,{slots:a}){const i=D(()=>e.sent===!0?"sent":"received"),r=D(()=>`q-message-text-content q-message-text-content--${i.value}`+(e.textColor!==void 0?` text-${e.textColor}`:"")),u=D(()=>`q-message-text q-message-text--${i.value}`+(e.bgColor!==void 0?` text-${e.bgColor}`:"")),p=D(()=>"q-message-container row items-end no-wrap"+(e.sent===!0?" reverse":"")),l=D(()=>e.size!==void 0?`col-${e.size}`:""),d=D(()=>({msg:e.textHtml===!0?"innerHTML":"textContent",stamp:e.stampHtml===!0?"innerHTML":"textContent",name:e.nameHtml===!0?"innerHTML":"textContent",label:e.labelHtml===!0?"innerHTML":"textContent"}));function v(b){return a.stamp!==void 0?[b,I("div",{class:"q-message-stamp"},a.stamp())]:e.stamp?[b,I("div",{class:"q-message-stamp",[d.value.stamp]:e.stamp})]:[b]}function c(b,h){const T=h===!0?b.length>1?k=>k:k=>I("div",[k]):k=>I("div",{[d.value.msg]:k});return b.map((k,S)=>I("div",{key:S,class:u.value},[I("div",{class:r.value},v(T(k)))]))}return()=>{const b=[];a.avatar!==void 0?b.push(a.avatar()):e.avatar!==void 0&&b.push(I("img",{class:`q-message-avatar q-message-avatar--${i.value}`,src:e.avatar,"aria-hidden":"true"}));const h=[];a.name!==void 0?h.push(I("div",{class:`q-message-name q-message-name--${i.value}`},a.name())):e.name!==void 0&&h.push(I("div",{class:`q-message-name q-message-name--${i.value}`,[d.value.name]:e.name})),a.default!==void 0?h.push(c(ca(a.default()),!0)):e.text!==void 0&&h.push(c(e.text)),b.push(I("div",{class:l.value},h));const T=[];return a.label!==void 0?T.push(I("div",{class:"q-message-label"},a.label())):e.label!==void 0&&T.push(I("div",{class:"q-message-label",[d.value.label]:e.label})),T.push(I("div",{class:p.value},b)),I("div",{class:`q-message q-message-${i.value}`},T)}}});const Ct=[{name:"fecha_hora",field:"fecha_hora",label:"Fecha hora",align:"center",type:"text",sortable:!0,editable:!0,disableModal:!0},{name:"actividad_realizada",field:"actividad_realizada",label:"Actividad realizada",align:"left",type:"text",hint:"Obligatorio",requerido:!0},{name:"responsable",field:"responsable",label:"Responsable",align:"center",editable:!1},{name:"observacion",field:"observacion",label:"Observaci\xF3n",align:"left",type:"text",hint:"Opcional"},{name:"fotografia",field:"fotografia",label:"Fotografia",align:"left",type:"imagen",visible:!1,hint:"Opcional"}];class qt extends qe{constructor(){super(G.archivos_seguimientos_tickets)}}class Qe extends ye{constructor(){super();n(this,"fecha_hora");n(this,"actividad_realizada");n(this,"observacion");n(this,"fotografia");n(this,"ticket");n(this,"responsable");this.fecha_hora=null,this.actividad_realizada=null,this.observacion=null,this.fotografia=null,this.ticket=null,this.responsable=null}}class yt extends qe{constructor(){super(G.actividades_realizadas_seguimientos_tickets)}}class At extends ye{constructor(){super();n(this,"comentario");n(this,"empleado");n(this,"ticket");this.comentario=null,this.empleado=null,this.ticket=null}}class $t extends qe{constructor(){super(G.comentarios_tickets)}}var St=le({components:{EssentialTable:fe,SelectorImagen:_a,ButtonSubmits:Oa,TablaFilasDinamicas:Ea,TablaObservaciones:Ha,ArchivoSeguimiento:Re,VisorImagen:Da,DetalleTicket:ve},emits:["cerrar-modal"],setup(e,{emit:a}){const i=re(),r=he(),u=new ne(Qe,new yt),{entidad:p,accion:l,listadosAuxiliares:d,listado:v}=u.useReferencias(),{guardar:c,editar:b,reestablecer:h,setValidador:T,listar:k}=u.useComportamiento(),S=new ne(Ve,new qt),{listar:M}=S.useComportamiento(),U=new ne(At,new $t),{entidad:N,listado:Q}=U.useReferencias(),{guardar:w,listar:R}=U.useComportamiento(),{onReestablecer:A}=U.useHooks(),te=C(),Z=C();C();const Y=C(),H=i.filaTicket,V=C(),W=r.user.id==i.filaTicket.responsable_id&&H.estado===f.EJECUTANDO,x=C(0),J=C(),o=C();k({ticket_id:i.filaTicket.id}),M({ticket_id:i.filaTicket.id}),Oe.extend(wa),Oe.locale(xa);const y={titulo:"Ver fotograf\xEDa",icono:"bi-image-fill",color:"primary",visible:({entidad:F})=>F.fotografia,accion:async({entidad:F})=>{Y.value.abrir(F.fotografia)}},E=Me({},p);T(E.value);function z(F){p.hydrate(F),p.ticket=i.filaTicket.id,p.responsable=r.user.id,c(p)}function ee(){V.value.subir({ticket_id:i.filaTicket.id})}function O(){Z.value.abrir()}function ie(){J.value.setScrollPercentage("horizontal",x.value,300),x.value=x.value<1?x.value+.1:x.value}function aa(){J.value.setScrollPercentage("horizontal",x.value,300),x.value=x.value>0?x.value-.1:x.value}const Be=C();async function ta(){const F=_e.getInstance(),ge=await F.get(F.getEndpoint(G.linea_tiempo_tickets)+"/"+H.id);Be.value=ge.data.results}ta();const Ae=C([]),ce=C(!1),$e=C(),Le=C("Se muestran todas las actividades registradas hasta el momento");function ia(F,ge){ce.value=ge===$e.value?!ce.value:!0,$e.value=ge,Le.value=ce.value?`Se muestran las actividades de ${F.responsable} a partir de la fecha ${F.created_at}`:"Se muestran todas las actividades registradas hasta el momento",Ae.value=ce.value?v.value.filter(Se=>Se.responsable===F.responsable&&(Se.fecha_hora?Se.fecha_hora>=F.created_at:!1)):v.value}return Ge(v,()=>{v.value.length&&(Ae.value=v.value)}),A(()=>{N.empleado=r.user.id,N.ticket=H.id}),N.empleado=r.user.id,N.ticket=H.id,R({ticket_id:H.id}),{comentarios:Q,v$:E,refEditarModal:Z,refTrabajos:te,refVisorImagen:Y,refArchivoSeguimiento:V,mixinArchivoSeguimiento:S,accion:l,regiones:da,atenciones:ua,editar:b,reestablecer:h,emit:a,listadosAuxiliares:d,ticket:H,endpoint:G.archivos_seguimientos_tickets,columnasActividades:Ct,abrirModalArbol:O,actividadesRealizadas:v,ActividadRealizadaSeguimientoTicket:Qe,verFotografia:y,guardarFilaActividad:z,subirArchivos:ee,mostrarBotonSubir:D(()=>{var F;return(F=V.value)==null?void 0:F.quiero_subir_archivos}),permitirSubir:W,siguiente:ie,anterior:aa,position:x,scrollAreaRef:J,lineaTiempo:Be,filtrarActividades:ia,actividadesFiltradas:Ae,filtrado:ce,indice:$e,mensajeFiltro:Le,comentario:o,guardarComentario:w,comentarioTicket:N,dayjs:Oe}}});const wt={class:"bg-desenfoque rounded border-white q-pa-md"},xt={class:"row q-mb-md"},Et={class:"col-12 text-bold q-mb-md"},Ot={class:"col-12 col-md-3"},Dt={class:"q-mb-md"},zt={class:"col-12 col-md-9"},Ft={class:"q-mb-md"},It={class:"col-12"},Mt=["innerHTML"],Nt={id:"responsables",class:"row items-center q-mb-md"},Rt={class:"col-12 q-mb-md"},Vt={class:"row items-center q-pt-md"},Bt={class:"text-bold"},Lt={class:"col-12 bg-solid q-pa-sm rounded q-mb-md"},Pt={key:0,class:"row q-gutter-md items-center no-wrap q-pa-sm"},jt={class:"circulo"},Ut={class:"col-12"},Qt={class:"col-12 text-bold q-mb-md"},Ht={class:"col-12 q-mb-md bg-solid rounded q-pa-sm"},Gt={class:"text-wrap q-pa-sm"},Zt={class:"col-12 q-mb-md"},Jt={class:"col-12 text-bold q-mb-md"},Kt={class:"col-12"},Xt={class:"col-12 q-mb-md"},Yt={class:"col-12 text-bold q-mb-md"},Wt={class:"q-pa-md row col-12 justify-center bg-solid rounded"},ei={class:"full-width q-col-gutter-sm row q-mb-md"},ai={class:"full-width"},ti={class:"col-12 q-mb-md"},ii={key:0,style:{width:"100%"}},oi={key:1},si={class:"col-12 q-my-md"},li={class:"col-12"};function ni(e,a,i,r,u,p){const l=se("tabla-filas-dinamicas"),d=se("archivo-seguimiento"),v=se("visor-imagen");return m(),j(Sa,null,{default:g(()=>[t("div",wt,[t("div",xt,[t("div",Et,[s($,{name:"bi-ticket-detailed",class:"q-mr-sm"}),a[5]||(a[5]=L(" Detalles del ticket "))]),t("div",Ot,[a[6]||(a[6]=t("label",{class:"q-mb-sm text-bold block"},"C\xF3digo",-1)),t("div",Dt,q(e.ticket.codigo),1)]),t("div",zt,[a[7]||(a[7]=t("label",{class:"q-mb-sm text-bold block"},"Asunto",-1)),t("div",Ft,q(e.ticket.asunto),1)]),t("div",It,[a[8]||(a[8]=t("label",{class:"q-mb-sm text-bold block"},"Descripci\xF3n",-1)),t("div",{innerHTML:e.ticket.descripcion,class:"border-white bg-solid q-pa-sm"},null,8,Mt)])]),s(oe),t("div",Nt,[t("div",Rt,[t("div",Vt,[t("div",{class:ze(["col-12 col-sm-6 col-md-6",{"text-center q-mb-md":e.$q.screen.xs}])},[t("div",Bt,[s($,{name:"bi-clock-history",class:"q-mr-sm"}),a[9]||(a[9]=L(" Linea de tiempo del ticket "))]),a[10]||(a[10]=t("small",null,"Seleccione un responsable para filtrar las actividades registradas de la linea de tiempo del ticket",-1))],2)])]),t("div",Lt,[s($a,{ref:"scrollAreaRef",style:{height:"250px","max-width":"100%"}},{default:g(()=>[e.lineaTiempo?(m(),_("div",Pt,[(m(!0),_(K,null,X(e.lineaTiempo,(c,b)=>(m(),_("div",{key:b,class:"row items-center no-wrap"},[s(be,{class:"rounded cursor-pointer q-card-hover q-card-press bg-solid border-grey",style:{width:"180px"},onClick:h=>e.filtrarActividades(c,b)},{default:g(()=>[e.filtrado&&e.indice===b?(m(),j(ya,{key:0,color:"transparent",floating:"",class:"q-mt-xs"},{default:g(()=>[s($,{name:"bi-check-circle-fill",color:"white",size:"sm"})]),_:1})):P("",!0),s(Ce,{class:"column q-gutter-sm items-center text-center"},{default:g(()=>[t("div",jt,[s(Aa,{src:c.foto,height:"50px",fit:"contain"},null,8,["src"])]),t("small",null,q(c.departamento),1),t("b",null,q(c.responsable),1),t("small",null,q(c.estado),1),t("small",null,q(c.created_at),1)]),_:2},1024)]),_:2},1032,["onClick"]),s($,{name:"bi-caret-right-fill",size:"md",color:"grey-6",class:"q-ml-md"})]))),128))])):P("",!0)]),_:1},512),t("div",{class:ze(["row justify-center",{"justify-center":e.$q.screen.xs,"justify-end":!e.$q.screen.xs}])},[s(ae,{icon:"bi-chevron-left",class:"bg-desenfoque text-primary q-pr-md q-mr-sm",onClick:e.anterior,unelevated:"",rounded:"","no-caps":"",dense:"",label:"Regresar"},null,8,["onClick"]),s(ae,{"icon-right":"bi-chevron-right",class:"bg-desenfoque text-primary q-pl-md",onClick:ma(e.siguiente,["stop"]),unelevated:"",rounded:"","no-caps":"",dense:"",label:"Avanzar"},null,8,["onClick"])],2)]),t("div",Ut,[s(oe,{class:"q-mb-md"})]),t("div",Qt,[s($,{name:"bi-list",class:"q-mr-sm"}),a[11]||(a[11]=L(" Actividades registradas "))]),t("div",Ht,[t("div",Gt,[s($,{name:"bi-clock-history",class:"q-mr-sm"}),L(" "+q(e.mensajeFiltro),1)]),s(l,{listado:e.actividadesFiltradas,"configuracion-columnas":e.columnasActividades,entidad:e.ActividadRealizadaSeguimientoTicket,accion1:e.verFotografia,mostrarAccion1Header:e.permitirSubir,titulo:"Cronolog\xEDa de actividades realizadas",onGuardarFila:a[0]||(a[0]=c=>e.guardarFilaActividad(c)),"ajustar-celdas":!0},null,8,["listado","configuracion-columnas","entidad","accion1","mostrarAccion1Header"])]),t("div",Zt,[s(oe)]),t("div",Jt,[s($,{name:"bi-archive",class:"q-mr-sm"}),a[12]||(a[12]=L(" Archivos "))]),t("div",Kt,[s(d,{ref:"refArchivoSeguimiento",mixin:e.mixinArchivoSeguimiento,endpoint:e.endpoint,"permitir-subir":e.permitirSubir,"permitir-eliminar":e.permitirSubir},{"boton-subir":g(()=>[e.mostrarBotonSubir?(m(),j(ae,{key:0,color:"positive",push:"","no-caps":"",class:"full-width q-mb-lg",onClick:a[1]||(a[1]=c=>e.subirArchivos())},{default:g(()=>[s($,{name:"bi-upload",class:"q-mr-sm",size:"xs"}),a[13]||(a[13]=L(" Subir archivos seleccionados"))]),_:1})):P("",!0)]),_:1},8,["mixin","endpoint","permitir-subir","permitir-eliminar"])]),t("div",Xt,[s(oe)]),t("div",Yt,[s($,{name:"bi-chat-square-text",class:"q-mr-sm"}),a[14]||(a[14]=L(" Comentarios "))]),t("div",Wt,[t("div",ei,[(m(!0),_(K,null,X(e.ticket.cc,c=>(m(),_("span",{key:c},[s($,{name:"bi-circle-fill",color:"positive",class:"q-mr-sm"}),L(q(c),1)]))),128)),t("div",ai,[s($,{name:"people",class:"q-mr-sm"}),a[15]||(a[15]=L(" Miembros que pueden comentar "))])]),t("div",ti,[s(oe)]),e.comentarios.length?(m(),_("div",ii,[(m(!0),_(K,null,X(e.comentarios,c=>(m(),j(Tt,{key:c.id,name:c.empleado,avatar:c.avatar,text:c.comentario,stamp:e.dayjs(c.stamp).fromNow(),sent:c.sent,"bg-color":c.sent?"primary":"grey-4","text-color":c.sent?"white":"black"},null,8,["name","avatar","text","stamp","sent","bg-color","text-color"]))),128))])):(m(),_("div",oi,"A\xFAn no hay comentarios.")),t("div",si,[s(oe)]),t("div",li,[s(Ie,{modelValue:e.comentarioTicket.comentario,"onUpdate:modelValue":a[3]||(a[3]=c=>e.comentarioTicket.comentario=c),placeholder:"Mensaje...",outlined:"",rounded:"",dense:"",autogrow:"",type:"textarea",class:"col-11",onKeyup:a[4]||(a[4]=pa(c=>e.guardarComentario(e.comentarioTicket,!1),["enter"]))},{append:g(()=>[s(ae,{color:"primary",round:"",flat:"",onClick:a[2]||(a[2]=c=>e.guardarComentario(e.comentarioTicket,!1))},{default:g(()=>[s($,{name:"send",color:"primary"})]),_:1})]),_:1},8,["modelValue"])])])]),s(v,{ref:"refVisorImagen"},null,512)])]),_:1})}var ri=Te(St,[["render",ni],["__scopeId","data-v-b9c6d906"]]);class We extends qe{constructor(){super(G.archivos_tickets)}}const ci=le({__name:"DetalleTicketAsignadoPage",setup(e){const i=re().filaTicket,r=G.archivos_tickets,u=new ne(Ve,new We),p=C();return Ze(()=>p.value.listarArchivos({ticket_id:i.id})),(l,d)=>(m(),j(be,{class:"rounded-card border-none"},{default:g(()=>[s(Ce,null,{default:g(()=>[s(ve,{ticket:ke(i)},null,8,["ticket"]),d[0]||(d[0]=t("br",null,null,-1)),s(Re,{ref_key:"refArchivoTicket",ref:p,mixin:ke(u),endpoint:ke(r),disable:!0,"permitir-eliminar":!1,"listar-al-guardar":!1,permitirSubir:!1},null,8,["mixin","endpoint"])]),_:1})]),_:1}))}}),di=()=>({});var ui=He({name:"QSlider",props:{...za,modelValue:{required:!0,default:null,validator:e=>typeof e=="number"||e===null},labelValue:[String,Number]},emits:Fa,setup(e,{emit:a}){const{proxy:{$q:i}}=va(),{state:r,methods:u}=Ia({updateValue:S,updatePosition:U,getDragging:M,formAttrs:ba(e)}),p=C(null),l=C(0),d=C(0);function v(){d.value=e.modelValue===null?r.innerMin.value:Ue(e.modelValue,r.innerMin.value,r.innerMax.value)}Ge(()=>`${e.modelValue}|${r.innerMin.value}|${r.innerMax.value}`,v),v();const c=D(()=>u.convertModelToRatio(d.value)),b=D(()=>r.active.value===!0?l.value:c.value),h=D(()=>{const w={[r.positionProp.value]:`${100*r.innerMinRatio.value}%`,[r.sizeProp.value]:`${100*(b.value-r.innerMinRatio.value)}%`};return e.selectionImg!==void 0&&(w.backgroundImage=`url(${e.selectionImg}) !important`),w}),T=u.getThumbRenderFn({focusValue:!0,getNodeData:di,ratio:b,label:D(()=>e.labelValue!==void 0?e.labelValue:d.value),thumbColor:D(()=>e.thumbColor||e.color),labelColor:D(()=>e.labelColor),labelTextColor:D(()=>e.labelTextColor)}),k=D(()=>r.editable.value!==!0?{}:i.platform.is.mobile===!0?{onClick:u.onMobileClick}:{onMousedown:u.onActivate,onFocus:N,onBlur:u.onBlur,onKeydown:Q,onKeyup:u.onKeyup});function S(w){d.value!==e.modelValue&&a("update:modelValue",d.value),w===!0&&a("change",d.value)}function M(){return p.value.getBoundingClientRect()}function U(w,R=r.dragging.value){const A=u.getDraggingRatio(w,R);d.value=u.convertRatioToModel(A),l.value=e.snap!==!0||e.step===0?A:u.convertModelToRatio(d.value)}function N(){r.focus.value=!0}function Q(w){if(!Ma.includes(w.keyCode))return;fa(w);const R=([34,33].includes(w.keyCode)?10:1)*r.keyStep.value,A=([34,37,40].includes(w.keyCode)?-1:1)*(r.isReversed.value===!0?-1:1)*(e.vertical===!0?-1:1)*R;d.value=Ue(r.roundValueFn.value(d.value+A),r.innerMin.value,r.innerMax.value),S()}return()=>{const w=u.getContent(h,r.tabindex,k,R=>{R.push(T())});return I("div",{ref:p,class:r.classes.value+(e.modelValue===null?" q-slider--no-value":""),...r.attributes.value,"aria-valuenow":e.modelValue},w)}}});class ea{constructor(){n(this,"axios");n(this,"cargando",new Ne);this.axios=_e.getInstance()}async asignar(a){return await this.solicitud("/asignar",a)}async ejecutar(a,i){return this.solicitud("/ejecutar",a,i)}async finalizar(a){return this.solicitud("/finalizar",a)}async finalizarNoSolucion(a,i){return this.solicitud("/finalizar-no-solucion",a,i)}async pausar(a,i){return this.solicitud("/pausar",a,i)}async reanudar(a,i){return this.solicitud("/reanudar",a,i)}async cancelar(a,i){return this.solicitud("/cancelar",a,{motivo_cancelado_ticket_id:i})}async rechazar(a,i){return this.solicitud("/rechazar",a,i)}async calificar(a,i){return this.solicitud("/calificar",a,i)}async solicitud(a,i,r){try{const u=this.axios.getEndpoint(G.tickets)+a+"/"+i;this.cargando.activar();const p=await this.axios.post(u,r);return{response:p,result:p.data.modelo}}catch(u){const p=u;throw new ga(p)}finally{this.cargando.desactivar()}}}var mi=le({components:{EssentialTable:fe,DetalleTicket:ve},props:{mixinModal:{type:Object,required:!0},accion:{type:Function,required:!0}},emits:["cerrar-modal","guardado"],setup(e,{emit:a}){const i=re(),r=he();Ca().setQuasar(ka());const{confirmar:u,notificarCorrecto:p,notificarAdvertencia:l}=me(),d=i.filaTicket,v=pe({observacion:null,calificacion:1,solicitante_o_responsable:""}),c=D(()=>{switch(v.calificacion){case 1:return"\xAB Malo \xBB";case 2:return"\xAB Aceptable \xBB";case 3:return"\xAB Bueno \xBB";case 4:return"\xAB Excelente \xBB"}}),h=Me({observacion:{required:Fe}},v);async function T(){if(await h.value.$validate())try{u("\xBFEst\xE1 seguro de continuar?",async()=>{const S=new ea;if(d.id){v.solicitante_o_responsable=r.user.id===d.solicitante_id?"SOLICITANTE":"RESPONSABLE";const{response:M}=await S.calificar(d.id,v);p(M.data.mensaje)}a("guardado","CalificarTicketPage")})}catch(S){l(S)}}function k(){a("cerrar-modal",!1)}return{v$:h,calificar:v,ticket:d,enviarCalificacion:T,cancelar:k,labelCalificacion:c}}});const pi={class:"row q-col-gutter-xs"},bi={class:"col-12"},fi={class:"col-12 q-px-xl q-mb-xl"},vi={class:"q-mb-md text-center text-bold"},gi={class:"row q-gutter-sm justify-end"};function ki(e,a,i,r,u,p){const l=se("DetalleTicket");return m(),j(be,{class:"q-mb-lg q-pa-md rounded"},{default:g(()=>[a[8]||(a[8]=t("div",{class:"text-bold q-mb-lg"},"Informaci\xF3n general",-1)),s(l,{ticket:e.ticket},null,8,["ticket"]),a[9]||(a[9]=t("br",null,null,-1)),s(oe,{inset:"",class:"q-mt-md q-mb-xl"}),t("div",pi,[t("div",bi,[a[4]||(a[4]=t("label",{class:"q-mb-sm block"},"Observaci\xF3n",-1)),s(Ie,{modelValue:e.calificar.observacion,"onUpdate:modelValue":a[0]||(a[0]=d=>e.calificar.observacion=d),placeholder:"Obligatorio",outlined:"",dense:"",autogrow:"",type:"textarea",error:!!e.v$.observacion.$errors.length,onBlur:e.v$.observacion.$touch},{error:g(()=>[(m(!0),_(K,null,X(e.v$.observacion.$errors,d=>(m(),_("div",{key:d.$uid},[t("div",null,q(d.$message),1)]))),128))]),_:1},8,["modelValue","error","onBlur"])]),a[5]||(a[5]=t("label",{class:"block"},"Calificaci\xF3n del servicio",-1)),t("div",fi,[s(ui,{class:"q-mt-xl",modelValue:e.calificar.calificacion,"onUpdate:modelValue":a[1]||(a[1]=d=>e.calificar.calificacion=d),snap:"",color:"orange","thumb-color":"yellow-8",min:1,max:4,step:1,markers:"","marker-labels":"","switch-marker-labels-side":""},{"marker-label-group":g(({markerMap:d})=>[t("div",vi,q(e.labelCalificacion),1),t("div",{class:ze(["row items-center no-wrap",d[e.calificar.calificacion].classes]),style:ha(d[e.calificar.calificacion].style)},[e.calificar.calificacion===0?(m(),j($,{key:0,size:"xs",color:"yellow-8",name:"star_outline"})):(m(!0),_(K,{key:1},X(Math.floor(e.calificar.calificacion),v=>(m(),j($,{key:v,size:"xs",color:"yellow-8",name:"star_rate"}))),128))],6)]),_:1},8,["modelValue"])])]),t("div",gi,[s(ae,{color:"positive","no-caps":"",push:"",onClick:a[2]||(a[2]=d=>e.enviarCalificacion())},{default:g(()=>[s($,{name:"bi-stars",size:"xs",class:"q-pr-sm"}),a[6]||(a[6]=t("span",null,"Calificar ticket",-1))]),_:1}),s(ae,{color:"negative","no-caps":"",push:"",onClick:a[3]||(a[3]=d=>e.cancelar())},{default:g(()=>[s($,{name:"bi-x",size:"xs",class:"q-pr-sm"}),a[7]||(a[7]=t("span",null,"Cancelar",-1))]),_:1})])]),_:1})}var hi=Te(mi,[["render",ki]]);const _i=[{name:"fecha_hora",field:"fecha_hora",label:"Fecha hora",align:"left"},{name:"motivo",field:"motivo",label:"Motivo",align:"left"},{name:"responsable",field:"responsable",label:"Responsable",align:"left"}];var Ti=le({components:{EssentialTable:fe,ModalesEntidad:Ra,ArchivoSeguimiento:Re,EstadosSubtareas:Je,DetalleTicket:ve},setup(e){var z,ee;const a=re(),i=new ne(Ye,new Va),{listadosAuxiliares:r,accion:u,disabled:p}=i.useReferencias(),{guardar:l,editar:d,eliminar:v,reestablecer:c,obtenerListados:b,cargarVista:h}=i.useComportamiento(),T=new ne(Ve,new We);h(async()=>{await b({empleados:[],departamentos:new Ke,categoriasTiposTickets:new Ba,tiposTickets:{controller:new La,params:{activo:1}},motivosCancelados:{controller:new Pa,params:{activo:1}}}),W.value=r.departamentos});const k=_e.getInstance(),S=new Ne,M=C(),U=C(),N=C(),Q=C(),w=C([]),R=C([]),A=a.filaTicket;N.value=(z=A.fecha_hora_limite)==null?void 0:z.split(" ")[0],Q.value=(ee=A.fecha_hora_limite)==null?void 0:ee.split(" ")[1],A.establecer_hora_limite=!!Q.value,U.value=A.fecha_hora_solicitud;const te=D(()=>r.categoriasTiposTickets.filter(O=>O.departamento_id===A.departamento_responsable)),Z=D(()=>r.tiposTickets.filter(O=>O.categoria_tipo_ticket_id===A.categoria_tipo_ticket));A.departamento_responsable&&y({departamento_id:A.departamento_responsable}),Ze(()=>{M.value.listarArchivos({ticket_id:A.id}),M.value.quiero_subir_archivos=!1}),J(),o();const{filtrarDepartamentos:Y,filtrarEmpleados:H,filtrarTiposTickets:V,departamentos:W,empleados:x}=Xe(r);async function J(){try{S.activar();const O=k.getEndpoint(G.pausas_tickets)+"/"+A.id,ie=await k.get(O);w.value=ie.data.results}catch{}finally{S.desactivar()}}async function o(){const O=k.getEndpoint(G.rechazos_tickets)+"/"+A.id,ie=await k.get(O);R.value=ie.data.results}async function y(O){h(async()=>{await b({empleados:{controller:new De,params:{...O,campos:"id,nombres,apellidos"}}}),x.value=r.empleados})}function B(O){switch(O){case 1:return"MALO";case 2:return"ACEPTABLE";case 3:return"BUENO";case 4:return"EXCELENTE"}}return{columnasPausas:[...ja,{name:"responsable",field:"responsable",label:"Responsable",align:"left",sortable:!0}],configuracionColumnasTicketRechazado:_i,ticket:A,accion:u,disabled:p,guardar:l,editar:d,eliminar:v,reestablecer:c,listadosAuxiliares:r,mixin:i,filtrarDepartamentos:Y,filtrarEmpleados:H,filtrarTiposTickets:V,departamentos:W,empleados:x,fechaHoraActual:U,endpoint:G.archivos_tickets,refArchivoTicket:M,fechaLimite:N,horaLimite:Q,obtenerResponsables:y,pausas:w,rechazos:R,obtenerTexto:B,categoriasTiposTickets:te,tiposTickets:Z,tiposPrioridades:Ta,mixinArchivoTicket:T}}});const Ci={class:"q-pa-md"},qi={class:"col-12 q-mb-md"},yi={class:"text-bold q-mb-lg"},Ai={class:"col-12 col-md-4"},$i={class:"q-mb-sm block"},Si={class:"col-12 col-md-8"},wi={class:"q-mb-sm block"};function xi(e,a,i,r,u,p){const l=se("detalle-ticket"),d=se("archivo-seguimiento"),v=se("essential-table");return m(),_("div",Ci,[s(l,{ticket:e.ticket},null,8,["ticket"]),t("div",qi,[s(d,{ref:"refArchivoTicket",mixin:e.mixinArchivoTicket,endpoint:e.endpoint,disable:!0,"permitir-eliminar":!1,"listar-al-guardar":!1},null,8,["mixin","endpoint"])]),e.ticket.calificaciones.length?(m(),j(be,{key:0,class:"rounded-card q-mb-md"},{default:g(()=>[s(Ce,null,{default:g(()=>[t("div",yi,[s($,{name:"bi-stars"}),a[0]||(a[0]=L(" Calificaciones "))]),(m(!0),_(K,null,X(e.ticket.calificaciones,c=>(m(),_("div",{key:c.id,class:"row q-col-gutter-sm q-mb-md"},[t("div",Ai,[t("label",$i,"Calificaci\xF3n del "+q(c.solicitante_o_responsable),1),s(Na,{color:"grey-3"},{default:g(()=>[(m(!0),_(K,null,X(c.calificacion,b=>(m(),j($,{key:b,name:"bi-star-fill",color:"yellow-7",class:"q-mr-xs"}))),128)),L(" "+q(e.obtenerTexto(c.calificacion)),1)]),_:2},1024)]),t("div",Si,[t("label",wi,"Observaci\xF3n del "+q(c.solicitante_o_responsable),1),s(Ie,{modelValue:c.observacion,"onUpdate:modelValue":b=>c.observacion=b,outlined:"",disable:"",dense:"",autogrow:"",type:"textarea"},null,8,["modelValue","onUpdate:modelValue"])])]))),128))]),_:1})]),_:1})):P("",!0),e.pausas.length?(m(),j(v,{key:1,titulo:"Listado de pausas realizadas",configuracionColumnas:e.columnasPausas,datos:e.pausas,separador:"cell","alto-fijo":!1,"permitir-buscar":!1,"mostrar-footer":!e.pausas.length,estilos:"margin-bottom: 16px;"},null,8,["configuracionColumnas","datos","mostrar-footer"])):P("",!0),e.rechazos.length?(m(),j(v,{key:2,titulo:"Listado de rechazos realizados",configuracionColumnas:e.configuracionColumnasTicketRechazado,datos:e.rechazos,separador:"cell","alto-fijo":!1,"permitir-buscar":!1,"mostrar-footer":!e.rechazos.length},null,8,["configuracionColumnas","datos","mostrar-footer"])):P("",!0)])}var Ei=Te(Ti,[["render",xi]]);class uo{constructor(){n(this,"ReagendarTicketPage");n(this,"SeguimientoTicketPage");n(this,"DetalleTicketAsignadoPage");n(this,"CalificarTicketPage");n(this,"DetalleCompletoTicket");this.ReagendarTicketPage=ue(new de("Cambiar responsable",_t)),this.SeguimientoTicketPage=ue(new de("Seguimiento del ticket",ri)),this.DetalleTicketAsignadoPage=ue(new de("Detalles del ticket",ci)),this.CalificarTicketPage=ue(new de("Calificar ticket",hi)),this.DetalleCompletoTicket=ue(new de("Detalle ticket",Ei))}}const mo=(e,a)=>{const{confirmar:i,prompt:r,notificarCorrecto:u,promptItems:p}=me(),l=me(),{entidad:d,listado:v,listadosAuxiliares:c}=e.useReferencias(),{editarParcial:b}=e.useComportamiento(),h=new ea,T=re(),k=he();let S;const M=o=>S=o,U={titulo:"Transferir",icono:"bi-arrow-right",color:"secondary",visible:({entidad:o})=>[f.ASIGNADO,f.REASIGNADO,f.EJECUTANDO,f.PAUSADO].includes(o.estado)&&o.responsable_id===k.user.id,accion:({entidad:o,posicion:y})=>{T.filaTicket=o,T.posicionFilaTicket=y,a.abrirModalEntidad("ReagendarTicketPage")}},N={titulo:"Ejecutar",icono:"bi-play-fill",color:"positive",visible:({entidad:o})=>[f.ASIGNADO,f.REASIGNADO].includes(o.estado)&&o.puede_ejecutar,accion:({entidad:o})=>{i("\xBFEst\xE1 seguro de ejecutar el ticket?",async()=>{const{response:y,result:B}=await h.ejecutar(o.id);o.estado=f.EJECUTANDO,o.fecha_hora_ejecucion=B.fecha_hora_ejecucion,S(f.EJECUTANDO),u(y.data.mensaje)})}},Q={titulo:"Pausar",icono:"bi-pause-circle",color:"blue-6",visible:({entidad:o})=>o.estado===f.EJECUTANDO&&o.responsable_id===k.user.id,accion:({entidad:o})=>{i("\xBFEst\xE1 seguro de pausar el ticket?",()=>{const y=pe({mensaje:"Seleccione el motivo de la pausa",accion:async B=>{try{const E={motivo_pausa_ticket_id:B};await h.pausar(o.id,E),S(f.PAUSADO),u("Ticket pausado exitosamente!")}catch(E){if(xe(E)){const z=E.erroresValidacion;Ee(z,l)}else l.notificarError(E.message)}},tipo:"radio",items:c.motivosPausas.map(B=>({label:B.motivo,value:B.id}))});p(y)})}},w={titulo:"Reanudar",icono:"bi-play-circle",color:"positive",visible:({entidad:o})=>[f.PAUSADO,f.FINALIZADO_SOLUCIONADO].includes(o.estado)&&o.puede_ejecutar,accion:async({entidad:o})=>{i("\xBFEst\xE1 seguro de reanudar el trabajo?",async()=>{await h.reanudar(o.id),S(f.EJECUTANDO),u("Ticket reanudado exitosamente!")})}},R={titulo:"Finalizar",color:"positive",icono:"bi-check",visible:({entidad:o})=>o.estado===f.EJECUTANDO&&o.responsable_id===k.user.id,accion:({entidad:o,posicion:y})=>i("\xBFEst\xE1 seguro de marcar como finalizado el ticket?",async()=>{const B=pe({mensaje:"Seleccione una opci\xF3n de finalizaci\xF3n",accion:async E=>{if(E===1)try{await h.finalizar(o.id),S(f.FINALIZADO_SOLUCIONADO),J(y),u("Ticket finalizado exitosamente!")}catch(z){if(xe(z)){const ee=z.erroresValidacion;Ee(ee,l)}else l.notificarError(z.message)}else r({titulo:"Motivo",mensaje:"Ingrese el motivo por el que no se pudo dar soluci\xF3n.",accion:async ee=>{try{await h.finalizarNoSolucion(o.id,{motivo:ee}),S(f.FINALIZADO_SIN_SOLUCION),J(y),u("Ticket finalizado exitosamente!")}catch(O){if(xe(O)){const ie=O.erroresValidacion;Ee(ie,l)}else l.notificarError(O.message)}}})},tipo:"radio",items:[{label:"SE SOLUCION\xD3 EL TICKET",value:1},{label:"NO SE LOGR\xD3 DAR SOLUCI\xD3N AL TICKET",value:2}]});p(B)})},A={titulo:"Seguimiento",icono:"bi-check2-square",color:"indigo",visible:({entidad:o})=>[f.REASIGNADO,f.EJECUTANDO,f.PAUSADO,f.FINALIZADO_SIN_SOLUCION,f.FINALIZADO_SOLUCIONADO].includes(o.estado),accion:async({entidad:o})=>{T.filaTicket=o,a.abrirModalEntidad("SeguimientoTicketPage")}},te={titulo:"Cambiar responsable",icono:"bi-arrow-left-right",color:"teal",visible:({entidad:o})=>o.estado===f.ASIGNADO,accion:async({entidad:o,posicion:y})=>{T.filaTicket=o,T.posicionFilaTicket=y,a.abrirModalEntidad("ReagendarTicketPage")}},Z={titulo:"Asignar",icono:"bi-person-fill-up",color:"positive",visible:({entidad:o})=>o.estado===f.RECHAZADO,accion:async({entidad:o,posicion:y})=>{T.filaTicket=o,T.posicionFilaTicket=y,a.abrirModalEntidad("ReagendarTicketPage")}},Y={titulo:"Rechazar",icono:"bi-person-fill-down",color:"negative",visible:({entidad:o})=>[f.ASIGNADO,f.REASIGNADO].includes(o.estado),accion:async({entidad:o,posicion:y})=>{r({titulo:"Motivo",mensaje:"Ingrese el motivo por el que rechaza el ticket.",accion:async E=>{i("\xBFEst\xE1 seguro de rechazar el ticket?",async()=>{const{response:z}=await h.rechazar(o.id,{motivo:E});J(y),u(z.data.mensaje)})}})}},H={titulo:"Cancelar",icono:"bi-x",color:"negative",visible:({entidad:o})=>[f.RECHAZADO,f.ASIGNADO].includes(o.estado),accion:async({entidad:o,posicion:y})=>{const B={mensaje:"Seleccione el motivo de la cancelaci\xF3n",accion:E=>{i("\xBFEst\xE1 seguro de cancelar el ticket?",async()=>{const{result:z}=await h.cancelar(o.id,E);o.estado=f.CANCELADO,o.fecha_hora_cancelado=z.fecha_hora_cancelado,o.motivo_cancelado=z.motivo_cancelado,u("Ticket cancelado exitosamente!"),J(y)})},tipo:"radio",items:c.motivosCancelados.map(E=>({label:E.motivo,value:E.id}))};p(B)}},V={titulo:"Calificar",icono:"bi-stars",color:"amber-8",visible:({entidad:o})=>[f.FINALIZADO_SIN_SOLUCION,f.FINALIZADO_SOLUCIONADO].includes(o.estado)&&k.user.id===o.solicitante_id&&o.pendiente_calificar_solicitante,accion:({entidad:o,posicion:y})=>{T.posicionFilaTicket=y,T.filaTicket=o,a.abrirModalEntidad("CalificarTicketPage")}},W={titulo:"Calificar",icono:"bi-stars",color:"positive",visible:({entidad:o})=>[f.FINALIZADO_SIN_SOLUCION,f.FINALIZADO_SOLUCIONADO].includes(o.estado)&&k.user.id===o.responsable_id&&o.pendiente_calificar_responsable,accion:({entidad:o,posicion:y})=>{T.posicionFilaTicket=y,T.filaTicket=o,a.abrirModalEntidad("CalificarTicketPage")}},x={titulo:({entidad:o})=>(o.recurrence_active?"Pausar ":"Activar ")+"recurrencia",icono:({entidad:o})=>o.recurrence_active?"bi-pause-fill":"bi-play-fill",color:({entidad:o})=>o.recurrence_active?"blue-4":"blue",visible:({entidad:o})=>o.is_recurring&&o.solicitante_id===k.user.id,accion:({entidad:o})=>{i(`\xBFEst\xE1 seguro de ${o.recurrence_active?"pausar":"activar"} la recurrencia del ticket?`,async()=>{await b(o.id,{recurrence_active:!o.recurrence_active})})}};function J(o){o>=0&&v.value.splice(o,1)}return{btnTransferir:U,btnEjecutar:N,btnPausar:Q,btnReanudar:w,btnFinalizar:R,btnSeguimiento:A,btnReasignar:te,btnCancelar:H,btnRechazar:Y,btnCalificarSolicitante:V,btnCalificarResponsable:W,btnAsignar:Z,setFiltrarTickets:M,btnPausarRecurrente:x}};export{We as A,Ye as T,Ha as _,_i as a,uo as b,ja as c,re as d,mo as u};
