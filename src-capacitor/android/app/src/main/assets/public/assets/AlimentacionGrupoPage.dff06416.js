var ke=Object.defineProperty;var Ce=(e,a,g)=>a in e?ke(e,a,{enumerable:!0,configurable:!0,writable:!0,value:g}):e[a]=g;var u=(e,a,g)=>(Ce(e,typeof a!="symbol"?a+"":a,g),g);import{bw as we,s as qe,d as Te,u as Ae,$ as Ee,be as Fe,a0 as H,q as Pe,f as J,bx as P,_ as je,t as z,v as p,P as De,F as l,z as i,a4 as Ge,y as t,I as S,B as Y,j as K,O as w,x as c,G as v,H as $,K as f,L as Ne,J as j,D as h,bd as W,b0 as Oe}from"./index.6449c167.js";import{Q as Me,a as Qe,C as Ue}from"./QPopupProxy.72ff1d6d.js";import{Q as y,a as V}from"./QItemSection.9a955ec6.js";import{Q as D,a as G}from"./QSelect.6ce302d7.js";import{Q as Ie}from"./QForm.ca56f146.js";import{u as Re}from"./filtrosListadosGenerales.c3aa2da3.js";import{r as k,h as Be,d as Le,a as X}from"./i18n-validators.29e2545c.js";import{o as He,M as Je}from"./utils.521b98f3.js";import{E as ze}from"./entidadAuditable.75a46700.js";import{u as Ye}from"./index.490dde02.js";import{D as Ke}from"./DesignarResponsableTrabajo.445ecff6.js";import{T as We}from"./TabLayout.0bce4313.js";import{C as Z}from"./ContenedorSimpleMixin.09c9bed5.js";import{G as Xe}from"./GrupoController.6ad12a37.js";import{S as x}from"./Subtarea.3371ad54.js";import{S as Ze}from"./SubtareaController.f99556ec.js";import{a as q}from"./tareas.utils.309e0dff.js";import{u as xe}from"./trabajoAsignado.75736b56.js";class ea{constructor(a){u(this,"subtarea");this.subtarea=a}async validar(){if(console.log(this.subtarea),this.subtarea.modo_asignacion_trabajo===q.por_grupo&&!this.subtarea.empleados_designados.some(a=>a.es_responsable))throw new Error("Debe designar a un empleado como responsable.");return!0}}const aa=[{name:"tarea",field:"tarea",label:"Tarea",align:"left",operador:"like"},{name:"coordinador",field:"coordinador",label:"Coordinador",align:"left",operador:"like"},{name:"observacion",field:"observacion",label:"Observaci\xF3n",align:"left",operador:"like"},{name:"grupo",field:"grupo",label:"Grupo",align:"left",operador:"like"},{name:"cantidad_personas",field:"cantidad_personas",label:"Cantidad personas",align:"left",type:"number",operador:"="},{name:"precio",field:"precio",label:"Precio",align:"left",type:"number"},{name:"total",field:"total",label:"Total",align:"left",type:"number",operador:"="},{name:"fecha",field:"fecha",label:"Fecha",align:"left",type:"date",operador:"="},{name:"tipo_alimentacion",field:"tipo_alimentacion",label:"Tipo alimentaci\xF3n",align:"left",operador:"like"}];class N extends ze{constructor(){super();u(this,"tarea");u(this,"tarea_id");u(this,"subtarea_id");u(this,"coordinador");u(this,"observacion");u(this,"grupo_id");u(this,"grupo");u(this,"cantidad_personas");u(this,"precio");u(this,"total");u(this,"fecha");u(this,"tipo_alimentacion");u(this,"tipo_alimentacion_id");u(this,"alimentacion_grupos");u(this,"empleado");u(this,"editar_participantes");this.tarea=null,this.tarea_id=null,this.coordinador=null,this.observacion=null,this.grupo_id=null,this.grupo=null,this.cantidad_personas=null,this.precio=null,this.total=null,this.fecha=null,this.tipo_alimentacion=null,this.tipo_alimentacion_id=null,this.alimentacion_grupos=[],this.empleado=null,this.grupo=null,this.editar_participantes=!1}}class oa extends we{constructor(){super(qe.alimentacion_grupos)}}var ra=Te({name:"alimentacion_grupo",props:{datos:Object},components:{TabLayout:We,DesignarResponsableTrabajo:Ke},emits:["guardado","cerrar-modal"],setup(e,{emit:a}){var R,B,L;const g=Ae(),O=xe(),T=3,M=g.esJefeTecnico||g.esCoordinadorBackup,A=Ee(),E=["monitor_subtareas","tareas"].includes((B=(R=A.name)==null?void 0:R.toString())!=null?B:""),s=new Z(N,new oa),{entidad:r,disabled:o,listadosAuxiliares:_,accion:C}=s.useReferencias(),{setValidador:ee,obtenerListados:ae,cargarVista:oe}=s.useComportamiento(),{onBeforeGuardar:re,onConsultado:se,onBeforeModificar:ie,onReestablecer:ne,onGuardado:le}=s.useHooks(),F=new Z(x,new Ze),{entidad:d}=F.useReferencias(),{consultar:te,editarParcial:de}=F.useComportamiento(),{onConsultado:ue}=F.useHooks();oe(async()=>{await ae({grupos:{controller:new Xe,params:{campos:"id,nombre",activo:1,coordinador_id:M?null:g.user.id}},tareas:{controller:new Fe,params:{campos:"id,codigo_tarea,titulo,cliente_id","f_params[orderBy][field]":"id","f_params[orderBy][type]":"DESC","f_params[limit]":100}},subdetalles:[]}),_.subdetalles=ve(),I.value=_.subdetalles,U.value=_.tareas});const pe={fecha:{required:k},alimentacion_grupos:{$each:Be.forEach({grupo_id:{required:k},cantidad_personas:{required:k,minValue:Le(1)},tarea_id:{required:k},tipo_alimentacion_id:{required:k}})},grupo:{required:X(()=>d.modo_asignacion_trabajo===q.por_grupo)},empleado:{required:X(()=>d.modo_asignacion_trabajo===q.por_empleado)}},Q=Ye(pe,r);ee(Q.value);const me=new ea(d);s.agregarValidaciones(me);const{grupos:ce,filtrarGrupos:be,tareas:U,filtrarTareasTitulo:ge,subdetalles:I,filtrarSubdetalles:fe}=Re(_),_e=()=>{var m,b;const n=new N;n.grupo_id=r.editar_participantes?r.grupo:(m=e.datos)==null?void 0:m.idGrupo,n.tarea_id=(b=e.datos)==null?void 0:b.idTarea,r.alimentacion_grupos.push(n)},ve=()=>(H.getItem("sub_detalles")?JSON.parse(H.getItem("sub_detalles").toString()):[]).filter(m=>{var b;return["ALIMENTACION","ALIMENTACI\xD3N"].includes((b=m.detalle_viatico_info)!=null?b:"")});function $e(n){d.grupo=n,r.grupo=n,r.alimentacion_grupos.map(m=>m.grupo_id=n)}function he(n,m){d.empleado=n,r.empleado=n,console.log(m),r.grupo=m.grupo_id,r.alimentacion_grupos.map(b=>b.grupo_id=m.grupo_id)}function Se(n){d.empleado=n,r.empleado=n}function ye(n){d.modo_asignacion_trabajo=n,d.empleado=null,d.grupo=null,r.grupo=null,r.empleado=null}const Ve=()=>{var n;r.editar_participantes||(d.hydrate(new x),r.grupo_id=(n=e.datos)==null?void 0:n.idGrupo,r.alimentacion_grupos.map(m=>{var b;return m.grupo_id=(b=e.datos)==null?void 0:b.idGrupo}))};return re(()=>{r.alimentacion_grupos=r.alimentacion_grupos.map(n=>{var m,b;return n.precio=T,n.fecha=r.fecha,n.subtarea_id=(m=e.datos)==null?void 0:m.idSubtarea,n.tarea_id=e.datos?(b=e.datos)==null?void 0:b.idTarea:n.tarea_id,n})}),ie(()=>{r.observacion=r.alimentacion_grupos[0].observacion,r.cantidad_personas=r.alimentacion_grupos[0].cantidad_personas,r.alimentacion_grupos=[]}),se(()=>{const n=JSON.parse(JSON.stringify(r));n.alimentacion_grupos=[],r.alimentacion_grupos=[n]}),le(()=>{d.modo_asignacion_trabajo===q.por_grupo?d.empleados_designados=d.empleados_designados.map(n=>n.id):d.empleados_designados=[d.empleado],d.id&&de(d.id,{grupo:d.grupo,empleado:d.empleado,empleados_designados:d.empleados_designados,modo_asignacion_trabajo:d.modo_asignacion_trabajo}),a("guardado","AlimentacionGrupoPage")}),ne(()=>{r.hydrate(new N),a("cerrar-modal",!1)}),ue(()=>{r.grupo=d.grupo,console.log(r.grupo)}),r.fecha=He("YYYY-MM-DD"),te({id:O.idSubtareaSeleccionada}),{v$:Q,mixin:s,disabled:o,accion:C,maskFecha:Pe,alimentacion:r,optionsFecha:Je,configuracionColumnasAlimentacionGrupo:aa,agregarGrupo:_e,tareas:U,filtrarTareasTitulo:ge,grupos:ce,filtrarGrupos:be,subdetalles:I,filtrarSubdetalles:fe,PRECIO_ALIMENTACION:T,noSePuedeEditar:J(()=>C.value===P.editar),consultado:J(()=>C.value===P.editar||C.value===P.consultar),existeSubtarea:!!((L=e.datos)!=null&&L.idSubtarea),mostrarFormulario:E,subtarea:d,seleccionarGrupo:$e,seleccionarEmpleado:he,seleccionarResponsable:Se,seleccionarModoDesignacion:ye,limpiarSubtarea:Ve}}});const sa={class:"row q-col-gutter-sm q-pa-md border-white rounded q-mb-xl"},ia={class:"col-12 col-md-3"},na={class:"row items-center justify-end"},la={class:"error-msg"},ta={class:"col-12 col-md-3"},da={class:"col-12 col-md-3"},ua={key:0,class:"col-12 border-callout-warning bg-solid q-pb-sm"},pa={class:"col-12 col-md-3"},ma={class:"error-msg"},ca={key:0,class:"col-12 col-md-4"},ba={class:"error-msg"},ga={key:1,class:"col-12 col-md-4"},fa={class:"col-12 col-md-2"},_a={class:"error-msg"},va={class:"col-12 col-md-3"},$a={class:"col-12 col-md-3"},ha={class:"error-msg"},Sa={class:"col-12 col-md-9"};function ya(e,a,g,O,T,M){const A=z("designar-responsable-trabajo"),E=z("tab-layout");return p(),De(E,{mixin:e.mixin,"configuracion-columnas":e.configuracionColumnasAlimentacionGrupo,paginate:!0,"puede-filtrar":"","puede-exportar":"","ajustar-celdas":"","mostrar-formulario":e.mostrarFormulario},{formulario:l(()=>[i(Ie,{onSubmit:a[6]||(a[6]=Ge(()=>{},["prevent"]))},{default:l(()=>[t("div",sa,[t("div",ia,[a[8]||(a[8]=t("label",{class:"q-mb-sm block"},"Fecha",-1)),i(S,{modelValue:e.alimentacion.fecha,"onUpdate:modelValue":a[1]||(a[1]=s=>e.alimentacion.fecha=s),placeholder:"Obligatorio",error:!!e.v$.fecha.$errors.length,disable:e.disabled,readonly:"",onBlur:e.v$.fecha.$touch,outlined:"",dense:""},{append:l(()=>[i(Y,{name:"event",class:"cursor-pointer"},{default:l(()=>[i(Me,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:l(()=>[i(Qe,{modelValue:e.alimentacion.fecha,"onUpdate:modelValue":a[0]||(a[0]=s=>e.alimentacion.fecha=s),mask:e.maskFecha,"today-btn":""},{default:l(()=>[t("div",na,[K(i(w,{label:"Cerrar",color:"primary",flat:""},null,512),[[Ue]])])]),_:1},8,["modelValue","mask"])]),_:1})]),_:1})]),error:l(()=>[(p(!0),c(v,null,$(e.v$.fecha.$errors,s=>(p(),c("div",{key:s.$uid},[t("div",la,f(s.$message),1)]))),128))]),_:1},8,["modelValue","error","disable","onBlur"])]),t("div",ta,[a[9]||(a[9]=t("label",{class:"block q-mb-sm"},"\xA0",-1)),i(w,{color:"positive",icon:"bi-plus",label:"Agregar registro",unelevated:"",square:"","no-caps":"",onClick:a[2]||(a[2]=s=>e.agregarGrupo())})]),t("div",da,[a[10]||(a[10]=t("br",null,null,-1)),i(Ne,{modelValue:e.alimentacion.editar_participantes,"onUpdate:modelValue":[a[3]||(a[3]=s=>e.alimentacion.editar_participantes=s),a[4]||(a[4]=s=>e.limpiarSubtarea())],label:"Editar participantes (Desmarque para descartar cambios)",outlined:"",dense:""},null,8,["modelValue"])]),!!e.datos&&!e.datos.idGrupo||!e.alimentacion.grupo?(p(),c("div",ua,[i(Y,{name:"bi-cone-striped",color:"warning",class:"q-mr-sm"}),a[11]||(a[11]=t("span",{innerHTML:"El empleado responsable no pertenece a ning\xFAn grupo. Comun\xEDquese con RRHH para asignarle un grupo en el sistema en caso de que sea necesario.<br>Sino pertenece a ning\xFAn grupo <b>Finalice sin registrar alimentaci\xF3n</b>."},null,-1))])):j("",!0)]),(p(!0),c(v,null,$(e.alimentacion.alimentacion_grupos,(s,r)=>(p(),c("div",{key:r,class:"row q-col-gutter-sm q-py-md q-mb-xl bg-desenfoque border-white rounded"},[i(w,{class:"btn-quitar-item",color:"negative",label:"Quitar",icon:"bi-x","no-caps":"",rounded:"","no-wrap":"",onClick:o=>e.alimentacion.alimentacion_grupos.splice(r,1)},null,8,["onClick"]),t("div",pa,[a[13]||(a[13]=t("label",{class:"q-mb-sm block"},"Grupo",-1)),i(D,{modelValue:s.grupo_id,"onUpdate:modelValue":o=>s.grupo_id=o,options:e.grupos,onFilter:e.filtrarGrupos,"transition-show":"scale","transition-hide":"scale",hint:"Obligatorio","options-dense":"",dense:"",outlined:"","option-label":o=>o.nombre,"option-value":o=>o.id,"use-input":"","input-debounce":"0","emit-value":"","map-options":"","error-message":"Seleccione un grupo",disable:e.disabled||e.noSePuedeEditar||e.existeSubtarea,error:!!e.v$.alimentacion_grupos.$each.$response.$errors[r].grupo_id.length},{"no-option":l(()=>[i(y,null,{default:l(()=>[i(V,{class:"text-grey"},{default:l(()=>a[12]||(a[12]=[h(" No hay resultados ")])),_:1})]),_:1})]),error:l(()=>[(p(!0),c(v,null,$(e.v$.alimentacion_grupos.$each.$response.$errors[r].grupo_id,o=>(p(),c("div",{key:o.$uid},[t("div",ma,f(o.$message),1)]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","options","onFilter","option-label","option-value","disable","error"])]),e.consultado?j("",!0):(p(),c("div",ca,[a[15]||(a[15]=t("label",{class:"q-mb-sm block"},"Tarea",-1)),i(D,{modelValue:s.tarea_id,"onUpdate:modelValue":o=>s.tarea_id=o,options:e.tareas,"transition-show":"jump-up","transition-hide":"jump-down","options-dense":"",dense:"",outlined:"",disable:e.disabled||e.noSePuedeEditar||e.existeSubtarea,onFilter:e.filtrarTareasTitulo,error:!!e.v$.alimentacion_grupos.$each.$response.$errors[r].tarea_id.length,"error-message":"Seleccione una tarea","use-input":"","input-debounce":"0","option-value":o=>o.id,"option-label":o=>o.codigo_tarea+" | "+o.titulo,"emit-value":"","map-options":""},{error:l(()=>[(p(!0),c(v,null,$(e.v$.alimentacion_grupos.$each.$response.$errors[r].tarea_id,o=>(p(),c("div",{key:o.$uid},[t("div",ba,f(o.$message),1)]))),128))]),option:l(o=>[i(y,W({ref_for:!0},o.itemProps,{class:"q-my-sm"}),{default:l(()=>[i(V,null,{default:l(()=>[i(G,{class:"text-bold text-primary"},{default:l(()=>[h(f(o.opt.codigo_tarea),1)]),_:2},1024),i(G,{caption:""},{default:l(()=>[h(f(o.opt.titulo),1)]),_:2},1024)]),_:2},1024)]),_:2},1040)]),"no-option":l(()=>[i(y,null,{default:l(()=>[i(V,{class:"text-grey"},{default:l(()=>a[14]||(a[14]=[h(" No hay resultados ")])),_:1})]),_:1})]),_:2},1032,["modelValue","onUpdate:modelValue","options","disable","onFilter","error","option-value","option-label"])])),e.consultado?(p(),c("div",ga,[a[16]||(a[16]=t("label",{class:"q-mb-sm block"},"Tarea",-1)),i(S,{modelValue:s.tarea,"onUpdate:modelValue":o=>s.tarea=o,disable:"",outlined:"",dense:"",autogrow:""},null,8,["modelValue","onUpdate:modelValue"])])):j("",!0),t("div",fa,[a[17]||(a[17]=t("label",{class:"q-mb-sm block"},"Cantidad personas",-1)),i(S,{modelValue:s.cantidad_personas,"onUpdate:modelValue":o=>s.cantidad_personas=o,placeholder:"Obligatorio",disable:e.disabled,type:"number",outlined:"",dense:"","error-message":"Escriba la cantidad de personas",error:!!e.v$.alimentacion_grupos.$each.$response.$errors[r].cantidad_personas.length},{error:l(()=>[(p(!0),c(v,null,$(e.v$.alimentacion_grupos.$each.$response.$errors[r].cantidad_personas,o=>(p(),c("div",{key:o.$uid},[t("div",_a,f(o.$message),1)]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","disable","error"])]),t("div",va,[a[18]||(a[18]=t("label",{class:"q-mb-sm block"},"Total",-1)),i(S,{"model-value":e.PRECIO_ALIMENTACION*s.cantidad_personas,disable:"",outlined:"",dense:""},null,8,["model-value"])]),t("div",$a,[a[20]||(a[20]=t("label",{class:"q-mb-sm block"},"Tipo alimentaci\xF3n",-1)),i(D,{modelValue:s.tipo_alimentacion_id,"onUpdate:modelValue":o=>s.tipo_alimentacion_id=o,options:e.subdetalles,"transition-show":"scale","transition-hide":"scale","options-dense":"",dense:"",outlined:"",disable:e.disabled||e.noSePuedeEditar,readonly:e.disabled,"use-input":"","input-debounce":"0",onFilter:e.filtrarSubdetalles,"error-message":"Seleccionar un tipo de alimentaci\xF3n",error:!!e.v$.alimentacion_grupos.$each.$response.$errors[r].tipo_alimentacion_id.length,"option-value":o=>o.id,"option-label":o=>o.descripcion,"emit-value":"","map-options":""},{option:l(({itemProps:o,opt:_})=>[i(y,W({ref_for:!0},o),{default:l(()=>[i(V,null,{default:l(()=>[h(f(_.descripcion)+" ",1),i(G,{"inner-h-t-m-l":_.nombres},null,8,["inner-h-t-m-l"])]),_:2},1024)]),_:2},1040)]),error:l(()=>[(p(!0),c(v,null,$(e.v$.alimentacion_grupos.$each.$response.$errors[r].tipos_alimentacion,o=>(p(),c("div",{key:o.$uid},[t("div",ha,f(o.$message),1)]))),128))]),"no-option":l(()=>[i(y,null,{default:l(()=>[i(V,{class:"text-grey"},{default:l(()=>a[19]||(a[19]=[h(" No hay resultados ")])),_:1})]),_:1})]),_:2},1032,["modelValue","onUpdate:modelValue","options","disable","readonly","onFilter","error","option-value","option-label"])]),t("div",Sa,[a[21]||(a[21]=t("label",{class:"q-mb-sm block"},"Observaci\xF3n",-1)),i(S,{modelValue:s.observacion,"onUpdate:modelValue":o=>s.observacion=o,placeholder:"Opcional",disable:e.disabled,outlined:"",dense:""},null,8,["modelValue","onUpdate:modelValue","disable"])])]))),128)),K(t("div",null,[a[22]||(a[22]=t("div",{class:"text-bold"},"Editar participantes",-1)),i(A,{disable:e.disabled,accion:e.accion,v$:e.v$,"subtarea-inicial":e.subtarea,onSeleccionarGrupo:e.seleccionarGrupo,onSeleccionarEmpleado:e.seleccionarEmpleado,onSeleccionarModoDesignacion:e.seleccionarModoDesignacion,onSeleccionarResponsable:e.seleccionarResponsable,onActualizarEmpleados:a[5]||(a[5]=s=>e.subtarea.empleados_designados=s)},null,8,["disable","accion","v$","subtarea-inicial","onSeleccionarGrupo","onSeleccionarEmpleado","onSeleccionarModoDesignacion","onSeleccionarResponsable"])],512),[[Oe,e.alimentacion.editar_participantes]])]),_:1})]),"custom-buttons":l(()=>[i(w,{icon:"bi-cone-striped",label:"Finalizar sin registrar alimentaci\xF3n","no-caps":"",unelevated:"",square:"",color:"warning",class:"q-mr-xs",onClick:a[7]||(a[7]=()=>{e.$emit("guardado","AlimentacionGrupoPage")})})]),_:1},8,["mixin","configuracion-columnas","mostrar-formulario"])}var Va=je(ra,[["render",ya]]),Ba=Object.freeze(Object.defineProperty({__proto__:null,default:Va},Symbol.toStringTag,{value:"Module"}));export{oa as A,ea as D,Va as a,Ba as b};
