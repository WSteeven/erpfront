var R=Object.defineProperty;var W=(e,o,b)=>o in e?R(e,o,{enumerable:!0,configurable:!0,writable:!0,value:b}):e[o]=b;var d=(e,o,b)=>(W(e,typeof o!="symbol"?o+"":o,b),b);import{E as X}from"./entidadAuditable.75a46700.js";import{bw as B,s as O,d as Y,u as Z,c as L,a0 as V,q as ee,f as oe,bx as z,_ as ae,t as se,v as r,x as u,y as i,z as n,F as m,P as h,J as c,T as $,B as g,D as f,j as F,a3 as ie,O as A,b0 as te,G as le,H as ne,K as x,I as C}from"./index.6449c167.js";import{Q as _}from"./QSelect.6ce302d7.js";import{a as Q}from"./QToolbar.8dbe891b.js";import{Q as de,a as re,C as me}from"./QPopupProxy.72ff1d6d.js";import{Q as ue}from"./QChip.95469f73.js";import{S as ce}from"./SimpleLayout.3a4276ec.js";import{D as pe}from"./DetallePaciente.b09d5be6.js";import{L as be}from"./LaboratorioClinicoController.cad94168.js";import{S as ve}from"./utils.521b98f3.js";import{u as fe}from"./filtrosListadosGenerales.c3aa2da3.js";import{E as ge}from"./EmpleadoPermisosController.f2fe35f7.js";import{D as qe,y as he}from"./EssentialTable.00c17e97.js";class no extends X{constructor(){super();d(this,"codigo");d(this,"observacion");d(this,"observacion_autorizador");d(this,"registro_empleado_examen");d(this,"estado_solicitud_examen");d(this,"cantidad_examenes_solicitados");d(this,"examenes_solicitados");d(this,"empleado");d(this,"empleado_id");d(this,"departamento");d(this,"canton");d(this,"autorizador");d(this,"solicitante");d(this,"autorizacion");d(this,"generar_orden_compra",!1);this.codigo=null,this.observacion=null,this.observacion_autorizador=null,this.registro_empleado_examen=null,this.estado_solicitud_examen=null,this.cantidad_examenes_solicitados=null,this.examenes_solicitados=[],this.empleado=null,this.empleado_id=null,this.departamento=null,this.canton=null,this.autorizador=null,this.solicitante=null,this.autorizacion=null}}class ro extends B{constructor(){super(O.solicitudes_examenes)}}class Ce extends B{constructor(){super(O.examenes)}}var Ve=Y({components:{DetallePaciente:pe,SimpleLayout:ce},props:{mixin:{type:Object,required:!0},empleado:{type:Object,required:!0}},emits:["guardado","cerrar-modal"],setup(e,{emit:o}){const b=Z(),q=e.empleado,k=new ve,y=new be,E=L([]),a=L(!1),{entidad:t,listadosAuxiliares:s,accion:w,disabled:S}=e.mixin.useReferencias(),{cargarVista:D,obtenerListados:N,guardar:P}=e.mixin.useComportamiento(),{onBeforeGuardar:I,onBeforeModificar:j}=e.mixin.useHooks();D(async()=>{const l=V.getItem("examenes")?JSON.parse(V.getItem("examenes").toString()):[];await N({laboratoriosClinicos:{controller:y,params:{canton_id:q.canton,activo:1,campos:"id,nombre"}},autorizadores:{controller:new ge,params:{permisos:["puede.autorizar.solicitudes_examenes"]}},cantones:[],examenes:l.length?l:new Ce}),s.cantones=JSON.parse(V.getItem("cantones").toString()),V.set("examenes",JSON.stringify(s.examenes)),U.value=s.cantones});const{cantones:U,filtrarCantones:H}=fe(s),T=async l=>{k.activar();try{M();const{result:p}=await y.listar({canton_id:l,activo:1,campos:"id,nombre"});s.laboratoriosClinicos=p}catch(p){console.log(p)}finally{k.desactivar()}},J=(l,p)=>{p===0&&(t.examenes_solicitados=t.examenes_solicitados.map(v=>(v.laboratorio_clinico=l,v)))},G=(l,p)=>{p===0&&w.value===z.nuevo&&(t.examenes_solicitados=t.examenes_solicitados.map(v=>(v.fecha_asistencia=l,v)))},K=(l,p)=>{p===0&&w.value===z.nuevo&&(t.examenes_solicitados=t.examenes_solicitados.map(v=>(v.hora_asistencia=l,v)))},M=()=>{t.examenes_solicitados=t.examenes_solicitados.map(l=>(l.laboratorio_clinico=null,l))};return I(()=>{console.log("on before guardar..."),t.examenes_solicitados=t.examenes_solicitados.map(l=>(l.fecha_hora_asistencia=`${l.fecha_asistencia} ${l.hora_asistencia}`,l)),t.canton=q.canton}),j(()=>{console.log("on before modificar..."),t.examenes_solicitados=t.examenes_solicitados.map(l=>(l.fecha_hora_asistencia=`${l.fecha_asistencia} ${l.hora_asistencia}`,l)),t.canton=q.canton}),{mixin:e.mixin,solicitudExamen:t,empleado:q,examenes:E,listadosAuxiliares:s,maskFecha:ee,esAutorizador:oe(()=>t.autorizador===b.user.id),selectAprobarEstadosSolicitudesExamenes:qe,mostrarCambiarCanton:a,acciones:z,estadosSolicitudesExamenes:he,cantones:U,filtrarCantones:H,accion:w,disabled:S,consultarLaboratoriosClinicos:T,guardar:P,asignarLaboratorio:J,asignarFecha:G,asignarHora:K}}});const _e={class:"q-mb-md"},ke={key:0,class:"bg-desenfoque rounded q-pt-md q-mb-md"},ye={class:"col-12 text-primary text-bold q-px-md q-mb-md"},Ee={class:"row q-mb-md q-px-md"},we={class:"row justify-between items-center q-mb-sm"},ze={key:0,class:"q-mb-sm block"},Ae={key:1,class:"q-mb-sm block text-bold"},xe={class:"col-12 col-md-3"},Ue={class:"col-12 col-md-3"},Le={class:"q-mb-md block"},$e={class:"col-12 col-md-3"},Fe={class:"q-mb-md block"},Qe={class:"row items-center justify-end"},Be={class:"col-12 col-md-3"},Oe={class:"q-mb-md block"},Se={class:"row q-px-md"},De={class:"col-12 q-mb-md"},Ne={key:1,class:"bg-desenfoque rounded q-pt-md"},Pe={class:"col-12 text-primary text-bold q-px-md q-mb-md"},Ie={class:"row q-col-gutter-sm q-px-md"},je={class:"col-12 col-md-3 q-mb-md"},He={key:0,class:"col-12 col-md-3 q-mb-md"},Te={key:1,class:"col-12 col-md-3"},Je={key:2,class:"col-12 q-mb-md"};function Ge(e,o,b,q,k,y){const E=se("detalle-paciente");return r(),u("div",null,[i("div",_e,[n($,{name:"scale",mode:"out-in"},{default:m(()=>[e.empleado.id?(r(),h(E,{key:0,empleado:e.empleado},null,8,["empleado"])):c("",!0)]),_:1})]),e.empleado.id?(r(),u("div",ke,[i("div",ye,[n(g,{name:"bi-list"}),o[8]||(o[8]=f(" Listado de ex\xE1menes solicitados "))]),i("div",Ee,[o[9]||(o[9]=i("div",{class:"col-12 col-md-3"},null,-1)),n($,{name:"scale",mode:"out-in"},{default:m(()=>[F(i("div",{class:ie(["rounded q-mb-md",{"col-12":e.solicitudExamen.id,"col-6 custom-shadow q-pa-md border-white":!e.solicitudExamen.id}])},[i("div",we,[e.solicitudExamen.id?(r(),u("label",ze,"Cant\xF3n")):(r(),u("label",Ae,"Seleccione un cant\xF3n para filtrar los laboratorios cl\xEDnicos")),e.solicitudExamen.id?c("",!0):(r(),h(A,{key:2,icon:"bi-x",class:"rounded",unelevated:"",color:"negative",dense:"",onClick:o[0]||(o[0]=()=>e.mostrarCambiarCanton=!e.mostrarCambiarCanton)}))]),n(_,{modelValue:e.empleado.canton,"onUpdate:modelValue":[o[1]||(o[1]=a=>e.empleado.canton=a),o[2]||(o[2]=a=>e.consultarLaboratoriosClinicos(e.empleado.canton))],options:e.cantones,onFilter:e.filtrarCantones,disable:e.disabled||e.esAutorizador,"transition-show":"scale","transition-hide":"scale","options-dense":"",dense:"",outlined:"","option-label":a=>a.canton,"option-value":a=>a.id,"use-input":"","input-debounce":"0","emit-value":"","map-options":""},null,8,["modelValue","options","onFilter","disable","option-label","option-value"])],2),[[te,e.mostrarCambiarCanton||e.solicitudExamen.id]])]),_:1})]),(r(!0),u(le,null,ne(e.solicitudExamen.examenes_solicitados,(a,t)=>(r(),u("div",{key:a.examen_id,class:"row q-col-gutter-sm q-mb-md q-px-md"},[i("div",xe,[o[10]||(o[10]=i("label",{class:"q-mb-md block"},"Ex\xE1men a solicitar ",-1)),n(_,{modelValue:a.examen,"onUpdate:modelValue":s=>a.examen=s,options:e.listadosAuxiliares.examenes,disable:"","transition-show":"scale","transition-hide":"scale","options-dense":"",dense:"",outlined:"","option-label":s=>s.examen,"option-value":s=>s.id,"use-input":"","input-debounce":"0","emit-value":"","map-options":""},null,8,["modelValue","onUpdate:modelValue","options","option-label","option-value"])]),i("div",Ue,[i("label",Le,[o[12]||(o[12]=f("Laboratorio cl\xEDnico ")),t===0&&e.accion===e.acciones.nuevo?(r(),h(A,{key:0,class:"bg-white q-px-sm",outline:"",color:"grey-7",dense:"",flat:"",size:"sm","no-caps":"",rounded:"",unelevated:"",onClick:o[3]||(o[3]=()=>e.mostrarCambiarCanton=!e.mostrarCambiarCanton)},{default:m(()=>[n(g,{size:"12px",name:"bi-arrow-left-right",class:"q-mr-sm"}),o[11]||(o[11]=i("div",null,"Seleccionar otro cant\xF3n",-1))]),_:1})):c("",!0)]),n(_,{modelValue:a.laboratorio_clinico,"onUpdate:modelValue":[s=>a.laboratorio_clinico=s,s=>e.asignarLaboratorio(a.laboratorio_clinico,t)],options:e.listadosAuxiliares.laboratoriosClinicos,disable:e.disabled||e.esAutorizador,hint:t===0&&e.accion===e.acciones.nuevo?"Se autocompletar\xE1n los dem\xE1s laboratorios con el seleccionado aqu\xED":null,"transition-show":"scale","transition-hide":"scale","options-dense":"",dense:"",outlined:"","option-label":s=>s.nombre,"option-value":s=>s.id,"use-input":"","input-debounce":"0","emit-value":"","map-options":""},null,8,["modelValue","onUpdate:modelValue","options","disable","hint","option-label","option-value"])]),i("div",$e,[i("label",Fe,[o[14]||(o[14]=f("Fecha de asistencia ")),t===0?(r(),h(g,{key:0,name:"info",color:"grey"},{default:m(()=>[n(Q,{class:"bg-dark"},{default:m(()=>o[13]||(o[13]=[f(x("Se autocompletar\xE1n las dem\xE1s fechas con la seleccionada aqu\xED"))])),_:1})]),_:1})):c("",!0)]),n(C,{modelValue:a.fecha_asistencia,"onUpdate:modelValue":s=>a.fecha_asistencia=s,outlined:"",type:"datetime",disable:e.disabled,dense:""},{append:m(()=>[n(g,{name:"event",class:"cursor-pointer"},{default:m(()=>[n(de,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:m(()=>[n(re,{modelValue:a.fecha_asistencia,"onUpdate:modelValue":[s=>a.fecha_asistencia=s,s=>e.asignarFecha(a.fecha_asistencia,t)],mask:e.maskFecha,"today-btn":""},{default:m(()=>[i("div",Qe,[F(n(A,{label:"Cerrar",color:"primary",flat:""},null,512),[[me]])])]),_:2},1032,["modelValue","onUpdate:modelValue","mask"])]),_:2},1024)]),_:2},1024)]),_:2},1032,["modelValue","onUpdate:modelValue","disable"])]),i("div",Be,[i("label",Oe,[o[16]||(o[16]=f("Hora de asistencia ")),t===0?(r(),h(g,{key:0,name:"info",color:"grey"},{default:m(()=>[n(Q,{class:"bg-dark"},{default:m(()=>o[15]||(o[15]=[f(x("Se autocompletar\xE1n las dem\xE1s horas con la seleccionada aqu\xED"))])),_:1})]),_:1})):c("",!0)]),n(C,{modelValue:a.hora_asistencia,"onUpdate:modelValue":[s=>a.hora_asistencia=s,s=>e.asignarHora(a.hora_asistencia,t)],disable:e.disabled,type:"time",step:"1","stack-label":"",outlined:"",dense:""},null,8,["modelValue","onUpdate:modelValue","disable"])])]))),128)),i("div",Se,[i("div",De,[o[17]||(o[17]=i("label",{class:"q-mb-sm block"},"Observaci\xF3n del solicitante",-1)),n(C,{modelValue:e.solicitudExamen.observacion,"onUpdate:modelValue":o[4]||(o[4]=a=>e.solicitudExamen.observacion=a),disable:e.disabled||e.esAutorizador,outlined:"",dense:"",autogrow:""},null,8,["modelValue","disable"])])])])):c("",!0),e.empleado.id?(r(),u("div",Ne,[i("div",Pe,[n(g,{name:"bi-key"}),o[18]||(o[18]=f(" Autorizaci\xF3n "))]),i("div",Ie,[i("div",je,[o[19]||(o[19]=i("label",{class:"q-mb-sm block"},"Autorizador",-1)),n(_,{modelValue:e.solicitudExamen.autorizador,"onUpdate:modelValue":o[5]||(o[5]=a=>e.solicitudExamen.autorizador=a),options:e.listadosAuxiliares.autorizadores,disable:e.disabled||e.esAutorizador,"transition-show":"scale","transition-hide":"scale","options-dense":"",dense:"",outlined:"","option-label":a=>`${a.apellidos} ${a.nombres}`,"option-value":a=>a.id,"use-input":"","input-debounce":"0","emit-value":"","map-options":""},null,8,["modelValue","options","disable","option-label","option-value"])]),e.solicitudExamen.created_at?(r(),u("div",He,[o[20]||(o[20]=i("label",{class:"q-mb-sm block"},"Fecha de solicitud",-1)),n(C,{modelValue:e.solicitudExamen.created_at,"onUpdate:modelValue":o[6]||(o[6]=a=>e.solicitudExamen.created_at=a),dense:"",outlined:"",disable:""},null,8,["modelValue"])])):c("",!0),e.esAutorizador||e.accion===e.acciones.consultar?(r(),u("div",Te,[o[21]||(o[21]=i("label",{class:"q-mb-sm block text-positive text-bold"},"Autorizaci\xF3n",-1)),n(ue,{color:"grey-4"},{default:m(()=>[f(x(e.solicitudExamen.estado_solicitud_examen),1)]),_:1})])):c("",!0),e.solicitudExamen.created_at?(r(),u("div",Je,[o[22]||(o[22]=i("label",{class:"q-mb-sm block"},"Observaci\xF3n del autorizador",-1)),n(C,{modelValue:e.solicitudExamen.observacion_autorizador,"onUpdate:modelValue":o[7]||(o[7]=a=>e.solicitudExamen.observacion_autorizador=a),disable:"",outlined:"",dense:"",autogrow:""},null,8,["modelValue"])])):c("",!0)])])):c("",!0)])}var mo=ae(Ve,[["render",Ge]]);export{Ce as E,mo as F,no as S,ro as a};
