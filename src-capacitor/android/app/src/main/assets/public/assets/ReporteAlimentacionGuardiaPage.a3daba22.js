import{c as me,p as fe,be as pe,e as v,U as ce,f as be,E as ve,s as ge,w as H,A as ye,t as we,bH as qe,v as Qe,y as r,S as V,H as o,D as e,bf as g,B as t,bg as Ve,F as u,G as n,z as m,L as h,K,k as W,R as k,aa as X,Q as T,M as f,I as _,J as F}from"./index.976e8f3c.js";import{Q as P,a as p}from"./QSelect.a8f2bfb2.js";import{Q as x,a as ee,C as ae}from"./QPopupProxy.d8ef7a42.js";import{a as oe}from"./QToolbar.cff7174f.js";import{Q as he}from"./QBtnGroup.7d0835e4.js";import{Q as z,a as c}from"./QItemSection.c6f2640c.js";import{Q as le}from"./QChip.334d746c.js";import{a as se,Q as R}from"./QTable.048b8be8.js";import{Q as te}from"./QBadge.1ddeabfd.js";import{Q as ke}from"./QExpansionItem.558e637e.js";import{Q as Ce}from"./QPage.ed5d79ca.js";import{Q as ze,a as De}from"./QLayout.732b3e1b.js";import{M as Ae}from"./ModalEntidad.84100166.js";import{u as Oe,v as Re,A as Ne}from"./utils.30e08aa2.js";import{C as Ue}from"./ContenedorSimpleMixin.5a0b06ab.js";import{u as Se}from"./filtrosListadosGenerales.31e9eb2c.js";import{a as je,B as Ee}from"./Bitacora.e93a1ffa.js";import{Z as Ie}from"./ZonaController.fdd7c7d0.js";import"./QMenu.410ae527.js";import"./position-engine.2f1d750c.js";import"./format.8ac60962.js";import"./use-fullscreen.0ccd26e6.js";import"./QScrollObserver.cb4b92b2.js";import"./QResizeObserver.6ec10d95.js";import"./configuracion_general.ef04b031.js";import"./ConfiguracionController.65de3fc5.js";import"./entidadAuditable.75a46700.js";var Te=me({components:{ModalEntidad:Ae},setup(){const l=fe();pe().setQuasar(l),Oe().setQuasar(l);const a=v(!1),N=v(!1),U=v(!1),D=v("-"),S=v(0),s=v(!1),i=v([]),{notificarError:w,notificarAdvertencia:q}=ce(),b=be({empleado:null,zona:null,jornada:null,fecha_inicio:"",fecha_fin:"",accion:""}),A=v([]),re=[{name:"fecha",label:"Fecha",align:"left",field:"fecha",sortable:!0},{name:"zona",label:"Zona",align:"left",field:"zona",sortable:!0},{name:"jornadas",label:"Jornadas",align:"left",field:"jornadas"},{name:"monto",label:"Monto",align:"right",field:"monto",sortable:!0}],B=v([]),M=new Ue(je,new Ee),{listadosAuxiliares:j}=M.useReferencias(),{obtenerListados:ne,cargarVista:ie}=M.useComportamiento(),{empleados:Z,filtrarEmpleados:de}=Se(j);ie(async()=>{await ne({empleados:new ve,zonas:new Ie}),b.fecha_fin=Re(ge),Z.value=j.empleados.filter(d=>d.roles?d.roles.split(",").map(O=>O.trim().toUpperCase()).includes("GUARDIA"):!1),B.value=j.zonas}),H(N,d=>{d?b.empleado=null:b.jornada=null}),H(U,d=>{d?b.empleado=null:b.zona=null});async function ue(d){var E,O,$,J,G,L,Y;a.value=!0;try{const y=ye.getInstance();let C=y.getEndpoint(we.bitacoras)+"/reportes";const I="reporte_alimentacion_guardia";if(b.accion=d,d==="excel"||d==="pdf"){C=qe.URL_BASE+C,await Ne(C,"POST","blob",d==="excel"?"xlsx":"pdf",I,b);return}const Q=(await y.post(C,b)).data;s.value=((E=Q.total)==null?void 0:E.guardia)==="TODOS",s.value?(i.value=Q.detalle||[],A.value=[],D.value="TODOS"):(A.value=Q.detalle||[],i.value=[],D.value=((O=Q.total)==null?void 0:O.guardia)||Q.guardia||"-"),S.value=s.value?(J=($=Q.total)==null?void 0:$.monto_total)!=null?J:0:(G=Q.monto_total)!=null?G:0,(!s.value&&A.value.length<1||s.value&&i.value.length<1)&&q("No se encontraron registros para los filtros ingresados.")}catch(y){if(((L=y.response)==null?void 0:L.status)===422){const C=y.response.data.errors,I=Object.values(C).flat();q(I.join(`
`))}else((Y=y.response)==null?void 0:Y.status)===404?q(y.response.data.message||"No se encontraron resultados"):(console.error("Error inesperado:",y),w("Ocurri\xF3 un error inesperado al generar el reporte"))}finally{a.value=!1}}return{filtros:b,listado:A,columnasDetalle:re,empleados:Z,zonas:B,mostrarJornada:N,mostrarZona:U,resumenGuardia:D,totalMonto:S,buscarReporte:ue,filtrarEmpleados:de,mostrarVarios:s,guardiasDetalle:i}}});const _e={class:"q-pa-md"},Fe={class:"text-h6 text-bold text-warning flex items-center"},Pe={class:"row q-col-gutter-sm q-pa-sm q-py-md"},Be={key:0,class:"col-12 col-md-4"},Me={class:"col-12 col-md-2"},Ze={class:"row items-center justify-end"},$e={class:"col-12 col-md-2"},Je={class:"row items-center justify-end"},Ge={key:1,class:"col-12 col-md-2"},Le={key:2,class:"col-12 col-md-2"},Ye={class:"q-mb-sm block row items-center justify-between"},He={key:3,class:"col-12 col-md-2"},Ke={key:4,class:"col-12 col-md-2"},We={class:"q-mb-sm block row items-center justify-between"},Xe={class:"col-12 col-md-12 q-mt-md"},xe={class:"text-center"},ea={class:"row q-col-gutter-md"},aa={key:0,class:"col-12 col-md-4"},oa={key:1,class:"col-12 col-md-4"},la={key:2,class:"col-12 col-md-4"},sa={class:"col-12 col-md-4"},ta={class:"col-12 col-md-4"};function ra(l,a,N,U,D,S){return r(),V(De,null,{default:o(()=>[e(ze,null,{default:o(()=>[e(Ce,{padding:""},{default:o(()=>[e(g,null,{default:o(()=>[t("div",_e,[e(Ve,{class:"q-px-lg q-pt-lg q-pb-sm"},{default:o(()=>[t("div",Fe,[e(u,{name:"assignment",class:"q-mr-sm"}),a[14]||(a[14]=n(" Reporte de Alimentaci\xF3n de Guardias "))])]),_:1}),t("div",Pe,[!l.mostrarZona&&!l.mostrarJornada?(r(),m("div",Be,[a[15]||(a[15]=t("label",{class:"q-mb-sm block"},"Seleccione un guardia",-1)),e(P,{modelValue:l.filtros.empleado,"onUpdate:modelValue":a[0]||(a[0]=s=>l.filtros.empleado=s),options:l.empleados,"transition-show":"scale","transition-hide":"scale","options-dense":"",dense:"",outlined:"","use-input":"","input-debounce":"0","option-label":s=>s.apellidos+" "+s.nombres,"option-value":s=>s.id,"emit-value":"","map-options":""},null,8,["modelValue","options","option-label","option-value"])])):h("",!0),t("div",Me,[a[16]||(a[16]=t("label",{class:"q-mb-sm block"},"Fecha de inicio",-1)),e(K,{modelValue:l.filtros.fecha_inicio,"onUpdate:modelValue":a[2]||(a[2]=s=>l.filtros.fecha_inicio=s),placeholder:"Obligatorio",outlined:"",dense:""},{append:o(()=>[e(u,{name:"event",class:"cursor-pointer"},{default:o(()=>[e(x,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:o(()=>[e(ee,{modelValue:l.filtros.fecha_inicio,"onUpdate:modelValue":a[1]||(a[1]=s=>l.filtros.fecha_inicio=s),mask:"YYYY-MM-DD","today-btn":""},{default:o(()=>[t("div",Ze,[W(e(k,{label:"Cerrar",color:"primary",flat:""},null,512),[[ae]])])]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),t("div",$e,[a[17]||(a[17]=t("label",{class:"q-mb-sm block"},"Fecha fin",-1)),e(K,{modelValue:l.filtros.fecha_fin,"onUpdate:modelValue":a[4]||(a[4]=s=>l.filtros.fecha_fin=s),placeholder:"Opcional",outlined:"",dense:""},{append:o(()=>[e(u,{name:"event",class:"cursor-pointer"},{default:o(()=>[e(x,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:o(()=>[e(ee,{modelValue:l.filtros.fecha_fin,"onUpdate:modelValue":a[3]||(a[3]=s=>l.filtros.fecha_fin=s),mask:"YYYY-MM-DD","today-btn":""},{default:o(()=>[t("div",Je,[W(e(k,{label:"Cerrar",color:"primary",flat:""},null,512),[[ae]])])]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),l.mostrarZona?(r(),m("div",Le,[t("label",Ye,[a[20]||(a[20]=t("span",null,"Seleccione una zona",-1)),e(k,{flat:"",dense:"",round:"",size:"sm",icon:"close",color:"red",onClick:a[6]||(a[6]=()=>{l.mostrarZona=!1,l.filtros.zona=null})},{default:o(()=>[e(oe,null,{default:o(()=>a[19]||(a[19]=[n("Quitar Filtro de Zona")])),_:1})]),_:1})]),e(P,{modelValue:l.filtros.zona,"onUpdate:modelValue":a[7]||(a[7]=s=>l.filtros.zona=s),options:l.zonas,"transition-show":"scale","transition-hide":"scale","options-dense":"",dense:"",outlined:"",label:"Opcional","option-label":s=>s.nombre,"option-value":s=>s.id,"emit-value":"","map-options":""},null,8,["modelValue","options","option-label","option-value"])])):(r(),m("div",Ge,[a[18]||(a[18]=t("label",{class:"q-mb-sm block"},"\xBFFiltrar por zona?",-1)),e(X,{modelValue:l.mostrarZona,"onUpdate:modelValue":a[5]||(a[5]=s=>l.mostrarZona=s),color:"primary",dense:"","left-label":""},null,8,["modelValue"])])),l.mostrarJornada?(r(),m("div",Ke,[t("label",We,[a[23]||(a[23]=t("span",null,"Seleccione jornada",-1)),e(k,{flat:"",dense:"",round:"",size:"sm",icon:"close",color:"red",onClick:a[9]||(a[9]=()=>{l.mostrarJornada=!1,l.filtros.jornada=null})},{default:o(()=>[e(oe,null,{default:o(()=>a[22]||(a[22]=[n("Eliminar jornada")])),_:1})]),_:1})]),e(P,{modelValue:l.filtros.jornada,"onUpdate:modelValue":a[10]||(a[10]=s=>l.filtros.jornada=s),options:["DIURNA","NOCTURNA"],"transition-show":"scale","transition-hide":"scale","options-dense":"",dense:"",outlined:"",label:"Opcional"},null,8,["modelValue"])])):(r(),m("div",He,[a[21]||(a[21]=t("label",{class:"q-mb-sm block"},"\xBFFiltrar por jornada?",-1)),e(X,{modelValue:l.mostrarJornada,"onUpdate:modelValue":a[8]||(a[8]=s=>l.mostrarJornada=s),color:"primary",dense:"","left-label":""},null,8,["modelValue"])])),t("div",Xe,[t("div",xe,[e(he,{push:""},{default:o(()=>[e(k,{color:"primary",class:"full-width","no-caps":"","no-wrap":"",push:"",glossy:"",onClick:a[11]||(a[11]=s=>l.buscarReporte("consulta"))},{default:o(()=>[e(u,{name:"bi-search",size:"xs",class:"q-pr-sm"}),a[24]||(a[24]=t("span",null,"Consultar",-1))]),_:1}),e(k,{color:"positive",class:"full-width","no-caps":"","no-wrap":"",push:"",glossy:"",onClick:a[12]||(a[12]=s=>l.buscarReporte("excel"))},{default:o(()=>[e(u,{name:"bi-file-earmark-excel-fill",size:"xs",class:"q-mr-sm"}),a[25]||(a[25]=t("span",null,"Excel",-1))]),_:1}),e(k,{color:"negative",class:"full-width","no-caps":"","no-wrap":"",push:"",glossy:"",onClick:a[13]||(a[13]=s=>l.buscarReporte("pdf"))},{default:o(()=>[e(u,{name:"bi-file-earmark-pdf-fill",size:"xs",class:"q-mr-sm"}),a[26]||(a[26]=t("span",null,"PDF",-1))]),_:1})]),_:1})])])])])]),_:1}),!l.mostrarVarios&&l.listado.length>0||l.mostrarVarios?(r(),V(g,{key:0,class:"q-mt-md q-pa-md"},{default:o(()=>[a[32]||(a[32]=t("div",{class:"text-h6 text-primary"},"Resumen general",-1)),e(T,{class:"q-my-sm"}),t("div",ea,[l.mostrarVarios?h("",!0):(r(),m("div",aa,[e(g,{flat:"",bordered:"",class:"q-pa-md full-height",style:{height:"100%"}},{default:o(()=>[e(z,null,{default:o(()=>[e(c,{avatar:""},{default:o(()=>[e(u,{name:"person",size:"md",color:"primary"})]),_:1}),e(c,null,{default:o(()=>[e(p,{class:"text-subtitle2"},{default:o(()=>[n(f(l.resumenGuardia),1)]),_:1}),e(p,{caption:""},{default:o(()=>a[27]||(a[27]=[n("GUARDIA DE SEGURIDAD")])),_:1})]),_:1})]),_:1})]),_:1})])),l.mostrarZona&&l.filtros.zona?(r(),m("div",oa,[e(g,{flat:"",bordered:"",class:"q-pa-md full-height",style:{height:"100%"}},{default:o(()=>[e(z,null,{default:o(()=>[e(c,{avatar:""},{default:o(()=>[e(u,{name:"map",size:"md",color:"primary"})]),_:1}),e(c,null,{default:o(()=>[e(p,{class:"text-subtitle2"},{default:o(()=>{var s;return[n(f(((s=l.zonas.find(i=>i.id===l.filtros.zona))==null?void 0:s.nombre)||"-"),1)]}),_:1}),e(p,{caption:""},{default:o(()=>a[28]||(a[28]=[n("ZONA")])),_:1})]),_:1})]),_:1})]),_:1})])):h("",!0),l.mostrarJornada&&l.filtros.jornada?(r(),m("div",la,[e(g,{flat:"",bordered:"",class:"q-pa-md full-height",style:{height:"100%"}},{default:o(()=>[e(z,null,{default:o(()=>[e(c,{avatar:""},{default:o(()=>[e(u,{name:"schedule",size:"md",color:"primary"})]),_:1}),e(c,null,{default:o(()=>[e(p,{class:"text-subtitle2"},{default:o(()=>[n(f(l.filtros.jornada),1)]),_:1}),e(p,{caption:""},{default:o(()=>a[29]||(a[29]=[n("JORNADA")])),_:1})]),_:1})]),_:1})]),_:1})])):h("",!0),t("div",sa,[e(g,{flat:"",bordered:"",class:"q-pa-md full-height",style:{height:"100%"}},{default:o(()=>[e(z,null,{default:o(()=>[e(c,{avatar:""},{default:o(()=>[e(u,{name:"event",size:"md",color:"primary"})]),_:1}),e(c,null,{default:o(()=>[e(p,{class:"text-subtitle1"},{default:o(()=>[n(f(l.filtros.fecha_inicio)+" al "+f(l.filtros.fecha_fin),1)]),_:1}),e(p,{caption:""},{default:o(()=>a[30]||(a[30]=[n("PERIODO")])),_:1})]),_:1})]),_:1})]),_:1})]),t("div",ta,[e(g,{flat:"",bordered:"",class:"q-pa-md full-height",style:{height:"100%"}},{default:o(()=>[e(z,null,{default:o(()=>[e(c,{avatar:""},{default:o(()=>[e(u,{name:"attach_money",size:"md",color:"primary"})]),_:1}),e(c,null,{default:o(()=>[e(p,{class:"text-subtitle1"},{default:o(()=>[n(" $"+f(l.totalMonto)+".00 ",1)]),_:1}),e(p,{caption:""},{default:o(()=>a[31]||(a[31]=[n("TOTAL DE ALIMENTACION")])),_:1})]),_:1})]),_:1})]),_:1})])])]),_:1})):h("",!0),!l.mostrarVarios&&l.listado.length>0?(r(),V(g,{key:1,class:"q-mt-md q-pa-md",flat:"",bordered:""},{default:o(()=>[a[33]||(a[33]=t("div",{class:"text-h6 text-primary"},"Detalle por d\xEDa",-1)),e(T,{class:"q-my-sm"}),e(se,{rows:l.listado,columns:l.columnasDetalle,"row-key":"fecha",dense:"",flat:"",bordered:"",class:"q-mb-md",pagination:{rowsPerPage:5}},{"body-cell-jornadas":o(s=>[e(R,{props:s},{default:o(()=>[(r(!0),m(_,null,F(s.value,i=>(r(),V(le,{key:i,dense:"",color:i==="NOCTURNA"?"indigo-7":"amber-7","text-color":"white",class:"q-mr-xs",icon:"schedule"},{default:o(()=>[n(f(i),1)]),_:2},1032,["color"]))),128))]),_:2},1032,["props"])]),"body-cell-monto":o(s=>[e(R,{props:s},{default:o(()=>[e(te,{color:"green-6"},{default:o(()=>[n("$"+f(s.value),1)]),_:2},1024)]),_:2},1032,["props"])]),_:1},8,["rows","columns"])]),_:1})):h("",!0),l.mostrarVarios?(r(),V(g,{key:2,class:"q-mt-md q-pa-md",flat:"",bordered:""},{default:o(()=>[a[34]||(a[34]=t("div",{class:"text-h6 text-primary"},"Detalle por guardia",-1)),e(T,{class:"q-my-sm"}),(r(!0),m(_,null,F(l.guardiasDetalle,(s,i)=>(r(),V(ke,{key:i,label:s.guardia,caption:"Total alimentaci\xF3n: $"+s.monto_total,"expand-separator":"","header-class":"bg-grey-1 text-bold"},{default:o(()=>[e(se,{rows:s.detalle,columns:l.columnasDetalle,"row-key":"fecha",dense:"",flat:"",bordered:"",class:"q-mb-md",pagination:{rowsPerPage:5}},{"body-cell-jornadas":o(w=>[e(R,{props:w},{default:o(()=>[(r(!0),m(_,null,F(w.value,q=>(r(),V(le,{key:q,dense:"",color:q==="NOCTURNA"?"indigo-7":"amber-7","text-color":"white",class:"q-mr-xs",icon:"schedule"},{default:o(()=>[n(f(q),1)]),_:2},1032,["color"]))),128))]),_:2},1032,["props"])]),"body-cell-monto":o(w=>[e(R,{props:w},{default:o(()=>[e(te,{color:"green-6"},{default:o(()=>[n("$"+f(w.value),1)]),_:2},1024)]),_:2},1032,["props"])]),_:2},1032,["rows","columns"])]),_:2},1032,["label","caption"]))),128))]),_:1})):h("",!0)]),_:1})]),_:1})]),_:1})}var Ia=Qe(Te,[["render",ra]]);export{Ia as default};
