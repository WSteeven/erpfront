var me=Object.defineProperty;var ue=(e,i,r)=>i in e?me(e,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[i]=r;var t=(e,i,r)=>(ue(e,typeof i!="symbol"?i+"":i,r),r);import{Q as F,a as L}from"./QItemSection.9a955ec6.js";import{Q as N}from"./QSelect.6ce302d7.js";import{bw as J,s as E,d as pe,u as fe,c as f,f as P,cR as be,a1 as Q,q as I,dA as ve,_ as _e,t as O,v as d,P as he,F as s,z as n,a4 as ge,y as a,x as m,G as _,H as h,K as g,D as T,I as V,B as U,j as S,O as z,J as Ve}from"./index.6449c167.js";import{Q as M,a as Y,C as R}from"./QPopupProxy.72ff1d6d.js";import{Q as $e}from"./QForm.ca56f146.js";import{r as $}from"./i18n-validators.29e2545c.js";import{u as ye}from"./index.490dde02.js";import{T as je}from"./TabLayoutFilterTabs2.5e702525.js";import{G as Ee}from"./GestorDocumentos.59a805e5.js";import{S as Ce}from"./EssentialTable.00c17e97.js";import{C as H}from"./ContenedorSimpleMixin.09c9bed5.js";import{E as ke}from"./entidadAuditable.75a46700.js";import{a as we,O as G,H as De,A as Ae,x as qe}from"./utils.521b98f3.js";import{A as Be}from"./Archivo.c26f5472.js";import{T as Fe}from"./TipoLicenciaController.760cd373.js";import"./QChip.95469f73.js";import"./position-engine.70d0a89f.js";import"./format.8ac60962.js";import"./index.0198dd12.js";import"./QTabs.6c234f27.js";import"./QResizeObserver.9af84680.js";import"./QTabPanels.49d2362a.js";import"./touch.9135741d.js";import"./QPage.5d173a8a.js";import"./EssentialTableTabs.586dbdfc.js";import"./QBadge.e6f320cd.js";import"./EssentialTablePagination.d5c1010a.js";import"./QToolbar.8dbe891b.js";import"./use-fullscreen.a7661f85.js";import"./buttonSubmits.fe817da3.js";import"./QUploader.cca1b7bd.js";import"./QCircularProgress.b24a7ee9.js";import"./QFile.90d9394a.js";import"./_commonjsHelpers.8402d862.js";import"./QImg.fd079679.js";import"./VisorImagen.75b3c53f.js";import"./logo.4781eea2.js";import"./seleccionContratacionPersonal.utils.e3e1ed3d.js";const Le=[{name:"justificacion",field:"justificacion",label:"Juatificacion",align:"left",sortable:!0},{name:"estado_licencia_info",field:"estado_licencia_info",label:"Estado",align:"left",sortable:!0},{name:"fecha_inicio",field:"fecha_inicio",label:"Inicio",align:"left",sortable:!0},{name:"fecha_fin",field:"fecha_fin",label:"Fin",align:"left",sortable:!0},{name:"empleado_info",field:"empleado_info",label:"Empleado",align:"left",sortable:!0}];class Ne extends J{constructor(){super(E.licencia_empleado)}}class Pe extends ke{constructor(){super();t(this,"id");t(this,"empleado");t(this,"empleado_info");t(this,"tipo_licencia");t(this,"tipo_licencia_info");t(this,"estado");t(this,"estado_licencia_info");t(this,"fecha_inicio");t(this,"fecha_fin");t(this,"justificacion");t(this,"id_jefe_inmediato");t(this,"jefe_inmediato");t(this,"documento");t(this,"tieneDocumento");t(this,"dias_licencia");this.id=null,this.empleado=null,this.empleado_info=null,this.fecha_inicio=null,this.fecha_fin=null,this.tipo_licencia=null,this.tipo_licencia_info=null,this.estado=null,this.estado_licencia_info=null,this.justificacion=null,this.id_jefe_inmediato=null,this.jefe_inmediato=null,this.documento=null,this.tieneDocumento=null,this.dias_licencia=null}}class Qe extends J{constructor(){super(E.archivo_licencia_empleado)}}var Ie=pe({components:{TabLayoutFilterTabs2:je,SelectorImagen:Ce,GestorDocumentos:Ee},emits:["cerrar-modal"],setup(e,{emit:i}){const r=new H(Pe,new Ne),C=new H(Be,new Qe),{entidad:l,disabled:k,accion:b,listadosAuxiliares:p}=r.useReferencias(),{setValidador:o,cargarVista:K,obtenerListados:W,listar:X}=r.useComportamiento(),{onBeforeGuardar:Z,onConsultado:x,onGuardado:ee,onBeforeModificar:ie,onReestablecer:oe}=r.useHooks(),v=fe(),{notificarAdvertencia:ae}=we(),w=f([]),u=f(),D=f(),se=v.esRecursosHumanos;let A="1";const q=f(!1),y=f(!1),ne=P(()=>v.can("puede.ver.campo.empleado")),le=P(()=>b.value==="NUEVO");function te(){const c=p.tipos_licencias.filter(j=>j.id==l.tipo_licencia);c[0].num_dias>0?(l.dias_licencia=c[0].num_dias,y.value=!0):(l.dias_licencia=null,l.fecha_fin=null,y.value=!1)}Z(()=>{l.tieneDocumento=u.value.tamanioListado>0,l.tieneDocumento||ae("Debe seleccionar al menos un archivo.")}),ie(()=>{l.tieneDocumento=!0}),ee(c=>{re(c),i("cerrar-modal")}),x(()=>{q.value=v.user.id==l.id_jefe_inmediato,setTimeout(()=>{u.value.listarArchivos({licencia_id:l.id}),u.value.esConsultado=!0},2e3)}),oe(()=>{setTimeout(()=>{u.value.limpiarListado(),u.value.esConsultado=!1},1e3)}),K(async()=>{await W({tipos_licencias:new Fe,autorizaciones:{controller:new be,params:{campos:"id,nombre",es_modulo_rhh:!0,es_jefe_inmediato:v.user.id==l.id_jefe_inmediato}}}),w.value=p.tipos_licencias,D.value=p.autorizaciones});const B=ye({tipo_licencia:{required:$},fecha_inicio:{required:$},fecha_fin:{required:$},justificacion:{required:$}},l);o(B.value);async function re(c){await u.value.subir({licencia_id:c})}function ce(c){X({estado:c}),A=c}Q(()=>{l.fecha_inicio&&l.dias_licencia&&(l.fecha_fin=G(De(l.fecha_inicio,"DD-MM-YYYY"),0,0,Number(l.dias_licencia),I))});function de(c){const j=G(qe(),0,0,-15,"YYYY/MM/DD");return c>=j}return{removeAccents:Ae,mixin:r,licencia:l,optionsFechaInicio:de,filtrarPermisoEmpleado:ce,watchEffect:Q,es_jefe_inmediato:q,esRecursosHumanos:se,esNuevo:le,verEmpleado:ne,refArchivoPrestamoEmpresarial:u,mixinArchivoPrestamoEmpleado:C,endpoint:E.archivo_licencia_empleado,tipos_licencias:w,tiene_dias_licencia:y,obtenerDiasLicencia:te,tabPermisoEmpleado:A,autorizaciones:D,accion:b,maskFecha:I,v$:B,disabled:k,tabOptionsLicencias:ve,configuracionColumnas:Le}}});const Oe={class:"row q-col-gutter-sm q-mb-md q-mt-md q-mx-md q-py-sm"},Te={class:"col-12 col-md-3 q-mb-md"},Ue={class:"error-msg"},Se={class:"col-12 col-md-3"},ze={class:"row items-center justify-end"},Me={class:"error-msg"},Ye={class:"col-12 col-md-3"},Re={class:"row items-center justify-end"},He={class:"error-msg"},Ge={class:"col-12 col-md-3"},Je={class:"error-msg"},Ke={class:"col-12 col-md-3"},We={class:"col-12 col-md-3"},Xe={key:0,class:"col-12 col-md-3"};function Ze(e,i,r,C,l,k){const b=O("gestor-documentos"),p=O("tab-layout-filter-tabs2");return d(),he(p,{mixin:e.mixin,configuracionColumnas:e.configuracionColumnas,tabOptions:e.tabOptionsLicencias,full:!0,permitirEditar:!e.esRecursosHumanos,permitirEliminar:!1,mostrarButtonSubmits:!0,filtrar:e.filtrarPermisoEmpleado,tabDefecto:e.tabPermisoEmpleado,forzarListar:!0},{formulario:s(()=>[n($e,{onSubmit:i[9]||(i[9]=ge(()=>{},["prevent"]))},{default:s(()=>[a("div",Oe,[a("div",Te,[i[11]||(i[11]=a("label",{class:"q-mb-sm block"},"Tipo",-1)),n(N,{modelValue:e.licencia.tipo_licencia,"onUpdate:modelValue":[i[0]||(i[0]=o=>e.licencia.tipo_licencia=o),e.obtenerDiasLicencia],options:e.tipos_licencias,"transition-show":"jump-up","transition-hide":"jump-down",disable:!e.esNuevo,"options-dense":"",dense:"",outlined:"","input-debounce":0,"use-input":"","option-value":o=>o.id,"option-label":o=>o.nombre,"emit-value":"","map-options":""},{error:s(()=>[(d(!0),m(_,null,h(e.v$.tipo_licencia.$errors,o=>(d(),m("div",{key:o.$uid},[a("div",Ue,g(o.$message),1)]))),128))]),"no-option":s(()=>[n(F,null,{default:s(()=>[n(L,{class:"text-grey"},{default:s(()=>i[10]||(i[10]=[T(" No hay resultados ")])),_:1})]),_:1})]),_:1},8,["modelValue","options","disable","onUpdate:modelValue","option-value","option-label"])]),a("div",Se,[i[12]||(i[12]=a("label",{class:"q-mb-sm block"},"Fecha Inicio",-1)),n(V,{modelValue:e.licencia.fecha_inicio,"onUpdate:modelValue":i[2]||(i[2]=o=>e.licencia.fecha_inicio=o),placeholder:"Obligatorio",error:!!e.v$.fecha_inicio.$errors.length,disable:!e.esNuevo,onBlur:e.v$.fecha_inicio.$touch,readonly:"",outlined:"",dense:""},{append:s(()=>[n(U,{name:"event",class:"cursor-pointer"},{default:s(()=>[n(M,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:s(()=>[n(Y,{modelValue:e.licencia.fecha_inicio,"onUpdate:modelValue":i[1]||(i[1]=o=>e.licencia.fecha_inicio=o),mask:e.maskFecha,options:e.optionsFechaInicio,"today-btn":""},{default:s(()=>[a("div",ze,[S(n(z,{label:"Cerrar",color:"primary",flat:""},null,512),[[R]])])]),_:1},8,["modelValue","mask","options"])]),_:1})]),_:1})]),error:s(()=>[(d(!0),m(_,null,h(e.v$.fecha_inicio.$errors,o=>(d(),m("div",{key:o.$uid},[a("div",Me,g(o.$message),1)]))),128))]),_:1},8,["modelValue","error","disable","onBlur"])]),a("div",Ye,[i[13]||(i[13]=a("label",{class:"q-mb-sm block"},"Fecha Fin",-1)),n(V,{modelValue:e.licencia.fecha_fin,"onUpdate:modelValue":i[4]||(i[4]=o=>e.licencia.fecha_fin=o),placeholder:"Obligatorio",error:!!e.v$.fecha_fin.$errors.length,disable:!1,onBlur:e.v$.fecha_fin.$touch,outlined:"",dense:""},{append:s(()=>[n(U,{name:"event",class:"cursor-pointer"},{default:s(()=>[n(M,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:s(()=>[n(Y,{modelValue:e.licencia.fecha_fin,"onUpdate:modelValue":i[3]||(i[3]=o=>e.licencia.fecha_fin=o),mask:e.maskFecha,"today-btn":""},{default:s(()=>[a("div",Re,[S(n(z,{label:"Cerrar",color:"primary",flat:""},null,512),[[R]])])]),_:1},8,["modelValue","mask"])]),_:1})]),_:1})]),error:s(()=>[(d(!0),m(_,null,h(e.v$.fecha_fin.$errors,o=>(d(),m("div",{key:o.$uid},[a("div",He,g(o.$message),1)]))),128))]),_:1},8,["modelValue","error","onBlur"]),i[14]||(i[14]=a("div",{class:"q-gutter-md row items-start"},null,-1))]),a("div",Ge,[i[15]||(i[15]=a("label",{class:"q-mb-sm block"},"Justificativo",-1)),n(V,{modelValue:e.licencia.justificacion,"onUpdate:modelValue":[i[5]||(i[5]=o=>e.licencia.justificacion=o),i[6]||(i[6]=o=>e.licencia.justificacion=e.removeAccents(o))],placeholder:"Obligatorio",disable:!e.esNuevo,error:!!e.v$.justificacion.$errors.length,outlined:"",dense:""},{error:s(()=>[(d(!0),m(_,null,h(e.v$.justificacion.$errors,o=>(d(),m("div",{key:o.$uid},[a("div",Je,g(o.$message),1)]))),128))]),_:1},8,["modelValue","disable","error"])]),a("div",Ke,[i[16]||(i[16]=a("label",{class:"q-mb-sm block"},"Documento",-1)),n(b,{ref:"refArchivoPrestamoEmpresarial",mixin:e.mixinArchivoPrestamoEmpleado,endpoint:e.endpoint,disable:!e.esNuevo,"permitir-eliminar":!1,"listar-al-guardar":!1,esMultiple:!1},null,8,["mixin","endpoint","disable"])]),a("div",We,[i[17]||(i[17]=a("label",{class:"q-mb-sm block"},"Dias de licencia",-1)),n(V,{modelValue:e.licencia.dias_licencia,"onUpdate:modelValue":i[7]||(i[7]=o=>e.licencia.dias_licencia=o),placeholder:"Obligatorio",disable:e.tiene_dias_licencia,onBlur:e.v$.fecha_fin.$touch,outlined:"",dense:""},null,8,["modelValue","disable","onBlur"])]),e.accion=="EDITAR"&&e.es_jefe_inmediato?(d(),m("div",Xe,[i[19]||(i[19]=a("label",{class:"q-mb-sm block"},"Autorizacion",-1)),n(N,{modelValue:e.licencia.estado,"onUpdate:modelValue":i[8]||(i[8]=o=>e.licencia.estado=o),options:e.autorizaciones,"transition-show":"jump-up","transition-hide":"jump-down","options-dense":"",dense:"",outlined:"",disable:e.disabled,readonly:e.disabled,"use-input":"","input-debounce":"0","option-value":o=>o.id,"option-label":o=>o.nombre,"emit-value":"","map-options":""},{"no-option":s(()=>[n(F,null,{default:s(()=>[n(L,{class:"text-grey"},{default:s(()=>i[18]||(i[18]=[T(" No hay resultados ")])),_:1})]),_:1})]),_:1},8,["modelValue","options","disable","readonly","option-value","option-label"])])):Ve("",!0)])]),_:1})]),_:1},8,["mixin","configuracionColumnas","tabOptions","permitirEditar","filtrar","tabDefecto"])}var Ti=_e(Ie,[["render",Ze]]);export{Ti as default};
