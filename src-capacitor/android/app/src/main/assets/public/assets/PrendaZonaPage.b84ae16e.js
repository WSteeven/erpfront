var ye=Object.defineProperty;var De=(e,o,c)=>o in e?ye(e,o,{enumerable:!0,configurable:!0,writable:!0,value:c}):e[o]=c;var d=(e,o,c)=>(De(e,typeof o!="symbol"?o+"":o,c),c);import{Q as $,a as R}from"./QItemSection.c6f2640c.js";import{a as h}from"./QToolbar.cff7174f.js";import{e as E,bz as T,t as _,c as Be,be as Ve,p as ke,U as Ae,g as Le,f as $e,bA as H,A as O,v as Re,x as M,y as q,S as G,H as r,D as s,B as l,G as z,R as S,M as J,z as Q,I as Me,J as Qe,F as Z,L as W,K as X,a5 as Y,k as Fe,b3 as Te}from"./index.976e8f3c.js";import{Q as F}from"./QSelect.a8f2bfb2.js";import{Q as je}from"./QBtnToggle.8d809b19.js";import{Q as x}from"./QExpansionItem.558e637e.js";import{c as Ie,a as Ne}from"./configuracionColumnasDetallesModal.0b76e70c.js";import{c as Ue}from"./configuracionColumnasEmpleadosLite.5961fbe8.js";import{c as Ke}from"./configuracionColumnasEmpleadoDesignado.41f10aaf.js";import{u as he}from"./selector.b9804ebb.js";import{u as He}from"./filtrosListadosGenerales.31e9eb2c.js";import{r as Oe}from"./i18n-validators.06eef631.js";import{s as Ge}from"./utils.30e08aa2.js";import{u as Je}from"./index.ed676411.js";import{i as We}from"./iconos.5bc406be.js";import{E as Xe}from"./EssentialSelectableTable.001f5242.js";import{T as Ye}from"./TabLayout.d6dcc414.js";import{E as xe}from"./EssentialTable.d8e6954a.js";import{u as eo}from"./useOrquestadorSelectorEmpleados.8099bd32.js";import{C as ee}from"./ContenedorSimpleMixin.5a0b06ab.js";import{F as oo,u as ao}from"./FiltroMiBodegaEmpleado.020f4a2d.js";import{Z as oe}from"./ZonaController.fdd7c7d0.js";import{E as ae}from"./entidadAuditable.75a46700.js";import"./position-engine.2f1d750c.js";import"./QChip.334d746c.js";import"./QMenu.410ae527.js";import"./format.8ac60962.js";import"./QBtnGroup.7d0835e4.js";import"./SelectorController.62baf71e.js";import"./index.95f5a0db.js";import"./QTabs.3c726b04.js";import"./QResizeObserver.6ec10d95.js";import"./QTabPanels.1c8c4baa.js";import"./touch.9135741d.js";import"./QPopupProxy.d8ef7a42.js";import"./QPage.ed5d79ca.js";import"./buttonSubmits.2eb37d38.js";import"./EssentialTablePagination.f449a738.js";import"./QTable.048b8be8.js";import"./use-fullscreen.0ccd26e6.js";import"./QBadge.1ddeabfd.js";import"./QFile.e27868da.js";import"./_commonjsHelpers.8402d862.js";import"./QImg.e0fb285c.js";import"./VisorImagen.e7965569.js";import"./seleccionContratacionPersonal.utils.e3e1ed3d.js";import"./ErrorComponent.b482e77d.js";import"./ClienteMaterialEmpleadoController.fcdf149e.js";import"./listadoMaterialesDevolucion.5ce4073a.js";const so=[{name:"detalle_producto",field:"detalle_producto",label:"Prenda",align:"left",sortable:!0}],io=[{name:"zona",field:"zona",label:"Zona",align:"left"},{name:"tiene_restricciones",field:"tiene_restricciones",label:"Tiene restricciones",align:"left"}];function no(e,o){const c=E(),m=E([]),g=E(),P={refListadoSeleccionable:c,listadoSeleccionable:m,endpoint:o,limpiar:()=>{e.id=null,g.value=null},seleccionar:p=>{e.detalles_productos=[...e.detalles_productos,...p]}},u=he(P);return{refListadoSeleccionable:c,listado:m,listar:p=>u.listar(g.value,p),limpiar:()=>P.limpiar(),seleccionar:p=>{let t=[];t=e.detalles_productos.map(C=>C.id);const k=p.filter(C=>!t.includes(C.id));P.seleccionar(k)},criterioBusqueda:g}}class lo extends T{constructor(){super(_.restricciones_prendas_zonas)}}class ro extends T{constructor(){super(_.miembros_zonas)}}class to extends T{constructor(){super(_.prendas_zonas)}}class co extends ae{constructor(){super(...arguments);d(this,"detalle_producto",null);d(this,"detalle_producto_id",null);d(this,"miembro_zona",null);d(this,"miembro_zona_id",null)}}class uo extends ae{constructor(){super(...arguments);d(this,"zona",null);d(this,"detalles_productos",[]);d(this,"empleado_id",null);d(this,"cliente_id",null);d(this,"empleado_apellidos_nombres",null);d(this,"tiene_restricciones",!1);d(this,"miembro_zona",null)}}var mo=Be({components:{TabLayout:Ye,EssentialTable:xe,EssentialSelectableTable:Xe},setup(){Ve().setQuasar(ke());const e=new ee(uo,new to),{entidad:o,disabled:c,listadosAuxiliares:m,accion:g}=e.useReferencias(),{setValidador:P,cargarVista:u,obtenerListados:v}=e.useComportamiento(),{onReestablecer:y,onConsultado:a}=e.useHooks(),p=new ee(co,new lo),{listado:t}=p.useReferencias(),{listar:k,guardarListado:C,eliminarListado:j}=p.useComportamiento();u(async()=>{await v({zonas:{controller:new oe,params:{activo:1}},clientesMaterialesEmpleado:[],miembrosZona:[]})});const{confirmar:se,notificarAdvertencia:ie}=Ae(),D=E(),B=E(),w=E(),ne=Le(()=>o.detalles_productos.filter(i=>!t.value.some(n=>n.detalle_producto_id===i.id&&n.miembro_zona_id===o.miembro_zona)).map((i,n)=>({id:n,detalle_producto_id:i.id,detalle_producto:i.descripcion,miembro_zona_id:o.miembro_zona}))),le=({posicion:i})=>se("Esta operaci\xF3n es irreversible. \xBFDesea continuar?",async()=>{const n=o.detalles_productos.splice(i,1)[0],f=m.miembrosZona.filter(b=>!!b.tiene_restriccion).map(b=>({miembro_zona_id:b.id,detalle_producto_id:n.id}));if(console.log(f),f.length)await ue(f);else{const b=t.value.findIndex(_e=>_e.detalle_producto_id===n.id);t.value.splice(b,1)}}),{zonas:re,filtrarZonas:te}=He(m),A=$e(new oo),{consultarClientesMaterialesEmpleado:I}=ao(A,m),de=()=>{A.empleado_id=o.empleado_id,A.cliente_id=o.cliente_id},ce=async()=>{u(async()=>{await v({zonas:{controller:new oe,params:{activo:1}}})})},V=i=>{me(i),u(async()=>{await v({miembrosZona:{controller:new ro,params:{zona_id:i}}})})},ue=async i=>{const n=O.getInstance();await n.delete(n.getEndpoint(_.restricciones_prendas_zonas_datos),{data:i})},me=async i=>{if(console.log(i),!i||g.value===H.editar)return w.value=null;try{const n=O.getInstance();await n.get(n.getEndpoint(_.prendas_zonas_existe)+"?zona_id="+i),w.value="Esta zona ya est\xE1 registrada, en su lugar edite este registro"}catch{w.value=null}o.tiene_restricciones=!1},N=async i=>{await k({miembro_zona_id:i}),t.value.length||(t.value=o.detalles_productos.map((n,f)=>({id:f,detalle_producto_id:n.id,detalle_producto:n.descripcion,miembro_zona_id:i})))},U=async i=>{await C(i),t.value.length===o.detalles_productos.length&&(await j(t.value.flatMap(n=>n.id)),o.miembro_zona&&await N(o.miembro_zona),o.zona&&V(o.zona))},pe=async i=>{if(i.length===t.value.length)return ie("Deje al menos una prenda asignada.");if(t.value[0].id)await j(i.flatMap(n=>n.id));else{const n=t.value.filter(f=>!i.some(b=>b.detalle_producto_id===f.detalle_producto_id&&b.miembro_zona_id===f.miembro_zona_id));await U(n)}o.zona&&V(o.zona)},fe=async()=>{await B.value.seleccionar(),await B.value.clearSelection()},be=async()=>{await D.value.seleccionar(),await D.value.clearSelection()},K=Je({zona:{required:Oe}},o);P(K.value),a(()=>{o.zona&&V(o.zona),L.value=o.empleado_apellidos_nombres,I()}),y(()=>{var i,n;m.miembrosZona=[],(i=B.value)==null||i.clearSelection(),(n=D.value)==null||n.clearSelection(),L.value=null});const{refListadoSeleccionable:ge,criterioBusqueda:ve,listado:ze,listar:Pe,limpiar:Ze,seleccionar:Ee}=no(o,"materiales_empleado"),{refListadoSeleccionable:Ce,criterioBusqueda:L,listado:we,listar:qe,seleccionar:Se}=eo(o,"empleados","empleado_id");return{v$:K,mixin:e,prendaZona:o,disabled:c,listadosAuxiliares:m,configuracionColumnasPrendaZona:io,configuracionColumnasDetallesModal:Ie,configuracionColumnasProductosSeleccionados:Ne,configuracionColumnasRestriccionPrendaZona:so,ccEmpleadoDesignado:[...Ke,{name:"tiene_restriccion",field:"tiene_restriccion",label:"Tiene restricci\xF3n de acceso a las prendas de la zona",align:"left"}],zonas:re,filtrarZonas:te,ordenarLista:Ge,iconos:We,recargarListados:ce,eliminarDetalleProductoSeleccionado:le,consultarMiembrosZona:V,prendasSinAsignar:ne,prendasAsignadas:t,asignarPrenda:U,quitarPrendas:pe,btnAsignarPrendas:fe,btnQuitarPrendas:be,obtenerPrendasAsignadas:N,refPrendasAsignadas:D,refPrendasSinAsignar:B,errorExisteZona:w,accion:g,acciones:H,configuracionColumnasEmpleadosLite:Ue,seleccionarCliente:de,consultarClientesMaterialesEmpleado:I,refListadoSeleccionableDetalleProducto:ge,criterioBusquedaDetalleProducto:ve,listadoDetalleProducto:ze,listarDetalleProducto:Pe,limpiarDetalleProducto:Ze,seleccionarDetalleProducto:Ee,refListadoSeleccionableEmpleado:Ce,criterioBusquedaEmpleado:L,listadoEmpleado:we,listarEmpleado:qe,seleccionarEmpleado:Se}}});const po={class:"row q-col-gutter-sm q-mb-md q-pa-md"},fo={class:"col-12 col-md-3"},bo={class:"text-negative"},go={class:"error-msg"},vo={class:"col-12 col-md-9"},zo={key:0,class:"col-12 q-mb-md"},Po={class:"q-mb-md"},Zo={class:"row q-col-gutter-sm q-pa-md"},Eo={class:"col-12 col-md-6"},Co={class:"col-12 col-md-6"},wo={class:"col-12 q-mb-md"},qo={class:"col-12"},So={class:"row q-col-gutter-sm q-pa-md"},_o={class:"col-12"},yo={class:"row q-col-gutter-sm q-mb-md q-pa-md"},Do={class:"col-12 col-md-5 q-gutter-y-sm"},Bo={class:"q-mb-sm text-center"},Vo={class:"col-md-2 column justify-center q-gutter-y-sm"},ko={class:"col-12 col-md-5 q-mb-md"},Ao={class:"q-mb-sm text-center"};function Lo(e,o,c,m,g,P){const u=M("essential-table"),v=M("essential-selectable-table"),y=M("tab-layout");return q(),G(y,{mixin:e.mixin,"configuracion-columnas":e.configuracionColumnasPrendaZona,paginate:"",full:""},{formulario:r(()=>[s(x,{class:"overflow-hidden q-mb-md rounded bg-desenfoque-2",label:"Agregar productos a la zona seleccionada","header-class":"text-bold bg-solid text-primary","default-opened":"",icon:"bi-box-seam-fill"},{default:r(()=>[l("div",po,[l("div",fo,[o[20]||(o[20]=l("label",{class:"q-mb-sm block"},"Seleccione una zona",-1)),s(F,{modelValue:e.prendaZona.zona,"onUpdate:modelValue":[o[1]||(o[1]=a=>e.prendaZona.zona=a),o[3]||(o[3]=a=>e.consultarMiembrosZona(e.prendaZona.zona))],options:e.zonas,"transition-show":"jump-up","transition-hide":"jump-down",disable:e.disabled||e.accion===e.acciones.editar,"options-dense":"",dense:"",outlined:"","input-debounce":0,"use-input":"",onFilter:e.filtrarZonas,onPopupShow:o[2]||(o[2]=a=>e.ordenarLista(e.zonas,"nombre")),"option-value":a=>a.id,"option-label":a=>a.nombre,error:!!e.v$.zona.$errors.length||!!e.errorExisteZona,onBlur:e.v$.zona.$touch,"emit-value":"","map-options":""},{"no-option":r(()=>[s($,null,{default:r(()=>[s(R,{class:"text-grey"},{default:r(()=>o[18]||(o[18]=[z(" A\xFAn no se han agregado zonas ")])),_:1})]),_:1})]),after:r(()=>[s(S,{color:"positive",icon:e.iconos.recargar,onClick:o[0]||(o[0]=a=>e.recargarListados()),unelevated:"",dense:""},{default:r(()=>[s(h,null,{default:r(()=>o[19]||(o[19]=[z("Recargar zonas")])),_:1})]),_:1},8,["icon"])]),error:r(()=>[l("small",bo,J(e.errorExisteZona),1),(q(!0),Q(Me,null,Qe(e.v$.zona.$errors,a=>(q(),Q("div",{key:a.$uid},[l("div",go,J(a.$message),1)]))),128))]),_:1},8,["modelValue","options","disable","onFilter","option-value","option-label","error","onBlur"])]),l("div",vo,[o[21]||(o[21]=l("label",{class:"q-mb-sm block"},"Restricci\xF3n de acceso a las prendas asignadas a la zona",-1)),s(je,{modelValue:e.prendaZona.tiene_restricciones,"onUpdate:modelValue":o[4]||(o[4]=a=>e.prendaZona.tiene_restricciones=a),class:"toggle-button-primary",disable:e.disabled||!!e.errorExisteZona,spread:"","no-caps":"",rounded:"","toggle-color":"primary",unelevated:"",options:[{label:"Todos los miembros tienen acceso a todos los productos asignados.",value:!1},{label:"Restringir acceso a los productos asignados.",value:!0}]},null,8,["modelValue","disable"])]),e.listadosAuxiliares.miembrosZona.length?(q(),Q("div",zo,[l("div",Po,[o[22]||(o[22]=z(" Empleados asignados a la zona ")),s(Z,{name:"bi-check-circle-fill",color:"positive"})]),s(u,{configuracionColumnas:e.ccEmpleadoDesignado,datos:e.listadosAuxiliares.miembrosZona,permitirConsultar:!1,permitirEditar:!1,"permitir-eliminar":!1,"permitir-buscar":!1,mostrarBotones:!1,ajustarCeldas:!0,altoFijo:!1,"mostrar-footer":!1,"mostrar-header":!1},null,8,["configuracionColumnas","datos"])])):W("",!0)]),l("div",Zo,[l("div",Eo,[o[23]||(o[23]=l("label",{class:"q-mb-sm block"},"Empleado propietario",-1)),s(X,{modelValue:e.criterioBusquedaEmpleado,"onUpdate:modelValue":o[5]||(o[5]=a=>e.criterioBusquedaEmpleado=a),placeholder:"Escriba y presione enter para buscar",hint:"Puede buscar por nombre, apellido o identificaci\xF3n",disable:e.disabled,onKeydown:Y(e.listarEmpleado,["enter"]),outlined:"",dense:""},{append:r(()=>[s(Z,{name:e.prendaZona.empleado_id?"bi-check-circle-fill":"bi-check-circle",color:e.prendaZona.empleado_id?"positive":"grey-6",size:"xs"},null,8,["name","color"])]),_:1},8,["modelValue","disable","onKeydown"])]),l("div",Co,[o[25]||(o[25]=l("label",{class:"q-mb-sm block"},"Seleccione un cliente",-1)),s(F,{modelValue:e.prendaZona.cliente_id,"onUpdate:modelValue":[o[6]||(o[6]=a=>e.prendaZona.cliente_id=a),o[7]||(o[7]=a=>e.seleccionarCliente())],options:e.listadosAuxiliares.clientesMaterialesEmpleado,"transition-show":"scale","transition-hide":"scale","use-input":"","input-debounce":"0","options-dense":"",dense:"",outlined:"","option-label":a=>a.razon_social,"option-value":a=>a.cliente_id,"emit-value":"","map-options":""},{"no-option":r(()=>[s($,null,{default:r(()=>[s(R,{class:"text-grey"},{default:r(()=>o[24]||(o[24]=[z(" Primero seleccione un empleado propietario ")])),_:1})]),_:1})]),_:1},8,["modelValue","options","option-label","option-value"])]),o[27]||(o[27]=l("div",{class:"col-12"},[l("label",{class:"q-mb-sm block"},"Agregar productos a la zona seleccionada")],-1)),l("div",wo,[s(X,{modelValue:e.criterioBusquedaDetalleProducto,"onUpdate:modelValue":o[9]||(o[9]=a=>e.criterioBusquedaDetalleProducto=a),disable:e.disabled,placeholder:"Nombre de producto",hint:"Presiona Enter para seleccionar un producto",onKeydown:o[10]||(o[10]=Y(a=>e.listarDetalleProducto({empleado_id:e.prendaZona.empleado_id,cliente_id:e.prendaZona.cliente_id,search:e.criterioBusquedaDetalleProducto}),["enter"])),onBlur:o[11]||(o[11]=a=>e.criterioBusquedaDetalleProducto===""?e.limpiarProducto():null),outlined:"",clearable:"",dense:""},{after:r(()=>[s(S,{onClick:o[8]||(o[8]=a=>e.listarDetalleProducto({empleado_id:e.prendaZona.empleado_id,cliente_id:e.prendaZona.cliente_id,search:e.criterioBusquedaDetalleProducto})),icon:"search",unelevated:"",color:"positive",disable:e.disabled,"no-caps":""},{default:r(()=>o[26]||(o[26]=[z("Buscar")])),_:1},8,["disable"])]),_:1},8,["modelValue","disable"])]),l("div",qo,[s(u,{titulo:"Productos asignados a la zona",configuracionColumnas:e.configuracionColumnasProductosSeleccionados,datos:e.prendaZona.detalles_productos,permitirConsultar:!1,permitirEditar:!1,"permitir-buscar":!1,mostrarBotones:!1,ajustarCeldas:!0,altoFijo:!1,onEliminar:e.eliminarDetalleProductoSeleccionado},null,8,["configuracionColumnas","datos","onEliminar"])])])]),_:1}),e.prendaZona.tiene_restricciones?(q(),G(x,{key:0,class:"overflow-hidden q-mb-md rounded bg-desenfoque-2",label:"Restringir acceso a los productos asignados a la zona.","header-class":"text-bold bg-solid text-primary","default-opened":"",icon:"bi-shield-fill-check"},{default:r(()=>[l("div",So,[l("div",_o,[o[30]||(o[30]=l("label",{class:"q-mb-sm block"},"Seleccione un miembro de la zona",-1)),s(F,{modelValue:e.prendaZona.miembro_zona,"onUpdate:modelValue":[o[13]||(o[13]=a=>e.prendaZona.miembro_zona=a),o[14]||(o[14]=a=>e.obtenerPrendasAsignadas(e.prendaZona.miembro_zona))],options:e.listadosAuxiliares.miembrosZona,"transition-show":"scale","transition-hide":"scale","options-dense":"",dense:"",outlined:"","use-input":"","input-debounce":"0","option-label":a=>a.empleado,"option-value":a=>a.id,"emit-value":"","map-options":""},{"no-option":r(()=>[s($,null,{default:r(()=>[s(R,{class:"text-grey"},{default:r(()=>o[28]||(o[28]=[z(" A\xFAn no se han agregado miembros a la zona ")])),_:1})]),_:1})]),after:r(()=>[s(S,{color:"positive",icon:e.iconos.recargar,onClick:o[12]||(o[12]=a=>e.consultarMiembrosZona(e.prendaZona.zona)),unelevated:"",dense:""},{default:r(()=>[s(h,null,{default:r(()=>o[29]||(o[29]=[z("Recargar miembros de la zona")])),_:1})]),_:1},8,["icon"])]),_:1},8,["modelValue","options","option-label","option-value"])])]),Fe(l("div",yo,[l("div",Do,[l("div",Bo,[s(Z,{name:"bi-person-fill-dash",color:"negative",size:"sm"})]),s(u,{titulo:"Listado de prendas no asignadas",configuracionColumnas:e.configuracionColumnasRestriccionPrendaZona,datos:e.prendasSinAsignar,permitirConsultar:!1,permitirEditar:!1,permitirEliminar:!1,mostrarFooter:!0,mostrarColumnasVisibles:!1,"ajustar-celdas":"","mostrar-exportar":!1,ref:"refPrendasSinAsignar",onSelected:e.asignarPrenda,"tipo-seleccion":"multiple"},null,8,["configuracionColumnas","datos","onSelected"])]),l("div",Vo,[s(S,{class:"full-width block",color:"positive",onClick:o[15]||(o[15]=a=>e.btnAsignarPrendas()),unelevated:"",glossy:"",rounded:""},{default:r(()=>[s(Z,{name:"bi-arrow-right"})]),_:1}),s(S,{class:"full-width block",color:"negative",onClick:o[16]||(o[16]=a=>e.btnQuitarPrendas()),glossy:"",unelevated:"",rounded:""},{default:r(()=>[s(Z,{name:"bi-arrow-left"})]),_:1})]),l("div",ko,[l("div",Ao,[s(Z,{name:"bi-person-fill-check",color:"positive",size:"sm"})]),s(u,{titulo:"Listado de prendas asignadas",configuracionColumnas:e.configuracionColumnasRestriccionPrendaZona,mostrarColumnasVisibles:!1,datos:e.prendasAsignadas,permitirConsultar:!1,permitirEditar:!1,permitirEliminar:!1,"mostrar-exportar":!1,"ajustar-celdas":"",ref:"refPrendasAsignadas",onSelected:e.quitarPrendas,"tipo-seleccion":"multiple"},null,8,["configuracionColumnas","datos","onSelected"])])],512),[[Te,e.prendaZona.miembro_zona]])]),_:1})):W("",!0)]),modales:r(()=>[s(v,{ref:"refListadoSeleccionableDetalleProducto","configuracion-columnas":e.configuracionColumnasDetallesModal,datos:e.listadoDetalleProducto,"tipo-seleccion":"multiple",onSelected:e.seleccionarDetalleProducto},null,8,["configuracion-columnas","datos","onSelected"]),s(v,{ref:"refListadoSeleccionableEmpleado","configuracion-columnas":e.configuracionColumnasEmpleadosLite,datos:e.listadoEmpleado,onSelected:o[17]||(o[17]=a=>{e.seleccionarEmpleado(a),e.consultarClientesMaterialesEmpleado({empleado_id:e.prendaZona.empleado_id})}),"tipo-seleccion":"single"},null,8,["configuracion-columnas","datos"])]),_:1},8,["mixin","configuracion-columnas"])}var ka=Re(mo,[["render",Lo]]);export{ka as default};
