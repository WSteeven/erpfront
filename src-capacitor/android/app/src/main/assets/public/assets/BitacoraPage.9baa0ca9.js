var la=Object.defineProperty;var na=(e,a,s)=>a in e?la(e,a,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[a]=s;var p=(e,a,s)=>(na(e,typeof a!="symbol"?a+"":a,s),s);import{e as ue,ac as da,bA as ca,bB as ua,k as ma,d as x,c as Q,f as le,v as c,x as b,y as i,K as S,z as o,F as n,G as P,H as O,O as F,B as h,I as k,by as _e,s as me,V as L,U as ba,a4 as Y,h as va,bz as T,_ as Ve,t as $,P as N,D as B,J as C,L as ne,j as pa,b2 as fa,bh as ga,u as ya,bd as ha,m as ge,R as $a,n as _a,p as Va,A as qa,a6 as ka,Q as te}from"./index.b8e09611.js";import{Q as qe,a as ke}from"./QItemSection.ec4cc512.js";import{a as se}from"./QToolbar.afeb6de9.js";import{Q as de}from"./QSelect.b920278b.js";import{Q as Aa}from"./QForm.eab79b48.js";import{c as Ae}from"./configuracionColumnasEmpleadosLite.5961fbe8.js";import{u as Ca}from"./filtrosListadosGenerales.87fcb144.js";import{w as G,J as Ba,s as Sa}from"./utils.9344cd7e.js";import{r as R,a as X}from"./i18n-validators.06abe774.js";import{u as Ce}from"./index.70965bc7.js";import{i as ce}from"./iconos.5bc406be.js";import{M as wa}from"./MultiplePageLayout.ab045a99.js";import{E as Be}from"./EssentialSelectableTable.ac03bc90.js";import{T as Ea}from"./TabLayout.45a66130.js";import{R as D,S as Fa,E as Pa}from"./EssentialTable.23af6cc8.js";import{M as Oa}from"./ModalEntidad.54c9ab3a.js";import{S as za}from"./SolicitarArchivo.e58ad909.js";import{C as La}from"./CalloutComponent.faccc689.js";import{C as ye}from"./ContenedorSimpleMixin.4e22246b.js";import{u as W}from"./useOrquestadorSelectorEmpleados.e7e8ebc2.js";import{C as Ra,a as Ia}from"./ComponenteModal.domain.92aacded.js";import{S as Ma}from"./SimpleLayout.97ee66fd.js";import{G as Ta}from"./GestorArchivos.801d8a9f.js";import{E as Se}from"./entidadAuditable.75a46700.js";import{Z as he}from"./ZonaController.fdb195f9.js";import{B as Ua,a as ja}from"./Bitacora.a31b94c3.js";import"./position-engine.799c9136.js";import"./QChip.f8f308fa.js";import"./QMenu.b3fb639b.js";import"./format.8ac60962.js";import"./index.ea415f98.js";import"./QTabs.1ee2fae1.js";import"./QResizeObserver.1422c274.js";import"./QTabPanels.1776fc83.js";import"./touch.9135741d.js";import"./QPopupProxy.685eacb5.js";import"./QPage.e6f8825d.js";import"./buttonSubmits.f2d72caa.js";import"./EssentialTablePagination.ce808cac.js";import"./QTable.c4bfb038.js";import"./use-fullscreen.37810a50.js";import"./QBtnGroup.7d38eecd.js";import"./QBadge.89898cd2.js";import"./QFile.c79664c6.js";import"./_commonjsHelpers.8402d862.js";import"./QImg.95754b62.js";import"./VisorImagen.29457a6f.js";import"./seleccionContratacionPersonal.utils.e3e1ed3d.js";import"./ErrorComponent.3c1fc91c.js";import"./configuracion_general.1d29d94f.js";import"./ConfiguracionController.a136b041.js";import"./selector.e0ee4903.js";import"./SelectorController.efbca5b9.js";import"./QUploader.16c4ab83.js";import"./QCircularProgress.c6e924d2.js";import"./configuracionColumnasArchivoSubtarea.215f4ffd.js";const $e=ue([{name:"fecha_hora_inicio",field:"fecha_hora_inicio",label:"Fecha y hora de inicio",align:"left",disableModal:!0},{name:"fecha_hora_fin",field:"fecha_hora_fin",label:"Fecha y hora de fin",align:"left",sortable:!0,visibleModal:!1},{name:"tipo_evento_bitacora",field:"tipo_evento_bitacora",label:"Tipo de evento",align:"left",type:"select",requerido:!0},{name:"medio_notificacion",field:"medio_notificacion",label:"Medio por el cual se notific\xF3",align:"left"},{name:"actividad",field:"actividad",label:"Actividad",align:"left",type:"voice",columnClass:"col-12 col-md-6",requerido:!0},{name:"fotografia_evidencia_1",field:"fotografia_evidencia_1",label:"Fotograf\xEDa de evidencia 1 (Opcional)",align:"left",type:"imagen",editable:!0,visible:!1},{name:"fotografia_evidencia_2",field:"fotografia_evidencia_2",label:"Fotograf\xEDa de evidencia 2 (Opcional)",align:"left",type:"imagen",editable:!0,visible:!1}]),Na=[{name:"zona",field:"zona",label:"Zona",align:"left",type:"text",operador:"like",sortable:!0},{name:"jornada",field:"jornada",label:"Jornada",align:"left",type:"text",operador:"like",sortable:!0},{name:"fecha_hora_inicio_turno",field:"fecha_hora_inicio_turno",label:"Fecha y hora de inicio de turno",align:"left",type:"date",operador:"=",sortable:!0},{name:"fecha_hora_fin_turno",field:"fecha_hora_fin_turno",label:"Fecha y hora de fin de turno",align:"left",type:"date",operador:"=",sortable:!0},{name:"agente_turno",field:"agente_turno",label:"Agente de turno",align:"left",operador:"like",sortable:!0},{name:"protector",field:"protector",label:"Protector",align:"left",operador:"like",sortable:!0},{name:"conductor",field:"conductor",label:"Conductor",align:"left",operador:"like",sortable:!0},{name:"observaciones",field:"observaciones",label:"Observaciones",align:"left",type:"text",operador:"like",sortable:!0},{name:"revisado_por_supervisor",field:"revisado_por_supervisor",label:"Revisado por supervisor",align:"left",type:"select",operador:"=",filtrar:!0,sortable:!0,options:[{label:"S\xED",value:1},{label:"No",value:0}],formato:e=>e?"S\xED":"No",filtro:(e,a)=>{var s;a((s=e==null?void 0:e.value)!=null?s:null)}}],Da=["DIURNA","NOCTURNA"],Qa='<g transform="translate(20 50)"><rect x="-10" y="-30" width="20" height="60" fill="currentColor" opacity="0.6"><animateTransform attributeName="transform" type="scale" from="2" to="1" begin="0s" repeatCount="indefinite" dur="1s" calcMode="spline" keySplines="0.1 0.9 0.4 1" keyTimes="0;1" values="2;1"></animateTransform></rect></g><g transform="translate(50 50)"><rect x="-10" y="-30" width="20" height="60" fill="currentColor" opacity="0.8"><animateTransform attributeName="transform" type="scale" from="2" to="1" begin="0.1s" repeatCount="indefinite" dur="1s" calcMode="spline" keySplines="0.1 0.9 0.4 1" keyTimes="0;1" values="2;1"></animateTransform></rect></g><g transform="translate(80 50)"><rect x="-10" y="-30" width="20" height="60" fill="currentColor" opacity="0.9"><animateTransform attributeName="transform" type="scale" from="2" to="1" begin="0.2s" repeatCount="indefinite" dur="1s" calcMode="spline" keySplines="0.1 0.9 0.4 1" keyTimes="0;1" values="2;1"></animateTransform></rect></g>';var Ga=da({name:"QSpinnerFacebook",props:ca,setup(e){const{cSize:a,classes:s}=ua(e);return()=>ma("svg",{class:s.value,width:a.value,height:a.value,viewBox:"0 0 100 100",xmlns:"http://www.w3.org/2000/svg",preserveAspectRatio:"xMidYMid",innerHTML:Qa})}});const Ha={class:"row"},Ka={class:"col-12"},Za={class:"col-12"},Ja={class:"q-mb-sm block"},Xa=x({__name:"FechaHoraAutomaticaInput",props:{modelValue:{type:String,default:""},disable:{type:Boolean,default:!1},validador:{type:Object,required:!0},clave:{type:String,required:!0},label:{type:String,default:"Fecha y hora"}},emits:["update:modelValue"],setup(e,{emit:a}){const s=a,y=e,u=Q(!1),_=le({get:()=>y.modelValue,set:m=>{s("update:modelValue",m)}});async function f(){u.value=!0,_.value=(await G()).fecha_hora,u.value=!1}return(m,V)=>{var d,v;return c(),b("div",Ha,[i("div",Ka,[i("div",Za,[i("label",Ja,S(e.label),1),o(k,{modelValue:_.value,"onUpdate:modelValue":V[1]||(V[1]=t=>_.value=t),outlined:"",readonly:"",dense:"",hint:"Presione el bot\xF3n para obtener la fecha y hora actual",error:!!((d=e.validador[e.clave])!=null&&d.$errors.length),onBlur:(v=e.validador.coordenadas)==null?void 0:v.$touch},{error:n(()=>{var t;return[(c(!0),b(P,null,O((t=e.validador[e.clave])==null?void 0:t.$errors,w=>(c(),b("div",{key:w.$uid},[i("div",null,S(w.$message),1)]))),128))]}),append:n(()=>[o(F,{color:"primary","no-wrap":"",onClick:V[0]||(V[0]=t=>f()),disable:e.disable,dense:"",push:"",loading:u.value},{loading:n(()=>[o(Ga)]),default:n(()=>[o(h,{name:"bi-clock",size:"xs"})]),_:1},8,["disable","loading"])]),_:1},8,["modelValue","error","onBlur"])])])])}}});var Ya=Xa;class Wa extends _e{constructor(){super(me.actividades_bitacoras)}}const xa={class:"row q-col-gutter-sm q-py-md q-mb-md"},eo={class:"col-12 col-md-3"},ao={class:"col-12 col-md-3"},oo={class:"col-12 col-md-3"},io={class:"col-12 col-md-3"},ro={class:"col-12 col-md-3"},to={class:"error-msg"},so={class:"col-12 col-md-3"},lo={class:"col-12 col-md-3"},no={class:"col-12"},co=x({__name:"FormularioVisitante",props:{visitante:{type:Object,required:!0},v$:{type:Object,required:!0},disable:{type:Boolean,default:!1}},setup(e){const a=e,{refListadoSeleccionable:s,criterioBusqueda:y,listado:u,listar:_,seleccionar:f}=W(a.visitante,"empleados","persona_visitada"),m=ue(a.visitante);return y.value=m.persona_visitada,(V,d)=>(c(),b("div",xa,[i("div",eo,[o(D,{modelValue:m.nombre_completo,"onUpdate:modelValue":d[0]||(d[0]=v=>m.nombre_completo=v),v$:e.v$,"key-error":"visitante.nombre_completo",label:"Nombre completo (Apellidos y nombres)",placeholder:"OBLIGATORIO",disable:e.disable},null,8,["modelValue","v$","disable"])]),i("div",ao,[d[7]||(d[7]=i("label",{class:"q-mb-sm block"},"Identificaci\xF3n",-1)),o(k,{modelValue:m.identificacion,"onUpdate:modelValue":d[1]||(d[1]=v=>m.identificacion=v),placeholder:"Obligatorio",disable:e.disable,error:!!e.v$.visitante.identificacion.$errors.length,onBlur:e.v$.visitante.identificacion.$touch,outlined:"",dense:""},null,8,["modelValue","disable","error","onBlur"])]),i("div",oo,[d[8]||(d[8]=i("label",{class:"q-mb-sm block"},"Celular",-1)),o(k,{modelValue:m.celular,"onUpdate:modelValue":d[2]||(d[2]=v=>m.celular=v),placeholder:"Opcional",disable:e.disable,mask:"0## ### ####",outlined:"",dense:""},null,8,["modelValue","disable"])]),i("div",io,[o(D,{modelValue:m.motivo_visita,"onUpdate:modelValue":d[3]||(d[3]=v=>m.motivo_visita=v),v$:e.v$,"key-error":"visitante.motivo_visita",label:"Motivo de visita",placeholder:"OBLIGATORIO",disable:e.disable},null,8,["modelValue","v$","disable"])]),i("div",ro,[d[9]||(d[9]=i("label",{class:"q-mb-sm block"},"Persona visitada",-1)),o(k,{modelValue:L(y),"onUpdate:modelValue":d[4]||(d[4]=v=>ba(y)?y.value=v:null),placeholder:"Escriba y presione enter para buscar",hint:"Puede buscar por nombre, apellido o identificaci\xF3n",disable:e.disable,onKeydown:Y(L(_),["enter"]),error:!!e.v$.visitante.persona_visitada.$errors.length,onBlur:e.v$.visitante.persona_visitada.$touch,outlined:"",dense:""},{append:n(()=>[o(h,{name:e.visitante.persona_visitada?"bi-check-circle-fill":"bi-check-circle",color:m.persona_visitada?"positive":"grey-6",size:"xs"},null,8,["name","color"])]),after:n(()=>[o(F,{color:"positive",icon:L(ce).buscar,onClick:L(_),unelevated:"",dense:""},null,8,["icon","onClick"])]),error:n(()=>[(c(!0),b(P,null,O(e.v$.visitante.persona_visitada.$errors,v=>(c(),b("div",{key:v.$uid},[i("div",to,S(v.$message),1)]))),128))]),_:1},8,["modelValue","disable","onKeydown","error","onBlur"])]),i("div",so,[d[10]||(d[10]=i("label",{class:"q-mb-sm block"},"Placa de veh\xEDculo",-1)),o(k,{modelValue:m.placa_vehiculo,"onUpdate:modelValue":d[5]||(d[5]=v=>m.placa_vehiculo=v),placeholder:"Opcional",disable:e.disable,mask:"XXX-##X#",outlined:"",dense:""},null,8,["modelValue","disable"])]),i("div",lo,[o(D,{modelValue:m.observaciones,"onUpdate:modelValue":d[6]||(d[6]=v=>m.observaciones=v),v$:e.v$,"key-error":"observaciones",label:"Observaciones",placeholder:"OPCIONAL",disable:e.disable},null,8,["modelValue","v$","disable"])]),i("div",no,[o(Be,{ref_key:"refListadoSeleccionable",ref:s,"configuracion-columnas":L(Ae),datos:L(u),onSelected:L(f),"tipo-seleccion":"single"},null,8,["configuracion-columnas","datos","onSelected"])])]))}});class uo extends _e{constructor(){super(me.tipos_eventos_bitacoras)}}var mo=x({components:{SimpleLayout:Ma,VoiceInput:D,SelectorImagen:Fa,GestorArchivos:Ta,FormularioVisitante:co},props:{datos:Object},emits:["cerrar-modal"],setup(e,{emit:a}){var Z;const{entidad:s,disabled:y,listadosAuxiliares:u,accion:_,listadoArchivos:f}=e.datos.mixin.useReferencias(),{setValidador:m,cargarVista:V,obtenerListados:d,consultar:v}=e.datos.mixin.useComportamiento(),{onGuardado:t,onModificado:w,onConsultado:U,onReestablecer:I,onBeforeGuardar:r}=e.datos.mixin.useHooks();V(async()=>{await d({tiposEventos:{controller:new uo,params:{activo:1}}})});const q=Q(),j=Q(),ee={tipo_evento_bitacora:{required:R},actividad:{required:R},visitante:{nombre_completo:{requiredIf:X(()=>s.mostrar_seccion_visitante)},identificacion:{requiredIf:X(()=>s.mostrar_seccion_visitante)},motivo_visita:{requiredIf:X(()=>s.mostrar_seccion_visitante)},persona_visitada:{requiredIf:X(()=>s.mostrar_seccion_visitante)}}},z=Ce(ee,s);m(z.value);const H=async()=>await q.value.subir(),K=()=>{s.notificacion_inmediata=u.tiposEventos.find(g=>g.id===s.tipo_evento_bitacora).notificacion_inmediata};return t(g=>{j.value=g,setTimeout(async()=>{await H(),a("cerrar-modal")})}),w(g=>{j.value=g,setTimeout(()=>H(),1)}),U(async()=>{setTimeout(async()=>{var g;await q.value.listarArchivosAlmacenados(s.id),s.mostrar_seccion_archivos_adjuntos=!!f.value.length,s.mostrar_seccion_visitante=!!((g=s.visitante)!=null&&g.id),q.value.quiero_subir_archivos=!1},1)}),I(()=>{var g,E;q.value&&q.value.limpiarListado(),G().then(M=>s.fecha_hora_inicio=M.fecha_hora),s.bitacora=(E=(g=e.datos)==null?void 0:g.bitacora_id)!=null?E:null,q.value.quiero_subir_archivos=!0}),r(()=>{s.visitante=s.mostrar_seccion_visitante?s.visitante:null}),va(()=>{var g,E;q.value&&q.value.limpiarListado(),_.value===T.consultar?v(s):(G().then(M=>s.fecha_hora_inicio=M.fecha_hora),s.bitacora=(E=(g=e.datos)==null?void 0:g.bitacora_id)!=null?E:null)}),{v$:z,mixin:(Z=e.datos)==null?void 0:Z.mixin,actividad:s,disabled:y,listadosAuxiliares:u,refArchivo:q,accion:_,acciones:T,idEntidad:j,validarNotificacionInmediata:K,listadoArchivos:f}}});const bo={class:"row q-col-gutter-sm q-mb-lg"},vo={class:"col-12 text-pdrimary text-bold q-py-sm q-my-sm"},po={class:"col-12 col-md-3"},fo={key:0,class:"col-12 col-md-3"},go={class:"col-12 col-md-6"},yo={class:"error-msg"},ho={key:1,class:"col-12 col-md-3"},$o={class:"col-12 col-md-6"},_o={class:"col-12 col-md-3"},Vo={class:"col-12 col-md-3"},qo={class:"row q-col-gutter-sm"},ko={class:"col-12 text-pdrimary text-bold q-py-sm q-mt-sm"},Ao={class:"col-12 q-mb-md"},Co={class:"row q-col-gutter-sm"},Bo={class:"col-12 text-pdrimary text-bold q-py-sm q-mt-sm"},So={key:0,class:"col-12 q-mb-md"};function wo(e,a,s,y,u,_){const f=$("voice-input"),m=$("selector-imagen"),V=$("gestor-archivos"),d=$("formulario-visitante"),v=$("simple-layout");return c(),N(v,{mixin:e.mixin},{formulario:n(()=>[i("div",bo,[i("div",vo,[o(h,{name:"bi-x-diamond",class:"q-mr-sm",color:"primary"}),a[10]||(a[10]=B(" Registro de la actividad "))]),i("div",po,[a[11]||(a[11]=i("label",{class:"q-mb-sm block"},"Fecha y hora de inicio",-1)),o(k,{modelValue:e.actividad.fecha_hora_inicio,"onUpdate:modelValue":a[0]||(a[0]=t=>e.actividad.fecha_hora_inicio=t),outlined:"",disable:"",dense:""},null,8,["modelValue"])]),e.actividad.fecha_hora_fin?(c(),b("div",fo,[a[12]||(a[12]=i("label",{class:"q-mb-sm block"},"Fecha y hora de fin",-1)),o(k,{modelValue:e.actividad.fecha_hora_fin,"onUpdate:modelValue":a[1]||(a[1]=t=>e.actividad.fecha_hora_fin=t),outlined:"",disable:"",dense:""},null,8,["modelValue"])])):C("",!0),i("div",go,[a[14]||(a[14]=i("label",{class:"q-mb-sm block"},"Tipo de evento",-1)),o(de,{modelValue:e.actividad.tipo_evento_bitacora,"onUpdate:modelValue":[a[2]||(a[2]=t=>e.actividad.tipo_evento_bitacora=t),a[3]||(a[3]=t=>e.validarNotificacionInmediata())],options:e.listadosAuxiliares.tiposEventos,"transition-show":"scale","transition-hide":"scale",hint:"Obligatorio","options-dense":"",dense:"",outlined:"",disable:e.disabled,"option-label":t=>t.nombre,"option-value":t=>t.id,"use-input":"","input-debounce":"0","emit-value":"","map-options":"",error:!!e.v$.tipo_evento_bitacora.$errors.length,onBlur:e.v$.tipo_evento_bitacora.$touch},{"no-option":n(()=>[o(qe,null,{default:n(()=>[o(ke,{class:"text-grey"},{default:n(()=>a[13]||(a[13]=[B(" No se han agregado tipos de eventos ")])),_:1})]),_:1})]),error:n(()=>[(c(!0),b(P,null,O(e.v$.tipo_evento_bitacora.$errors,t=>(c(),b("div",{key:t.$uid},[i("div",yo,S(t.$message),1)]))),128))]),_:1},8,["modelValue","options","disable","option-label","option-value","error","onBlur"])]),e.actividad.medio_notificacion?(c(),b("div",ho,[a[15]||(a[15]=i("label",{class:"q-mb-sm block"},"Medio por el cual se notific\xF3",-1)),o(k,{modelValue:e.actividad.medio_notificacion,"onUpdate:modelValue":a[4]||(a[4]=t=>e.actividad.medio_notificacion=t),outlined:"",disable:"",dense:""},null,8,["modelValue"])])):C("",!0),i("div",$o,[o(f,{modelValue:e.actividad.actividad,"onUpdate:modelValue":a[5]||(a[5]=t=>e.actividad.actividad=t),label:"Actividad",disable:e.disabled,error:!!e.v$.actividad.$errors.length,onBlur:e.v$.actividad.$touch,v$:e.v$,keyError:"actividad"},null,8,["modelValue","disable","error","onBlur","v$"])]),i("div",_o,[a[16]||(a[16]=i("label",{class:"q-mb-sm block"},S("Fotograf\xEDa de evidencia 1"),-1)),o(m,{imagen:e.actividad.fotografia_evidencia_1,file_extensiones:".jpg, image/*","onUpdate:modelValue":a[6]||(a[6]=t=>e.actividad.fotografia_evidencia_1=t),hint:"Opcional",disable:e.disabled},null,8,["imagen","disable"])]),i("div",Vo,[a[17]||(a[17]=i("label",{class:"q-mb-sm block"},S("Fotograf\xEDa de evidencia 2"),-1)),o(m,{imagen:e.actividad.fotografia_evidencia_2,file_extensiones:".jpg, image/*","onUpdate:modelValue":a[7]||(a[7]=t=>e.actividad.fotografia_evidencia_2=t),hint:"Opcional",disable:e.disabled},null,8,["imagen","disable"])])]),i("div",qo,[i("div",ko,[o(h,{name:"bi-x-diamond",class:"q-mr-sm",color:"primary"}),a[18]||(a[18]=B(" Archivos adjuntos (Opcional) "))]),o(ne,{"keep-color":"",modelValue:e.actividad.mostrar_seccion_archivos_adjuntos,"onUpdate:modelValue":a[8]||(a[8]=t=>e.actividad.mostrar_seccion_archivos_adjuntos=t),label:"Mostrar seccion",color:"positive",disable:e.disabled},null,8,["modelValue","disable"]),pa(i("div",Ao,[o(V,{ref:"refArchivo",label:"Adjuntar archivos",mixin:e.mixin,disable:e.disabled,"listar-al-guardar":!1,"quiero-subir-archivos":"","permitir-subir":!1,"permitir-eliminar":e.accion==e.acciones.nuevo||e.accion==e.acciones.editar,idModelo:e.idEntidad},null,8,["mixin","disable","permitir-eliminar","idModelo"])],512),[[fa,e.actividad.mostrar_seccion_archivos_adjuntos]])]),i("div",Co,[i("div",Bo,[o(h,{name:"bi-x-diamond",class:"q-mr-sm",color:"primary"}),a[19]||(a[19]=B(" Visitante (Opcional) "))]),o(ne,{"keep-color":"",modelValue:e.actividad.mostrar_seccion_visitante,"onUpdate:modelValue":a[9]||(a[9]=t=>e.actividad.mostrar_seccion_visitante=t),label:"Mostrar seccion",color:"positive",disable:e.disabled},null,8,["modelValue","disable"]),e.actividad.mostrar_seccion_visitante?(c(),b("div",So,[o(d,{visitante:e.actividad.visitante,v$:e.v$,disable:e.disabled},null,8,["visitante","v$","disable"])])):C("",!0)])]),_:1},8,["mixin"])}var Eo=Ve(mo,[["render",wo]]);class Fo{constructor(){p(this,"ActividadBitacoraPage");this.ActividadBitacoraPage=ga(new Ra("Actividad de bit\xE1cora",Eo))}}class Po extends Ia{constructor(){super(new Fo)}}class Oo extends Se{constructor(){super(...arguments);p(this,"nombre_completo",null);p(this,"identificacion",null);p(this,"celular",null);p(this,"motivo_visita",null);p(this,"persona_visitada",null);p(this,"placa_vehiculo",null);p(this,"fecha_hora_ingreso",null);p(this,"fecha_hora_salida",null);p(this,"observaciones",null);p(this,"actividad_bitacora",null)}}class zo extends Se{constructor(){super(...arguments);p(this,"fecha_hora_inicio",null);p(this,"fecha_hora_fin",null);p(this,"tipo_evento_bitacora",null);p(this,"notificacion_inmediata",!1);p(this,"actividad",null);p(this,"fotografia_evidencia_1",null);p(this,"fotografia_evidencia_2",null);p(this,"medio_notificacion",null);p(this,"tiene_adjuntos",!1);p(this,"visitante",new Oo);p(this,"bitacora",null);p(this,"mostrar_seccion_archivos_adjuntos",!1);p(this,"mostrar_seccion_visitante",!1)}}var Lo=x({components:{MultiplePageLayout:wa,TabLayout:Ea,EssentialTable:Pa,FechaHoraAutomaticaInput:Ya,EssentialSelectableTable:Be,VoiceInput:D,Callout:La,SolicitarArchivo:za,ModalesEntidad:Oa},setup(){const e=ya();ha().setQuasar(ge());const s=new Ua,y=new ye(ja,s),{entidad:u,disabled:_,listadosAuxiliares:f,tabsPage:m,tabs:V,accion:d}=y.useReferencias(),{setValidador:v,cargarVista:t,obtenerListados:w,consultar:U,editarParcial:I,filtrar:r}=y.useComportamiento(),{onConsultado:q,onReestablecer:j,onGuardado:ee}=y.useHooks(),z=new ye(zo,new Wa),{entidad:H,listado:K,accion:Z}=z.useReferencias(),{listar:g,reestablecer:E,editarParcial:M}=z.useComportamiento();t(async()=>{await w({zonas:{controller:new he,params:{activo:1,"":Ba("id",e.user.zonas_ids)}},prendas:[]})});const we=ge(),Ee=Q(),Fe=Q(!1),ae=new Po,{confirmar:be,promptItems:Pe,notificarAdvertencia:oe}=$a(),Oe=le(()=>f.prendas.map(l=>({...l,descripcion:l.descripcion.toLowerCase().replace(/\b\w/g,A=>A.toUpperCase())}))),ze=["1. Bit\xE1cora","2. Actividades registradas en la bit\xE1cora"],{zonas:Le,filtrarZonas:Re}=Ca(f),Ie=async()=>{t(async()=>{await w({zonas:{controller:new he,params:{activo:1}}})})},ve=async()=>{const l=qa.getInstance(),A=await l.get(l.getEndpoint(me.prendas_zonas_permitidas,{zona_id:u.zona,empleado_id:u.agente_turno}));f.prendas=A.data.results},Me=l=>{u.actividades.unshift(l)},Te={titulo:"Registrar actividades",icono:"bi-list",color:"teal",accion:async({entidad:l})=>{await U(l),d.value=T.consultar,await g({bitacora_id:l.id}),V.value="formulario",m.value="2"}},Ue={titulo:"Finalizar bit\xE1cora",icono:"bi-check-circle-fill",color:"positive",visible:({entidad:l})=>!l.fecha_hora_fin_turno,accion:({entidad:l})=>{if(!K.value.length){oe("No puede finalizar la bit\xE1cora sin registrar ninguna actividad.");return}be("\xBFEst\xE1 seguro de finalizar la bit\xE1cora?",async()=>{const A=(await G()).fecha_hora;I(l.id,{fecha_hora_fin_turno:A})})}},je={titulo:"Agregar actividad",icono:"bi-plus",accion:()=>t(async()=>{if(u.fecha_hora_fin_turno)return oe("Ya no tiene permitido registrar actividades debido a que la bit\xE1cora ha sido finalizada.");E(),ae.abrirModalEntidad("ActividadBitacoraPage",{bitacora_id:u.id,mixin:z})})},Ne={titulo:"Finalizar",icono:"bi-clock-history",color:"positive",visible:({entidad:l})=>!l.fecha_hora_fin,accion:({entidad:l})=>{be("\xBFEst\xE1 seguro de finalizar esta actividad?",async()=>{const A=(await G()).fecha_hora;M(l.id,{fecha_hora_fin:A})})}},De={titulo:"Confirmar que se notific\xF3",icono:"bi-clock-history",color:"teal",visible:({entidad:l})=>l.notificacion_inmediata&&!l.medio_notificacion,accion:({entidad:l})=>{const A=ue({mensaje:"Seleccione el medio por el cu\xE1l realiz\xF3 la notificaci\xF3n",accion:async sa=>{M(l.id,{medio_notificacion:sa})},tipo:"radio",items:[{label:"Llamada",value:"LLAMADA"},{label:"Correo electr\xF3nico",value:"CORREO ELECTRONICO"},{label:"Mensajer\xEDa instant\xE1nea (Whatsapp, telegram, etc)",value:"MENSAJERIA INSTANTANEA"},{label:"SMS",value:"SMS"},{label:"Radio an\xE1loga o digital ",value:"RADIO ANALOGA O DIGITAL"}]});Pe(A)}},Qe={titulo:"Consultar",icono:ce.consultar,color:"primary",accion:({entidad:l})=>{E(),console.log(l),H.hydrate(l),Z.value=T.consultar,ae.abrirModalEntidad("ActividadBitacoraPage",{bitacora_id:u.id,mixin:z})}},Ge=()=>{we.dialog({title:"Revisi\xF3n de bit\xE1cora",message:"Ingrese la retroalimentaci\xF3n del supervisor:",prompt:{model:"",type:"textarea"},cancel:!0,persistent:!0}).onOk(async l=>{if(!(l!=null&&l.trim())){oe("Debe ingresar una retroalimentaci\xF3n.");return}await I(u.id,{revisado_por_supervisor:!0,retroalimentacion_supervisor:l}),u.revisado_por_supervisor=!0,u.retroalimentacion_supervisor=l==null?void 0:l.trim()})},He=le(()=>e.user.roles.includes("SUPERVISOR DE GUARDIAS")),{refListadoSeleccionable:Ke,criterioBusqueda:J,listado:Ze,listar:Je,seleccionar:Xe}=W(u,"empleados","agente_turno"),{refListadoSeleccionable:Ye,criterioBusqueda:ie,listado:We,listar:xe,seleccionar:ea}=W(u,"empleados","protector"),{refListadoSeleccionable:aa,criterioBusqueda:re,listado:oa,listar:ia,seleccionar:ra}=W(u,"empleados","conductor"),pe=Ce({zona:{required:R},jornada:{required:R},agente_turno:{required:R},protector:{required:R},conductor:{required:R}},u);v(pe.value),q(()=>{fe(),m.value="1",g({bitacora_id:u.id})}),j(()=>{J.value=e.user.apellidos+" "+e.user.nombres,u.agente_turno=e.user.id,ie.value=null,re.value=null,f.prendas=[]}),ee(l=>{m.value="2",_a(async()=>{if(l){const A=await s.consultar(l);u.hydrate(A.result),d.value=T.consultar,fe()}})});const fe=()=>{J.value=u.nombres_agente_turno,ie.value=u.nombres_protector,re.value=u.nombres_conductor,ve()};function ta(l){r(l)}return J.value=e.user.apellidos+" "+e.user.nombres,u.agente_turno=e.user.id,{v$:pe,refActividades:Ee,mixin:y,configuracionColumnasBitacora:Na,configuracionColumnasEmpleadosLite:Ae,configuracionColumnasActividadBitacora:$e,bitacora:u,disabled:_,listadosAuxiliares:f,ordenarLista:Sa,zonas:Le,filtrarZonas:Re,jornadas:Da,btnAgregarActividad:je,btnEstablecerHoraFin:Ne,btnVerActividadBitacora:Qe,btnConfirmarNotificado:De,ccActividadBitacora:[...$e,Va],tabsPage:m,mostrarSolicitarArchivoActividad:Fe,modales:ae,iconos:ce,recargarZonas:Ie,consultarPrendasPermitidas:ve,guardarActividad:Me,marcarRevisadoDesdeTabla:Ge,listadoActividadBitacora:K,btnRegistrarActividades:Te,btnFinalizarBitacora:Ue,listarActividadBitacora:g,accion:d,acciones:T,prendas:Oe,tabsOptions:ze,refListadoSeleccionable:Ke,criterioBusqueda:J,listado:Ze,esSupervisor:He,listar:Je,filtrar:r,aplicarFiltro:ta,seleccionar:Xe,refListadoSeleccionableProtector:Ye,criterioBusquedaProtector:ie,listadoProtector:We,listarProtector:xe,seleccionarProtector:ea,refListadoSeleccionableConductor:aa,criterioBusquedaConductor:re,listadoConductor:oa,listarConductor:ia,seleccionarConductor:ra}}});const Ro={class:"row q-col-gutter-sm q-mb-md"},Io={class:"col-12 text-bold q-py-sm"},Mo={class:"col-12 col-md-3"},To={class:"error-msg"},Uo={class:"col-12 col-md-3"},jo={class:"error-msg"},No={key:0,class:"col-12 col-md-3"},Do={key:1,class:"col-12 col-md-3"},Qo={key:2,class:"col-12 col-md-3"},Go={class:"col-12 col-md-3"},Ho={class:"error-msg"},Ko={class:"col-12 col-md-3"},Zo={class:"error-msg"},Jo={class:"row q-mb-md"},Xo={class:"col-12 text-bold q-py-sm"},Yo={key:0,class:"bg-body q-pa-md rounded"},Wo={class:"col-12 q-pt-md"},xo={key:1,class:"col-12 q-mt-lg"},ei={class:"text-bold q-mb-sm"},ai={key:0,class:"row"},oi={class:"col-12 q-mb-sm"},ii={class:"col-12 q-mb-md"},ri={class:"col-12 text-bold q-py-sm q-my-sm"},ti={class:"col-12"},si={key:1,class:"column"};function li(e,a,s,y,u,_){const f=$("callout"),m=$("fecha-hora-automatica-input"),V=$("voice-input"),d=$("essential-table"),v=$("multiple-page-layout"),t=$("essential-selectable-table"),w=$("solicitar-archivo"),U=$("modales-entidad"),I=$("tab-layout");return c(),N(I,{mixin:e.mixin,"configuracion-columnas":e.configuracionColumnasBitacora,"mostrar-button-submits":e.tabsPage==1,mostrarColumnasVisibles:!e.$q.screen.xs,accion1:e.btnRegistrarActividades,accion2:e.btnFinalizarBitacora,"permitir-editar":!1,"puede-filtrar":!0,paginate:"",full:""},{formulario:n(()=>[o(v,{mixin:e.mixin,tabsOptions:e.tabsOptions,"regresar-principio":"",mostrarRegresar:!1},{tab1:n(()=>[o(f,{mensaje:"La <b>selecci\xF3n de prendas recibidas</b> se activar\xE1 luego de que <b>seleccione la zona</b>.",tipo:"info",class:"q-mb-xl"}),o(Aa,{onSubmit:a[14]||(a[14]=ka(()=>{},["prevent"]))},{default:n(()=>[i("div",Ro,[i("div",Io,[o(h,{name:"bi-x-diamond",class:"q-mr-sm",color:"primary"}),a[17]||(a[17]=B(" Informaci\xF3n general ")),o(te,{class:"q-my-xs"})]),i("div",Mo,[a[20]||(a[20]=i("label",{class:"q-mb-sm block"},"Zona",-1)),o(de,{modelValue:e.bitacora.zona,"onUpdate:modelValue":[a[1]||(a[1]=r=>e.bitacora.zona=r),a[3]||(a[3]=r=>e.consultarPrendasPermitidas())],options:e.zonas,disable:e.disabled,"options-dense":"",dense:"",outlined:"","input-debounce":0,"use-input":"",onFilter:e.filtrarZonas,onPopupShow:a[2]||(a[2]=r=>e.ordenarLista(e.zonas,"nombre")),"option-value":r=>r.id,"option-label":r=>r.nombre,error:!!e.v$.zona.$errors.length,onBlur:e.v$.zona.$touch,"emit-value":"","map-options":""},{"no-option":n(()=>[o(qe,null,{default:n(()=>[o(ke,{class:"text-grey"},{default:n(()=>a[18]||(a[18]=[B(" No hay resultados ")])),_:1})]),_:1})]),after:n(()=>[o(F,{color:"primary",onClick:a[0]||(a[0]=r=>e.recargarZonas()),dense:""},{default:n(()=>[o(h,{name:e.iconos.recargar,class:"q-pad-xs"},null,8,["name"]),o(se,null,{default:n(()=>a[19]||(a[19]=[B("Recargar zonas")])),_:1})]),_:1})]),error:n(()=>[(c(!0),b(P,null,O(e.v$.zona.$errors,r=>(c(),b("div",{key:r.$uid},[i("div",To,S(r.$message),1)]))),128))]),_:1},8,["modelValue","options","disable","onFilter","option-value","option-label","error","onBlur"])]),i("div",Uo,[a[21]||(a[21]=i("label",{class:"q-mb-sm block"},"Jornada",-1)),o(de,{modelValue:e.bitacora.jornada,"onUpdate:modelValue":a[4]||(a[4]=r=>e.bitacora.jornada=r),options:e.jornadas,disable:e.disabled,error:!!e.v$.jornada.$errors.length,onBlur:e.v$.jornada.$touch,"options-dense":"",outlined:"",dense:""},{error:n(()=>[(c(!0),b(P,null,O(e.v$.jornada.$errors,r=>(c(),b("div",{key:r.$uid},[i("div",jo,S(r.$message),1)]))),128))]),_:1},8,["modelValue","options","disable","error","onBlur"])]),e.accion===e.acciones.consultar?(c(),b("div",No,[o(m,{modelValue:e.bitacora.fecha_hora_inicio_turno,"onUpdate:modelValue":a[5]||(a[5]=r=>e.bitacora.fecha_hora_inicio_turno=r),disable:e.disabled,label:"Fecha y hora de inicio de turno",validador:e.v$,clave:"fecha_hora_inicio_turno"},null,8,["modelValue","disable","validador"])])):C("",!0),e.accion===e.acciones.consultar?(c(),b("div",Do,[a[22]||(a[22]=i("label",{class:"q-mb-sm block"},"Fecha y hora de fin de turno",-1)),o(k,{modelValue:e.bitacora.fecha_hora_fin_turno,"onUpdate:modelValue":a[6]||(a[6]=r=>e.bitacora.fecha_hora_fin_turno=r),hint:"Se calcula autom\xE1ticamente al finalizar la bit\xE1cora",disable:"",outlined:"",dense:""},null,8,["modelValue"])])):C("",!0),e.accion===e.acciones.consultar?(c(),b("div",Qo,[a[23]||(a[23]=i("label",{class:"q-mb-sm block"},"Agente de turno",-1)),o(k,{modelValue:e.criterioBusqueda,"onUpdate:modelValue":a[7]||(a[7]=r=>e.criterioBusqueda=r),placeholder:"Escriba y presione enter para buscar",hint:"Puede buscar por nombre, apellido o identificaci\xF3n",disable:"",onKeydown:Y(e.listar,["enter"]),outlined:"",dense:""},{append:n(()=>[o(h,{name:e.bitacora.agente_turno?"bi-check-circle-fill":"bi-check-circle",color:e.bitacora.agente_turno?"positive":"grey-6",size:"xs"},null,8,["name","color"])]),_:1},8,["modelValue","onKeydown"])])):C("",!0),i("div",Go,[a[25]||(a[25]=i("label",{class:"q-mb-sm block"},"Protector",-1)),o(k,{modelValue:e.criterioBusquedaProtector,"onUpdate:modelValue":a[8]||(a[8]=r=>e.criterioBusquedaProtector=r),placeholder:"Escriba y presione enter para buscar",hint:"Puede buscar por nombre, apellido o identificaci\xF3n",disable:e.disabled,onKeydown:Y(e.listarProtector,["enter"]),error:!!e.v$.protector.$errors.length,onBlur:e.v$.protector.$touch,outlined:"",dense:""},{append:n(()=>[o(h,{name:e.bitacora.protector?"bi-check-circle-fill":"bi-check-circle",color:e.bitacora.protector?"positive":"grey-6",size:"xs"},null,8,["name","color"])]),after:n(()=>[o(F,{color:"primary",onClick:e.listarProtector,dense:""},{default:n(()=>[o(h,{name:e.iconos.buscar},null,8,["name"]),o(se,null,{default:n(()=>a[24]||(a[24]=[B("Recargar protector")])),_:1})]),_:1},8,["onClick"])]),error:n(()=>[(c(!0),b(P,null,O(e.v$.protector.$errors,r=>(c(),b("div",{key:r.$uid},[i("div",Ho,S(r.$message),1)]))),128))]),_:1},8,["modelValue","disable","onKeydown","error","onBlur"])]),i("div",Ko,[a[27]||(a[27]=i("label",{class:"q-mb-sm block"},"Conductor",-1)),o(k,{modelValue:e.criterioBusquedaConductor,"onUpdate:modelValue":a[9]||(a[9]=r=>e.criterioBusquedaConductor=r),placeholder:"Escriba y presione enter para buscar",hint:"Puede buscar por nombre, apellido o identificaci\xF3n",disable:e.disabled,onKeydown:Y(e.listarConductor,["enter"]),error:!!e.v$.conductor.$errors.length,onBlur:e.v$.conductor.$touch,outlined:"",dense:""},{append:n(()=>[o(h,{name:e.bitacora.conductor?"bi-check-circle-fill":"bi-check-circle",color:e.bitacora.conductor?"positive":"grey-6",size:"xs"},null,8,["name","color"])]),after:n(()=>[o(F,{color:"primary",onClick:e.listarConductor,dense:""},{default:n(()=>[o(h,{name:e.iconos.buscar},null,8,["name"]),o(se,null,{default:n(()=>a[26]||(a[26]=[B("Recargar protector")])),_:1})]),_:1},8,["onClick"])]),error:n(()=>[(c(!0),b(P,null,O(e.v$.conductor.$errors,r=>(c(),b("div",{key:r.$uid},[i("div",Zo,S(r.$message),1)]))),128))]),_:1},8,["modelValue","disable","onKeydown","error","onBlur"])])]),i("div",Jo,[i("div",Xo,[o(h,{name:"bi-x-diamond",class:"q-mr-sm",color:"primary"}),a[28]||(a[28]=i("span",{class:"inline-block q-mr-sm q-mb-sm"},"Selecci\xF3n de prendas recibidas",-1)),e.bitacora.zona&&e.accion===e.acciones.nuevo?(c(),N(F,{key:0,color:"positive",icon:e.iconos.recargar,onClick:a[10]||(a[10]=r=>e.consultarPrendasPermitidas()),unelevated:"",dense:"",rounded:"","no-caps":"",label:"Recargar prendas asignadas",class:"q-px-sm"},null,8,["icon"])):C("",!0),o(te,{class:"q-my-xs"})]),e.prendas.length?C("",!0):(c(),b("span",Yo,"Seleccione una zona para mostrar el listado de prendas.")),(c(!0),b(P,null,O(e.prendas,r=>(c(),b("div",{key:r.id,class:"col-12 col-md-3 q-mb-md"},[o(ne,{modelValue:e.bitacora.prendas_recibidas,"onUpdate:modelValue":a[11]||(a[11]=q=>e.bitacora.prendas_recibidas=q),label:r.descripcion,val:r.id,disable:e.disabled},null,8,["modelValue","label","val","disable"])]))),128)),i("div",Wo,[o(V,{modelValue:e.bitacora.observaciones,"onUpdate:modelValue":a[12]||(a[12]=r=>e.bitacora.observaciones=r),v$:e.v$,"key-error":"observaciones",label:"Observaciones o Novedades acerca de las prendas recibidas",disable:e.disabled,placeholder:"Opcional"},null,8,["modelValue","v$","disable"])]),e.bitacora.revisado_por_supervisor?(c(),b("div",xo,[o(te,{class:"q-my-md"}),i("div",ei,[o(h,{name:"bi-chat-square-quote",class:"q-mr-sm",color:"teal"}),a[29]||(a[29]=B(" Retroalimentaci\xF3n del supervisor "))]),o(k,{modelValue:e.bitacora.retroalimentacion_supervisor,"onUpdate:modelValue":a[13]||(a[13]=r=>e.bitacora.retroalimentacion_supervisor=r),type:"textarea",outlined:"",autogrow:"",dense:"",disable:""},null,8,["modelValue"])])):C("",!0)])]),_:1})]),tab2:n(()=>[e.bitacora.id?(c(),b("div",ai,[i("div",oi,[o(f,{tipo:"info",mensaje:"Las actividades registradas <b>se guardan autom\xE1ticamente</b>."})]),i("div",ii,[e.bitacora.fecha_hora_fin_turno?(c(),N(f,{key:0,mensaje:"<b>Ya no tiene permitido registrar actividades</b> debido a que la <b>bit\xE1cora ha sido finalizada</b>."})):C("",!0)]),i("div",ri,[o(h,{name:"bi-x-diamond",class:"q-mr-sm",color:"primary"}),a[30]||(a[30]=B(" Registro de actividades "))]),i("div",ti,[o(d,{ref:"refActividades",titulo:"Actividades",configuracionColumnas:e.ccActividadBitacora,datos:e.listadoActividadBitacora,"ajustar-celdas":"","alto-fijo":!1,accion1Header:e.btnAgregarActividad,accion1:e.btnVerActividadBitacora,accion2:e.btnConfirmarNotificado,accion3:e.btnEstablecerHoraFin,"permitir-consultar":!1,"permitir-editar":!1,"permitir-eliminar":!1,"mostrar-footer":!1,permitirEditarModal:"","editar-fila-local":!1,"permitir-editar-celdas":"",mostrarColumnasVisibles:!e.$q.screen.xs,onGuardarFilaNueva:e.guardarActividad},null,8,["configuracionColumnas","datos","accion1Header","accion1","accion2","accion3","mostrarColumnasVisibles","onGuardarFilaNueva"])])])):(c(),b("div",si,[o(f,{tipo:"info",mensaje:"Primero <b>cree una bit\xE1cora</b> para poder <b>registrar actividades</b>.",class:"q-mb-md"}),o(F,{color:"primary",label:"Ir a formulario para crear bit\xE1cora",icon:"bi-list",onClick:a[15]||(a[15]=r=>e.tabsPage="1"),"no-caps":"",unelevated:""})]))]),_:1},8,["mixin","tabsOptions"])]),"custom-buttons":n(()=>[e.bitacora.id&&e.accion===e.acciones.consultar&&e.bitacora.fecha_hora_fin_turno&&!e.bitacora.revisado_por_supervisor&&e.esSupervisor?(c(),N(F,{key:0,color:"green",icon:"bi-check",label:"Marcar Bit\xE1cora como revisada",onClick:e.marcarRevisadoDesdeTabla,"no-caps":"",unelevated:""},null,8,["onClick"])):C("",!0)]),modales:n(()=>[o(t,{ref:"refListadoSeleccionable","configuracion-columnas":e.configuracionColumnasEmpleadosLite,datos:e.listado,onSelected:e.seleccionar,"tipo-seleccion":"single"},null,8,["configuracion-columnas","datos","onSelected"]),o(t,{ref:"refListadoSeleccionableProtector","configuracion-columnas":e.configuracionColumnasEmpleadosLite,datos:e.listadoProtector,onSelected:e.seleccionarProtector,"tipo-seleccion":"single"},null,8,["configuracion-columnas","datos","onSelected"]),o(t,{ref:"refListadoSeleccionableConductor","configuracion-columnas":e.configuracionColumnasEmpleadosLite,datos:e.listadoConductor,onSelected:e.seleccionarConductor,"tipo-seleccion":"single"},null,8,["configuracion-columnas","datos","onSelected"]),o(w,{mostrar:e.mostrarSolicitarArchivoActividad,onCerrar:a[16]||(a[16]=r=>e.mostrarSolicitarArchivoActividad=!1),mixin:e.mixin,"tipo-archivo":"ADJUNTO"},null,8,["mostrar","mixin"]),o(U,{comportamiento:e.modales,"mixin-modal":e.mixin,persistent:!1},null,8,["comportamiento","mixin-modal"])]),_:1},8,["mixin","configuracion-columnas","mostrar-button-submits","mostrarColumnasVisibles","accion1","accion2"])}var mr=Ve(Lo,[["render",li]]);export{mr as default};
