var oo=Object.defineProperty;var eo=(a,o,n)=>o in a?oo(a,o,{enumerable:!0,configurable:!0,writable:!0,value:n}):a[o]=n;var l=(a,o,n)=>(eo(a,typeof o!="symbol"?o+"":o,n),n);import{e as sa,aa as io,by as to,bz as ro,k as lo,d as x,c as D,f as ya,v as c,x as p,y as i,K as B,z as e,F as s,G as P,H as F,O as z,B as y,I as k,bw as $a,s as da,U as O,S as no,a2 as X,h as so,bx as T,_ as _a,t as $,P as Y,D as C,J as w,L as ra,j as co,b0 as uo,bf as mo,u as bo,m as vo,n as po,p as fo,A as go,a4 as ho,Q as pa}from"./index.6449c167.js";import{Q as Va,a as qa}from"./QItemSection.9a955ec6.js";import{a as ta}from"./QToolbar.8dbe891b.js";import{Q as la}from"./QSelect.6ce302d7.js";import{Q as yo}from"./QForm.ca56f146.js";import{c as ka}from"./configuracionColumnasEmpleadosLite.5961fbe8.js";import{u as $o}from"./filtrosListadosGenerales.c3aa2da3.js";import{y as G,b as _o,Y as Vo,a as qo,w as ko}from"./utils.521b98f3.js";import{r as L,a as J}from"./i18n-validators.29e2545c.js";import{u as Aa}from"./index.490dde02.js";import{i as na}from"./iconos.5bc406be.js";import{M as Ao}from"./MultiplePageLayout.2165795c.js";import{E as Ca}from"./EssentialSelectableTable.5a9cc771.js";import{T as Co}from"./TabLayout.0bce4313.js";import{_ as Q,S as Bo,E as So}from"./EssentialTable.00c17e97.js";import{M as wo}from"./ModalEntidad.168b465e.js";import{S as Eo}from"./SolicitarArchivo.f1fba8d9.js";import{C as Po}from"./CalloutComponent.a81d1558.js";import{C as fa}from"./ContenedorSimpleMixin.09c9bed5.js";import{u as W}from"./useOrquestadorSelectorEmpleados.bdcf8e7e.js";import{C as Fo,a as Oo}from"./ComponenteModal.domain.50e59f97.js";import{S as zo}from"./SimpleLayout.3a4276ec.js";import{G as Lo}from"./GestorArchivos.10722df3.js";import{T as Mo}from"./TipoEventoBitacoraController.e73343d5.js";import{E as ca}from"./entidadAuditable.75a46700.js";import{Z as ga}from"./ZonaController.bf2f58e2.js";import"./position-engine.70d0a89f.js";import"./QChip.95469f73.js";import"./format.8ac60962.js";import"./index.0198dd12.js";import"./QTabs.6c234f27.js";import"./QResizeObserver.9af84680.js";import"./QTabPanels.49d2362a.js";import"./touch.9135741d.js";import"./QPopupProxy.72ff1d6d.js";import"./QPage.5d173a8a.js";import"./buttonSubmits.fe817da3.js";import"./EssentialTablePagination.d5c1010a.js";import"./use-fullscreen.a7661f85.js";import"./QBadge.e6f320cd.js";import"./_commonjsHelpers.8402d862.js";import"./QImg.fd079679.js";import"./QFile.90d9394a.js";import"./VisorImagen.75b3c53f.js";import"./logo.4781eea2.js";import"./seleccionContratacionPersonal.utils.e3e1ed3d.js";import"./configuracion_general.37a05c0a.js";import"./ConfiguracionController.c50d9536.js";import"./selector.9691ac4b.js";import"./SelectorController.de8e1cd0.js";import"./QUploader.cca1b7bd.js";import"./QCircularProgress.b24a7ee9.js";import"./configuracionColumnasArchivoSubtarea.215f4ffd.js";const ha=sa([{name:"fecha_hora_inicio",field:"fecha_hora_inicio",label:"Fecha y hora de inicio",align:"left",disableModal:!0},{name:"fecha_hora_fin",field:"fecha_hora_fin",label:"Fecha y hora de fin",align:"left",sortable:!0,visibleModal:!1},{name:"tipo_evento_bitacora",field:"tipo_evento_bitacora",label:"Tipo de evento",align:"left",type:"select",requerido:!0},{name:"medio_notificacion",field:"medio_notificacion",label:"Medio por el cual se notific\xF3",align:"left"},{name:"actividad",field:"actividad",label:"Actividad",align:"left",type:"voice",columnClass:"col-12 col-md-6",requerido:!0},{name:"fotografia_evidencia_1",field:"fotografia_evidencia_1",label:"Fotograf\xEDa de evidencia 1 (Opcional)",align:"left",type:"imagen",editable:!0,visible:!1},{name:"fotografia_evidencia_2",field:"fotografia_evidencia_2",label:"Fotograf\xEDa de evidencia 2 (Opcional)",align:"left",type:"imagen",editable:!0,visible:!1}]),Io=[{name:"zona",field:"zona",label:"Zona",align:"left"},{name:"jornada",field:"jornada",label:"Jornada",align:"left"},{name:"fecha_hora_inicio_turno",field:"fecha_hora_inicio_turno",label:"Fecha y hora de inicio de turno",align:"left"},{name:"fecha_hora_fin_turno",field:"fecha_hora_fin_turno",label:"Fecha y hora de fin de turno",align:"left"},{name:"agente_turno",field:"agente_turno",label:"Agente de turno",align:"left"},{name:"protector",field:"protector",label:"Protector",align:"left"},{name:"conductor",field:"conductor",label:"Conductor",align:"left"},{name:"observaciones",field:"observaciones",label:"Observaciones",align:"left"}],To=["DIURNA","NOCTURNA"],jo='<g transform="translate(20 50)"><rect x="-10" y="-30" width="20" height="60" fill="currentColor" opacity="0.6"><animateTransform attributeName="transform" type="scale" from="2" to="1" begin="0s" repeatCount="indefinite" dur="1s" calcMode="spline" keySplines="0.1 0.9 0.4 1" keyTimes="0;1" values="2;1"></animateTransform></rect></g><g transform="translate(50 50)"><rect x="-10" y="-30" width="20" height="60" fill="currentColor" opacity="0.8"><animateTransform attributeName="transform" type="scale" from="2" to="1" begin="0.1s" repeatCount="indefinite" dur="1s" calcMode="spline" keySplines="0.1 0.9 0.4 1" keyTimes="0;1" values="2;1"></animateTransform></rect></g><g transform="translate(80 50)"><rect x="-10" y="-30" width="20" height="60" fill="currentColor" opacity="0.9"><animateTransform attributeName="transform" type="scale" from="2" to="1" begin="0.2s" repeatCount="indefinite" dur="1s" calcMode="spline" keySplines="0.1 0.9 0.4 1" keyTimes="0;1" values="2;1"></animateTransform></rect></g>';var Uo=io({name:"QSpinnerFacebook",props:to,setup(a){const{cSize:o,classes:n}=ro(a);return()=>lo("svg",{class:n.value,width:o.value,height:o.value,viewBox:"0 0 100 100",xmlns:"http://www.w3.org/2000/svg",preserveAspectRatio:"xMidYMid",innerHTML:jo})}});const No={class:"row"},Ro={class:"col-12"},Qo={class:"col-12"},Do={class:"q-mb-sm block"},Go=x({__name:"FechaHoraAutomaticaInput",props:{modelValue:{type:String,default:""},disable:{type:Boolean,default:!1},validador:{type:Object,required:!0},clave:{type:String,required:!0},label:{type:String,default:"Fecha y hora"}},emits:["update:modelValue"],setup(a,{emit:o}){const n=o,h=a,u=D(!1),_=ya({get:()=>h.modelValue,set:m=>{n("update:modelValue",m)}});async function f(){u.value=!0,_.value=(await G()).fecha_hora,u.value=!1}return(m,V)=>{var d,v;return c(),p("div",No,[i("div",Ro,[i("div",Qo,[i("label",Do,B(a.label),1),e(k,{modelValue:_.value,"onUpdate:modelValue":V[1]||(V[1]=r=>_.value=r),outlined:"",readonly:"",dense:"",hint:"Presione el bot\xF3n para obtener la fecha y hora actual",error:!!((d=a.validador[a.clave])!=null&&d.$errors.length),onBlur:(v=a.validador.coordenadas)==null?void 0:v.$touch},{error:s(()=>{var r;return[(c(!0),p(P,null,F((r=a.validador[a.clave])==null?void 0:r.$errors,S=>(c(),p("div",{key:S.$uid},[i("div",null,B(S.$message),1)]))),128))]}),append:s(()=>[e(z,{color:"primary","no-wrap":"",onClick:V[0]||(V[0]=r=>f()),disable:a.disable,dense:"",push:"",loading:u.value},{loading:s(()=>[e(Uo)]),default:s(()=>[e(y,{name:"bi-clock",size:"xs"})]),_:1},8,["disable","loading"])]),_:1},8,["modelValue","error","onBlur"])])])])}}});var Ho=Go;class Ko extends $a{constructor(){super(da.actividades_bitacoras)}}const Zo={class:"row q-col-gutter-sm q-py-md q-mb-md"},Jo={class:"col-12 col-md-3"},Xo={class:"col-12 col-md-3"},Yo={class:"col-12 col-md-3"},Wo={class:"col-12 col-md-3"},xo={class:"col-12 col-md-3"},ae={class:"error-msg"},oe={class:"col-12 col-md-3"},ee={class:"col-12 col-md-3"},ie={class:"col-12"},te=x({__name:"FormularioVisitante",props:{visitante:{type:Object,required:!0},v$:{type:Object,required:!0},disable:{type:Boolean,default:!1}},setup(a){const o=a,{refListadoSeleccionable:n,criterioBusqueda:h,listado:u,listar:_,seleccionar:f}=W(o.visitante,"empleados","persona_visitada"),m=sa(o.visitante);return h.value=m.persona_visitada,(V,d)=>(c(),p("div",Zo,[i("div",Jo,[e(Q,{modelValue:m.nombre_completo,"onUpdate:modelValue":d[0]||(d[0]=v=>m.nombre_completo=v),v$:a.v$,"key-error":"visitante.nombre_completo",label:"Nombre completo (Apellidos y nombres)",placeholder:"OBLIGATORIO",disable:a.disable},null,8,["modelValue","v$","disable"])]),i("div",Xo,[d[7]||(d[7]=i("label",{class:"q-mb-sm block"},"Identificaci\xF3n",-1)),e(k,{modelValue:m.identificacion,"onUpdate:modelValue":d[1]||(d[1]=v=>m.identificacion=v),placeholder:"Obligatorio",disable:a.disable,error:!!a.v$.visitante.identificacion.$errors.length,onBlur:a.v$.visitante.identificacion.$touch,outlined:"",dense:""},null,8,["modelValue","disable","error","onBlur"])]),i("div",Yo,[d[8]||(d[8]=i("label",{class:"q-mb-sm block"},"Celular",-1)),e(k,{modelValue:m.celular,"onUpdate:modelValue":d[2]||(d[2]=v=>m.celular=v),placeholder:"Opcional",disable:a.disable,mask:"0## ### ####",outlined:"",dense:""},null,8,["modelValue","disable"])]),i("div",Wo,[e(Q,{modelValue:m.motivo_visita,"onUpdate:modelValue":d[3]||(d[3]=v=>m.motivo_visita=v),v$:a.v$,"key-error":"visitante.motivo_visita",label:"Motivo de visita",placeholder:"OBLIGATORIO",disable:a.disable},null,8,["modelValue","v$","disable"])]),i("div",xo,[d[9]||(d[9]=i("label",{class:"q-mb-sm block"},"Persona visitada",-1)),e(k,{modelValue:O(h),"onUpdate:modelValue":d[4]||(d[4]=v=>no(h)?h.value=v:null),placeholder:"Escriba y presione enter para buscar",hint:"Puede buscar por nombre, apellido o identificaci\xF3n",disable:a.disable,onKeydown:X(O(_),["enter"]),error:!!a.v$.visitante.persona_visitada.$errors.length,onBlur:a.v$.visitante.persona_visitada.$touch,outlined:"",dense:""},{append:s(()=>[e(y,{name:a.visitante.persona_visitada?"bi-check-circle-fill":"bi-check-circle",color:m.persona_visitada?"positive":"grey-6",size:"xs"},null,8,["name","color"])]),after:s(()=>[e(z,{color:"positive",icon:O(na).buscar,onClick:O(_),unelevated:"",dense:""},null,8,["icon","onClick"])]),error:s(()=>[(c(!0),p(P,null,F(a.v$.visitante.persona_visitada.$errors,v=>(c(),p("div",{key:v.$uid},[i("div",ae,B(v.$message),1)]))),128))]),_:1},8,["modelValue","disable","onKeydown","error","onBlur"])]),i("div",oe,[d[10]||(d[10]=i("label",{class:"q-mb-sm block"},"Placa de veh\xEDculo",-1)),e(k,{modelValue:m.placa_vehiculo,"onUpdate:modelValue":d[5]||(d[5]=v=>m.placa_vehiculo=v),placeholder:"Opcional",disable:a.disable,mask:"XXX-##X#",outlined:"",dense:""},null,8,["modelValue","disable"])]),i("div",ee,[e(Q,{modelValue:m.observaciones,"onUpdate:modelValue":d[6]||(d[6]=v=>m.observaciones=v),v$:a.v$,"key-error":"observaciones",label:"Observaciones",placeholder:"OPCIONAL",disable:a.disable},null,8,["modelValue","v$","disable"])]),i("div",ie,[e(Ca,{ref_key:"refListadoSeleccionable",ref:n,"configuracion-columnas":O(ka),datos:O(u),onSelected:O(f),"tipo-seleccion":"single"},null,8,["configuracion-columnas","datos","onSelected"])])]))}});var re=x({components:{SimpleLayout:zo,VoiceInput:Q,SelectorImagen:Bo,GestorArchivos:Lo,FormularioVisitante:te},props:{datos:Object},emits:["cerrar-modal"],setup(a,{emit:o}){var I;const{entidad:n,disabled:h,listadosAuxiliares:u,accion:_,listadoArchivos:f}=a.datos.mixin.useReferencias(),{setValidador:m,cargarVista:V,obtenerListados:d,consultar:v}=a.datos.mixin.useComportamiento(),{onGuardado:r,onModificado:S,onConsultado:j,onReestablecer:U,onBeforeGuardar:t}=a.datos.mixin.useHooks();V(async()=>{await d({tiposEventos:{controller:new Mo,params:{activo:1}}})});const q=D(),N=D(),M={tipo_evento_bitacora:{required:L},actividad:{required:L},visitante:{nombre_completo:{requiredIf:J(()=>n.mostrar_seccion_visitante)},identificacion:{requiredIf:J(()=>n.mostrar_seccion_visitante)},motivo_visita:{requiredIf:J(()=>n.mostrar_seccion_visitante)},persona_visitada:{requiredIf:J(()=>n.mostrar_seccion_visitante)}}},H=Aa(M,n);m(H.value);const K=async()=>await q.value.subir(),aa=()=>{n.notificacion_inmediata=u.tiposEventos.find(g=>g.id===n.tipo_evento_bitacora).notificacion_inmediata};return r(g=>{N.value=g,setTimeout(async()=>{await K(),o("cerrar-modal")})}),S(g=>{N.value=g,setTimeout(()=>K(),1)}),j(async()=>{setTimeout(async()=>{var g;await q.value.listarArchivosAlmacenados(n.id),n.mostrar_seccion_archivos_adjuntos=!!f.value.length,n.mostrar_seccion_visitante=!!((g=n.visitante)!=null&&g.id),q.value.quiero_subir_archivos=!1},1)}),U(()=>{var g,E;q.value&&q.value.limpiarListado(),G().then(R=>n.fecha_hora_inicio=R.fecha_hora),n.bitacora=(E=(g=a.datos)==null?void 0:g.bitacora_id)!=null?E:null,q.value.quiero_subir_archivos=!0}),t(()=>{n.visitante=n.mostrar_seccion_visitante?n.visitante:null}),so(()=>{var g,E;q.value&&q.value.limpiarListado(),_.value===T.consultar?v(n):(G().then(R=>n.fecha_hora_inicio=R.fecha_hora),n.bitacora=(E=(g=a.datos)==null?void 0:g.bitacora_id)!=null?E:null)}),{v$:H,mixin:(I=a.datos)==null?void 0:I.mixin,actividad:n,disabled:h,listadosAuxiliares:u,refArchivo:q,accion:_,acciones:T,idEntidad:N,validarNotificacionInmediata:aa,listadoArchivos:f}}});const le={class:"row q-col-gutter-sm q-mb-lg"},ne={class:"col-12 text-pdrimary text-bold q-py-sm q-my-sm"},se={class:"col-12 col-md-3"},de={key:0,class:"col-12 col-md-3"},ce={class:"col-12 col-md-6"},ue={class:"error-msg"},me={key:1,class:"col-12 col-md-3"},be={class:"col-12 col-md-6"},ve={class:"col-12 col-md-3"},pe={class:"col-12 col-md-3"},fe={class:"row q-col-gutter-sm"},ge={class:"col-12 text-pdrimary text-bold q-py-sm q-mt-sm"},he={class:"col-12 q-mb-md"},ye={class:"row q-col-gutter-sm"},$e={class:"col-12 text-pdrimary text-bold q-py-sm q-mt-sm"},_e={key:0,class:"col-12 q-mb-md"};function Ve(a,o,n,h,u,_){const f=$("voice-input"),m=$("selector-imagen"),V=$("gestor-archivos"),d=$("formulario-visitante"),v=$("simple-layout");return c(),Y(v,{mixin:a.mixin},{formulario:s(()=>[i("div",le,[i("div",ne,[e(y,{name:"bi-x-diamond",class:"q-mr-sm",color:"primary"}),o[10]||(o[10]=C(" Registro de la actividad "))]),i("div",se,[o[11]||(o[11]=i("label",{class:"q-mb-sm block"},"Fecha y hora de inicio",-1)),e(k,{modelValue:a.actividad.fecha_hora_inicio,"onUpdate:modelValue":o[0]||(o[0]=r=>a.actividad.fecha_hora_inicio=r),outlined:"",disable:"",dense:""},null,8,["modelValue"])]),a.actividad.fecha_hora_fin?(c(),p("div",de,[o[12]||(o[12]=i("label",{class:"q-mb-sm block"},"Fecha y hora de fin",-1)),e(k,{modelValue:a.actividad.fecha_hora_fin,"onUpdate:modelValue":o[1]||(o[1]=r=>a.actividad.fecha_hora_fin=r),outlined:"",disable:"",dense:""},null,8,["modelValue"])])):w("",!0),i("div",ce,[o[14]||(o[14]=i("label",{class:"q-mb-sm block"},"Tipo de evento",-1)),e(la,{modelValue:a.actividad.tipo_evento_bitacora,"onUpdate:modelValue":[o[2]||(o[2]=r=>a.actividad.tipo_evento_bitacora=r),o[3]||(o[3]=r=>a.validarNotificacionInmediata())],options:a.listadosAuxiliares.tiposEventos,"transition-show":"scale","transition-hide":"scale",hint:"Obligatorio","options-dense":"",dense:"",outlined:"",disable:a.disabled,"option-label":r=>r.nombre,"option-value":r=>r.id,"use-input":"","input-debounce":"0","emit-value":"","map-options":"",error:!!a.v$.tipo_evento_bitacora.$errors.length,onBlur:a.v$.tipo_evento_bitacora.$touch},{"no-option":s(()=>[e(Va,null,{default:s(()=>[e(qa,{class:"text-grey"},{default:s(()=>o[13]||(o[13]=[C(" No se han agregado tipos de eventos ")])),_:1})]),_:1})]),error:s(()=>[(c(!0),p(P,null,F(a.v$.tipo_evento_bitacora.$errors,r=>(c(),p("div",{key:r.$uid},[i("div",ue,B(r.$message),1)]))),128))]),_:1},8,["modelValue","options","disable","option-label","option-value","error","onBlur"])]),a.actividad.medio_notificacion?(c(),p("div",me,[o[15]||(o[15]=i("label",{class:"q-mb-sm block"},"Medio por el cual se notific\xF3",-1)),e(k,{modelValue:a.actividad.medio_notificacion,"onUpdate:modelValue":o[4]||(o[4]=r=>a.actividad.medio_notificacion=r),outlined:"",disable:"",dense:""},null,8,["modelValue"])])):w("",!0),i("div",be,[e(f,{modelValue:a.actividad.actividad,"onUpdate:modelValue":o[5]||(o[5]=r=>a.actividad.actividad=r),label:"Actividad",disable:a.disabled,error:!!a.v$.actividad.$errors.length,onBlur:a.v$.actividad.$touch,v$:a.v$,keyError:"actividad"},null,8,["modelValue","disable","error","onBlur","v$"])]),i("div",ve,[o[16]||(o[16]=i("label",{class:"q-mb-sm block"},B("Fotograf\xEDa de evidencia 1"),-1)),e(m,{imagen:a.actividad.fotografia_evidencia_1,file_extensiones:".jpg, image/*","onUpdate:modelValue":o[6]||(o[6]=r=>a.actividad.fotografia_evidencia_1=r),hint:"Opcional",disable:a.disabled},null,8,["imagen","disable"])]),i("div",pe,[o[17]||(o[17]=i("label",{class:"q-mb-sm block"},B("Fotograf\xEDa de evidencia 2"),-1)),e(m,{imagen:a.actividad.fotografia_evidencia_2,file_extensiones:".jpg, image/*","onUpdate:modelValue":o[7]||(o[7]=r=>a.actividad.fotografia_evidencia_2=r),hint:"Opcional",disable:a.disabled},null,8,["imagen","disable"])])]),i("div",fe,[i("div",ge,[e(y,{name:"bi-x-diamond",class:"q-mr-sm",color:"primary"}),o[18]||(o[18]=C(" Archivos adjuntos (Opcional) "))]),e(ra,{"keep-color":"",modelValue:a.actividad.mostrar_seccion_archivos_adjuntos,"onUpdate:modelValue":o[8]||(o[8]=r=>a.actividad.mostrar_seccion_archivos_adjuntos=r),label:"Mostrar seccion",color:"positive",disable:a.disabled},null,8,["modelValue","disable"]),co(i("div",he,[e(V,{ref:"refArchivo",label:"Adjuntar archivos",mixin:a.mixin,disable:a.disabled,"listar-al-guardar":!1,"quiero-subir-archivos":"","permitir-subir":!1,"permitir-eliminar":a.accion==a.acciones.nuevo||a.accion==a.acciones.editar,idModelo:a.idEntidad},null,8,["mixin","disable","permitir-eliminar","idModelo"])],512),[[uo,a.actividad.mostrar_seccion_archivos_adjuntos]])]),i("div",ye,[i("div",$e,[e(y,{name:"bi-x-diamond",class:"q-mr-sm",color:"primary"}),o[19]||(o[19]=C(" Visitante (Opcional) "))]),e(ra,{"keep-color":"",modelValue:a.actividad.mostrar_seccion_visitante,"onUpdate:modelValue":o[9]||(o[9]=r=>a.actividad.mostrar_seccion_visitante=r),label:"Mostrar seccion",color:"positive",disable:a.disabled},null,8,["modelValue","disable"]),a.actividad.mostrar_seccion_visitante?(c(),p("div",_e,[e(d,{visitante:a.actividad.visitante,v$:a.v$,disable:a.disabled},null,8,["visitante","v$","disable"])])):w("",!0)])]),_:1},8,["mixin"])}var qe=_a(re,[["render",Ve]]);class ke{constructor(){l(this,"ActividadBitacoraPage");this.ActividadBitacoraPage=mo(new Fo("Actividad de bit\xE1cora",qe))}}class Ae extends Oo{constructor(){super(new ke)}}class Ce extends ca{constructor(){super(...arguments);l(this,"nombre_completo",null);l(this,"identificacion",null);l(this,"celular",null);l(this,"motivo_visita",null);l(this,"persona_visitada",null);l(this,"placa_vehiculo",null);l(this,"fecha_hora_ingreso",null);l(this,"fecha_hora_salida",null);l(this,"observaciones",null);l(this,"actividad_bitacora",null)}}class Be extends ca{constructor(){super(...arguments);l(this,"fecha_hora_inicio",null);l(this,"fecha_hora_fin",null);l(this,"tipo_evento_bitacora",null);l(this,"notificacion_inmediata",!1);l(this,"actividad",null);l(this,"fotografia_evidencia_1",null);l(this,"fotografia_evidencia_2",null);l(this,"medio_notificacion",null);l(this,"tiene_adjuntos",!1);l(this,"visitante",new Ce);l(this,"bitacora",null);l(this,"mostrar_seccion_archivos_adjuntos",!1);l(this,"mostrar_seccion_visitante",!1)}}class Se extends $a{constructor(){super(da.bitacoras)}}class we extends ca{constructor(){super(...arguments);l(this,"zona",null);l(this,"jornada",null);l(this,"fecha_hora_inicio_turno",null);l(this,"fecha_hora_fin_turno",null);l(this,"agente_turno",null);l(this,"protector",null);l(this,"conductor",null);l(this,"nombres_agente_turno",null);l(this,"nombres_protector",null);l(this,"nombres_conductor",null);l(this,"observaciones",null);l(this,"prendas_recibidas",[]);l(this,"actividades",[])}}var Ee=x({components:{MultiplePageLayout:Ao,TabLayout:Co,EssentialTable:So,FechaHoraAutomaticaInput:Ho,EssentialSelectableTable:Ca,VoiceInput:Q,Callout:Po,SolicitarArchivo:Eo,ModalesEntidad:wo},setup(){const a=bo();_o().setQuasar(vo());const n=new Se,h=new fa(we,n),{entidad:u,disabled:_,listadosAuxiliares:f,tabsPage:m,tabs:V,accion:d}=h.useReferencias(),{setValidador:v,cargarVista:r,obtenerListados:S,consultar:j,editarParcial:U}=h.useComportamiento(),{onConsultado:t,onReestablecer:q,onGuardado:N}=h.useHooks(),M=new fa(Be,new Ko),{entidad:H,listado:K,accion:aa}=M.useReferencias(),{listar:I,reestablecer:g,editarParcial:E}=M.useComportamiento();r(async()=>{await S({zonas:{controller:new ga,params:{activo:1,"":Vo("id",a.user.zonas_ids)}},prendas:[]})});const R=D(),Ba=D(!1),oa=new Ae,{confirmar:ua,promptItems:Sa,notificarAdvertencia:wa}=qo(),Ea=ya(()=>f.prendas.map(b=>({...b,descripcion:b.descripcion.toLowerCase().replace(/\b\w/g,A=>A.toUpperCase())}))),Pa=["1. Bit\xE1cora","2. Actividades registradas en la bit\xE1cora"],{zonas:Fa,filtrarZonas:Oa}=$o(f),za=async()=>{r(async()=>{await S({zonas:{controller:new ga,params:{activo:1}}})})},ma=async()=>{const b=go.getInstance(),A=await b.get(b.getEndpoint(da.prendas_zonas_permitidas,{zona_id:u.zona,empleado_id:u.agente_turno}));f.prendas=A.data.results},La=b=>{u.actividades.unshift(b)},Ma={titulo:"Registrar actividades",icono:"bi-list",color:"teal",accion:async({entidad:b})=>{await j(b),d.value=T.consultar,await I({bitacora_id:b.id}),V.value="formulario",m.value="2"}},Ia={titulo:"Finalizar bit\xE1cora",icono:"bi-check-circle-fill",color:"positive",visible:({entidad:b})=>!b.fecha_hora_fin_turno,accion:({entidad:b})=>{ua("\xBFEst\xE1 seguro de finalizar la bit\xE1cora?",async()=>{const A=(await G()).fecha_hora;U(b.id,{fecha_hora_fin_turno:A})})}},Ta={titulo:"Agregar actividad",icono:"bi-plus",accion:()=>r(async()=>{if(u.fecha_hora_fin_turno)return wa("Ya no tiene permitido registrar actividades debido a que la bit\xE1cora ha sido finalizada.");g(),oa.abrirModalEntidad("ActividadBitacoraPage",{bitacora_id:u.id,mixin:M})})},ja={titulo:"Finalizar",icono:"bi-clock-history",color:"positive",visible:({entidad:b})=>!b.fecha_hora_fin,accion:({entidad:b})=>{ua("\xBFEst\xE1 seguro de finalizar esta actividad?",async()=>{const A=(await G()).fecha_hora;E(b.id,{fecha_hora_fin:A})})}},Ua={titulo:"Confirmar que se notific\xF3",icono:"bi-clock-history",color:"teal",visible:({entidad:b})=>b.notificacion_inmediata&&!b.medio_notificacion,accion:({entidad:b})=>{const A=sa({mensaje:"Seleccione el medio por el cu\xE1l realiz\xF3 la notificaci\xF3n",accion:async ao=>{E(b.id,{medio_notificacion:ao})},tipo:"radio",items:[{label:"Llamada",value:"LLAMADA"},{label:"Correo electr\xF3nico",value:"CORREO ELECTRONICO"},{label:"Mensajer\xEDa instant\xE1nea (Whatsapp, telegram, etc)",value:"MENSAJERIA INSTANTANEA"},{label:"SMS",value:"SMS"},{label:"Radio an\xE1loga o digital ",value:"RADIO ANALOGA O DIGITAL"}]});Sa(A)}},Na={titulo:"Consultar",icono:na.consultar,color:"primary",accion:({entidad:b})=>{g(),console.log(b),H.hydrate(b),aa.value=T.consultar,oa.abrirModalEntidad("ActividadBitacoraPage",{bitacora_id:u.id,mixin:M})}},{refListadoSeleccionable:Ra,criterioBusqueda:Z,listado:Qa,listar:Da,seleccionar:Ga}=W(u,"empleados","agente_turno"),{refListadoSeleccionable:Ha,criterioBusqueda:ea,listado:Ka,listar:Za,seleccionar:Ja}=W(u,"empleados","protector"),{refListadoSeleccionable:Xa,criterioBusqueda:ia,listado:Ya,listar:Wa,seleccionar:xa}=W(u,"empleados","conductor"),ba=Aa({zona:{required:L},jornada:{required:L},agente_turno:{required:L},protector:{required:L},conductor:{required:L}},u);v(ba.value),t(()=>{va(),m.value="1",I({bitacora_id:u.id})}),q(()=>{Z.value=a.user.apellidos+" "+a.user.nombres,u.agente_turno=a.user.id,ea.value=null,ia.value=null,f.prendas=[]}),N(b=>{m.value="2",po(async()=>{if(b){const A=await n.consultar(b);u.hydrate(A.result),d.value=T.consultar,va()}})});const va=()=>{Z.value=u.nombres_agente_turno,ea.value=u.nombres_protector,ia.value=u.nombres_conductor,ma()};return Z.value=a.user.apellidos+" "+a.user.nombres,u.agente_turno=a.user.id,{v$:ba,refActividades:R,mixin:h,configuracionColumnasBitacora:Io,configuracionColumnasEmpleadosLite:ka,configuracionColumnasActividadBitacora:ha,bitacora:u,disabled:_,listadosAuxiliares:f,ordenarLista:ko,zonas:Fa,filtrarZonas:Oa,jornadas:To,btnAgregarActividad:Ta,btnEstablecerHoraFin:ja,btnVerActividadBitacora:Na,btnConfirmarNotificado:Ua,ccActividadBitacora:[...ha,fo],tabsPage:m,mostrarSolicitarArchivoActividad:Ba,modales:oa,iconos:na,recargarZonas:za,consultarPrendasPermitidas:ma,guardarActividad:La,listadoActividadBitacora:K,btnRegistrarActividades:Ma,btnFinalizarBitacora:Ia,listarActividadBitacora:I,accion:d,acciones:T,prendas:Ea,tabsOptions:Pa,refListadoSeleccionable:Ra,criterioBusqueda:Z,listado:Qa,listar:Da,seleccionar:Ga,refListadoSeleccionableProtector:Ha,criterioBusquedaProtector:ea,listadoProtector:Ka,listarProtector:Za,seleccionarProtector:Ja,refListadoSeleccionableConductor:Xa,criterioBusquedaConductor:ia,listadoConductor:Ya,listarConductor:Wa,seleccionarConductor:xa}}});const Pe={class:"row q-col-gutter-sm q-mb-md"},Fe={class:"col-12 text-bold q-py-sm"},Oe={class:"col-12 col-md-3"},ze={class:"error-msg"},Le={class:"col-12 col-md-3"},Me={class:"error-msg"},Ie={key:0,class:"col-12 col-md-3"},Te={key:1,class:"col-12 col-md-3"},je={key:2,class:"col-12 col-md-3"},Ue={class:"col-12 col-md-3"},Ne={class:"error-msg"},Re={class:"col-12 col-md-3"},Qe={class:"error-msg"},De={class:"row q-mb-md"},Ge={class:"col-12 text-bold q-py-sm"},He={key:0,class:"bg-body q-pa-md rounded"},Ke={class:"col-12 q-pt-md"},Ze={key:0,class:"row"},Je={class:"col-12 q-mb-sm"},Xe={class:"col-12 q-mb-md"},Ye={class:"col-12 text-bold q-py-sm q-my-sm"},We={class:"col-12"},xe={key:1,class:"column"};function ai(a,o,n,h,u,_){const f=$("callout"),m=$("fecha-hora-automatica-input"),V=$("voice-input"),d=$("essential-table"),v=$("multiple-page-layout"),r=$("essential-selectable-table"),S=$("solicitar-archivo"),j=$("modales-entidad"),U=$("tab-layout");return c(),Y(U,{mixin:a.mixin,"configuracion-columnas":a.configuracionColumnasBitacora,"mostrar-button-submits":a.tabsPage==1,mostrarColumnasVisibles:!a.$q.screen.xs,accion1:a.btnRegistrarActividades,accion2:a.btnFinalizarBitacora,"permitir-editar":!1,paginate:"",full:""},{formulario:s(()=>[e(v,{mixin:a.mixin,tabsOptions:a.tabsOptions,"regresar-principio":"",mostrarRegresar:!1},{tab1:s(()=>[e(f,{mensaje:"La <b>selecci\xF3n de prendas recibidas</b> se activar\xE1 luego de que <b>seleccione la zona</b>.",tipo:"info",class:"q-mb-xl"}),e(yo,{onSubmit:o[13]||(o[13]=ho(()=>{},["prevent"]))},{default:s(()=>[i("div",Pe,[i("div",Fe,[e(y,{name:"bi-x-diamond",class:"q-mr-sm",color:"primary"}),o[16]||(o[16]=C(" Informaci\xF3n general ")),e(pa,{class:"q-my-xs"})]),i("div",Oe,[o[19]||(o[19]=i("label",{class:"q-mb-sm block"},"Zona",-1)),e(la,{modelValue:a.bitacora.zona,"onUpdate:modelValue":[o[1]||(o[1]=t=>a.bitacora.zona=t),o[3]||(o[3]=t=>a.consultarPrendasPermitidas())],options:a.zonas,disable:a.disabled,"options-dense":"",dense:"",outlined:"","input-debounce":0,"use-input":"",onFilter:a.filtrarZonas,onPopupShow:o[2]||(o[2]=t=>a.ordenarLista(a.zonas,"nombre")),"option-value":t=>t.id,"option-label":t=>t.nombre,error:!!a.v$.zona.$errors.length,onBlur:a.v$.zona.$touch,"emit-value":"","map-options":""},{"no-option":s(()=>[e(Va,null,{default:s(()=>[e(qa,{class:"text-grey"},{default:s(()=>o[17]||(o[17]=[C(" No hay resultados ")])),_:1})]),_:1})]),after:s(()=>[e(z,{color:"primary",onClick:o[0]||(o[0]=t=>a.recargarZonas()),dense:""},{default:s(()=>[e(y,{name:a.iconos.recargar,class:"q-pad-xs"},null,8,["name"]),e(ta,null,{default:s(()=>o[18]||(o[18]=[C("Recargar zonas")])),_:1})]),_:1})]),error:s(()=>[(c(!0),p(P,null,F(a.v$.zona.$errors,t=>(c(),p("div",{key:t.$uid},[i("div",ze,B(t.$message),1)]))),128))]),_:1},8,["modelValue","options","disable","onFilter","option-value","option-label","error","onBlur"])]),i("div",Le,[o[20]||(o[20]=i("label",{class:"q-mb-sm block"},"Jornada",-1)),e(la,{modelValue:a.bitacora.jornada,"onUpdate:modelValue":o[4]||(o[4]=t=>a.bitacora.jornada=t),options:a.jornadas,disable:a.disabled,error:!!a.v$.jornada.$errors.length,onBlur:a.v$.jornada.$touch,"options-dense":"",outlined:"",dense:""},{error:s(()=>[(c(!0),p(P,null,F(a.v$.jornada.$errors,t=>(c(),p("div",{key:t.$uid},[i("div",Me,B(t.$message),1)]))),128))]),_:1},8,["modelValue","options","disable","error","onBlur"])]),a.accion===a.acciones.consultar?(c(),p("div",Ie,[e(m,{modelValue:a.bitacora.fecha_hora_inicio_turno,"onUpdate:modelValue":o[5]||(o[5]=t=>a.bitacora.fecha_hora_inicio_turno=t),disable:a.disabled,label:"Fecha y hora de inicio de turno",validador:a.v$,clave:"fecha_hora_inicio_turno"},null,8,["modelValue","disable","validador"])])):w("",!0),a.accion===a.acciones.consultar?(c(),p("div",Te,[o[21]||(o[21]=i("label",{class:"q-mb-sm block"},"Fecha y hora de fin de turno",-1)),e(k,{modelValue:a.bitacora.fecha_hora_fin_turno,"onUpdate:modelValue":o[6]||(o[6]=t=>a.bitacora.fecha_hora_fin_turno=t),hint:"Se calcula autom\xE1ticamente al finalizar la bit\xE1cora",disable:"",outlined:"",dense:""},null,8,["modelValue"])])):w("",!0),a.accion===a.acciones.consultar?(c(),p("div",je,[o[22]||(o[22]=i("label",{class:"q-mb-sm block"},"Agente de turno",-1)),e(k,{modelValue:a.criterioBusqueda,"onUpdate:modelValue":o[7]||(o[7]=t=>a.criterioBusqueda=t),placeholder:"Escriba y presione enter para buscar",hint:"Puede buscar por nombre, apellido o identificaci\xF3n",disable:"",onKeydown:X(a.listar,["enter"]),outlined:"",dense:""},{append:s(()=>[e(y,{name:a.bitacora.agente_turno?"bi-check-circle-fill":"bi-check-circle",color:a.bitacora.agente_turno?"positive":"grey-6",size:"xs"},null,8,["name","color"])]),_:1},8,["modelValue","onKeydown"])])):w("",!0),i("div",Ue,[o[24]||(o[24]=i("label",{class:"q-mb-sm block"},"Protector",-1)),e(k,{modelValue:a.criterioBusquedaProtector,"onUpdate:modelValue":o[8]||(o[8]=t=>a.criterioBusquedaProtector=t),placeholder:"Escriba y presione enter para buscar",hint:"Puede buscar por nombre, apellido o identificaci\xF3n",disable:a.disabled,onKeydown:X(a.listarProtector,["enter"]),error:!!a.v$.protector.$errors.length,onBlur:a.v$.protector.$touch,outlined:"",dense:""},{append:s(()=>[e(y,{name:a.bitacora.protector?"bi-check-circle-fill":"bi-check-circle",color:a.bitacora.protector?"positive":"grey-6",size:"xs"},null,8,["name","color"])]),after:s(()=>[e(z,{color:"primary",onClick:a.listarProtector,dense:""},{default:s(()=>[e(y,{name:a.iconos.buscar},null,8,["name"]),e(ta,null,{default:s(()=>o[23]||(o[23]=[C("Recargar protector")])),_:1})]),_:1},8,["onClick"])]),error:s(()=>[(c(!0),p(P,null,F(a.v$.protector.$errors,t=>(c(),p("div",{key:t.$uid},[i("div",Ne,B(t.$message),1)]))),128))]),_:1},8,["modelValue","disable","onKeydown","error","onBlur"])]),i("div",Re,[o[26]||(o[26]=i("label",{class:"q-mb-sm block"},"Conductor",-1)),e(k,{modelValue:a.criterioBusquedaConductor,"onUpdate:modelValue":o[9]||(o[9]=t=>a.criterioBusquedaConductor=t),placeholder:"Escriba y presione enter para buscar",hint:"Puede buscar por nombre, apellido o identificaci\xF3n",disable:a.disabled,onKeydown:X(a.listarConductor,["enter"]),error:!!a.v$.conductor.$errors.length,onBlur:a.v$.conductor.$touch,outlined:"",dense:""},{append:s(()=>[e(y,{name:a.bitacora.conductor?"bi-check-circle-fill":"bi-check-circle",color:a.bitacora.conductor?"positive":"grey-6",size:"xs"},null,8,["name","color"])]),after:s(()=>[e(z,{color:"primary",onClick:a.listarConductor,dense:""},{default:s(()=>[e(y,{name:a.iconos.buscar},null,8,["name"]),e(ta,null,{default:s(()=>o[25]||(o[25]=[C("Recargar protector")])),_:1})]),_:1},8,["onClick"])]),error:s(()=>[(c(!0),p(P,null,F(a.v$.conductor.$errors,t=>(c(),p("div",{key:t.$uid},[i("div",Qe,B(t.$message),1)]))),128))]),_:1},8,["modelValue","disable","onKeydown","error","onBlur"])])]),i("div",De,[i("div",Ge,[e(y,{name:"bi-x-diamond",class:"q-mr-sm",color:"primary"}),o[27]||(o[27]=i("span",{class:"inline-block q-mr-sm q-mb-sm"},"Selecci\xF3n de prendas recibidas",-1)),a.bitacora.zona&&a.accion===a.acciones.nuevo?(c(),Y(z,{key:0,color:"positive",icon:a.iconos.recargar,onClick:o[10]||(o[10]=t=>a.consultarPrendasPermitidas()),unelevated:"",dense:"",rounded:"","no-caps":"",label:"Recargar prendas asignadas",class:"q-px-sm"},null,8,["icon"])):w("",!0),e(pa,{class:"q-my-xs"})]),a.prendas.length?w("",!0):(c(),p("span",He,"Seleccione una zona para mostrar el listado de prendas.")),(c(!0),p(P,null,F(a.prendas,t=>(c(),p("div",{key:t.id,class:"col-12 col-md-3 q-mb-md"},[e(ra,{modelValue:a.bitacora.prendas_recibidas,"onUpdate:modelValue":o[11]||(o[11]=q=>a.bitacora.prendas_recibidas=q),label:t.descripcion,val:t.id,disable:a.disabled},null,8,["modelValue","label","val","disable"])]))),128)),i("div",Ke,[e(V,{modelValue:a.bitacora.observaciones,"onUpdate:modelValue":o[12]||(o[12]=t=>a.bitacora.observaciones=t),v$:a.v$,"key-error":"observaciones",label:"Observaciones o Novedades acerca de las prendas recibidas",disable:a.disabled,placeholder:"Opcional"},null,8,["modelValue","v$","disable"])])])]),_:1})]),tab2:s(()=>[a.bitacora.id?(c(),p("div",Ze,[i("div",Je,[e(f,{tipo:"info",mensaje:"Las actividades registradas <b>se guardan autom\xE1ticamente</b>."})]),i("div",Xe,[a.bitacora.fecha_hora_fin_turno?(c(),Y(f,{key:0,mensaje:"<b>Ya no tiene permitido registrar actividades</b> debido a que la <b>bit\xE1cora ha sido finalizada</b>."})):w("",!0)]),i("div",Ye,[e(y,{name:"bi-x-diamond",class:"q-mr-sm",color:"primary"}),o[28]||(o[28]=C(" Registro de actividades "))]),i("div",We,[e(d,{ref:"refActividades",titulo:"Actividades",configuracionColumnas:a.ccActividadBitacora,datos:a.listadoActividadBitacora,"ajustar-celdas":"","alto-fijo":!1,accion1Header:a.btnAgregarActividad,accion1:a.btnVerActividadBitacora,accion2:a.btnConfirmarNotificado,accion3:a.btnEstablecerHoraFin,"permitir-consultar":!1,"permitir-editar":!1,"permitir-eliminar":!1,"mostrar-footer":!1,permitirEditarModal:"","editar-fila-local":!1,"permitir-editar-celdas":"",mostrarColumnasVisibles:!a.$q.screen.xs,onGuardarFilaNueva:a.guardarActividad},null,8,["configuracionColumnas","datos","accion1Header","accion1","accion2","accion3","mostrarColumnasVisibles","onGuardarFilaNueva"])])])):(c(),p("div",xe,[e(f,{tipo:"info",mensaje:"Primero <b>cree una bit\xE1cora</b> para poder <b>registrar actividades</b>.",class:"q-mb-md"}),e(z,{color:"primary",label:"Ir a formulario para crear bit\xE1cora",icon:"bi-list",onClick:o[14]||(o[14]=t=>a.tabsPage="1"),"no-caps":"",unelevated:""})]))]),_:1},8,["mixin","tabsOptions"])]),modales:s(()=>[e(r,{ref:"refListadoSeleccionable","configuracion-columnas":a.configuracionColumnasEmpleadosLite,datos:a.listado,onSelected:a.seleccionar,"tipo-seleccion":"single"},null,8,["configuracion-columnas","datos","onSelected"]),e(r,{ref:"refListadoSeleccionableProtector","configuracion-columnas":a.configuracionColumnasEmpleadosLite,datos:a.listadoProtector,onSelected:a.seleccionarProtector,"tipo-seleccion":"single"},null,8,["configuracion-columnas","datos","onSelected"]),e(r,{ref:"refListadoSeleccionableConductor","configuracion-columnas":a.configuracionColumnasEmpleadosLite,datos:a.listadoConductor,onSelected:a.seleccionarConductor,"tipo-seleccion":"single"},null,8,["configuracion-columnas","datos","onSelected"]),e(S,{mostrar:a.mostrarSolicitarArchivoActividad,onCerrar:o[15]||(o[15]=t=>a.mostrarSolicitarArchivoActividad=!1),mixin:a.mixin,"tipo-archivo":"ADJUNTO"},null,8,["mostrar","mixin"]),e(j,{comportamiento:a.modales,"mixin-modal":a.mixin,persistent:!1},null,8,["comportamiento","mixin-modal"])]),_:1},8,["mixin","configuracion-columnas","mostrar-button-submits","mostrarColumnasVisibles","accion1","accion2"])}var et=_a(Ee,[["render",ai]]);export{et as default};
