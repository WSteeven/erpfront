var oo=Object.defineProperty;var ao=(o,a,n)=>a in o?oo(o,a,{enumerable:!0,configurable:!0,writable:!0,value:n}):o[a]=n;var p=(o,a,n)=>(ao(o,typeof a!="symbol"?a+"":a,n),n);import{bw as eo,s as S,l as io,e as so,c as y,A as P,bE as _,d as no,m as j,f as B,bx as to,p as ro,q as lo,_ as co,t as q,v as l,P as mo,F as b,z as c,y as u,x as d,O as D,j as M,J as g,I as E,G as O,H as Q,a4 as uo,K as U}from"./index.6449c167.js";import{Q as fo,a as po,C as L}from"./QPopupProxy.72ff1d6d.js";import{Q as bo}from"./QForm.ca56f146.js";import{r as G}from"./i18n-validators.29e2545c.js";import{u as go}from"./index.490dde02.js";import{T as vo}from"./TabLayoutFilterTabs2.5e702525.js";import{S as ho,E as Co}from"./EssentialTable.00c17e97.js";import{E as Eo}from"./EssentialTableTabs.586dbdfc.js";import{M as yo}from"./ModalEntidad.168b465e.js";import{C as ko}from"./ContenedorSimpleMixin.09c9bed5.js";import{a as H,S as Vo,B as wo,b as Po,u as _o}from"./utils.521b98f3.js";import{E as So}from"./entidadAuditable.75a46700.js";import{b as $o}from"./ventas.utils.b757673b.js";import"./format.8ac60962.js";import"./QSelect.6ce302d7.js";import"./QChip.95469f73.js";import"./QItemSection.9a955ec6.js";import"./position-engine.70d0a89f.js";import"./index.0198dd12.js";import"./QTabs.6c234f27.js";import"./QResizeObserver.9af84680.js";import"./QTabPanels.49d2362a.js";import"./touch.9135741d.js";import"./QPage.5d173a8a.js";import"./buttonSubmits.fe817da3.js";import"./QToolbar.8dbe891b.js";import"./use-fullscreen.a7661f85.js";import"./QBadge.e6f320cd.js";import"./_commonjsHelpers.8402d862.js";import"./QImg.fd079679.js";import"./QFile.90d9394a.js";import"./VisorImagen.75b3c53f.js";import"./logo.4781eea2.js";import"./seleccionContratacionPersonal.utils.e3e1ed3d.js";import"./EssentialTablePagination.d5c1010a.js";import"./configuracion_general.37a05c0a.js";import"./ConfiguracionController.c50d9536.js";const Fo=[{name:"nombre",field:"nombre",label:"Corte",align:"left",sortable:!1},{name:"fecha_inicio",field:"fecha_inicio",label:"Fecha de Inicio",align:"left",sortable:!0},{name:"fecha_fin",field:"fecha_fin",label:"Fecha de Inicio",align:"left",sortable:!0},{name:"estado",field:"estado",label:"Estado",align:"left",sortable:!0}],Bo=[{name:"vendedor_info",field:"vendedor_info",label:"Vendedor",align:"left",sortable:!1},{name:"tipo_vendedor",field:"tipo_vendedor",label:"Modalidad",align:"left",sortable:!0},{name:"fecha_inicio",field:"fecha_inicio",label:"Fecha de Inicio",align:"left",sortable:!0},{name:"fecha_fin",field:"fecha_fin",label:"Fecha de Inicio",align:"left",sortable:!0},{name:"ventas",field:"ventas",label:"Ventas",align:"left",sortable:!0},{name:"chargeback",field:"chargeback",label:"Chargeback",align:"left",sortable:!0},{name:"valor",field:"valor",label:"Valor Comisi\xF3n",align:"left",sortable:!0},{name:"pagado",field:"pagado",label:"Pagado",align:"left",sortable:!0}];class I extends So{constructor(){super();p(this,"id");p(this,"nombre");p(this,"fecha_inicio");p(this,"fecha_fin");p(this,"estado");p(this,"causa_anulacion");p(this,"listadoEmpleados");this.id=null,this.nombre=null,this.fecha_inicio=null,this.fecha_fin=null,this.estado=null,this.causa_anulacion=null,this.listadoEmpleados=[]}}class Do extends eo{constructor(){super(S.cortes_pagos_comisiones)}}const Io=io("cortes-comisiones",()=>{const o=so(new I),a=new I,n=y(),{notificarCorrecto:k,notificarAdvertencia:V,notificarError:v}=H(),r=new Vo;async function C(){try{r.activar();const s=P.getInstance(),t=_.URL_BASE+"/api/ventas-claro/obtener-fechas-disponibles-cortes";return(await s.get(t)).data.results}catch(s){v(s)}finally{r.desactivar()}}async function e(){r.activar();const s=P.getInstance(),t=_.URL_BASE+"/"+s.getEndpoint(S.cortes_pagos_comisiones)+"/imprimir-excel/"+n.value;await wo(t,"GET","blob","xlsx",o.nombre+"_"+Date.now()),r.desactivar()}async function $(s){try{r.activar();const t=P.getInstance(),f=_.URL_BASE+"/"+t.getEndpoint(S.cortes_pagos_comisiones)+"/anular/"+n.value;return await t.post(f,s)}catch(t){v(t)}finally{r.desactivar()}}async function F(){try{r.activar();const s=P.getInstance(),t=_.URL_BASE+"/"+s.getEndpoint(S.cortes_pagos_comisiones)+"/marcar-completada/"+n.value,f=await s.get(t);f.status===200?k(f.data.mensaje):V(f.data.mensaje)}catch(s){v("Error al marcar como completado el corte de pago de comisiones "+s)}finally{r.desactivar()}}return{corte:o,idCorte:n,corteReset:a,obtenerFechasDisponiblesCortes:C,marcarCompletada:F,imprimirExcel:e,anularCorte:$}});var Ao=no({components:{TabLayoutFilterTabs2:vo,ModalesEntidad:yo,SelectorImagen:ho,EssentialTable:Co,EssentialTableTabs:Eo},setup(){const o=new ko(I,new Do),{entidad:a,accion:n,disabled:k,listado:V}=o.useReferencias(),{setValidador:v,cargarVista:r,listar:C}=o.useComportamiento(),{onGuardado:e,onReestablecer:$}=o.useHooks(),{notificarCorrecto:F,notificarError:s,confirmar:t,prompt:f}=H();Po().setQuasar(j()),_o().setQuasar(j());const m=Io(),A=y("PENDIENTE"),h=y();y();const w=y(),K=B(()=>h.value.from),z=B(()=>h.value.to),J=B(()=>"Pago de comisiones desde "+h.value.from+" al "+h.value.to);r(async()=>{const i=Object.values(await m.obtenerFechasDisponiblesCortes());w.value=i});const T=go({fecha_inicio:{required:G},fecha_fin:{required:G}},a);v(T.value),e(()=>{console.log("guardado")}),$(async()=>{const i=Object.values(await m.obtenerFechasDisponiblesCortes());w.value=i});function N(i){A.value=i,C({estado:i})}function W(i){return w.value.includes(i)}function X(){h.value=w.value[0]}function Y(){a.nombre=J.value,a.fecha_inicio=K.value,a.fecha_fin=z.value}return{mixin:o,v$:T,pago:a,accion:n,acciones:to,accionesTabla:ro,disabled:k,fecha:h,maskFecha:lo,configuracionColumnas:Fo,configuracionColumnasPagoComisionEmpleado:Bo,tabDefecto:A,tabOptionsPagosComisiones:$o,btnAnular:{titulo:"Anular",color:"negative",icono:"bi-x",accion:async({entidad:i,posicion:R})=>{t("\xBFEst\xE1 seguro de anular el corte?",()=>{f({titulo:"Causa de anulaci\xF3n",mensaje:"Ingresa el motivo de anulaci\xF3n",accion:async Z=>{try{m.idCorte=i.id,(await m.anularCorte({causa_anulacion:Z})).status==200&&(F("Se ha anulado correctamente el corte de pagos"),V.value.splice(R,1))}catch{s("No se pudo anular, debes ingresar un motivo para la anulaci\xF3n")}}})})},visible:({entidad:i})=>i.estado=="PENDIENTE"},btnMarcarPagado:{titulo:"Completada",color:"primary",icono:"bi-check-circle-fill",accion:async({entidad:i})=>{t("\xBFEst\xE1 seguro de marcar como completado el corte de pago de comisiones?",async()=>{m.idCorte=i.id,await m.marcarCompletada(),await N("COMPLETA")})},visible:({entidad:i})=>i.estado=="PENDIENTE"},btnGenerarReporteExcel:{titulo:"Generar Reporte",color:"positive",icono:"bi-file-earmark-excel-fill",accion:async({entidad:i,posicion:R})=>{m.corte.nombre=i.nombre,m.idCorte=i.id,await m.imprimirExcel()}},options:W,updateProxy:X,save:Y,filtrarCortesComisiones:N}}});const To={class:"row q-col-gutter-sm"},No={key:0,class:"col-12 col-md-4"},Ro={class:"row items-center justify-end q-gutter-sm"},jo={key:1,class:"col-12 col-md-4"},qo={key:2,class:"col-12 col-md-4"},Mo={class:"error-msg"},Oo={key:3,class:"col-12 col-md-4"},Qo={class:"error-msg"},Uo={key:4,class:"col-12 col-md-4"},Lo={key:5,class:"col-12 col-md-4"},Go={key:6,class:"col-12 col-md-12"};function Ho(o,a,n,k,V,v){const r=q("essential-table"),C=q("tab-layout-filter-tabs2");return l(),mo(C,{mixin:o.mixin,configuracionColumnas:o.configuracionColumnas,ajustarCeldas:"","tab-options":o.tabOptionsPagosComisiones,tabDefecto:o.tabDefecto,permitirEditar:!1,filtrar:o.filtrarCortesComisiones,accion1:o.btnAnular,accion2:o.btnGenerarReporteExcel,accion3:o.btnMarcarPagado},{formulario:b(()=>[c(bo,{onSubmit:a[6]||(a[6]=uo(()=>{},["prevent"]))},{default:b(()=>[u("div",To,[o.accion==o.acciones.nuevo?(l(),d("div",No,[a[7]||(a[7]=u("label",{class:"q-mb-sm block"},"Selecciona un rango de fechas",-1)),c(D,{icon:"event",round:"",color:"primary"},{default:b(()=>[c(fo,{onBeforeShow:o.updateProxy,cover:"","transition-show":"scale","transition-hide":"scale"},{default:b(()=>[c(po,{modelValue:o.fecha,"onUpdate:modelValue":a[0]||(a[0]=e=>o.fecha=e),mask:o.maskFecha,range:"",options:o.options},{default:b(()=>[u("div",Ro,[M(c(D,{label:"Cancel",color:"primary",flat:""},null,512),[[L]]),M(c(D,{label:"OK",color:"primary",flat:"",onClick:o.save},null,8,["onClick"]),[[L]])])]),_:1},8,["modelValue","mask","options"])]),_:1},8,["onBeforeShow"])]),_:1})])):g("",!0),o.accion!=o.acciones.nuevo?(l(),d("div",jo,[a[8]||(a[8]=u("label",{class:"q-mb-sm block"},"Nombre",-1)),c(E,{modelValue:o.pago.nombre,"onUpdate:modelValue":a[1]||(a[1]=e=>o.pago.nombre=e),placeholder:"Obligatorio",autogrow:"",disable:"",outlined:"",dense:""},null,8,["modelValue"])])):g("",!0),o.pago.fecha_inicio?(l(),d("div",qo,[a[9]||(a[9]=u("label",{class:"q-mb-sm block"},"Desde",-1)),c(E,{modelValue:o.pago.fecha_inicio,"onUpdate:modelValue":a[2]||(a[2]=e=>o.pago.fecha_inicio=e),placeholder:"Obligatorio",error:!!o.v$.fecha_inicio.$errors.length,disable:"",onBlur:o.v$.fecha_inicio.$touch,outlined:"",dense:"","emit-value":""},{error:b(()=>[(l(!0),d(O,null,Q(o.v$.fecha_inicio.$errors,e=>(l(),d("div",{key:e.$uid},[u("div",Mo,U(e.$message),1)]))),128))]),_:1},8,["modelValue","error","onBlur"])])):g("",!0),o.pago.fecha_fin?(l(),d("div",Oo,[a[10]||(a[10]=u("label",{class:"q-mb-sm block"},"Hasta",-1)),c(E,{modelValue:o.pago.fecha_fin,"onUpdate:modelValue":a[3]||(a[3]=e=>o.pago.fecha_fin=e),placeholder:"Obligatorio",error:!!o.v$.fecha_fin.$errors.length,disable:"",onBlur:o.v$.fecha_fin.$touch,outlined:"",dense:"","emit-value":""},{error:b(()=>[(l(!0),d(O,null,Q(o.v$.fecha_fin.$errors,e=>(l(),d("div",{key:e.$uid},[u("div",Qo,U(e.$message),1)]))),128))]),_:1},8,["modelValue","error","onBlur"])])):g("",!0),o.accion!=o.acciones.nuevo?(l(),d("div",Uo,[a[11]||(a[11]=u("label",{class:"q-mb-sm block"},"Estado",-1)),c(E,{modelValue:o.pago.estado,"onUpdate:modelValue":a[4]||(a[4]=e=>o.pago.estado=e),disable:"",outlined:"",dense:""},null,8,["modelValue"])])):g("",!0),o.accion!=o.acciones.nuevo&&o.pago.causa_anulacion?(l(),d("div",Lo,[a[12]||(a[12]=u("label",{class:"q-mb-sm block"},"Causa anulaci\xF3n",-1)),c(E,{modelValue:o.pago.causa_anulacion,"onUpdate:modelValue":a[5]||(a[5]=e=>o.pago.causa_anulacion=e),disable:"",outlined:"",dense:""},null,8,["modelValue"])])):g("",!0),o.accion!==o.acciones.nuevo&&o.pago.listadoEmpleados.length>0?(l(),d("div",Go,[c(r,{titulo:"Comisiones de Empleados",configuracionColumnas:o.accion===o.acciones.editar?[...o.configuracionColumnasPagoComisionEmpleado,o.accionesTabla]:o.configuracionColumnasPagoComisionEmpleado,datos:o.pago.listadoEmpleados,permitirConsultar:!1,permitirEditar:!1,permitirEliminar:!1,mostrarBotones:!1,ajustarCeldas:!0,altoFijo:!1},null,8,["configuracionColumnas","datos"])])):g("",!0)])]),_:1})]),_:1},8,["mixin","configuracionColumnas","tab-options","tabDefecto","filtrar","accion1","accion2","accion3"])}var Na=co(Ao,[["render",Ho]]);export{Na as default};
