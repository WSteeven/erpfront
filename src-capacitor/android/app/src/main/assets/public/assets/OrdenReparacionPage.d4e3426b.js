var bo=Object.defineProperty;var fo=(o,e,t)=>e in o?bo(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t;var n=(o,e,t)=>(fo(o,typeof e!="symbol"?e+"":e,t),t);import{Q as w,a as $}from"./QSelect.a8f2bfb2.js";import{Q as j,a as G}from"./QItemSection.c6f2640c.js";import{bz as ho,t as oo,c as go,U as Vo,be as Co,p as H,u as wo,g as $o,e as A,bA as K,s as J,d9 as Ao,A as qo,bH as ko,v as zo,x as q,y as E,S as yo,H as r,D as i,a7 as Oo,B as l,z as W,L as P,O as X,P as Y,G as g,M as k,R as Z,F as _,K as V,k as Ro}from"./index.976e8f3c.js";import{Q as So,a as Qo,C as Fo}from"./QPopupProxy.d8ef7a42.js";import{Q as Eo}from"./QChip.334d746c.js";import{Q as Po}from"./QForm.ed6f6690.js";import{T as To}from"./TabLayoutFilterTabs2.f1a01a4e.js";import{G as Uo}from"./GestorArchivos.f1319a4d.js";import{N as Bo}from"./NoOptionComponent.ffe820c8.js";import{E as Lo}from"./ErrorComponent.b482e77d.js";import{C as Do}from"./ContenedorSimpleMixin.5a0b06ab.js";import{E as Io}from"./entidadAuditable.75a46700.js";import{p as No}from"./vehiculos.utils.c31e027d.js";import{u as Mo,S as jo,v as Go,s as Ho}from"./utils.30e08aa2.js";import{S as Ko}from"./ServicioController.b2e406e5.js";import{u as Jo}from"./filtrosListadosGenerales.31e9eb2c.js";import{r as v,a as Wo}from"./i18n-validators.06eef631.js";import{u as Xo}from"./index.ed676411.js";import{A as Yo}from"./AsignacionVehiculoController.4b6144c1.js";import{T as Zo}from"./TransferenciaVehiculoController.f2090917.js";import{r as _o}from"./funcionesActualizacionListados.b9eec647.js";import{V as x}from"./VehiculoController.fd9db948.js";import{C as xo}from"./ConductorController.e8e76909.js";import"./QMenu.410ae527.js";import"./position-engine.2f1d750c.js";import"./format.8ac60962.js";import"./QTabs.3c726b04.js";import"./QResizeObserver.6ec10d95.js";import"./QTabPanels.1c8c4baa.js";import"./touch.9135741d.js";import"./QPage.ed5d79ca.js";import"./EssentialTableTabs.c7e98bba.js";import"./QBadge.1ddeabfd.js";import"./EssentialTablePagination.f449a738.js";import"./QTable.048b8be8.js";import"./use-fullscreen.0ccd26e6.js";import"./QToolbar.cff7174f.js";import"./QBtnGroup.7d0835e4.js";import"./EssentialTable.d8e6954a.js";import"./QFile.e27868da.js";import"./_commonjsHelpers.8402d862.js";import"./QImg.e0fb285c.js";import"./VisorImagen.e7965569.js";import"./seleccionContratacionPersonal.utils.e3e1ed3d.js";import"./buttonSubmits.2eb37d38.js";import"./QUploader.43bbdad9.js";import"./QCircularProgress.4d1a2735.js";import"./configuracionColumnasArchivoSubtarea.215f4ffd.js";import"./index.95f5a0db.js";const oe=[{name:"fecha",field:"fecha",label:"Fecha",align:"left",sortable:!0},{name:"vehiculo",field:"vehiculo",label:"Placa",align:"left",sortable:!0},{name:"solicitante",field:"solicitante",label:"Solicitante",align:"left",sortable:!0},{name:"autorizacion",field:"autorizacion",label:"Estado",align:"left",sortable:!0},{name:"valor_reparacion",field:"valor_reparacion",label:"Valor Reparaci\xF3n",align:"left",sortable:!0},{name:"motivo",field:"motivo",label:"Motivo",align:"left",sortable:!0}];class ee extends Io{constructor(){super();n(this,"solicitante");n(this,"solicitante_id");n(this,"autorizador");n(this,"vehiculo");n(this,"fecha");n(this,"autorizacion");n(this,"servicios");n(this,"observacion");n(this,"valor_reparacion");n(this,"motivo");n(this,"num_factura");this.solicitante=null,this.solicitante_id=null,this.autorizador=null,this.vehiculo=null,this.fecha=null,this.autorizacion=null,this.servicios=null,this.observacion=null,this.valor_reparacion=null,this.motivo=null,this.num_factura=null}}class ae extends ho{constructor(){super(oo.ordenes_reparaciones)}}var ie=go({components:{ErrorComponent:Lo,NoOptionComponent:Bo,TabLayoutFilterTabs2:To,GestorArchivos:Uo},setup(){const o=new Do(ee,new ae),{entidad:e,disabled:t,listadosAuxiliares:m,accion:z}=o.useReferencias(),{setValidador:T,cargarVista:u,obtenerListados:p,listar:y}=o.useComportamiento(),{onReestablecer:O,onConsultado:a,onGuardado:eo,onModificado:ao}=o.useHooks(),{prompt:io,notificarCorrecto:ro,notificarAdvertencia:lo}=Vo();Co().setQuasar(H()),Mo().setQuasar(H());const U=new jo,c=wo(),B=$o(()=>["1","2"].includes(S.value)&&c.esAdministradorVehiculos),b=A(),R=A(),S=A("1"),f=A(),{empleados:L,filtrarEmpleados:so,servicios:D,filtrarServicios:no,vehiculos:Q,filtrarVehiculos:to}=Jo(m);u(async()=>{f.value=await mo(),await p({empleados:new xo,servicios:{controller:new Ko,params:{tipo:"CORRECTIVO",estado:1}},vehiculos:new x}),L.value=m.empleados,D.value=m.servicios,Q.value=m.vehiculos,M()});const uo={solicitante:{required:v},vehiculo:{required:v},fecha:{required:v},autorizacion:{required:v},num_factura:{required:Wo(()=>K.editar==z.value)},servicios:{required:v},observacion:{required:v}},I=Xo(uo,e);T(I.value),O(()=>{setTimeout(()=>{b.value.limpiarListado(),b.value.quiero_subir_archivos=!1},300),M()}),a(()=>{setTimeout(()=>{b.value.listarArchivosAlmacenados(e.id)},1)}),eo(s=>{R.value=s,setTimeout(()=>N(),1)}),ao(s=>{R.value=s,setTimeout(()=>N(),1)});async function co(s){S.value=s,await y({autorizacion_id:s})}async function N(){await b.value.subir()}async function mo(){const s=await new Yo().listar({filtro:1,responsable_id:c.user.id,estado:"ACEPTADO"});return s.result.length==0?(await new Zo().listar({filtro:1,responsable_id:c.user.id,estado:"ACEPTADO"})).result[0]:s.result[0]}function M(){f.value?(e.vehiculo=f.value.vehiculo,e.solicitante_id=f.value.responsable_id,e.solicitante=f.value.responsable,e.autorizacion=1):(c.esMecanicoGeneral&&(e.solicitante_id=c.user.id,e.solicitante=c.nombreUsuario),e.autorizacion=1),e.fecha=Go(J)}async function po(){await _o(m,"vehiculos",Q,new x)}async function vo(s,F){try{U.activar();const d=qo.getInstance(),h=ko.URL_BASE+"/"+d.getEndpoint(oo.ordenes_reparaciones)+"/registrar-valor-reparacion/"+s,C=await d.post(h,{valor_reparacion:F});if(C.status===200)return ro(C.data.mensaje),C.data.modelo;lo(C.data.mensaje)}catch(d){console.error(d)}finally{U.desactivar()}}return{mixin:o,orden:e,disabled:t,v$:I,accion:z,acciones:K,tabOptionsOrdenesReparaciones:No,configuracionColumnas:oe,tabActual:S,store:c,refArchivo:b,idOrden:R,maskFecha:J,visibleParaAdmin:B,empleados:L,filtrarEmpleados:so,servicios:D,filtrarServicios:no,vehiculos:Q,filtrarVehiculos:to,autorizaciones:Ao,ordenarLista:Ho,filtrarOrdenesReparaciones:co,recargarVehiculos:po,btnValorReparacion:{titulo:"Valor Reparaci\xF3n",icono:"bi-cash",accion:({entidad:s})=>{io({titulo:"Valor de la reparaci\xF3n",mensaje:"Ingrese el valor de la reparaci\xF3n",validacion:d=>/^(\d{1,3}(?:,\d{3})*(?:\.\d+)?|\d+)?$/.test(d),requerido:!0,accion:async d=>{const h=await vo(s.id,d);console.log(h),s.valor_reparacion=h.valor_reparacion}})},visible:()=>B.value}}}});const re={class:"row q-col-gutter-sm q-py-md"},le={key:0,class:"col-12 col-md-4 q-mb-md"},se={class:"col-12 col-md-4 q-mb-md"},ne={class:"col-12 col-md-4 q-mb-md"},te={class:"row items-center justify-end"},de={key:1,class:"col-12 col-md-4 q-mb-md q-pt-none"},ue={class:"col-12 col-md-4 q-mb-md"},ce={class:"col-12 col-md-4 q-mb-md"},me={class:"col-12 col-md-4 q-mb-md"},pe={class:"col-12 col-md-8 q-mb-md"},ve={class:"col-12"},be={class:"col-12 q-mb-md"};function fe(o,e,t,m,z,T){const u=q("error-component"),p=q("no-option-component"),y=q("gestor-archivos"),O=q("tab-layout-filter-tabs2");return E(),yo(O,{mixin:o.mixin,configuracionColumnas:o.configuracionColumnas,ajustarCeldas:!0,"tab-options":o.tabOptionsOrdenesReparaciones,tabDefecto:o.tabActual,permitirEditar:o.visibleParaAdmin,accion1:o.btnValorReparacion,filtrar:o.filtrarOrdenesReparaciones,"titulo-pagina":"Matriculas de Veh\xEDculos"},{formulario:r(()=>[i(Po,{onSubmit:e[12]||(e[12]=Oo(()=>{},["prevent"]))},{default:r(()=>[l("div",re,[o.accion==o.acciones.nuevo||o.orden.solicitante?(E(),W("div",le,[e[13]||(e[13]=l("label",{class:"q-mb-sm block"},"Chofer que solicita",-1)),i(w,{modelValue:o.orden.solicitante,"onUpdate:modelValue":e[0]||(e[0]=a=>o.orden.solicitante=a),options:o.empleados,"transition-show":"scale","transition-hide":"scale","options-dense":"",clearable:"",dense:"",outlined:"",disable:o.disabled,error:!!o.v$.solicitante.$errors.length,"use-input":"","input-debounce":"0",onPopupShow:e[1]||(e[1]=a=>o.ordenarLista(o.empleados,"apellidos")),onFilter:o.filtrarEmpleados,"option-label":a=>a.apellidos+" "+a.nombres,"option-value":a=>a.id,"emit-value":"","map-options":""},{error:r(()=>[i(u,{clave:"solicitante",v$:o.v$},null,8,["v$"])]),"no-option":r(()=>[i(p)]),_:1},8,["modelValue","options","disable","error","onFilter","option-label","option-value"])])):P("",!0),l("div",se,[e[14]||(e[14]=l("label",{class:"q-mb-sm block"},"Veh\xEDculo",-1)),i(w,{modelValue:o.orden.vehiculo,"onUpdate:modelValue":e[2]||(e[2]=a=>o.orden.vehiculo=a),options:o.vehiculos,hint:"Agregue elementos desde el panel de veh\xEDculos","transition-show":"scale","transition-hide":"scale","options-dense":"",clearable:"",dense:"",outlined:"",disable:o.disabled,"use-input":"","input-debounce":"0",onFilter:o.filtrarVehiculos,"option-label":a=>a.placa,"option-value":a=>a.id,error:!!o.v$.vehiculo.$errors.length,onBlur:o.v$.vehiculo.$touch,"emit-value":"","map-options":""},{option:r(a=>[i(j,X(Y(a.itemProps)),{default:r(()=>[i(G,null,{default:r(()=>[i($,null,{default:r(()=>[g(k(a.opt.placa),1)]),_:2},1024),i($,{caption:""},{default:r(()=>[g(k(a.opt.marca+" "+a.opt.modelo),1)]),_:2},1024)]),_:2},1024)]),_:2},1040)]),"no-option":r(()=>[i(p)]),error:r(()=>[i(u,{clave:"vehiculo",v$:o.v$},null,8,["v$"])]),after:r(()=>[i(Z,{color:"positive",onClick:o.recargarVehiculos},{default:r(()=>[i(_,{size:"xs",class:"q-mr-sm",name:"bi-arrow-clockwise"})]),_:1},8,["onClick"])]),_:1},8,["modelValue","options","disable","onFilter","option-label","option-value","error","onBlur"])]),l("div",ne,[e[15]||(e[15]=l("label",{class:"q-mb-sm block"},"Fecha",-1)),i(V,{modelValue:o.orden.fecha,"onUpdate:modelValue":e[4]||(e[4]=a=>o.orden.fecha=a),autogrow:"",disable:o.disabled,outlined:"",dense:""},{append:r(()=>[i(_,{name:"event",class:"cursor-pointer"},{default:r(()=>[i(So,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:r(()=>[i(Qo,{modelValue:o.orden.fecha,"onUpdate:modelValue":e[3]||(e[3]=a=>o.orden.fecha=a),mask:o.maskFecha,"today-btn":""},{default:r(()=>[l("div",te,[Ro(i(Z,{label:"Cerrar",color:"primary",flat:""},null,512),[[Fo]])])]),_:1},8,["modelValue","mask"])]),_:1})]),_:1})]),_:1},8,["modelValue","disable"])]),o.orden.autorizacion?(E(),W("div",de,[i(Eo,{color:"light-green-2",class:"text-positive text-bold q-mb-xs"},{default:r(()=>e[16]||(e[16]=[g("Autorizaci\xF3n ")])),_:1}),i(w,{modelValue:o.orden.autorizacion,"onUpdate:modelValue":e[5]||(e[5]=a=>o.orden.autorizacion=a),options:o.autorizaciones,"transition-show":"jum-up","transition-hide":"jump-down","options-dense":"",dense:"",outlined:"",disable:o.disabled||o.orden.autorizador!==o.store.user.id,"option-value":a=>a.id,"option-label":a=>a.nombre,"emit-value":"","map-options":""},{"no-option":r(()=>[i(p)]),_:1},8,["modelValue","options","disable","option-value","option-label"])])):P("",!0),l("div",ue,[e[17]||(e[17]=l("label",{class:"q-mb-sm block"},"Valor de Reparaci\xF3n",-1)),i(V,{type:"number",modelValue:o.orden.valor_reparacion,"onUpdate:modelValue":e[6]||(e[6]=a=>o.orden.valor_reparacion=a),placeholder:"Opcional",hint:"Puedes completar este valor luego de la aprobaci\xF3n del registro",outlined:"",disable:o.disabled,dense:""},null,8,["modelValue","disable"])]),l("div",ce,[e[18]||(e[18]=l("label",{class:"q-mb-sm block"},"Comentario o motivo de retraso",-1)),i(V,{autogrow:"",modelValue:o.orden.motivo,"onUpdate:modelValue":e[7]||(e[7]=a=>o.orden.motivo=a),placeholder:"Opcional",hint:"Llena este campo en caso de tener algun comentario",outlined:"",disable:o.disabled,dense:""},null,8,["modelValue","disable"])]),l("div",me,[e[19]||(e[19]=l("label",{class:"q-mb-sm block"},"N\xB0 Factura ",-1)),i(V,{autogrow:"",modelValue:o.orden.num_factura,"onUpdate:modelValue":e[8]||(e[8]=a=>o.orden.num_factura=a),placeholder:[o.acciones.nuevo,o.acciones.consultar].includes(o.accion)?"Opcional":"Obligatorio",hint:"Llena este campo con el n\xFAmero de factura correspondiente a la reparaci\xF3n realizada",outlined:"",disable:o.disabled,error:!!o.v$.num_factura.$errors.length,dense:""},{error:r(()=>[i(u,{clave:"num_factura",v$:o.v$},null,8,["v$"])]),_:1},8,["modelValue","placeholder","disable","error"])]),l("div",pe,[e[20]||(e[20]=l("label",{class:"q-mb-sm block"},"Servicios a realizar",-1)),i(w,{modelValue:o.orden.servicios,"onUpdate:modelValue":e[9]||(e[9]=a=>o.orden.servicios=a),options:o.servicios,"options-dense":"",clearable:"",dense:"",disable:o.disabled,error:!!o.v$.servicios.$errors.length,outlined:"","use-input":"","use-chips":"",hint:"Si el servicio a realizar no est\xE1 en esta lista, por favor escribirlo en la observaci\xF3n","input-debounce":"0",onFilter:o.filtrarServicios,multiple:"","option-label":a=>a.nombre,"option-value":a=>a.id,"emit-value":"","map-options":""},{option:r(a=>[i(j,X(Y(a.itemProps)),{default:r(()=>[i(G,null,{default:r(()=>[i($,null,{default:r(()=>[g(k(a.opt.nombre),1)]),_:2},1024),i($,{caption:""},{default:r(()=>[g(k(a.opt.tipo),1)]),_:2},1024)]),_:2},1024)]),_:2},1040)]),"no-option":r(()=>[i(p)]),error:r(()=>[i(u,{clave:"servicios",v$:o.v$},null,8,["v$"])]),_:1},8,["modelValue","options","disable","error","onFilter","option-label","option-value"])]),l("div",ve,[e[21]||(e[21]=l("label",{class:"q-mb-sm block"},"Observaci\xF3n",-1)),i(V,{autogrow:"",modelValue:o.orden.observacion,"onUpdate:modelValue":e[10]||(e[10]=a=>o.orden.observacion=a),error:!!o.v$.observacion.$errors.length,placeholder:"Obligatorio",hint:"Ingresa alguna observaci\xF3n o novedad presentada en el interior del veh\xEDculo",outlined:"",disable:o.disabled,dense:""},{error:r(()=>[i(u,{clave:"observacion",v$:o.v$},null,8,["v$"])]),_:1},8,["modelValue","error","disable"])]),l("div",be,[i(y,{ref:"refArchivo",label:"Evidencia fotogr\xE1fica",mixin:o.mixin,disable:o.disabled,listarAlGuardar:!1,"permitir-eliminar":o.accion==o.acciones.nuevo||o.accion==o.acciones.editar,idModelo:o.idOrden},{"boton-subir":r(()=>[P("",!0)]),_:1},8,["mixin","disable","permitir-eliminar","idModelo"])])])]),_:1})]),_:1},8,["mixin","configuracionColumnas","tab-options","tabDefecto","permitirEditar","accion1","filtrar"])}var va=zo(ie,[["render",fe]]);export{va as default};
