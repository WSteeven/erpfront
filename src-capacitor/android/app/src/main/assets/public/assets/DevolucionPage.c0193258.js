var Ee=Object.defineProperty;var Pe=(o,e,m)=>e in o?Ee(o,e,{enumerable:!0,configurable:!0,writable:!0,value:m}):o[e]=m;var H=(o,e,m)=>(Pe(o,typeof e!="symbol"?e+"":e,m),m);import{c as y,A as Uo,s as X,d as Ao,a0 as $,bx as J,_ as Bo,t as z,v as d,P as qe,F as t,y as n,x as r,z as l,I as C,J as v,L as U,a3 as Se,a4 as Mo,bf as De,bw as Ie,m as Eo,u as $e,Z as Le,$ as Po,f as K,E as ao,be as Fe,p as ze,cw as Ue,b_ as qo,cs as Ae,R as io,a7 as Be,D as E,G as Q,H as Z,O as lo,B as So,M as Me,N as Te,K as M,a2 as Ne}from"./index.6449c167.js";import{Q as T,a as N}from"./QItemSection.9a955ec6.js";import{Q as I,a as Do}from"./QSelect.6ce302d7.js";import{a as W}from"./QToolbar.8dbe891b.js";import{Q as To}from"./QForm.ca56f146.js";import{D as je,c as Oe}from"./DevolucionController.c60cf958.js";import{r as Io,a as so}from"./index.0198dd12.js";import{u as Re}from"./index.490dde02.js";import{u as Qe}from"./selector.9691ac4b.js";import{T as Je}from"./TabLayoutFilterTabs2.5e702525.js";import{E as No}from"./EssentialTable.00c17e97.js";import{E as Ge}from"./EssentialSelectableTable.5a9cc771.js";import{G as He}from"./GestorArchivos.10722df3.js";import{M as Ke}from"./ModalEntidad.168b465e.js";import{C as Ze}from"./ContenedorSimpleMixin.09c9bed5.js";import{u as jo,D as We}from"./devolucion.61aed08b.js";import{c as $o}from"./configuracionColumnasProductosSeleccionados.8e4ddf6e.js";import{a as Oo,u as Ro,b as Xe,S as Ye,w as he,F as _e}from"./utils.521b98f3.js";import{u as xe}from"./listadoMaterialesDevolucion.d0f286be.js";import{u as Lo}from"./filtrosListadosGenerales.c3aa2da3.js";import{C as oa,a as ea}from"./ComponenteModal.domain.50e59f97.js";import{B as aa}from"./buttonSubmits.fe817da3.js";import{e as Fo}from"./utils.7dcda2a3.js";function ia(o,e){const m=y(),s=y([]),P=y(),g={refListadoSeleccionable:m,listadoSeleccionable:s,endpoint:e,limpiar:()=>{o.id=null,P.value=null},seleccionar:w=>{o.listadoProductos=[...o.listadoProductos,...w]}},p=Qe(g);return{refListadoSeleccionable:m,listado:s,listar:w=>p.listar(P.value,w),limpiar:()=>g.limpiar(),seleccionar:w=>{let a=[];a=o.listadoProductos.map(q=>q.id);const B=w.filter(q=>!a.includes(q.id));B.forEach(q=>{q.devuelto=0}),g.seleccionar(B)},criterioBusqueda:P}}const la=[{name:"categoria",field:"Categoria",label:"Categoria",align:"left",sortable:!0},{name:"producto",field:"producto",label:"Producto",align:"left",sortable:!0},{name:"descripcion",field:"descripcion",label:"Descripci\xF3n",align:"left",sortable:!0},{name:"modelo",field:"modelo",label:"Modelo",align:"left",sortable:!0},{name:"serial",field:"serial",label:"Serial",align:"left",sortable:!0},{name:"cantidad",field:"cantidad",label:"Cantidad Disponible",align:"left",sortable:!0},{name:"cliente",field:"cliente",label:"Cliente Propietario",align:"left",sortable:!0}];class sa{constructor(){H(this,"axios");this.axios=Uo.getInstance()}async anular(e,m){return this.solicitud("/anular/",e,{motivo:m})}async solicitud(e,m,s){const P=this.axios.getEndpoint(X.devoluciones)+e+m,g=await this.axios.post(P,s);return console.log(g),{response:g,result:g.data.modelo}}}class na{constructor(e){H(this,"devolucion");this.devolucion=e}async validar(){if(this.devolucion.listadoProductos.length===0)throw new Error("Debe agregar al menos un producto al listado");if(this.devolucion.listadoProductos.some(e=>e.cantidad<=0||e.cantidad==null||e.cantidad==""))throw new Error("Todos los elementos del listado deben tener una cantidad mayor a cero");if(this.devolucion.misma_condicion&&(this.devolucion.condicion==null||this.devolucion.condicion==null||this.devolucion.condicion==""))throw new Error("Ingresa el estado para todos los items a devolver.");if(!this.devolucion.misma_condicion&&this.devolucion.listadoProductos.some(e=>e.condiciones==null||e.condiciones==null||e.condiciones==""))throw new Error("Todos los elementos del listado deben tener definido un estado.");return!0}}const ta=[{name:"producto",field:"producto",label:"Producto",align:"left",sortable:!0},{name:"descripcion",field:"descripcion",label:"Descripci\xF3n",align:"left",sortable:!0},{name:"categoria",field:"categoria",label:"Categoria",align:"left",sortable:!0},{name:"serial",field:"serial",label:"Serial",align:"left",sortable:!0},{name:"cantidad",field:"cantidad",label:"Cantidad",align:"left",sortable:!1},{name:"devuelto",field:"devuelto",label:"Devuelto",align:"left",sortable:!1},{name:"acciones",field:"acciones",label:"Acciones",align:"right",sortable:!1}],da=Ao({components:{EssentialTable:No,buttonSubmits:aa},emits:["cerrar-modal"],setup(o,{emit:e}){const m=jo(),{confirmar:s,prompt:P,notificarCorrecto:g,notificarError:p}=Oo(),f=m.devolucion,c=y([]);f.listadoProductos=m.devolucion.listadoProductos.filter(V=>V.cantidad!=V.despachado);function A(){m.resetearDevolucion(),e("cerrar-modal",!1)}async function w(){m.idDevolucion=f.id,(await m.modificarDevolucion(f)).status==200?(g("Devoluci\xF3n actualizada correctamente"),e("cerrar-modal",!1)):(p("Hubo un error al guardar los cambios"),e("cerrar-modal",!1))}function a({entidad:V,posicion:L}){s("\xBFEst\xE1 seguro de continuar?",async()=>{const S=await m.eliminarDetalle(V.id,f.id);S.status==200?(g(S.data.mensaje),f.listadoProductos.splice(L,1)):p("No se pudo eliminar el elemento")})}const B={titulo:"Quitar",color:"negative",icono:"bi-x",accion:({entidad:V,posicion:L})=>a({entidad:V,posicion:L}),visible:({entidad:V})=>V.devuelto==0},q={titulo:"Cantidad",icono:"bi-pencil",accion:({posicion:V})=>{const L={titulo:"Modifica",mensaje:"Ingresa la cantidad",tipo:"number",defecto:f.listadoProductos[V].cantidad,accion:S=>f.listadoProductos[V].cantidad=S,validacion:S=>f.listadoProductos[V].devuelto<=S};P(L)},visible:()=>!0};return c.value=JSON.parse($.getItem("estados_transacciones").toString()),{devolucion:f,botonEditarCantidad:q,botonEliminar:B,configuracionColumnasProductosSeleccionados:ta,opciones_estados:c,storeCargando:Ro(),cancelar:A,actualizarDevolucion:w,acciones:J}}}),ra={class:"row q-col-gutter-sm q-py-md"},ua={key:0,class:"col-12 col-md-3"},ca={key:1,class:"col-12 col-md-3"},ma={class:"col-12 col-md-3"},pa={key:2,class:"col-12 col-md-3"},va={class:"col-12 col-md-6"},ba={key:3,class:"col-12 col-md-3"},fa={key:4,class:"col-12 col-md-3"},ga={key:5,class:"col-12 col-md-3"},Va={key:6,class:"col-12 col-md-3"},Ca={key:7,class:"col-12 col-md-3"},ya={key:8,class:"col-12 col-md-3 q-mb-md"},ka={key:9,class:"col-12 col-md-3"},wa={class:"col-12"},Ea={class:"row justify-end q-col-gutter-x-xs"};function Pa(o,e,m,s,P,g){const p=z("essential-table"),f=z("button-submits");return d(),qe(To,{onSubmit:e[12]||(e[12]=Mo(()=>{},["prevent"]))},{default:t(()=>[n("div",ra,[o.devolucion.id?(d(),r("div",ua,[e[13]||(e[13]=n("label",{class:"q-mb-sm block"},"Devoluci\xF3n N\xB0",-1)),l(C,{modelValue:o.devolucion.id,"onUpdate:modelValue":e[0]||(e[0]=c=>o.devolucion.id=c),placeholder:"Obligatorio",disable:"",outlined:"",dense:""},null,8,["modelValue"])])):v("",!0),o.devolucion.created_at?(d(),r("div",ca,[e[14]||(e[14]=n("label",{class:"q-mb-sm block"},"Fecha",-1)),l(C,{modelValue:o.devolucion.created_at,"onUpdate:modelValue":e[1]||(e[1]=c=>o.devolucion.created_at=c),disable:"",outlined:"",dense:""},null,8,["modelValue"])])):v("",!0),n("div",ma,[e[15]||(e[15]=n("label",{class:"q-mb-sm block"},"Sucursal",-1)),l(C,{modelValue:o.devolucion.sucursal,"onUpdate:modelValue":e[2]||(e[2]=c=>o.devolucion.sucursal=c),dense:"",outlined:"",disable:""},null,8,["modelValue"])]),o.devolucion.solicitante?(d(),r("div",pa,[e[16]||(e[16]=n("label",{class:"q-mb-sm block"},"Solicitante",-1)),l(C,{modelValue:o.devolucion.solicitante,"onUpdate:modelValue":e[3]||(e[3]=c=>o.devolucion.solicitante=c),dense:"",outlined:"",disable:""},null,8,["modelValue"])])):v("",!0),n("div",va,[e[17]||(e[17]=n("label",{class:"q-mb-sm block"},"Justificaci\xF3n",-1)),l(C,{type:"textarea",autogrow:"",modelValue:o.devolucion.justificacion,"onUpdate:modelValue":e[4]||(e[4]=c=>o.devolucion.justificacion=c),placeholder:"Obligatorio",disable:"",outlined:"",dense:""},null,8,["modelValue"])]),o.devolucion.es_para_stock?(d(),r("div",ba,[l(U,{class:"q-mt-lg q-pt-md",modelValue:o.devolucion.es_para_stock,"onUpdate:modelValue":e[5]||(e[5]=c=>o.devolucion.es_para_stock=c),label:"\xBFEs devoluci\xF3n al stock personal?",disable:"",outlined:"",dense:""},null,8,["modelValue"])])):v("",!0),o.devolucion.pedido_automatico?(d(),r("div",fa,[l(U,{class:"q-mt-lg q-pt-md",modelValue:o.devolucion.pedido_automatico,"onUpdate:modelValue":e[6]||(e[6]=c=>o.devolucion.pedido_automatico=c),label:"\xBFPedido autom\xE1tico?",disable:"",outlined:"",dense:""},null,8,["modelValue"])])):v("",!0),o.devolucion.es_tarea?(d(),r("div",ga,[l(U,{class:"q-mt-lg q-pt-md",modelValue:o.devolucion.es_tarea,"onUpdate:modelValue":e[7]||(e[7]=c=>o.devolucion.es_tarea=c),label:"\xBFEs material de tarea?",disable:"",outlined:"",dense:""},null,8,["modelValue"])])):v("",!0),o.devolucion.es_tarea?(d(),r("div",Va,[e[18]||(e[18]=n("label",{class:"q-mb-sm block"},"Tarea",-1)),l(C,{modelValue:o.devolucion.tarea,"onUpdate:modelValue":e[8]||(e[8]=c=>o.devolucion.tarea=c),hint:"Tarea #",dense:"",outlined:"",disable:""},null,8,["modelValue"])])):v("",!0),o.devolucion.per_autoriza?(d(),r("div",Ca,[e[19]||(e[19]=n("label",{class:"q-mb-sm block"},"Persona que autoriza",-1)),l(C,{modelValue:o.devolucion.per_autoriza,"onUpdate:modelValue":e[9]||(e[9]=c=>o.devolucion.per_autoriza=c),dense:"",outlined:"",disable:""},null,8,["modelValue"])])):v("",!0),o.devolucion.autorizacion?(d(),r("div",ya,[e[20]||(e[20]=n("label",{class:"q-mb-sm block"},"Autorizacion",-1)),l(C,{modelValue:o.devolucion.autorizacion,"onUpdate:modelValue":e[10]||(e[10]=c=>o.devolucion.autorizacion=c),dense:"",outlined:"",disable:""},null,8,["modelValue"])])):v("",!0),o.devolucion.observacion_aut?(d(),r("div",ka,[e[21]||(e[21]=n("label",{class:"q-mb-sm block"},"Observacion",-1)),l(C,{autogrow:"",modelValue:o.devolucion.observacion_aut,"onUpdate:modelValue":e[11]||(e[11]=c=>o.devolucion.observacion_aut=c),placeholder:"Opcional",disable:"",outlined:"",dense:""},null,8,["modelValue"])])):v("",!0),n("div",wa,[l(p,{titulo:"Productos Seleccionados",configuracionColumnas:o.configuracionColumnasProductosSeleccionados,datos:o.devolucion.listadoProductos,permitirConsultar:!1,permitirEditar:!1,permitirEliminar:!1,mostrarBotones:!1,"alto-fijo":!1,ajustarCeldas:!0,accion1:o.botonEditarCantidad,accion2:o.botonEliminar},null,8,["configuracionColumnas","datos","accion1","accion2"])])]),n("div",{class:Se({"q-pa-md":o.$q.screen.xs})},[n("div",Ea,[l(f,{accion:o.acciones.editar,permitirGuardar:!0,disabled:o.storeCargando.cargando,labelGuardar:"Guardar",onCancelar:o.cancelar,onEditar:o.actualizarDevolucion},null,8,["accion","disabled","onCancelar","onEditar"])])],2)]),_:1})}var qa=Bo(da,[["render",Pa]]);class Sa{constructor(){H(this,"CorregirDevolucionPage");this.CorregirDevolucionPage=De(new oa("CorregirDevolucionPage",qa))}}class Da extends ea{constructor(){super(new Sa)}}class zo extends Ie{constructor(){super(X.incidentes)}}var Ia=Ao({name:"DevolucionPage",emits:["guardado"],components:{TabLayoutFilterTabs2:Je,EssentialTable:No,ModalesEntidad:Ke,EssentialSelectableTable:Ge,GestorArchivos:He},setup(o,{emit:e}){const m=new Ze(We,new je),{entidad:s,disabled:P,accion:g,listadosAuxiliares:p,listado:f,filtros:c}=m.useReferencias(),{setValidador:A,obtenerListados:w,cargarVista:a,listar:B,consultar:q,reestablecer:V}=m.useComportamiento(),{onReestablecer:L,onGuardado:S,onConsultado:Qo}=m.useHooks(),{confirmar:no,prompt:to,notificarCorrecto:Jo,notificarError:Go,notificarInformacion:Ho}=Oo();Xe().setQuasar(Eo()),Ro().setQuasar(Eo());const ro=y(!1),uo=new Da,j=jo(),b=$e(),k=xe(),Ko=Le(),co=Po(),D=new Ye,G=Uo.getInstance(),{refListadoSeleccionable:Zo,criterioBusqueda:Wo,listado:Xo,listar:Yo,limpiar:ho,seleccionar:_o}=ia(s,"materiales_empleado_consolidado"),O=y(),mo=y(),F=y(),Y=y(!1),h=y(!1),po=b.esCoordinador,vo=b.esActivosFijos,_=y([]),xo=K(()=>{var i,u;return["inspecciones","incidentes"].includes((u=(i=Po().name)==null?void 0:i.toString())!=null?u:"")}),oe=()=>{const i=s.solicitante,u=s.devolver_materiales_tecnicos;V(),Y.value=!1,O.value.limpiarListado(),s.solicitante=i,s.devolver_materiales_tecnicos=u};L(()=>{Y.value=!1,O.value.limpiarListado(),s.solicitante=b.user.id}),Qo(()=>{setTimeout(()=>{O.value.listarArchivosAlmacenados(s.id)},1)}),S(i=>{mo.value=i,setTimeout(()=>{de()},1),s.solicitante=b.user.id,e("guardado",i)});const{empleados:x,filtrarEmpleados:ee,sucursales:bo,filtrarSucursales:ae}=Lo(p),oo=y([]),fo=y([]);a(async()=>{await w({empleados:{controller:new ao,params:{estado:1}},tareas:{controller:new Fe,params:{todas:1,campos:"id,codigo_tarea,titulo,cliente_id","f_params[orderBy][field]":"id","f_params[orderBy][type]":"DESC","f_params[limit]":150}},incidentes:{controller:new zo,params:{campos:"id,titulo",estado:Fo.CREADO}}}),x.value=p.empleados,fo.value=JSON.parse($.getItem("autorizaciones").toString()),Co.value=p.tareas,p.condiciones=$.getItem("condiciones")?JSON.parse($.getItem("condiciones").toString()):[],oo.value=p.condiciones,K(()=>{var u,R;return["inspecciones","incidentes"].includes((R=(u=co.name)==null?void 0:u.toString())!=null?R:"")}).value||(s.solicitante=b.user.id),console.log(k),k.listadoMateriales.length&&(D.activar(),ro.value=k.inactivo,await wo(k.inactivo),s.devolver_materiales_tecnicos=k.empleado_id!==b.user.id,s.tarea=k.tareaId?k.tareaId:null,s.solicitante=k.empleado_id,s.cliente=k.cliente_id,await ko(s.cliente),s.es_tarea=!!s.tarea,s.es_para_stock=k.devolverAlStock,s.listadoProductos=k.listadoMateriales.map(u=>({producto:u.producto,categoria:u.categoria,descripcion:u.detalle_producto,cantidad:u.stock_actual,medida:u.medida,id:u.detalle_producto_id,serial:u.serial})),k.tareaId&&Vo(k.tareaId),D.desactivar()),p.sucursales=JSON.parse($.getItem("sucursales").toString()),bo.value=p.sucursales,await eo()});const ie={justificacion:{required:Io},observacion_aut:{requiredIfCoordinador:so(()=>s.tiene_observacion_aut)},sucursal:{required:Io},tarea:{requiredIfTarea:so(s.es_tarea)},condicion:{requiredIf:so(()=>s.misma_condicion)}},go=Re(ie,s);A(go.value);const le=new na(s);m.agregarValidaciones(le);function Vo(i){i?te():eo()}const{tareas:Co,filtrarTareas:se,incidentes:yo,filtrarIncidentes:ne}=Lo(p);async function eo(){try{D.activar();const i=G.getEndpoint(X.obtener_clientes_materiales_empleado),u=await G.get(i,{params:{empleado_id:s.solicitante}});_.value=u.data.results}catch(i){console.log(i)}finally{D.desactivar()}}async function te(){try{D.activar();const i=G.getEndpoint(X.obtener_clientes_materiales_tarea),u=await G.get(i,{params:{empleado_id:s.solicitante}});_.value=u.data.results}catch(i){console.log(i)}finally{D.desactivar()}}async function ko(i){s.listadoProductos=[],s.sucursal=null,s.sucursal_id=null,i==null?p.sucursales=JSON.parse($.getItem("sucursales").toString()):p.sucursales=JSON.parse($.getItem("sucursales").toString()).filter(u=>u.cliente_id==i)}async function de(){await O.value.subir()}function re({posicion:i}){no("\xBFEst\xE1 seguro de continuar?",()=>s.listadoProductos.splice(i,1))}function ue(i){F.value=i,h.value=(po||vo||b.esJefeTecnico||b.esGerente||b.esRecursosHumanos||b.can("puede.autorizar.devoluciones"))&&F.value===qo.pendiente,h.value=i=="PENDIENTE",B({estado:i,paginate:!0}),c.fields={estado:i}}async function ce(){const i=(await new Ae().listar({campos:"id,lugar"})).result;$.set("sucursales",JSON.stringify(i)),p.sucursales=i}function me(i){i&&Ho("Esta opci\xF3n generar\xE1 un pedido autom\xE1ticamente con los mismos items de la devoluci\xF3n, cuando la devoluci\xF3n sea aprobada")}async function pe(i){i?(s.per_autoriza=b.user.id,s.autorizacion=2,b.esCoordinadorBodega||b.esBodeguero||(p.empleados=await _e(p.empleados,[io.tecnico,io.tecnico_lider,io.secretario]))):(s.solicitante=b.user.id,s.per_autoriza=null,s.autorizacion=null)}async function wo(i){const u=y();i?u.value=await D.cargarConsulta(async()=>(await new ao().listar({estado:0})).result):u.value=await D.cargarConsulta(async()=>(await new ao().listar({estado:1})).result),p.empleados=u.value,x.value=p.empleados}async function ve(i){switch(i){case"incidentes":a(async()=>{await w({incidentes:{controller:new zo,params:{campos:"id,titulo",estado:Fo.CREADO}}}),yo.value=p.incidentes});break}}const be={titulo:"Quitar",color:"negative",icono:"bi-x",accion:({entidad:i,posicion:u})=>{re({entidad:i,posicion:u})},visible:()=>g.value!=J.consultar},fe={titulo:"Cantidad",icono:"bi-pencil",accion:({posicion:i})=>{const u={titulo:"Modifica",mensaje:"Ingresa la cantidad",tipo:"number",defecto:s.listadoProductos[i].cantidad,accion:R=>s.listadoProductos[i].cantidad=R};to(u)},visible:()=>g.value==J.nuevo&&s.misma_condicion||g.value==J.editar&&s.misma_condicion},ge={titulo:"Anular",color:"negative",icono:"bi-x",accion:({entidad:i,posicion:u})=>{no("\xBFEst\xE1 seguro de anular la devoluci\xF3n?",()=>{to({titulo:"Motivo",mensaje:"Ingresa el motivo de la anulaci\xF3n",accion:async we=>{try{await new sa().anular(i.id,we),Jo("Devoluci\xF3n anulada exitosamente!"),u>=0&&(f.value.splice(u,1),f.value=[...f.value])}catch{Go("No se pudo anular, debes ingresar un motivo para la anulaci\xF3n")}}})})},visible:({entidad:i})=>i.estado_bodega=="PENDIENTE"&&(i.solicitante_id==b.user.id||i.per_autoriza_id==b.user.id||b.esBodeguero||b.esAdministrador)},Ve={titulo:"Imprimir",color:"secondary",icono:"bi-printer",accion:async({entidad:i})=>{j.idDevolucion=i.id,await j.imprimirPdf()},visible:()=>!0},Ce={titulo:"Gestionar",color:"primary",icono:"bi-pencil-square",accion:({entidad:i})=>{j.devolucion=i,console.log("Devoluci\xF3n a ingresar a bodega es: ",j.devolucion),Ko.push("transacciones-ingresos")},visible:()=>(F.value=="APROBADO"||F.value=="PARCIAL")&&b.can("puede.gestionar.devoluciones")},ye={titulo:"Corregir devoluci\xF3n",color:"amber-3",icono:"bi-gear",accion:({entidad:i})=>{j.devolucion=i,uo.abrirModalEntidad("CorregirDevolucionPage")},visible:({entidad:i})=>(F.value=="APROBADO"||F.value=="PARCIAL")&&(b.esBodeguero||i.per_autoriza_id==b.user.id)&&i.estado_bodega==qo.parcial},ke=K(()=>[...$o,{name:"condiciones",field:"condiciones",label:"Estado del producto",align:"left",sortable:!1,visible:!0,type:"select",options:oo.value.map(i=>({label:i.nombre}))},{name:"observacion",field:"observacion",label:"Observaci\xF3n",align:"left",type:"string",sortable:!1}]);return{mixin:m,devolucion:s,disabled:P,accion:g,v$:go,acciones:J,accionesTabla:ze,configuracionColumnas:Oe,empleados:x,filtrarEmpleados:ee,clientes:_,tareas:Co,filtrarTareas:se,autorizaciones:fo,sucursales:bo,filtrarSucursales:ae,condiciones:oo,store:b,refArchivo:O,idDevolucion:mo,modales:uo,mostrarInactivos:ro,refListado:Zo,criterioBusquedaProducto:Wo,listadoProductos:Xo,listarProductos:Yo,limpiarProducto:ho,seleccionarProducto:_o,configuracionColumnasDetallesModal:la,configuracionColumnasProductosSeleccionadosAccion:ke,configuracionColumnasProductosSeleccionados:$o,botonEditarCantidad:fe,botonEliminar:be,botonCorregir:ye,botonAnular:ge,botonImprimir:Ve,botonDespachar:Ce,soloLectura:Y,esCoordinador:po,esActivosFijos:vo,tabOptionsPedidos:Ue,tabSeleccionado:F,puedeEditar:h,checkMostrarInactivos:wo,checkEsTarea:Vo,filtrarDevoluciones:ue,filtrarCliente:ko,checkMismaCondicion(i){i||(s.condicion=null)},onRowClick:i=>alert(`${i.name} clicked`),recargarSucursales:ce,ordenarLista:he,comunicarComportamiento:me,checkSolicitantes:pe,consultar:q,enRutaInspeccionIncidente:xo,reestablecer:V,obtenerClientesMaterialesEmpleado:eo,limpiarCampos:oe,incidentes:yo,filtrarIncidentes:ne,enRutaIncidente:K(()=>co.name==="incidentes"),refrescarListados:ve}}});const $a={class:"row q-col-gutter-sm q-py-md"},La={key:0,class:"col-12 col-md-3"},Fa={key:1,class:"col-12 col-md-3"},za={key:2,class:"col-12 col-md-3"},Ua={key:3,class:"col-12 col-md-3"},Aa={class:"col-md-3 q-mt-md q-pt-sm"},Ba={key:4,class:"col-12 col-md-3"},Ma={class:"col-12 col-md-3"},Ta={class:"error-msg"},Na={class:"col-12 col-md-6"},ja={class:"error-msg"},Oa={key:5,class:"col-12 col-md-3"},Ra={key:6,class:"col-12 col-md-3"},Qa={key:7,class:"col-12 col-md-3"},Ja={key:8,class:"col-12 col-md-3"},Ga={key:9,class:"col-12 col-md-3"},Ha={class:"error-msg"},Ka={key:10,class:"col-12 col-md-3"},Za={key:11,class:"col-12 col-md-3 q-mb-md"},Wa={key:12,class:"col-12 col-md-3"},Xa={class:"error-msg"},Ya={key:13,class:"col-12 col-md-3 q-mb-md"},ha={key:14,class:"col-12 col-md-3 q-mb-md"},_a={class:"col-12 col-md-3"},xa={class:"col-12 q-mb-md"},oi={class:"col-12 col-md-12"},ei={class:"row q-col-gutter-x-xs"},ai={class:"col-12 col-md-10 q-mb-md"},ii={class:"col-12 col-md-2"},li={class:"col-12"};function si(o,e,m,s,P,g){const p=z("gestor-archivos"),f=z("essential-table"),c=z("essential-selectable-table"),A=z("tab-layout-filter-tabs2"),w=z("modales-entidad");return d(),r(Q,null,[l(A,{mixin:o.mixin,configuracionColumnas:o.configuracionColumnas,"titulo-pagina":"Devoluciones","tab-options":o.tabOptionsPedidos,tabDefecto:"PENDIENTE",filtrar:o.filtrarDevoluciones,ajustarCeldas:!0,permitirEditar:o.puedeEditar,"permitir-cancelar":!o.enRutaInspeccionIncidente,"mostrar-listado":!o.enRutaInspeccionIncidente,accion1:o.botonDespachar,accion2:o.botonAnular,accion3:o.botonCorregir,accion4:o.botonImprimir,paginate:""},{formulario:t(()=>[l(To,{onSubmit:e[27]||(e[27]=Mo(()=>{},["prevent"]))},{default:t(()=>[n("div",$a,[o.devolucion.id?(d(),r("div",La,[e[28]||(e[28]=n("label",{class:"q-mb-sm block"},"Devoluci\xF3n N\xB0",-1)),l(C,{modelValue:o.devolucion.id,"onUpdate:modelValue":e[0]||(e[0]=a=>o.devolucion.id=a),placeholder:"Obligatorio",disable:o.disabled||o.soloLectura,readonly:o.disabled||o.soloLectura,outlined:"",dense:""},null,8,["modelValue","disable","readonly"])])):v("",!0),o.devolucion.created_at?(d(),r("div",Fa,[e[29]||(e[29]=n("label",{class:"q-mb-sm block"},"Fecha",-1)),l(C,{modelValue:o.devolucion.created_at,"onUpdate:modelValue":e[1]||(e[1]=a=>o.devolucion.created_at=a),disable:"",outlined:"",dense:""},null,8,["modelValue"])])):v("",!0),o.accion==o.acciones.nuevo&&(o.store.esCoordinador||o.store.esCoordinadorBackup||o.store.esJefeTecnico||o.store.esCoordinadorBodega||o.store.can("puede.hacer.devoluciones_terceros"))?(d(),r("div",za,[e[30]||(e[30]=n("br",null,null,-1)),l(Be,{modelValue:o.devolucion.devolver_materiales_tecnicos,"onUpdate:modelValue":[e[2]||(e[2]=a=>o.devolucion.devolver_materiales_tecnicos=a),o.checkSolicitantes],label:o.devolucion.devolver_materiales_tecnicos?"Devolver materiales de tecnicos":"Devolver mis materiales",disable:o.disabled,color:"positive","checked-icon":"bi-check",outlined:"",dense:""},null,8,["modelValue","label","disable","onUpdate:modelValue"])])):v("",!0),o.accion==o.acciones.nuevo&&o.devolucion.devolver_materiales_tecnicos||o.accion!=o.acciones.nuevo&&o.devolucion.solicitante?(d(),r("div",Ua,[e[32]||(e[32]=n("label",{class:"q-mb-sm block"},"Solicitante",-1)),l(I,{modelValue:o.devolucion.solicitante,"onUpdate:modelValue":[e[3]||(e[3]=a=>o.devolucion.solicitante=a),e[4]||(e[4]=()=>{o.limpiarCampos(),o.obtenerClientesMaterialesEmpleado()})],options:o.empleados,"transition-show":"scale","transition-hide":"scale","options-dense":"",dense:"",outlined:"",disable:o.disabled||o.soloLectura,readonly:o.disabled||o.soloLectura,"option-label":a=>a.apellidos+" "+a.nombres,"option-value":a=>a.id,"use-input":"","input-debounce":"0",onFilter:o.filtrarEmpleados,onPopupShow:e[5]||(e[5]=a=>o.ordenarLista(o.empleados,"apellidos")),"emit-value":"","map-options":""},{"no-option":t(()=>[l(T,null,{default:t(()=>[l(N,{class:"text-grey"},{default:t(()=>e[31]||(e[31]=[E(" No hay resultados ")])),_:1})]),_:1})]),_:1},8,["modelValue","options","disable","readonly","option-label","option-value","onFilter"])])):v("",!0),n("div",Aa,[l(U,{class:"q-mt-sm q-pt-sm",modelValue:o.mostrarInactivos,"onUpdate:modelValue":[e[6]||(e[6]=a=>o.mostrarInactivos=a),o.checkMostrarInactivos],label:"Inactivos",disable:o.disabled,outlined:"",dense:""},null,8,["modelValue","disable","onUpdate:modelValue"])]),o.accion==o.acciones.nuevo||o.devolucion.cliente?(d(),r("div",Ba,[e[33]||(e[33]=n("label",{class:"q-mb-sm block"},"Seleccione un cliente para filtrar los materiales",-1)),l(I,{modelValue:o.devolucion.cliente,"onUpdate:modelValue":[e[7]||(e[7]=a=>o.devolucion.cliente=a),o.filtrarCliente],options:o.clientes,"transition-show":"scale","transition-hide":"scale","use-input":"","input-debounce":"0","options-dense":"",dense:"",outlined:"",disable:o.disabled||o.soloLectura,"option-label":a=>a.razon_social,"option-value":a=>a.cliente_id,"emit-value":"","map-options":""},null,8,["modelValue","options","disable","option-label","option-value","onUpdate:modelValue"])])):v("",!0),n("div",Ma,[e[34]||(e[34]=n("label",{class:"q-mb-sm block"},"Lugar de devoluci\xF3n",-1)),l(I,{modelValue:o.devolucion.sucursal,"onUpdate:modelValue":e[8]||(e[8]=a=>o.devolucion.sucursal=a),options:o.sucursales,"transition-show":"scale","transition-hide":"scale","options-dense":"",dense:"",outlined:"",disable:o.disabled||o.soloLectura,error:!!o.v$.sucursal.$errors.length,"error-message":"Debes seleccionar una sucursal",hint:"Bodega donde se realiza la devoluci\xF3n de materiales","use-input":"","input-debounce":"0",onFilter:o.filtrarSucursales,onPopupShow:e[9]||(e[9]=a=>o.ordenarLista(o.sucursales,"lugar")),"option-label":a=>a.lugar,"option-value":a=>a.id,"emit-value":"","map-options":""},{error:t(()=>[(d(!0),r(Q,null,Z(o.v$.sucursal.$errors,a=>(d(),r("div",{key:a.$uid},[n("div",Ta,M(a.$message),1)]))),128))]),after:t(()=>[l(lo,{color:"positive",onClick:o.recargarSucursales,disable:o.disabled||o.soloLectura},{default:t(()=>[l(So,{size:"xs",class:"q-mr-sm",name:"bi-arrow-clockwise"})]),_:1},8,["onClick","disable"])]),_:1},8,["modelValue","options","disable","error","onFilter","option-label","option-value"])]),n("div",Na,[e[35]||(e[35]=n("label",{class:"q-mb-sm block"},"Justificaci\xF3n",-1)),l(C,{type:"textarea",autogrow:"",modelValue:o.devolucion.justificacion,"onUpdate:modelValue":e[10]||(e[10]=a=>o.devolucion.justificacion=a),placeholder:"Obligatorio",disable:o.disabled||o.soloLectura,readonly:o.disabled||o.soloLectura,error:!!o.v$.justificacion.$errors.length,outlined:"",dense:""},{error:t(()=>[(d(!0),r(Q,null,Z(o.v$.justificacion.$errors,a=>(d(),r("div",{key:a.$uid},[n("div",ja,M(a.$message),1)]))),128))]),_:1},8,["modelValue","disable","readonly","error"])]),o.devolucion.pedido_automatico||o.accion===o.acciones.nuevo?(d(),r("div",Oa,[l(W,{class:"bg-dark"},{default:t(()=>e[36]||(e[36]=[E("Marque esta opci\xF3n unicamente cuando quieras hacer un pedido de lo mismo que vas a devolver")])),_:1}),l(U,{class:"q-mt-lg q-pt-md",modelValue:o.devolucion.pedido_automatico,"onUpdate:modelValue":[e[11]||(e[11]=a=>o.devolucion.pedido_automatico=a),o.comunicarComportamiento],label:"\xBFPedido autom\xE1tico?",disable:o.disabled||o.soloLectura,outlined:"",dense:""},null,8,["modelValue","disable","onUpdate:modelValue"])])):v("",!0),o.devolucion.es_tarea||o.accion===o.acciones.nuevo?(d(),r("div",Ra,[l(W,{class:"bg-dark"},{default:t(()=>e[37]||(e[37]=[E("Marque esta opci\xF3n cuando quieras hacer devoluciones de materiales de tarea")])),_:1}),l(U,{class:"q-mt-lg q-pt-md",modelValue:o.devolucion.es_tarea,"onUpdate:modelValue":[e[12]||(e[12]=a=>o.devolucion.es_tarea=a),o.checkEsTarea],label:"\xBFEs material de tarea?",disable:o.disabled||o.soloLectura,outlined:"",dense:""},null,8,["modelValue","disable","onUpdate:modelValue"])])):v("",!0),o.devolucion.es_tarea?(d(),r("div",Qa,[e[39]||(e[39]=n("label",{class:"q-mb-sm block"},"Tarea",-1)),l(I,{modelValue:o.devolucion.tarea,"onUpdate:modelValue":e[13]||(e[13]=a=>o.devolucion.tarea=a),options:o.tareas,onFilter:o.filtrarTareas,"use-input":"","input-debounce":"0","transition-show":"scale","transition-hide":"scale","options-dense":"",clearable:"",hint:"Tarea #",dense:"",outlined:"",disable:o.disabled||o.soloLectura,readonly:o.disabled||o.soloLectura,"option-label":a=>a.codigo_tarea+" - "+a.titulo,"option-value":a=>a.id,"emit-value":"","map-options":""},{option:t(a=>[l(T,Me(Te(a.itemProps)),{default:t(()=>[l(N,null,{default:t(()=>[l(Do,null,{default:t(()=>[E(M(a.opt.codigo_tarea),1)]),_:2},1024),l(Do,{caption:""},{default:t(()=>[E(M(a.opt.titulo),1)]),_:2},1024)]),_:2},1024)]),_:2},1040)]),"no-option":t(()=>[l(T,null,{default:t(()=>[l(N,{class:"text-grey"},{default:t(()=>e[38]||(e[38]=[E(" No hay resultados ")])),_:1})]),_:1})]),_:1},8,["modelValue","options","onFilter","disable","readonly","option-label","option-value"])])):v("",!0),o.accion===o.acciones.nuevo||o.devolucion.misma_condicion?(d(),r("div",Ja,[l(W,{class:"bg-dark"},{default:t(()=>e[40]||(e[40]=[E("Marque esta opci\xF3n para seleccionar un estado para todos los elementos de la devoluci\xF3n")])),_:1}),l(U,{class:"q-mt-lg q-pt-md",modelValue:o.devolucion.misma_condicion,"onUpdate:modelValue":[e[14]||(e[14]=a=>o.devolucion.misma_condicion=a),o.checkMismaCondicion],label:"\xBFMismo estado?",disable:o.disabled||o.soloLectura||o.accion==o.acciones.editar&&o.devolucion.misma_condicion,dense:""},null,8,["modelValue","onUpdate:modelValue","disable"])])):v("",!0),o.devolucion.misma_condicion?(d(),r("div",Ga,[e[42]||(e[42]=n("label",{class:"q-mb-sm block"},"Estado de los productos",-1)),l(I,{modelValue:o.devolucion.condicion,"onUpdate:modelValue":e[15]||(e[15]=a=>o.devolucion.condicion=a),options:o.condiciones,"transition-show":"jum-up","transition-hide":"jump-down","options-dense":"",dense:"",outlined:"",readonly:o.disabled,error:!!o.v$.condicion.$errors.length,"error-message":"Debes seleccionar una condici\xF3n","option-value":a=>a.id,"option-label":a=>a.nombre,"emit-value":"","map-options":""},{error:t(()=>[(d(!0),r(Q,null,Z(o.v$.condicion.$errors,a=>(d(),r("div",{key:a.$uid},[n("div",Ha,M(a.$message),1)]))),128))]),"no-option":t(()=>[l(T,null,{default:t(()=>[l(N,{class:"text-grey"},{default:t(()=>e[41]||(e[41]=[E(" No hay resultados ")])),_:1})]),_:1})]),_:1},8,["modelValue","options","readonly","error","option-value","option-label"])])):v("",!0),o.devolucion.per_autoriza?(d(),r("div",Ka,[e[43]||(e[43]=n("label",{class:"q-mb-sm block"},"Persona que autoriza",-1)),l(I,{modelValue:o.devolucion.per_autoriza,"onUpdate:modelValue":e[16]||(e[16]=a=>o.devolucion.per_autoriza=a),options:o.empleados,"transition-show":"jump-up","transition-hide":"jump-up","options-dense":"",dense:"",outlined:"",disable:o.disabled||o.soloLectura,readonly:o.disabled||o.soloLectura,"option-label":a=>a.nombres+" "+a.apellidos,"option-value":a=>a.id,"emit-value":"","map-options":""},null,8,["modelValue","options","disable","readonly","option-label","option-value"])])):v("",!0),o.devolucion.autorizacion?(d(),r("div",Za,[e[45]||(e[45]=n("label",{class:"q-mb-sm block"},"Autorizacion",-1)),l(I,{modelValue:o.devolucion.autorizacion,"onUpdate:modelValue":e[17]||(e[17]=a=>o.devolucion.autorizacion=a),options:o.autorizaciones,"transition-show":"jum-up","transition-hide":"jump-down","options-dense":"",dense:"",outlined:"",disable:o.disabled||o.soloLectura,readonly:o.disabled||o.soloLectura&&!(o.esCoordinador||o.esActivosFijos||o.store.user.id==o.devolucion.per_autoriza),"option-value":a=>a.id,"option-label":a=>a.nombre,"emit-value":"","map-options":""},{"no-option":t(()=>[l(T,null,{default:t(()=>[l(N,{class:"text-grey"},{default:t(()=>e[44]||(e[44]=[E(" No hay resultados ")])),_:1})]),_:1})]),_:1},8,["modelValue","options","disable","readonly","option-value","option-label"])])):v("",!0),o.store.user.id===o.devolucion.per_autoriza?(d(),r("div",Wa,[e[46]||(e[46]=n("label",{class:"q-mb-sm block"},"Observacion",-1)),l(C,{autogrow:"",modelValue:o.devolucion.observacion_aut,"onUpdate:modelValue":e[18]||(e[18]=a=>o.devolucion.observacion_aut=a),placeholder:"Opcional",disable:o.disabled||o.soloLectura&&!(o.esCoordinador||o.esActivosFijos||o.store.user.id==o.devolucion.per_autoriza_id),error:!!o.v$.observacion_aut.$errors.length,outlined:"",dense:""},{error:t(()=>[(d(!0),r(Q,null,Z(o.v$.observacion_aut.$errors,a=>(d(),r("div",{key:a.$uid},[n("div",Xa,M(a.$message),1)]))),128))]),_:1},8,["modelValue","disable","error"])])):v("",!0),o.devolucion.estado_bodega?(d(),r("div",Ya,[e[47]||(e[47]=n("label",{class:"q-mb-sm block"},"Estado",-1)),l(C,{autogrow:"",modelValue:o.devolucion.estado_bodega,"onUpdate:modelValue":e[19]||(e[19]=a=>o.devolucion.estado_bodega=a),disable:"",outlined:"",dense:""},null,8,["modelValue"])])):v("",!0),o.devolucion.causa_anulacion?(d(),r("div",ha,[e[48]||(e[48]=n("label",{class:"q-mb-sm block"},"Causa anulaci\xF3n",-1)),l(C,{autogrow:"",modelValue:o.devolucion.causa_anulacion,"onUpdate:modelValue":e[20]||(e[20]=a=>o.devolucion.causa_anulacion=a),disable:"",outlined:"",dense:""},null,8,["modelValue"])])):v("",!0),n("div",_a,[e[51]||(e[51]=n("label",{class:"q-mb-sm block"},"Incidente (Opcional)",-1)),l(I,{modelValue:o.devolucion.incidente,"onUpdate:modelValue":e[22]||(e[22]=a=>o.devolucion.incidente=a),options:o.incidentes,"transition-show":"scale","transition-hide":"scale",disable:o.disabled||o.enRutaIncidente,"options-dense":"",dense:"",outlined:"",clearable:"","use-input":"","input-debounce":"0",onFilter:o.filtrarIncidentes,"option-label":a=>a.titulo,"option-value":a=>a.id,"emit-value":"","map-options":""},{"no-option":t(()=>[l(T,null,{default:t(()=>[l(N,{class:"text-grey"},{default:t(()=>e[49]||(e[49]=[E(" No hay resultados ")])),_:1})]),_:1})]),after:t(()=>[l(lo,{color:"positive",onClick:e[21]||(e[21]=a=>o.refrescarListados("incidentes")),disable:o.disabled||o.enRutaIncidente,unelevated:"",square:""},{default:t(()=>[l(So,{size:"xs",name:"bi-arrow-clockwise"}),l(W,null,{default:t(()=>e[50]||(e[50]=[E("Recargar incidentes")])),_:1})]),_:1},8,["disable"])]),_:1},8,["modelValue","options","disable","onFilter","option-label","option-value"])]),n("div",xa,[l(p,{ref:"refArchivo",label:"Evidencia de la devoluci\xF3n",mixin:o.mixin,disable:o.disabled,listarAlGuardar:!1,"permitir-eliminar":o.accion==o.acciones.nuevo||o.accion==o.acciones.editar,idModelo:o.idDevolucion},null,8,["mixin","disable","permitir-eliminar","idModelo"])]),n("div",oi,[e[53]||(e[53]=n("label",{class:"q-mb-sm block"},"Agregar productos",-1)),n("div",ei,[n("div",ai,[l(C,{modelValue:o.criterioBusquedaProducto,"onUpdate:modelValue":e[23]||(e[23]=a=>o.criterioBusquedaProducto=a),placeholder:"Nombre de producto",hint:"Presiona Enter para seleccionar un producto",onKeydown:e[24]||(e[24]=Ne(a=>o.listarProductos({empleado_id:o.devolucion.solicitante,cliente_id:o.devolucion.cliente}),["enter"])),onBlur:e[25]||(e[25]=a=>o.criterioBusquedaProducto===""?o.limpiarProducto():null),outlined:"",dense:""},null,8,["modelValue"])]),n("div",ii,[l(lo,{onClick:e[26]||(e[26]=a=>o.listarProductos({empleado_id:o.devolucion.solicitante,cliente_id:o.devolucion.cliente})),icon:"search",unelevated:"",color:"primary",class:"full-width",style:{height:"40px"},"no-caps":""},{default:t(()=>e[52]||(e[52]=[E("Buscar")])),_:1})])])]),n("div",li,[l(f,{titulo:"Productos Seleccionados",configuracionColumnas:o.accion==o.acciones.nuevo||o.accion==o.acciones.editar?[...o.configuracionColumnasProductosSeleccionadosAccion,o.accionesTabla]:o.configuracionColumnasProductosSeleccionadosAccion,datos:o.devolucion.listadoProductos,permitirConsultar:!1,permitirEditarModal:!0,permitirEditar:!o.devolucion.misma_condicion&&(o.accion==o.acciones.nuevo||o.accion==o.acciones.editar),permitirEliminar:!1,mostrarBotones:!1,accion1:o.botonEditarCantidad,accion2:o.botonEliminar,altoFijo:!1,ajustarCeldas:!0},null,8,["configuracionColumnas","datos","permitirEditar","accion1","accion2"])])])]),_:1}),l(c,{ref:"refListado","configuracion-columnas":o.configuracionColumnasDetallesModal,datos:o.listadoProductos,"tipo-seleccion":"multiple",onSelected:o.seleccionarProducto},null,8,["configuracion-columnas","datos","onSelected"])]),_:1},8,["mixin","configuracionColumnas","tab-options","filtrar","permitirEditar","permitir-cancelar","mostrar-listado","accion1","accion2","accion3","accion4"]),l(w,{comportamiento:o.modales},null,8,["comportamiento"])],64)}var ni=Bo(Ia,[["render",si]]),zi=Object.freeze(Object.defineProperty({__proto__:null,default:ni},Symbol.toStringTag,{value:"Module"}));export{ni as D,zo as I,zi as a};
