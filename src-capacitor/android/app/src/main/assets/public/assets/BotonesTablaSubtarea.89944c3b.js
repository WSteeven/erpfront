var Fe=Object.defineProperty;var Ue=(a,e,s)=>e in a?Fe(a,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):a[e]=s;var $=(a,e,s)=>(Ue(a,typeof e!="symbol"?e+"":e,s),s);import{A as wa,t as M,bG as De,bz as Qa,U as ra,e as b,bH as Ja,c as qe,u as Za,bV as f,q as Ve,g as ua,f as sa,i as Re,w as Va,bQ as Oe,bR as Pe,v as Ie,x as ta,y as A,S as V,H as w,B as d,a6 as ma,M as ya,D as p,R as Ra,F as Oa,bf as Ea,aa as oa,z as K,L as D,I as Pa,J as Ia,cP as Na,G as Ne}from"./index.976e8f3c.js";import{a as Ha,Q as W}from"./QTabs.3c726b04.js";import{Q as Ba}from"./QSelect.a8f2bfb2.js";import{a as La,Q as X}from"./QTabPanels.1c8c4baa.js";import{Q as He}from"./QPage.ed5d79ca.js";import{S as Be,v as Le,A as $e,i as Ca,n as Ta,a as Ge}from"./utils.30e08aa2.js";import{u as Ya}from"./trabajoAsignado.f9b7ddcf.js";import{A as Qe,u as Je}from"./ArchivoSeguimiento.c473f5d7.js";import{T as za,_ as Ze,u as Ye}from"./BotonesTablaTicket.8eaa0146.js";import{_ as Ke}from"./TablaFilasDinamicas.262857b3.js";import{E as We,S as Xe}from"./EssentialTable.d8e6954a.js";import{B as xe}from"./buttonSubmits.2eb37d38.js";import{M as ai}from"./ModalEntidad.84100166.js";import{V as ei}from"./VisorImagen.e7965569.js";import{M as ii}from"./MotivoCanceladoTicketController.b353f34a.js";import{T as Ka}from"./TicketController.af9c2ba9.js";import{C as ti}from"./ComportamientoModalesTicketAsignado.4be2d82b.js";import{C as Aa}from"./ContenedorSimpleMixin.5a0b06ab.js";import{F as oi,u as si}from"./FiltroMiBodegaEmpleado.020f4a2d.js";import{F as ri,u as li}from"./FiltroMiBodegaProyecto.782f312c.js";import{A as ni}from"./Archivo.c26f5472.js";import{E as di}from"./entidadAuditable.75a46700.js";import{u as ci}from"./movilizacionSubtarea.7b909866.js";import{S as ui}from"./SubtareaController.f9fcde99.js";class x{constructor(){$(this,"axios");$(this,"cargando",new Be);this.axios=wa.getInstance()}async asignar(e){return await this.solicitud("/asignar",e)}async agendar(e){return await this.solicitud("/agendar",e)}async ejecutar(e,s){return this.solicitud("/ejecutar",e,s)}async realizar(e,s){return this.solicitud("/realizar",e,s)}async finalizar(e,s){return this.solicitud("/finalizar",e,s)}async pausar(e,s){return this.solicitud("/pausar",e,s)}async reanudar(e,s){return this.solicitud("/reanudar",e,s)}async corregir(e){return this.solicitud("/corregir",e)}async suspender(e,s){return this.solicitud("/suspender",e,s)}async pendiente(e,s){return this.solicitud("/pendiente",e,{motivo_pendiente_id:s})}async cancelar(e,s){return this.solicitud("/cancelar",e,{motivo_suspendido_id:s})}async reagendar(e,s){return await this.solicitud("/reagendar",e,{nueva_fecha:s})}async solicitud(e,s,T){this.cargando.activar();try{const y=this.axios.getEndpoint(M.subtareas)+e+"/"+s,l=await this.axios.post(y,T);return{response:l,result:l.data.modelo}}catch(y){const l=y;throw new De(l)}finally{this.cargando.desactivar()}}}const Ma=[{name:"detalle_producto",field:"detalle_producto",label:"Producto",align:"left",sortable:!0,type:"text"},{name:"serial",field:"serial",label:"Serial",align:"left"},{name:"medida",field:"medida",label:"Medida",align:"left"},{name:"cliente",field:"cliente",label:"Cliente",align:"left"},{name:"despachado",field:"despachado",label:"Despachado",align:"left"},{name:"cantidad_utilizada",field:"cantidad_utilizada",label:"Cantidad utilizada en el dia",align:"left"},{name:"total_cantidad_utilizada",field:"total_cantidad_utilizada",label:"Total cantidad utilizada",align:"left"},{name:"stock_actual",field:"stock_actual",label:"Stock actual",align:"left"},{name:"devuelto",field:"devuelto",label:"Devuelto",align:"left"}],mi=[{name:"fecha_hora",field:"fecha_hora",label:"Fecha hora",align:"center",type:"text",sortable:!0,editable:!0,disableModal:!0},{name:"trabajo_realizado",field:"trabajo_realizado",label:"Trabajo realizado",align:"left",type:"text",hint:"Obligatorio",requerido:!0},{name:"fotografia",field:"fotografia",label:"Fotografia",align:"left",type:"imagen",visible:!1,hint:"Obligatorio",requerido:!0}];class pi extends Qa{constructor(){super(M.actividades_realizadas_seguimientos_subtareas)}}class bi extends Qa{constructor(){super(M.archivos_seguimientos)}}class $a extends di{constructor(){super();$(this,"fecha_hora");$(this,"trabajo_realizado");$(this,"fotografia");$(this,"subtarea");this.fecha_hora=null,this.trabajo_realizado=null,this.fotografia=null,this.subtarea=null}}const fi=[{name:"producto",field:"producto",label:"Producto",align:"left"},{name:"suma_total",field:"suma_total",label:"Suma total",align:"center"}],_i=[{name:"codigo",field:"codigo",label:"C\xF3digo del ticket",align:"left",sortable:!0,visible:!1,editable:!1},{name:"asunto",field:"asunto",label:"Asunto",align:"left"},{name:"descripcion",field:"descripcion",label:"Descripci\xF3n",align:"left"},{name:"fotografia",field:"fotografia",label:"Fotograf\xEDa",visible:!1,type:"imagen"},{name:"responsable",field:"responsable",label:"Responsable",align:"left",sortable:!0,editable:!1},{name:"estado",field:"estado",label:"Estado",align:"left",editable:!1}];function gi(a){const e=new Ka,{notificarCorrecto:s}=ra(),T=b([]);async function y(h){a(async()=>{const{result:k}=await e.listar({filter:`solicitud_ats[subtarea_id]=${h}`});return T.value=k})}async function l(h,k){const m=new za;m.asunto=h.asunto,m.descripcion=h.descripcion,m.es_solicitud_ats=!0,m.prioridad="ALTA",m.subtarea_id=k,m.para_sso=!0;const o=h.fotografia;try{a(async()=>{const{result:C}=await e.guardar(m);if(T.value.unshift(C),o){const U=E(o);await q(U,C.id)}})}catch(C){console.log(C)}}function E(h){const k=atob(h.split(",")[1]),m=new Array(k.length);for(let U=0;U<k.length;U++)m[U]=k.charCodeAt(U);const o=new Uint8Array(m),C=new Blob([o],{type:"image/png"});return new File([C],"nombre_de_archivo.png",{type:"image/png"})}async function q(h,k){const m=new FormData;m.append("file",h),m.append("ticket_id",k);const o=M.archivos_tickets,C=wa.getInstance(),U=`${Ja.URL_BASE}/${C.getEndpoint(o)}`,P=await C.post(U,m);s(P.data.mensaje)}return{mostrarSolicitudesAts:b(!1),consultarTicketsATS:y,ticketsAts:T,guardarFilaSolicitudAts:l}}const vi=[{name:"detalle_producto",field:"detalle_producto",label:"Producto",align:"left",sortable:!0,type:"text"},{name:"serial",field:"serial",label:"Serial",align:"left"},{name:"medida",field:"medida",label:"Medida",align:"left"},{name:"cliente",field:"cliente",label:"Cliente",align:"left"},{name:"despachado",field:"despachado",label:"Despachado",align:"left"},{name:"total_cantidad_utilizada",field:"total_cantidad_utilizada",label:"Total cantidad utilizada",align:"left"},{name:"stock_actual",field:"stock_actual",label:"Stock actual",align:"left"},{name:"devuelto",field:"devuelto",label:"Devuelto",align:"left"}];var Si=qe({components:{EssentialTable:We,SelectorImagen:Xe,ButtonSubmits:xe,TablaObservaciones:Ze,ArchivoSeguimiento:Qe,TablaFilasDinamicas:Ke,VisorImagen:ei,ModalesEntidad:ai},props:{mixinModal:{type:Object,required:!0}},emits:["cerrar-modal"],setup(a,{emit:e}){const s=Ya(),T=Za(),y=new Aa(ni,new bi),l=new Aa($a,new pi),{entidad:E,listado:q}=l.useReferencias(),{guardar:h,listar:k,cargarVista:m}=l.useComportamiento(),o=b(),C=b(),U=b(),P=b(!1),la=b(!1),R=b(!1),pa=b(!1),ba=b(!1),H=![f.FINALIZADO,f.PAUSADO,f.CANCELADO,f.SUSPENDIDO].includes(s.subtarea.estado),fa=H?[...Ma,Ve]:Ma,{prompt:B}=ra(),_a=s.codigoSubtarea,ga=ua(()=>{var t;return"Rango disponible desde "+s.subtarea.fecha_hora_ejecucion.substring(0,10)+" hasta "+((t=s.subtarea.fecha_hora_finalizacion)!=null?t:Le())}),na=b(!0),G=b([]),Q=ua(()=>na.value?G.value.filter(t=>t.stock_actual):G.value),J=b(!0),aa=b([]),Z=ua(()=>J.value?aa.value.filter(t=>t.stock_actual):aa.value),va=b([]),O=b([]),L=b([]),I=b([]),ea=b([]),i=T.esTecnicoLider,u=T.esCoordinador||T.esJefeTecnico||T.esCoordinadorBackup,S=b(),r=s.subtarea,c=b(),j=b(),Y=b(),da=b(),ja=b([]),Fa=b([]),Wa=b([]),Xa=b([]),v=wa.getInstance(),F={tarea_id:s.idTareaSeleccionada,subtarea_id:s.subtarea.id,proyecto_id:s.proyecto_id,etapa_id:s.etapa_id,empleado_id:N()},Ua=new ti,Sa=new Aa(za,new Ka),{obtenerListados:xa}=Sa.useComportamiento(),{listadosAuxiliares:ha}=Sa.useReferencias();xa({motivosCancelados:{controller:new ii,params:{activo:1}},clientesMaterialesTarea:[],clientesMaterialesEmpleado:[]});const{mostrarSolicitudesAts:ae,consultarTicketsATS:ee,ticketsAts:ie,guardarFilaSolicitudAts:te}=gi(m),{btnSeguimiento:oe,btnCancelar:se}=Ye(Sa,Ua),ca=sa(new ri);ca.empleado_id=F.empleado_id,ca.proyecto_id=F.proyecto_id,ca.etapa_id=F.etapa_id;const Da=new oi;Da.empleado_id=F.empleado_id;const{consultarClientesMaterialesTarea:ka}=li(ca,ha),{consultarClientesMaterialesEmpleado:re}=si(Da,ha);k({subtarea_id:s.subtarea.id}),Se(),he(),ye(),ke(),ee(r.id),Re(()=>S.value.listarArchivos({subtarea_id:s.subtarea.id}));const le={titulo:"Cantidad utilizada",icono:"bi-pencil-square",color:"primary",visible:()=>H,accion:({entidad:t,posicion:n})=>{const g={titulo:"Confirmaci\xF3n",mensaje:"Ingresa la cantidad",defecto:Q.value[n].cantidad_utilizada,tipo:"number",validacion:_=>{var z;return!!_&&_>=0&&_<=t.stock_actual+((z=t.cantidad_utilizada)!=null?z:0)},accion:async _=>{var ia;t.cantidad_anterior=(ia=t.cantidad_utilizada)!=null?ia:0,t.cantidad_utilizada=_;const z=await be(t);Q.value[n].total_cantidad_utilizada=z.total_cantidad_utilizada,Q.value[n].stock_actual=z.stock_actual}};B(g)}},ne={titulo:"Cantidad utilizada",icono:"bi-pencil-square",color:"primary",visible:()=>H,accion:({entidad:t,posicion:n})=>{const g={titulo:"Confirmaci\xF3n",mensaje:"Ingresa la cantidad",defecto:Z.value[n].cantidad_utilizada,tipo:"number",validacion:_=>{var z;return!!_&&_>=0&&_<=t.stock_actual+((z=t.cantidad_utilizada)!=null?z:0)},accion:async _=>{var ia;t.cantidad_anterior=(ia=t.cantidad_utilizada)!=null?ia:0,t.cantidad_utilizada=_;const z=await fe(t);Z.value[n].total_cantidad_utilizada=z.total_cantidad_utilizada,Z.value[n].stock_actual=z.stock_actual}};B(g)}},de={titulo:"Ver fotograf\xEDa",icono:"bi-image-fill",color:"secondary",visible:({entidad:t})=>t.fotografia,accion:async({entidad:t})=>{C.value.abrir(t.fotografia)}},ce={titulo:"Cantidad utilizada",icono:"bi-pencil-square",color:"primary",visible:()=>H,accion:({entidad:t,posicion:n})=>{const g={titulo:"Confirmaci\xF3n",mensaje:"Ingresa la cantidad",defecto:O.value[n].cantidad_utilizada,tipo:"number",validacion:_=>!!_&&_>=0&&_<=t.stock_actual+t.cantidad_utilizada,accion:async _=>{t.cantidad_anterior=t.cantidad_utilizada,t.cantidad_utilizada=_;const z=await me(t);z.id=t.id,O.value[n]=z}};B(g)}},ue={titulo:"Cantidad utilizada",icono:"bi-pencil-square",color:"primary",visible:()=>H,accion:({entidad:t,posicion:n})=>{const g={titulo:"Confirmaci\xF3n",mensaje:"Ingresa la cantidad",defecto:L.value[n].cantidad_utilizada,tipo:"number",validacion:_=>!!_&&_>=0&&_<=t.stock_actual+t.cantidad_utilizada,accion:async _=>{t.cantidad_anterior=t.cantidad_utilizada,t.cantidad_utilizada=_;const z=await pe(t);z.id=t.id,L.value[n]=z}};B(g)}};async function me(t){const n={...F,detalle_producto_id:t.detalle_producto_id,cantidad_utilizada:t.cantidad_utilizada,cantidad_anterior:t.cantidad_anterior,fecha:c.value,cliente_id:t.cliente_id},g=v.getEndpoint(M.actualizar_cantidad_utilizada_historial,n);return(await v.post(g)).data.modelo}async function pe(t){const n={...F,detalle_producto_id:t.detalle_producto_id,cantidad_utilizada:t.cantidad_utilizada,cantidad_anterior:t.cantidad_anterior,fecha:j.value,cliente_id:t.cliente_id},g=v.getEndpoint(M.actualizar_cantidad_utilizada_historial_stock,n);return(await v.post(g)).data.modelo}async function be(t){const n={...F,detalle_producto_id:t.detalle_producto_id,cantidad_utilizada:t.cantidad_utilizada,cantidad_anterior:t.cantidad_anterior,fecha:c.value,cliente_id:t.cliente_id},g=v.getEndpoint(M.actualizar_cantidad_utilizada_tarea,n);return(await v.post(g)).data.modelo}async function fe(t){const n={subtarea_id:s.subtarea.id,empleado_id:N(),detalle_producto_id:t.detalle_producto_id,cantidad_utilizada:t.cantidad_utilizada,cantidad_anterior:t.cantidad_anterior,fecha:c.value,cliente_id:t.cliente_id},g=v.getEndpoint(M.actualizar_cantidad_utilizada_stock,n);return(await v.post(g)).data.modelo}function N(){return i?T.user.id:s.subtarea.empleado_responsable_id}async function _e(t){m(async()=>{const n={tarea_id:s.subtarea.tarea_id,subtarea_id:s.subtarea.id,empleado_id:N(),cliente_id:t,proyecto_id:r.proyecto_id,etapa_id:r.etapa_id};r.proyecto_id||delete n.proyecto_id,r.etapa_id||delete n.etapa_id,r.etapa_id&&delete n.tarea_id;const g=v.getEndpoint(M.materiales_empleado_tarea,n),_=await v.get(g);G.value=_.data.results})}function ge(t){m(async()=>{const n=v.getEndpoint(M.materiales_empleado,{empleado_id:N(),subtarea_id:s.subtarea.id,cliente_id:t}),g=await v.get(n);aa.value=g.data.results})}function qa(t){m(async()=>{const n=v.getEndpoint(M.obtener_historial_material_tarea_usado_por_fecha,{fecha:t,subtarea_id:s.subtarea.id,empleado_id:N()}),g=await v.get(n);O.value=g.data.results})}function ve(t){m(async()=>{const n=v.getEndpoint(M.obtener_historial_material_stock_usado_por_fecha,{fecha:t,subtarea_id:s.subtarea.id,empleado_id:N()}),g=await v.get(n);L.value=g.data.results})}function Se(){m(async()=>{const t=v.getEndpoint(M.fechas_historial_materiales_usados)+"/"+s.subtarea.id,n=await v.get(t);ja.value=n.data.results})}function he(){m(async()=>{const t=v.getEndpoint(M.fechas_historial_materiales_stock_usados)+"/"+s.subtarea.id,n=await v.get(t);Fa.value=n.data.results})}function ke(){re({empleado_id:N()})}async function ye(){F.proyecto_id&&F.etapa_id?ka({proyecto_id:F.proyecto_id,etapa_id:F.etapa_id,filtrar_por_etapa:!0}):F.proyecto_id?ka({proyecto_id:F.proyecto_id,etapa_id:F.etapa_id,filtrar_por_proyecto:!0}):ka({tarea_id:r.tarea_id,filtrar_por_tarea:!0})}async function Ee(){const t=Ja.URL_BASE+"/"+v.getEndpoint(M.exportExcelSeguimiento)+"/"+r.id;$e(t,"GET","blob","xlsx","reporte_hoy_")}function Ce(){S.value.subir({subtarea_id:s.subtarea.id})}function Te(){c.value=null,O.value=[]}function Ae(){j.value=null,L.value=[]}function Me(t){E.hydrate(t),E.subtarea=s.subtarea.id,h(E)}function ze(){da.value=void 0,G.value=[]}const we=()=>{m(async()=>{const t=v.getEndpoint(M.obtener_resumen_material_subtarea_usado,{subtarea_id:s.subtarea.id,empleado_id:N()}),n=await v.get(t);I.value=n.data.results.filter(g=>g.total_cantidad_utilizada>0)})},je=()=>{m(async()=>{const t=v.getEndpoint(M.obtener_resumen_material_stock_usado,{subtarea_id:s.subtarea.id,empleado_id:N()}),n=await v.get(t);ea.value=n.data.results.filter(g=>g.total_cantidad_utilizada>0)})};return Va(c,()=>{c.value&&qa(c.value)}),Va(j,()=>{j.value&&ve(j.value)}),{refVisorImagen:C,refTrabajos:o,refObservaciones:U,refArchivoSeguimiento:S,mixinArchivoSeguimiento:y,utilizarMateriales:P,existeMaterialesDevolucion:la,existeObservaciones:R,usarMaterialStock:ba,usarMaterialTarea:pa,columnasMaterial:fa,configuracionColumnasResumenMaterialOcupado:vi,configuracionColumnasMaterialOcupadoFormulario:Ma,configuracionColumnasSumaMaterial:fi,materialesTarea:Q,materialesStock:Z,sumaMaterialesTareaUsado:va,historialMaterialTareaUsadoPorFecha:O,historialMaterialStockUsadoPorFecha:L,resumenMaterialSubtareaUsado:I,resumenMaterialStockUsado:ea,obtenerHistorialMaterialTareaUsadoPorFecha:qa,botonEditarCantidadTarea:le,botonEditarCantidadStock:ne,botonEditarCantidadTareaHistorial:ce,botonEditarCantidadStockHistorial:ue,regiones:Oe,atenciones:Pe,emit:e,codigoSubtarea:_a,esLider:i,esCoordinador:u,descargarExcel:Ee,endpoint:M.archivos_seguimientos,ActividadRealizadaSeguimientoSubtarea:$a,configuracionColumnasTrabajoRealizado:mi,verFotografia:de,clientes:Wa,subtarea:r,permitirSubir:H,tab:b("usar_material_tarea"),tabMaterialStock:b("usar_material_stock"),tabsMateriales:b("historial"),fecha_historial:c,fecha_historial_stock:j,rangoFechasHistorial:ga,actividadesRealizadas:q,guardarFilaActividad:Me,mostrarMaterialStock:r.proyecto_id===null,mostrarBotonSubir:ua(()=>{var t;return(t=S.value)==null?void 0:t.quiero_subir_archivos}),subirArchivos:Ce,fechasHistorialMaterialesUsados:ja,fechasHistorialMaterialesStockUsados:Fa,resetearFiltroHistorialTarea:Te,resetearFiltroHistorialStock:Ae,clienteMaterialStock:Y,clienteMaterialTarea:da,obtenerMaterialesStock:ge,obtenerMaterialesTarea:_e,clientesMaterialesTarea:Xa,listadosAuxiliares:ha,ticketsAts:ie,configuracionColumnasSolicitudAts:_i,Ticket:za,guardarFilaSolicitudAts:te,btnSeguimiento:oe,btnCancelar:se,modales:Ua,mostrarMaterialConStock:na,mostrarMaterialStockConStock:J,mostrarSolicitudesAts:ae,actualizarTablaMaterialesTarea:ze,actualizarTablaResumenMaterialesTarea:we,actualizarTablaResumenMaterialesStock:je}}});const hi={class:"column items-center justify-between q-gutter-sm q-mb-md"},ki={class:"row"},yi={class:"col-12 q-mb-md"},Ei={class:"col-12 q-mb-md"},Ci={key:0,class:"col-12"},Ti={class:"col-12 q-mb-md"},Ai={key:1,class:"col-12 q-mb-md"},Mi={class:"row q-col-gutter-sm q-pa-sm q-mb-md"},zi={class:"col-12 col-md-6"},wi={class:"col-12 col-md-6"},ji={class:"row q-col-gutter-sm q-pa-sm q-mb-md"},Fi={class:"col-12"},Ui={class:"row text-center justify-center bg-drawer rounded-card q-py-md q-mb-md custom-shadow"},Di={class:"col-12 col-md-3 q-mb-md"},qi={class:"text-positive"},Vi={class:"col-12"},Ri={class:"q-gutter-sm"},Oi={class:"col-12"},Pi={key:2,class:"col-12 q-mb-md"},Ii={key:3,class:"col-12 q-mb-md"},Ni={class:"row q-col-gutter-sm q-pa-sm q-mb-md"},Hi={class:"col-12 col-md-6"},Bi={class:"col-12 col-md-6"},Li={class:"col-12"},$i={class:"row q-col-gutter-sm q-pa-sm q-mb-md"},Gi={class:"col"},Qi={class:"row text-center justify-center bg-drawer rounded-card q-py-md q-mb-md custom-shadow"},Ji={class:"col-12 col-md-3 q-mb-md"},Zi={class:"text-positive"},Yi={class:"col-12"},Ki={class:"q-gutter-sm"},Wi={class:"col-12 q-mb-md"};function Xi(a,e,s,T,y,l){const E=ta("tabla-filas-dinamicas"),q=ta("essential-table"),h=ta("archivo-seguimiento"),k=ta("visor-imagen"),m=ta("modales-entidad");return A(),V(He,null,{default:w(()=>[d("div",hi,[d("div",{class:ma([{"text-center full-width":a.$q.screen.xs},"text-primary"])},ya("Subtarea "+a.subtarea.codigo_subtarea),3),p(Ra,{color:"primary","no-caps":"",push:"",class:ma(["q-mr-sm",{"full-width":a.$q.screen.xs}]),onClick:e[0]||(e[0]=o=>a.descargarExcel())},{default:w(()=>[p(Oa,{name:"bi-file-spreadsheet",size:"xs",class:"q-pr-sm"}),e[25]||(e[25]=d("span",null,"Descargar informe",-1))]),_:1},8,["class"])]),p(Ea,{class:"rounded-card custom-shadow q-pa-md"},{default:w(()=>[d("div",ki,[d("div",yi,[p(E,{listado:a.actividadesRealizadas,"configuracion-columnas":a.configuracionColumnasTrabajoRealizado,onGuardarFila:e[1]||(e[1]=o=>a.guardarFilaActividad(o)),mostrarAccion1Header:a.permitirSubir,entidad:a.ActividadRealizadaSeguimientoSubtarea,accion1:a.verFotografia,titulo:"Cronolog\xEDa de actividades realizadas"},null,8,["listado","configuracion-columnas","mostrarAccion1Header","entidad","accion1"])]),d("div",Ei,[e[26]||(e[26]=d("br",null,null,-1)),p(oa,{modelValue:a.mostrarSolicitudesAts,"onUpdate:modelValue":e[2]||(e[2]=o=>a.mostrarSolicitudesAts=o),label:"Solicitudes de ATS","checked-icon":"bi-eye",color:"positive",dense:""},null,8,["modelValue"])]),a.mostrarSolicitudesAts?(A(),K("div",Ci,[p(E,{titulo:"Solicitudes  de ATS a trav\xE9s de tickets",configuracionColumnas:a.configuracionColumnasSolicitudAts,listado:a.ticketsAts,permitirConsultar:!1,permitirEliminar:!1,permitirEditar:!1,mostrarBotones:!1,"alto-fijo":!1,entidad:a.Ticket,consultarTiempo:!1,accion1:a.btnSeguimiento,accion2:a.btnCancelar,mostrarAccion1Header:a.permitirSubir,onGuardarFila:e[3]||(e[3]=o=>a.guardarFilaSolicitudAts(o,a.subtarea.id))},null,8,["configuracionColumnas","listado","entidad","accion1","accion2","mostrarAccion1Header"])])):D("",!0),d("div",Ti,[e[27]||(e[27]=d("br",null,null,-1)),p(oa,{modelValue:a.usarMaterialTarea,"onUpdate:modelValue":e[4]||(e[4]=o=>a.usarMaterialTarea=o),label:"Usar material asignado para proyecto / etapa / tarea","checked-icon":"bi-eye",color:"positive",dense:""},null,8,["modelValue"])]),a.usarMaterialTarea?(A(),K("div",Ai,[p(Ea,{class:"rounded-card"},{default:w(()=>[p(Ha,{modelValue:a.tab,"onUpdate:modelValue":e[8]||(e[8]=o=>a.tab=o),class:ma(["text-primary",{"bg-grey-1":!a.$q.dark.isActive}]),"active-color":"primary",align:"justify","no-caps":"","inline-label":""},{default:w(()=>[p(W,{name:"usar_material_tarea",label:"Usar material de tarea",onClick:e[5]||(e[5]=o=>a.actualizarTablaMaterialesTarea())}),p(W,{name:"resumen_material_tarea_utilizado",label:"Resumen de material utilizado",onClick:e[6]||(e[6]=o=>a.actualizarTablaResumenMaterialesTarea())}),a.esCoordinador?(A(),V(W,{key:0,name:"historial_material_tarea_usado",label:"Editar historial de material de tarea usado",onClick:e[7]||(e[7]=o=>a.resetearFiltroHistorialTarea())})):D("",!0)]),_:1},8,["modelValue","class"]),p(La,{modelValue:a.tab,"onUpdate:modelValue":e[13]||(e[13]=o=>a.tab=o),animated:"",class:"bg-body"},{default:w(()=>[p(X,{name:"usar_material_tarea"},{default:w(()=>[d("div",Mi,[d("div",zi,[e[28]||(e[28]=d("label",{class:"q-mb-sm block"},"Seleccione un cliente para filtrar el material",-1)),p(Ba,{modelValue:a.clienteMaterialTarea,"onUpdate:modelValue":[e[9]||(e[9]=o=>a.clienteMaterialTarea=o),e[10]||(e[10]=o=>a.obtenerMaterialesTarea(a.clienteMaterialTarea))],options:a.listadosAuxiliares.clientesMaterialesTarea,hint:a.subtarea.cliente,"transition-show":"scale","transition-hide":"scale","use-input":"","input-debounce":"0","options-dense":"",dense:"",outlined:"","option-label":o=>o.razon_social,"option-value":o=>o.cliente_id,"emit-value":"","map-options":""},null,8,["modelValue","options","hint","option-label","option-value"])]),d("div",wi,[e[29]||(e[29]=d("br",null,null,-1)),p(oa,{modelValue:a.mostrarMaterialConStock,"onUpdate:modelValue":e[11]||(e[11]=o=>a.mostrarMaterialConStock=o),label:"Mostrar s\xF3lo material con stock mayor a cero","checked-icon":"bi-bag-check",icon:"bi-bag",color:"positive",dense:""},null,8,["modelValue"])])]),a.materialesTarea.length?(A(),V(q,{key:0,titulo:"Materiales designados para la tarea",configuracionColumnas:a.columnasMaterial,datos:a.materialesTarea,"alto-fijo":!1,permitirConsultar:!1,permitirEliminar:!1,permitirEditar:!1,"permitir-buscar":!0,permitirEditarModal:!0,separador:"cell",accion1:a.botonEditarCantidadTarea,"ajustar-celdas":!0},null,8,["configuracionColumnas","datos","accion1"])):D("",!0)]),_:1}),p(X,{name:"resumen_material_tarea_utilizado"},{default:w(()=>[d("div",ji,[d("div",Fi,[a.resumenMaterialSubtareaUsado.length?(A(),V(q,{key:0,titulo:"Resumen material tarea usado",configuracionColumnas:a.columnasMaterial,datos:a.resumenMaterialSubtareaUsado,"alto-fijo":!1,permitirConsultar:!1,permitirEliminar:!1,permitirEditar:!1,permitirEditarModal:!0,separador:"cell"},null,8,["configuracionColumnas","datos"])):D("",!0)])])]),_:1}),p(X,{name:"historial_material_tarea_usado"},{default:w(()=>[d("div",Ui,[d("div",Di,[e[30]||(e[30]=d("label",{class:"q-mb-sm block"},"Seleccione una fecha para filtrar en el historial",-1)),d("small",qi,ya(a.rangoFechasHistorial),1)]),d("div",Vi,[d("div",Ri,[(A(!0),K(Pa,null,Ia(a.fechasHistorialMaterialesUsados,o=>(A(),V(Na,{key:o.fecha,modelValue:a.fecha_historial,"onUpdate:modelValue":e[12]||(e[12]=C=>a.fecha_historial=C),val:o.fecha,label:o.fecha},null,8,["modelValue","val","label"]))),128))])]),d("div",Oi,[a.historialMaterialTareaUsadoPorFecha.length?(A(),V(q,{key:0,titulo:"Historial material tarea usado",configuracionColumnas:a.columnasMaterial,datos:a.historialMaterialTareaUsadoPorFecha,"alto-fijo":!1,permitirConsultar:!1,permitirEliminar:!1,permitirEditar:!1,permitirEditarModal:!0,separador:"cell",accion1:a.botonEditarCantidadTareaHistorial},null,8,["configuracionColumnas","datos","accion1"])):D("",!0)])])]),_:1})]),_:1},8,["modelValue"])]),_:1})])):D("",!0),a.mostrarMaterialStock?(A(),K("div",Pi,[e[31]||(e[31]=d("br",null,null,-1)),p(oa,{modelValue:a.usarMaterialStock,"onUpdate:modelValue":e[14]||(e[14]=o=>a.usarMaterialStock=o),label:"Usar material de mi stock","checked-icon":"bi-eye",color:"positive",dense:""},null,8,["modelValue"])])):D("",!0),a.usarMaterialStock?(A(),K("div",Ii,[p(Ea,{class:"rounded-card"},{default:w(()=>[p(Ha,{modelValue:a.tabMaterialStock,"onUpdate:modelValue":e[18]||(e[18]=o=>a.tabMaterialStock=o),class:ma(["text-primary",{"bg-grey-1":!a.$q.dark.isActive}]),"active-color":"primary",align:"justify","no-caps":"","inline-label":""},{default:w(()=>[p(W,{name:"usar_material_stock",label:"Usar material de mi stock",onClick:e[15]||(e[15]=()=>a.clienteMaterialStock=null)}),p(W,{name:"resumen_material_stock_utilizado",label:"Resumen de material utilizado",onClick:e[16]||(e[16]=o=>a.actualizarTablaResumenMaterialesStock())}),a.esCoordinador?(A(),V(W,{key:0,name:"historial_material_stock_usado",label:"Editar historial de material de stock usado",onClick:e[17]||(e[17]=o=>a.resetearFiltroHistorialStock())})):D("",!0)]),_:1},8,["modelValue","class"]),p(La,{modelValue:a.tabMaterialStock,"onUpdate:modelValue":e[23]||(e[23]=o=>a.tabMaterialStock=o),animated:"",class:"bg-body"},{default:w(()=>[p(X,{name:"usar_material_stock"},{default:w(()=>[d("div",Ni,[d("div",Hi,[e[32]||(e[32]=d("label",{class:"q-mb-sm block"},"Seleccione un cliente para filtrar el material",-1)),p(Ba,{modelValue:a.clienteMaterialStock,"onUpdate:modelValue":[e[19]||(e[19]=o=>a.clienteMaterialStock=o),e[20]||(e[20]=o=>a.obtenerMaterialesStock(a.clienteMaterialStock))],options:a.listadosAuxiliares.clientesMaterialesEmpleado,hint:a.subtarea.cliente,"transition-show":"scale","transition-hide":"scale","use-input":"","input-debounce":"0","options-dense":"",clearable:"",dense:"",outlined:"","option-label":o=>o.razon_social,"option-value":o=>o.cliente_id,"emit-value":"","map-options":""},null,8,["modelValue","options","hint","option-label","option-value"])]),d("div",Bi,[e[33]||(e[33]=d("br",null,null,-1)),p(oa,{modelValue:a.mostrarMaterialStockConStock,"onUpdate:modelValue":e[21]||(e[21]=o=>a.mostrarMaterialStockConStock=o),label:"Mostrar s\xF3lo material con stock mayor a cero","checked-icon":"bi-bag-check",icon:"bi-bag",color:"positive",dense:""},null,8,["modelValue"])]),d("div",Li,[a.materialesStock.length?(A(),V(q,{key:0,titulo:"Materiales de stock del responsable",configuracionColumnas:a.columnasMaterial,datos:a.materialesStock,"alto-fijo":!1,permitirConsultar:!1,permitirEliminar:!1,permitirEditar:!1,"permitir-buscar":!0,permitirEditarModal:!0,separador:"cell","ajustar-celdas":!0,accion1:a.botonEditarCantidadStock},null,8,["configuracionColumnas","datos","accion1"])):D("",!0)])])]),_:1}),p(X,{name:"resumen_material_stock_utilizado"},{default:w(()=>[d("div",$i,[d("div",Gi,[a.resumenMaterialStockUsado.length?(A(),V(q,{key:0,titulo:"Resumen material stock usado",configuracionColumnas:a.configuracionColumnasResumenMaterialOcupado,datos:a.resumenMaterialStockUsado,"alto-fijo":!1,permitirConsultar:!1,permitirEliminar:!1,permitirEditar:!1,permitirEditarModal:!0,"ajustar-celdas":!0,separador:"cell"},null,8,["configuracionColumnas","datos"])):D("",!0)])])]),_:1}),p(X,{name:"historial_material_stock_usado"},{default:w(()=>[d("div",Qi,[d("div",Ji,[e[34]||(e[34]=d("label",{class:"q-mb-sm block"},"Seleccione una fecha para filtrar en el historial",-1)),d("small",Zi,ya(a.rangoFechasHistorial),1)]),d("div",Yi,[d("div",Ki,[(A(!0),K(Pa,null,Ia(a.fechasHistorialMaterialesStockUsados,o=>(A(),V(Na,{key:o.fecha,modelValue:a.fecha_historial_stock,"onUpdate:modelValue":e[22]||(e[22]=C=>a.fecha_historial_stock=C),val:o.fecha,label:o.fecha},null,8,["modelValue","val","label"]))),128))])])]),a.historialMaterialStockUsadoPorFecha.length?(A(),V(q,{key:0,titulo:"Historial material stock usado",configuracionColumnas:a.columnasMaterial,datos:a.historialMaterialStockUsadoPorFecha,"alto-fijo":!1,permitirConsultar:!1,permitirEliminar:!1,permitirEditar:!1,permitirEditarModal:!0,separador:"cell","ajustar-celdas":!0,accion1:a.botonEditarCantidadStockHistorial},null,8,["configuracionColumnas","datos","accion1"])):D("",!0)]),_:1})]),_:1},8,["modelValue"])]),_:1})])):D("",!0),d("div",Wi,[p(h,{ref:"refArchivoSeguimiento",mixin:a.mixinArchivoSeguimiento,endpoint:a.endpoint,"permitir-eliminar":a.permitirSubir,"permitir-subir":a.permitirSubir},{"boton-subir":w(()=>[a.mostrarBotonSubir?(A(),V(Ra,{key:0,color:"positive",push:"","no-caps":"",class:"full-width q-mb-lg",onClick:e[24]||(e[24]=o=>a.subirArchivos())},{default:w(()=>[p(Oa,{name:"bi-upload",class:"q-mr-sm",size:"xs"}),e[35]||(e[35]=Ne(" Subir archivos seleccionados"))]),_:1})):D("",!0)]),_:1},8,["mixin","endpoint","permitir-eliminar","permitir-subir"])])])]),_:1}),p(k,{ref:"refVisorImagen"},null,512),p(m,{comportamiento:a.modales,"mixin-modal":a.mixin,"confirmar-cerrar":!1,persistente:!1},null,8,["comportamiento","mixin-modal"])]),_:1})}var Ct=Ie(Si,[["render",Xi]]);const Ga={TELCONET:2,NEDETEL:3},Tt=(a,e,s)=>{const T=ci(),y=Ya(),l=Za(),E=Je(),{notificarAdvertencia:q,confirmar:h,notificarCorrecto:k,promptItems:m,prompt:o}=ra(),C=ra(),U=new x;let P;const la=b(),R=sa({latitud_llegada:null,longitud_llegada:null,empleado_responsable_subtarea:null,coordinador_registrante_llegada:null}),pa={titulo:"Ejecutar",icono:"bi-play-fill",color:"positive",visible:({entidad:i})=>[f.AGENDADO,f.REALIZADO].includes(i.estado)&&i.puede_ejecutar&&(i.es_responsable||l.can("puede.ejecutar.subtareas")),accion:({entidad:i,posicion:u})=>{O(i),h("\xBFEst\xE1 seguro de iniciar el trabajo?",async()=>{var r;if(i.es_dependiente){const{result:c}=await new ui().consultar(i.subtarea_dependiente_id);if(![f.REALIZADO,f.FINALIZADO].includes((r=c.estado)!=null?r:""))return q("No puedes proceder. Primero debes realizar la subtarea "+c.codigo_subtarea)}const S={estado_subtarea_llegada:f.EJECUTANDO,...R};try{const{result:c}=await new x().ejecutar(i.id,S);l.esTecnico?P(f.EJECUTANDO):I(u,c),k("Trabajo ejecutado exitosamente!"),T.getSubtareaDestino(l.user.id)}catch(c){if(Ca(c)){const j=c.erroresValidacion;await Ta(j,ra())}}})}},ba={titulo:"Pausar",icono:"bi-pause-circle",color:"blue-6",visible:({entidad:i})=>i.estado===f.EJECUTANDO&&(i.es_responsable||l.can("puede.pausar.subtareas")),accion:({entidad:i,posicion:u})=>{O(i),h("\xBFEst\xE1 seguro de pausar la subtarea?",()=>{const S=sa({mensaje:"Seleccione el motivo de la pausa",accion:async r=>{const c={estado_subtarea_llegada:f.PAUSADO,motivo_pausa_id:r,...R},{result:j}=await new x().pausar(i.id,c);l.esTecnico?P(f.PAUSADO):I(u,j),k("Trabajo pausado exitosamente!"),T.getSubtareaDestino(l.user.id)},tipo:"radio",items:s.motivosPausas.map(r=>({label:r.motivo,value:r.id}))});m(S)})}},H={titulo:"Reanudar",icono:"bi-play-circle",color:"positive",visible:({entidad:i})=>i.estado===f.PAUSADO&&i.puede_ejecutar&&(i.es_responsable||l.can("puede.ejecutar.subtareas")),accion:async({entidad:i,posicion:u})=>{O(i),h("\xBFEst\xE1 seguro de reanudar el trabajo?",async()=>{const S={estado_subtarea_llegada:f.EJECUTANDO,...R},{result:r}=await new x().reanudar(i.id,S);l.esTecnico?P(f.EJECUTANDO):I(u,r),k("Trabajo ha sido reanudado exitosamente!"),T.getSubtareaDestino(l.user.id)})}},fa={titulo:"Realizado",icono:"bi-check-circle",color:"positive",visible:({entidad:i})=>[f.EJECUTANDO,f.PAUSADO].includes(i.estado)&&(l.esJefeTecnico||l.esCoordinador||i.es_responsable||l.esAdministrador),accion:({entidad:i,posicion:u})=>{O(i);const S=s.causasIntervenciones.filter(c=>c.tipo_trabajo===i.tipo_trabajo),r=sa({mensaje:"Seleccione la causa de intervenci\xF3n",accion:async c=>{B({entidad:i,posicion:u,causa_intervencion_id:c})},tipo:"radio",requerido:S.length,items:S.map(c=>({label:c.nombre,value:c.id}))});i.cliente_id===Ga.NEDETEL?m(r):B({entidad:i,posicion:u})}};function B(i){const{entidad:u,posicion:S,causa_intervencion_id:r}=i;h("\xBFEst\xE1 seguro de que complet\xF3 el trabajo?",async()=>{try{const c={estado_subtarea_llegada:f.REALIZADO,causa_intervencion_id:r,...R},{result:j}=await new x().realizar(u.id,c);l.esTecnico?ea(S):I(S,j),T.getSubtareaDestino(l.user.id),k("La subtarea se ha realizado exitosamente!")}catch(c){if(Ca(c)){const j=c.erroresValidacion;Ta(j,C)}}})}const _a={titulo:"Seguimiento",icono:"bi-check2-square",color:"indigo",visible:({entidad:i})=>![f.AGENDADO,f.CREADO].includes(i.estado)&&(l.esJefeTecnico||l.esCoordinador||l.esAdministrador||i.es_responsable),accion:async({entidad:i})=>{y.idSubtareaSeleccionada=i.id,y.idTareaSeleccionada=i.tarea_id,y.proyecto_id=i.proyecto_id,y.etapa_id=i.etapa_id,y.cliente_id=i.cliente_id,y.idEmpleadoResponsable=i.empleado_responsable_id,y.idEmergencia=i.seguimiento,y.codigoSubtarea=i.codigo_subtarea,y.subtarea=i,e.abrirModalEntidad("SeguimientoSubtareaPage")}},ga={titulo:"Ver alimentaci\xF3n",icono:"bi-cookie",color:"orange",visible:({entidad:i})=>[f.FINALIZADO].includes(i.estado),accion:async({entidad:i})=>{e.abrirModalEntidad("VerAlimentacionGrupoPage",{idSubtarea:i.id})}},na={titulo:"Finalizar",color:"positive",icono:"bi-check",visible:({entidad:i})=>i.estado===f.REALIZADO,accion:async({entidad:i,posicion:u})=>{const S=sa({mensaje:"Confirme la causa de intervenci\xF3n",accion:r=>{y.idSubtareaSeleccionada=i.id,i.tipo_trabajo==="STANDBY"?J({entidad:i,posicion:u}):G({entidad:i,causa_intervencion_id:r,posicion:u})},requerido:!1,defecto:i.causa_intervencion_id,tipo:"radio",items:s.causasIntervenciones.filter(r=>r.tipo_trabajo===i.tipo_trabajo).map(r=>({label:r.nombre,value:r.id}))});i.cliente_id!==Ga.TELCONET?m(S):J({entidad:i,posicion:u})}};async function G(i){const{entidad:u}=i;la.value=i,e.abrirModalEntidad("AlimentacionGrupoPage",{idGrupo:u.grupo_id,idSubtarea:u.id,idTarea:u.tarea_id})}async function Q(i){switch(i){case"AlimentacionGrupoPage":await J(la.value),e.cerrarModalEntidad();break}}async function J(i){const{entidad:u,causa_intervencion_id:S,posicion:r}=i;o({titulo:"Gastos adicionales",mensaje:"Ingrese los gastos adicionales.",requerido:!0,accion:async j=>{try{const{result:Y}=await U.finalizar(u.id,{causa_intervencion_id:S,gastos_adicionales:j});I(r,Y),k("Trabajo finalizada exitosamente!")}catch(Y){if(Ca(Y)){const da=Y.erroresValidacion;Ta(da,C)}}}})}const aa={titulo:"Suspender",icono:"bi-power",color:"negative",visible:({entidad:i})=>[f.EJECUTANDO,f.AGENDADO].includes(i.estado)&&i.puede_suspender&&(l.esJefeTecnico||l.esCoordinador||i.es_responsable),accion:({entidad:i,posicion:u})=>{O(i),h("\xBFEst\xE1 seguro de suspender el trabajo?",()=>{const S={mensaje:"Seleccione el motivo de la suspenci\xF3n del trabajo",accion:async r=>{const c={motivo_suspendido_id:r,estado_subtarea_llegada:f.SUSPENDIDO,...R};await new x().suspender(i.id,c),(l.esCoordinador||l.esJefeTecnico)&&P(f.SUSPENDIDO),l.esTecnico&&ea(u),k("Trabajo suspendido exitosamente!"),T.getSubtareaDestino(l.user.id)},tipo:"radio",items:s.motivosSuspendidos.map(r=>({label:r.motivo,value:r.id}))};m(S)})}},Z={titulo:"Cancelar",color:"negative",icono:"bi-x-circle",visible:({entidad:i})=>i.estado===f.SUSPENDIDO,accion:({entidad:i,posicion:u})=>h(["\xBFEst\xE1 seguro de cancelar definitivamente la subtarea?"],async()=>{const S={mensaje:"Seleccione el motivo de la cancelaci\xF3n",accion:async r=>{const{result:c}=await U.cancelar(i.id,r);i.estado=f.CANCELADO,i.fecha_hora_cancelado=c.fecha_hora_cancelado,i.motivo_cancelado=c.motivo_cancelado,k("Trabajo cancelado exitosamente!"),I(u,i)},tipo:"radio",items:s.motivosSuspendidos.map(r=>({label:r.motivo,value:r.id}))};m(S)})},va={titulo:"Reagendar",color:"orange-8",icono:"bi-calendar-check",visible:({entidad:i})=>[f.AGENDADO,f.SUSPENDIDO].includes(i.estado),accion:async({entidad:i,posicion:u})=>h("\xBFEst\xE1 seguro de reagendar la subtarea?",()=>{E.codigoSubtareaSeleccionada=i.codigo_subtarea,E.fechaHoraSuspendido=i.fecha_hora_suspendido,E.motivoSuspendido=i.motivo_suspendido,E.idSubtareaSeleccionada=i.id,E.tareaTieneSubtareas=i.tiene_subtareas,E.posicionSubtareaSeleccionada=u,E.subtareaEsVentana=i.es_ventana,E.fechaInicioTrabajo=i.fecha_inicio_trabajo,E.horaInicioTrabajo=i.hora_inicio_trabajo,E.horaFinTrabajo=i.hora_fin_trabajo,e.abrirModalEntidad("ReagendarPage")})};function O(i){Ge(u=>{R.latitud_llegada=u.coords.latitude,R.longitud_llegada=u.coords.longitude,R.empleado_responsable_subtarea=l.esTecnico?l.user.id:l.esCoordinador||l.esJefeTecnico?i.empleado_responsable_id:null,R.coordinador_registrante_llegada=l.esCoordinador||l.esJefeTecnico?l.user.id:null})}const L=i=>P=i;function I(i,u){i>=0&&(a.value.splice(i,1,u),a.value=[...a.value])}function ea(i){i>=0&&a.value.splice(i,1)}return{btnIniciar:pa,btnPausar:ba,btnReanudar:H,btnRealizar:fa,btnSeguimiento:_a,btnCancelar:Z,btnReagendar:va,btnSuspender:aa,btnFinalizar:na,setFiltrarTrabajoAsignado:L,guardadoModalesSubtarea:Q,btnVerAlimentacion:ga}};export{x as C,Ct as S,Ga as c,Tt as u};
