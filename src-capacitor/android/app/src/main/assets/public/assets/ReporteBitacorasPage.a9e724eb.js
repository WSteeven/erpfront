import{Q as D,a as S}from"./QSelect.6ce302d7.js";import{Q as ae,a as le}from"./QItemSection.9a955ec6.js";import{d as se,m as E,e as re,c as w,q as y,h as ie,a0 as F,bm as te,p as ne,A as ue,bE as me,s as de,_ as ce,t as C,v as _,P as R,F as s,z as a,y as r,bb as N,x as pe,M as fe,N as be,D as U,K as A,J as L,I as $,B as c,j as O,O as p}from"./index.6449c167.js";import{Q as T,a as j,C as M}from"./QPopupProxy.72ff1d6d.js";import{E as ve,q as he,c as ge}from"./EssentialTable.00c17e97.js";import{Q as Ve}from"./QPage.5d173a8a.js";import{Q as ke,a as we}from"./QLayout.418abf9d.js";import{a as ye,b as Ce,u as _e,S as $e,Q as z,I as qe,H as K,B as H}from"./utils.521b98f3.js";import{u as Qe}from"./index.490dde02.js";import{N as Be}from"./NoOptionComponent.b9594324.js";import{B as Ie,a as Pe,u as De}from"./Functions.82556c98.js";import{V as Se}from"./VehiculoController.5e90ff0e.js";import{C as Ee}from"./ContenedorSimpleMixin.09c9bed5.js";import{u as Fe}from"./filtrosListadosGenerales.c3aa2da3.js";import{r as G,a as Re}from"./i18n-validators.29e2545c.js";import"./QChip.95469f73.js";import"./position-engine.70d0a89f.js";import"./format.8ac60962.js";import"./QToolbar.8dbe891b.js";import"./use-fullscreen.a7661f85.js";import"./QBadge.e6f320cd.js";import"./_commonjsHelpers.8402d862.js";import"./QImg.fd079679.js";import"./QFile.90d9394a.js";import"./VisorImagen.75b3c53f.js";import"./logo.4781eea2.js";import"./seleccionContratacionPersonal.utils.e3e1ed3d.js";import"./QScrollObserver.b4b0444d.js";import"./QResizeObserver.9af84680.js";import"./entidadAuditable.75a46700.js";import"./index.0198dd12.js";const Ne=[{name:"id",field:"id",label:"Bit\xE1cora",align:"left",sortable:!0},{name:"vehiculo",field:"vehiculo",label:"Placa",align:"left",sortable:!0},{name:"chofer",field:"chofer",label:"Chofer",align:"left",sortable:!0},{name:"fecha",field:"fecha",label:"fecha",align:"left",sortable:!0},{name:"hora_salida",field:"hora_salida",label:"H Salida",align:"left",sortable:!0},{name:"hora_llegada",field:"hora_llegada",label:"H. Llegada",align:"left",sortable:!0},{name:"km_inicial",field:"km_inicial",label:"Km Inicio",align:"left",sortable:!0},{name:"km_final",field:"km_final",label:"Km Final",align:"left",sortable:!0},{name:"km_recorridos",field:"km_recorridos",label:"Km Recorridos",align:"left",sortable:!0},{name:"tareas",field:"tareas",label:"Tareas",align:"left",sortable:!0}];var Ue=se({name:"ReporteBitacorasPage",components:{EssentialTable:ve,ErrorComponent:he,NoOptionComponent:Be},setup(){const o=new Ee(Ie,new Pe),{listadosAuxiliares:e}=o.useReferencias(),{cargarVista:q,obtenerListados:v}=o.useComportamiento(),{notificarError:Q,notificarAdvertencia:B}=ye();Ce().setQuasar(E()),_e().setQuasar(E());const u=new $e,n=re({tipo:null,fecha_inicio:"",fecha_fin:"",vehiculo:null,todos:!1}),h="todos",l="individual",J=[h,l],m=w(),f=w([]),{vehiculos:g,filtrarVehiculos:W}=Fe(e),{imprimirPdf:X}=De();q(async()=>{await v({vehiculos:[]}),g.value=e.vehiculos;const t=z(new Date),i=qe(t,-1),d=z(i);n.fecha_inicio=K(d,y),n.fecha_fin=K(i,y)});const Y={tipo:{required:G},vehiculo:{required:Re(()=>n.tipo==l)},fecha_inicio:{required:G}},I=Qe(Y,n);ie(()=>{var t;m.value=(t=F.getItem("umbral_km_consumidos"))!=null?t:5200}),te(()=>{F.set("umbral_km_consumidos",m.value)});async function Z(t){t==l&&(await v({vehiculos:{controller:new Se,params:{estado:1}}}),g.value=e.vehiculos)}async function x(t,i,d){if(await I.value.$validate())try{u.activar();const b=ue.getInstance(),V=me.URL_BASE+"/"+b.getEndpoint(de.reporte_bitacoras),P="reporte_bitacoras";switch(t){case"excel":return i.accion="excel",i.umbral=m.value,await H(V,"POST","blob","xlsx",P,i),d;case"pdf":return i.accion="pdf",i.umbral=m.value,await H(V,"POST","blob","pdf",P,i),d;default:i.accion="";const k=await b.post(V,i);return k.data.results?(k.data.results.length<1&&B("No se obtuvieron resultados"),k.data.results):d}}catch(b){console.log(b),Q("Error al obtener el reporte")}finally{u.desactivar()}}async function ee(t){const i=w([]);i.value=await x(t,n,f.value),f.value=i.value,console.log(i.value),console.log(f.value)}const oe={titulo:"Imprimir",icono:"bi-printer",color:"secondary",accion:async({entidad:t})=>{await X(t.id)}};return{v$:I,listado:f,listadosAuxiliares:e,mixin:o,reporte:n,maskFecha:y,INDIVIDUAL:l,configuracionColumnas:[...Ne,ne],umbral_km_consumidos:m,vehiculos:g,filtrarVehiculos:W,opciones:J,btnImprimir:oe,buscarReporte:ee,consultarListado:Z}}});const Ae={class:"col"},Le={class:"row q-col-gutter-sm q-pa-sm q-py-md"},Oe={class:"col-12 col-md-3"},Te={key:0,class:"col-12 col-md-3 q-mb-md"},je={class:"col-12 col-md-3"},Me={class:"row items-center justify-end"},ze={class:"col-12 col-md-3"},Ke={class:"row items-center justify-end"},He={class:"col-12 col-md-3"},Ge={class:"col-12 col-md-12 q-mt-md"},Je={class:"text-center"},We={class:"row q-col-gutter-sm q-py-md q-mb-lg"},Xe={class:"col-12"};function Ye(o,e,q,v,Q,B){const u=C("error-component"),n=C("no-option-component"),h=C("essential-table");return _(),R(we,null,{default:s(()=>[a(ke,null,{default:s(()=>[a(Ve,{padding:""},{default:s(()=>[r("div",Ae,[a(N,{class:"col rounded no-border q-pb-md"},{default:s(()=>[r("div",Le,[r("div",Oe,[e[11]||(e[11]=r("label",{class:"q-mb-sm block"},"Tipo de reporte",-1)),a(D,{modelValue:o.reporte.tipo,"onUpdate:modelValue":[e[0]||(e[0]=l=>o.reporte.tipo=l),e[1]||(e[1]=l=>o.consultarListado(o.reporte.tipo))],options:o.opciones,"transition-show":"scale","transition-hide":"scale","options-dense":"",dense:"",outlined:"",error:!!o.v$.tipo.$errors.length,"emit-value":"","map-options":""},{error:s(()=>[a(u,{clave:"tipo",v$:o.v$},null,8,["v$"])]),_:1},8,["modelValue","options","error"])]),o.reporte.tipo==o.INDIVIDUAL?(_(),pe("div",Te,[e[12]||(e[12]=r("label",{class:"q-mb-sm block"},"Veh\xEDculo",-1)),a(D,{modelValue:o.reporte.vehiculo,"onUpdate:modelValue":e[2]||(e[2]=l=>o.reporte.vehiculo=l),options:o.vehiculos,hint:"Agregue elementos desde el panel de veh\xEDculos","transition-show":"scale","transition-hide":"scale","options-dense":"",clearable:"",dense:"",outlined:"","use-input":"","input-debounce":"0",onFilter:o.filtrarVehiculos,"option-label":l=>l.placa,"option-value":l=>l.id,error:!!o.v$.vehiculo.$errors.length,onBlur:o.v$.vehiculo.$touch,"emit-value":"","map-options":""},{option:s(l=>[a(ae,fe(be(l.itemProps)),{default:s(()=>[a(le,null,{default:s(()=>[a(S,null,{default:s(()=>[U(A(l.opt.placa),1)]),_:2},1024),a(S,{caption:""},{default:s(()=>[U(A(l.opt.marca+" "+l.opt.modelo),1)]),_:2},1024)]),_:2},1024)]),_:2},1040)]),"no-option":s(()=>[a(n)]),error:s(()=>[a(u,{clave:"vehiculo",v$:o.v$},null,8,["v$"])]),_:1},8,["modelValue","options","onFilter","option-label","option-value","error","onBlur"])])):L("",!0),r("div",je,[e[13]||(e[13]=r("label",{class:"q-mb-sm block"},"Fecha de inicio",-1)),a($,{modelValue:o.reporte.fecha_inicio,"onUpdate:modelValue":e[4]||(e[4]=l=>o.reporte.fecha_inicio=l),error:!!o.v$.fecha_inicio.$errors.length,placeholder:"Opcional",outlined:"",dense:""},{append:s(()=>[a(c,{name:"event",class:"cursor-pointer"},{default:s(()=>[a(T,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:s(()=>[a(j,{modelValue:o.reporte.fecha_inicio,"onUpdate:modelValue":e[3]||(e[3]=l=>o.reporte.fecha_inicio=l),mask:o.maskFecha,"today-btn":""},{default:s(()=>[r("div",Me,[O(a(p,{label:"Cerrar",color:"primary",flat:""},null,512),[[M]])])]),_:1},8,["modelValue","mask"])]),_:1})]),_:1})]),error:s(()=>[a(u,{clave:"fecha_inicio",v$:o.v$},null,8,["v$"])]),_:1},8,["modelValue","error"])]),r("div",ze,[e[14]||(e[14]=r("label",{class:"q-mb-sm block"},"Fecha fin ",-1)),a($,{modelValue:o.reporte.fecha_fin,"onUpdate:modelValue":e[6]||(e[6]=l=>o.reporte.fecha_fin=l),placeholder:"Opcional",outlined:"",dense:""},{append:s(()=>[a(c,{name:"event",class:"cursor-pointer"},{default:s(()=>[a(T,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:s(()=>[a(j,{modelValue:o.reporte.fecha_fin,"onUpdate:modelValue":e[5]||(e[5]=l=>o.reporte.fecha_fin=l),mask:o.maskFecha,"today-btn":""},{default:s(()=>[r("div",Ke,[O(a(p,{label:"Cerrar",color:"primary",flat:""},null,512),[[M]])])]),_:1},8,["modelValue","mask"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),r("div",He,[e[15]||(e[15]=r("label",{class:"q-mb-sm block"},"Umbral Kilometraje ",-1)),a($,{modelValue:o.umbral_km_consumidos,"onUpdate:modelValue":e[7]||(e[7]=l=>o.umbral_km_consumidos=l),type:"number",placeholder:"Opcional",outlined:"",dense:""},null,8,["modelValue"])]),r("div",Ge,[r("div",Je,[a(ge,{push:""},{default:s(()=>[a(p,{color:"primary",class:"full-width","no-caps":"","no-wrap":"",push:"",glossy:"",onClick:e[8]||(e[8]=l=>o.buscarReporte("consulta"))},{default:s(()=>[a(c,{name:"bi-search",size:"xs",class:"q-pr-sm"}),e[16]||(e[16]=r("span",null,"Buscar",-1))]),_:1}),a(p,{color:"positive",class:"full-width","no-caps":"","no-wrap":"",push:"",glossy:"",onClick:e[9]||(e[9]=l=>o.buscarReporte("excel"))},{default:s(()=>[a(c,{name:"bi-file-earmark-excel-fill",size:"xs",class:"q-mr-sm"}),e[17]||(e[17]=r("span",null,"Excel",-1))]),_:1}),a(p,{color:"negative",class:"full-width","no-caps":"","no-wrap":"",push:"",glossy:"",onClick:e[10]||(e[10]=l=>o.buscarReporte("pdf"))},{default:s(()=>[a(c,{name:"bi-file-earmark-pdf-fill",size:"xs",class:"q-mr-sm"}),e[18]||(e[18]=r("span",null,"PDF",-1))]),_:1})]),_:1})])])])]),_:1}),e[19]||(e[19]=r("br",null,null,-1)),o.listado?(_(),R(N,{key:0,class:"q-mb-md q-mt-sm rounded no-border custom-shadow"},{default:s(()=>[r("div",We,[r("div",Xe,[a(h,{titulo:"Bit\xE1coras de veh\xEDculos",configuracionColumnas:o.configuracionColumnas,datos:o.listado,altoFijo:!1,accion1:o.btnImprimir,permitirConsultar:!1,permitirEditar:!1,permitirEliminar:!1,permitirBuscar:!0,"ajustar-celdas":""},null,8,["configuracionColumnas","datos","accion1"])])])]),_:1})):L("",!0)])]),_:1})]),_:1})]),_:1})}var Po=ce(Ue,[["render",Ye]]);export{Po as default};
