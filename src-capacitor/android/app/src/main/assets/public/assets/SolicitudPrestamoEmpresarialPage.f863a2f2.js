import{by as _,s as x,d as oo,c as C,bd as eo,m as I,u as ao,a0 as io,f as $,bz as z,d0 as w,cs as so,w as lo,bY as N,q as ro,d6 as to,_ as no,t as B,v as u,P as uo,F as r,z as i,a6 as mo,y as l,x as p,I as d,J as c,B as po,j as co,O as bo,L as vo,D as fo,K as Po}from"./index.b8e09611.js";import{Q as Vo,a as $o,C as go}from"./QPopupProxy.685eacb5.js";import{Q}from"./QSelect.b920278b.js";import{Q as So}from"./QForm.eab79b48.js";import{r as O,d as j,a as g}from"./i18n-validators.06abe774.js";import{u as Co}from"./index.70965bc7.js";import{N as zo}from"./NoOptionComponent.9c331961.js";import{S as yo}from"./EssentialTable.23af6cc8.js";import{E as ko}from"./ErrorComponent.3c1fc91c.js";import{C as qo}from"./ContenedorSimpleMixin.4e22246b.js";import{S as Ao,u as wo}from"./recursosHumanos.ad85232a.js";import{T as Bo}from"./TabLayoutFilterTabs2.6bbaa932.js";import{P as Oo}from"./PeriodoController.f4499353.js";import{u as Do}from"./filtrosListadosGenerales.87fcb144.js";import{u as Eo}from"./utils.9344cd7e.js";import"./format.8ac60962.js";import"./QMenu.b3fb639b.js";import"./position-engine.799c9136.js";import"./QChip.f8f308fa.js";import"./QItemSection.ec4cc512.js";import"./index.ea415f98.js";import"./QFile.c79664c6.js";import"./QTable.c4bfb038.js";import"./use-fullscreen.37810a50.js";import"./QToolbar.afeb6de9.js";import"./QBtnGroup.7d38eecd.js";import"./QBadge.89898cd2.js";import"./_commonjsHelpers.8402d862.js";import"./QImg.95754b62.js";import"./VisorImagen.29457a6f.js";import"./seleccionContratacionPersonal.utils.e3e1ed3d.js";import"./entidadAuditable.75a46700.js";import"./QTabs.1ee2fae1.js";import"./QResizeObserver.1422c274.js";import"./QTabPanels.1776fc83.js";import"./touch.9135741d.js";import"./QPage.e6f8825d.js";import"./EssentialTableTabs.03c27e34.js";import"./EssentialTablePagination.ce808cac.js";import"./buttonSubmits.f2d72caa.js";class ho extends _{constructor(){super(x.solicitud_prestamo_empresarial)}}const Uo=[{name:"fecha",field:"fecha",label:"Fecha",align:"left",sortable:!0},{name:"solicitante_info",field:"solicitante_info",label:"Solicitante",align:"left",sortable:!0},{name:"monto",field:"monto",label:"Monto",align:"left",sortable:!0},{name:"plazo",field:"plazo",label:"Plazo",align:"left",sortable:!0},{name:"observacion",field:"observacion",label:"Observaci\xF3n",align:"left",sortable:!0},{name:"estado_info",field:"estado_info",label:"Estado",align:"left",sortable:!0},{name:"gestionada",field:"gestionada",label:"Gestionada",align:"left",sortable:!0}];var Io=oo({components:{ErrorComponent:ko,NoOptionComponent:zo,TabLayoutFilterTabs2:Bo,SelectorImagen:yo},setup(){const o=new qo(Ao,new ho),{entidad:e,disabled:y,accion:b,listadosAuxiliares:m}=o.useReferencias(),{setValidador:D,cargarVista:t,obtenerListados:S,listar:k}=o.useComportamiento(),{onConsultado:a}=o.useHooks(),F=C(!0);eo().setQuasar(I()),Eo().setQuasar(I());const n=wo(),v=ao(),P=C(),L=io(),H=$(()=>{let s=!1;return f.value&&(s=V.value==="1"),q.value&&(s=V.value==="4"),s}),M=$(()=>b.value===z.editar?e.estado===w.CANCELADO||v.user.id!==e.solicitante:y.value),E=C(0),T=[s=>s<=parseInt(n.sueldo_basico)*2||"Solo se permite prestamo menor o igual a 2 SBU ($ "+parseInt(n.sueldo_basico)*2+")"],V=C("1"),f=$(()=>v.can("puede.ver.campo.validado")),q=$(()=>v.can("puede.autorizar.solicitud_prestamo_empresarial")),{periodos:h,filtrarPeriodos:G}=Do(m);t(async()=>{var s;await n.obtenerSueldoBasico(),await n.nivelEndeudamiento((s=e.solicitante)!=null?s:v.user.id),await S({periodos:{controller:new Oo,params:{campos:"id,nombre",activo:1}},autorizaciones:{controller:new so,params:{campos:"id,nombre",es_validado:!1,es_modulo_rhh:!0}}}),P.value=m.autorizaciones,h.value=m.periodos,E.value=parseInt(n.sueldo_basico)*2}),a(async()=>{var s;F.value=!1,await n.nivelEndeudamiento((s=e.solicitante)!=null?s:v.user.id)});const R=$(()=>({fecha:{required:O},monto:{required:O,maxValue:j(E)},motivo:{required:O},estado:{required:g(()=>f.value)},observacion:{required:g(()=>f.value)},periodo:{requiredIf:g(()=>e.cargo_utilidad)},valor_utilidad:{required:g(()=>e.cargo_utilidad)},plazo:{maxValue:j(12),required:g(()=>f.value&&e.estado!==w.CANCELADO)}})),U=Co(R,e);D(U.value),lo(b,()=>{P.value=m.autorizaciones,b.value===z.editar&&f&&(P.value=m.autorizaciones.filter(s=>s.nombre!==N.aprobado)),b.value===z.editar&&q.value&&(P.value=m.autorizaciones.filter(s=>s.nombre!==N.pendiente))});function Y(s){const A=new Date,K=A.getFullYear(),W=String(A.getMonth()+1).padStart(2,"0"),X=String(A.getDate()).padStart(2,"0"),Z=`${K}/${W}/${X}`;return s>=Z}async function J(s){await k({estado:s}),V.value=s}return{mixin:o,solicitudPrestamo:e,periodos:h,filtrarPeriodos:G,esValidador:f,esAutorizador:q,optionsSolicitudPrestamo:Y,filtrarSolicitudPrestamo:J,maximoValorsolicitudPrestamo:T,autorizaciones:P,autorizacionesId:w,maskFecha:ro,v$:U,disabled:y,recursosHumanosStore:n,tabOptionsSolicitudPrestamo:to,accion:b,configuracionColumnas:Uo,tabSolicitudPrestamo:V,ver_boton_editar:H,acciones:z,restringirMotivo:M,btnGestionar:{titulo:"Gestionar",color:"primary",icono:"bi-pencil-square",accion:({entidad:s})=>{n.solicitudPrestamo=s,console.log("Solicitud de pr\xE9stamo a gestionar es: ",n.solicitudPrestamo),L.push("prestamo-empresarial")},visible:({entidad:s})=>!s.gestionada&&V.value==2&&v.can("puede.gestionar.solicitud_prestamo_empresarial")}}}});const No={class:"row q-col-gutter-sm q-mb-md q-mt-md q-mx-md q-py-sm"},Qo={key:0,class:"col-12 col-md-3"},jo={class:"col-12 col-md-3"},Fo={class:"row items-center justify-end"},Lo={class:"col-12 col-md-3"},Ho={key:1,class:"col-12 col-md-3"},Mo={class:"col-12 col-md-3"},To={key:2,class:"col-12 col-md-3"},Go={class:"col-12 col-md-3"},Ro={key:3,class:"col-12 col-md-3"},Yo={key:4,class:"col-12 col-md-3"},Jo={key:5,class:"col-12 col-md-3"},Ko={class:"col-12 col-md-3"},Wo={class:"col-12 col-md-3"},Xo={class:"col-12 col-md-3"},Zo={key:0,class:"q-mb-sm text-red text-h6 block"};function _o(o,e,y,b,m,D){const t=B("error-component"),S=B("no-option-component"),k=B("tab-layout-filter-tabs2");return u(),uo(k,{mixin:o.mixin,configuracionColumnas:o.configuracionColumnas,tabOptions:o.tabOptionsSolicitudPrestamo,permitirEditar:(o.esValidador||o.esAutorizador)&&o.ver_boton_editar,permitirEliminar:!1,filtrar:o.filtrarSolicitudPrestamo,tabDefecto:o.tabSolicitudPrestamo,accion1:o.btnGestionar,"ajustar-celdas":""},{formulario:r(()=>[i(So,{onSubmit:e[13]||(e[13]=mo(()=>{},["prevent"]))},{default:r(()=>[l("div",No,[[o.acciones.consultar,o.acciones.editar].includes(o.accion)?(u(),p("div",Qo,[e[14]||(e[14]=l("label",{class:"q-mb-sm block"},"Solicitante",-1)),i(d,{modelValue:o.solicitudPrestamo.solicitante_info,"onUpdate:modelValue":e[0]||(e[0]=a=>o.solicitudPrestamo.solicitante_info=a),placeholder:"Obligatorio",disable:"",outlined:"",dense:""},null,8,["modelValue"])])):c("",!0),l("div",jo,[e[15]||(e[15]=l("label",{class:"q-mb-sm block"},"Fecha",-1)),i(d,{modelValue:o.solicitudPrestamo.fecha,"onUpdate:modelValue":e[2]||(e[2]=a=>o.solicitudPrestamo.fecha=a),placeholder:"Obligatorio",error:!!o.v$.fecha.$errors.length,disable:!(o.accion.value!==o.acciones.nuevo&&o.solicitudPrestamo.estado!==o.autorizacionesId.CANCELADO)||o.disabled,onBlur:o.v$.fecha.$touch,outlined:"",dense:""},{append:r(()=>[i(po,{name:"event",class:"cursor-pointer"},{default:r(()=>[i(Vo,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:r(()=>[i($o,{modelValue:o.solicitudPrestamo.fecha,"onUpdate:modelValue":e[1]||(e[1]=a=>o.solicitudPrestamo.fecha=a),mask:o.maskFecha,options:o.optionsSolicitudPrestamo,"today-btn":""},{default:r(()=>[l("div",Fo,[co(i(bo,{label:"Cerrar",color:"primary",flat:""},null,512),[[go]])])]),_:1},8,["modelValue","mask","options"])]),_:1})]),_:1})]),error:r(()=>[i(t,{clave:"fecha",v$:o.v$},null,8,["v$"])]),_:1},8,["modelValue","error","disable","onBlur"])]),l("div",Lo,[e[16]||(e[16]=l("label",{class:"q-mb-sm block"},"Valor ",-1)),i(d,{modelValue:o.solicitudPrestamo.monto,"onUpdate:modelValue":e[3]||(e[3]=a=>o.solicitudPrestamo.monto=a),placeholder:"Obligatorio",type:"number",disable:!(o.accion.value!==o.acciones.nuevo&&o.solicitudPrestamo.estado!==o.autorizacionesId.CANCELADO)||o.disabled,error:!!o.v$.monto.$errors.length,"lazy-rules":"",rules:o.maximoValorsolicitudPrestamo,onBlur:o.v$.monto.$touch,outlined:"",dense:""},{error:r(()=>[i(t,{clave:"monto",v$:o.v$},null,8,["v$"])]),_:1},8,["modelValue","disable","error","rules","onBlur"])]),o.esValidador||o.esAutorizador?(u(),p("div",Ho,[e[17]||(e[17]=l("label",{class:"q-mb-sm block"},"Plazo (Meses) ",-1)),i(d,{modelValue:o.solicitudPrestamo.plazo,"onUpdate:modelValue":e[4]||(e[4]=a=>o.solicitudPrestamo.plazo=a),type:"number",disable:!(o.accion.value!==o.acciones.nuevo&&o.solicitudPrestamo.estado!==o.autorizacionesId.CANCELADO)||o.disabled,error:!!o.v$.plazo.$errors.length,placeholder:"Obligatorio",onBlur:o.v$.plazo.$touch,outlined:"",dense:""},{error:r(()=>[i(t,{clave:"plazo",v$:o.v$},null,8,["v$"])]),_:1},8,["modelValue","disable","error","onBlur"])])):c("",!0),l("div",Mo,[e[18]||(e[18]=l("label",{class:"q-mb-sm block"},"Motivo ",-1)),i(d,{modelValue:o.solicitudPrestamo.motivo,"onUpdate:modelValue":e[5]||(e[5]=a=>o.solicitudPrestamo.motivo=a),placeholder:"Obligatorio",disable:o.restringirMotivo,type:"textarea",error:!!o.v$.motivo.$errors.length,onBlur:o.v$.motivo.$touch,autogrow:"",outlined:"",dense:""},{error:r(()=>[i(t,{clave:"motivo",v$:o.v$},null,8,["v$"])]),_:1},8,["modelValue","disable","error","onBlur"])]),o.esValidador||o.esAutorizador?(u(),p("div",To,[e[19]||(e[19]=l("label",{class:"q-mb-sm block"},"Observacion ",-1)),i(d,{modelValue:o.solicitudPrestamo.observacion,"onUpdate:modelValue":e[6]||(e[6]=a=>o.solicitudPrestamo.observacion=a),placeholder:"Obligatorio",disable:!o.esValidador||o.disabled,type:"textarea",error:!!o.v$.observacion.$errors.length,onBlur:o.v$.observacion.$touch,autogrow:"",outlined:"",dense:""},{error:r(()=>[i(t,{clave:"observacion",v$:o.v$},null,8,["v$"])]),_:1},8,["modelValue","disable","error","onBlur"])])):c("",!0),l("div",Go,[i(vo,{class:"q-mt-lg q-pt-md",modelValue:o.solicitudPrestamo.cargo_utilidad,"onUpdate:modelValue":e[7]||(e[7]=a=>o.solicitudPrestamo.cargo_utilidad=a),label:"Cargo a Utilidades",disable:!(o.accion.value!==o.acciones.nuevo&&o.solicitudPrestamo.estado!==o.autorizacionesId.CANCELADO)||o.disabled,outlined:"",dense:""},null,8,["modelValue","disable"])]),o.solicitudPrestamo.cargo_utilidad?(u(),p("div",Ro,[e[20]||(e[20]=l("label",{class:"q-mb-sm block"},"Periodo",-1)),i(Q,{modelValue:o.solicitudPrestamo.periodo,"onUpdate:modelValue":e[8]||(e[8]=a=>o.solicitudPrestamo.periodo=a),options:o.periodos,"transition-show":"jump-up","transition-hide":"jump-down","options-dense":"",dense:"",outlined:"",disable:!(o.accion.value!==o.acciones.nuevo&&o.solicitudPrestamo.estado!==o.autorizacionesId.CANCELADO)||o.disabled,readonly:o.disabled,"use-input":"","input-debounce":"0",onFilter:o.filtrarPeriodos,error:!!o.v$.periodo.$errors.length,onBlur:o.v$.periodo.$touch,"option-value":a=>a.id,"option-label":a=>a.nombre,"emit-value":"","map-options":""},{"no-option":r(()=>[i(S)]),error:r(()=>[i(t,{clave:"periodo",v$:o.v$},null,8,["v$"])]),_:1},8,["modelValue","options","disable","readonly","onFilter","error","onBlur","option-value","option-label"])])):c("",!0),o.solicitudPrestamo.periodo!=null?(u(),p("div",Yo,[e[21]||(e[21]=l("label",{class:"q-mb-sm block"},"Valor Utilidades ",-1)),i(d,{modelValue:o.solicitudPrestamo.valor_utilidad,"onUpdate:modelValue":e[9]||(e[9]=a=>o.solicitudPrestamo.valor_utilidad=a),placeholder:"Obligatorio",type:"number",disable:!(o.accion.value!==o.acciones.nuevo&&o.solicitudPrestamo.estado!==o.autorizacionesId.CANCELADO)||o.disabled,error:!!o.v$.valor_utilidad.$errors.length,onBlur:o.v$.valor_utilidad.$touch,outlined:"",dense:""},{error:r(()=>[i(t,{clave:"valor_utilidad",v$:o.v$},null,8,["v$"])]),_:1},8,["modelValue","disable","error","onBlur"])])):c("",!0),o.accion==o.acciones.editar&&(o.esValidador||o.esAutorizador)?(u(),p("div",Jo,[e[22]||(e[22]=l("label",{class:"q-mb-sm block"},"Autorizacion",-1)),i(Q,{modelValue:o.solicitudPrestamo.estado,"onUpdate:modelValue":e[10]||(e[10]=a=>o.solicitudPrestamo.estado=a),options:o.autorizaciones,"transition-show":"jump-up","transition-hide":"jump-down","options-dense":"",dense:"",outlined:"",disable:o.disabled,readonly:o.disabled,"use-input":"","input-debounce":"0","option-value":a=>a.id,"option-label":a=>a.nombre,"emit-value":"","map-options":""},{"no-option":r(()=>[i(S)]),_:1},8,["modelValue","options","disable","readonly","option-value","option-label"])])):c("",!0),l("div",Ko,[e[23]||(e[23]=l("label",{class:"q-mb-sm block"},"Total de Descuentos ",-1)),i(d,{modelValue:o.recursosHumanosStore.total_descuento,"onUpdate:modelValue":e[11]||(e[11]=a=>o.recursosHumanosStore.total_descuento=a),type:"number",disable:"",outlined:"",dense:""},null,8,["modelValue"])]),l("div",Wo,[e[25]||(e[25]=l("label",{class:"q-mb-sm block"},"Porcentaje de Descuentos ",-1)),i(d,{modelValue:o.recursosHumanosStore.porcentaje_endeudamiento,"onUpdate:modelValue":e[12]||(e[12]=a=>o.recursosHumanosStore.porcentaje_endeudamiento=a),disable:"",outlined:"",dense:""},{after:r(()=>e[24]||(e[24]=[fo(" % ")])),_:1},8,["modelValue"])]),l("div",Xo,[o.recursosHumanosStore.mensaje?(u(),p("label",Zo,Po(o.recursosHumanosStore.mensaje),1)):c("",!0)])])]),_:1})]),_:1},8,["mixin","configuracionColumnas","tabOptions","permitirEditar","filtrar","tabDefecto","accion1"])}var Le=no(Io,[["render",_o]]);export{Le as default};
