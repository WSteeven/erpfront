var wo=Object.defineProperty;var Po=(o,i,l)=>i in o?wo(o,i,{enumerable:!0,configurable:!0,writable:!0,value:l}):o[i]=l;var b=(o,i,l)=>(Po(o,typeof i!="symbol"?i+"":i,l),l);import{a as _o,Q as B}from"./QTabs.1ee2fae1.js";import{Q as $o}from"./QExpansionItem.795361a7.js";import{by as W,s as Z,R as x,bG as N,A as S,d as yo,u as Io,m as q,bd as Lo,c as h,e as Ro,w as F,p as Eo,q as Vo,_ as To,t as Qo,v as c,P as Bo,F as s,z as a,a5 as O,y as r,j as L,b2 as No,be as So,bf as qo,I as A,B as U,O as R,x as d,G as $,H as y,K as I,D,J as H,T as Fo}from"./index.b8e09611.js";import{Q as z,a as j,C as G}from"./QPopupProxy.685eacb5.js";import{Q as M,a as J}from"./QItemSection.ec4cc512.js";import{Q as K}from"./QSelect.b920278b.js";import{Q as Oo}from"./QPage.e6f8825d.js";import{E as Ao,J as v,n as Uo}from"./EssentialTable.23af6cc8.js";import{r as E,a as Do}from"./i18n-validators.06abe774.js";import{A as X,u as Ho,F as zo}from"./utils.9344cd7e.js";import{M as jo}from"./ModalEntidad.54c9ab3a.js";import{R as Go,T as Mo}from"./RespuestaCuestionarioEmpleado.3d2b25ac.js";import{C as V}from"./ContenedorSimpleMixin.4e22246b.js";import{E as oo}from"./entidadAuditable.75a46700.js";import{L as Jo}from"./LinkCuestionarioPublicoController.399070f2.js";import{u as Ko}from"./index.70965bc7.js";import"./QResizeObserver.1422c274.js";import"./format.8ac60962.js";import"./QMenu.b3fb639b.js";import"./position-engine.799c9136.js";import"./QChip.f8f308fa.js";import"./QFile.c79664c6.js";import"./QTable.c4bfb038.js";import"./use-fullscreen.37810a50.js";import"./QToolbar.afeb6de9.js";import"./QBtnGroup.7d38eecd.js";import"./QBadge.89898cd2.js";import"./_commonjsHelpers.8402d862.js";import"./QImg.95754b62.js";import"./VisorImagen.29457a6f.js";import"./seleccionContratacionPersonal.utils.e3e1ed3d.js";import"./ErrorComponent.3c1fc91c.js";import"./index.ea415f98.js";import"./configuracion_general.1d29d94f.js";import"./ConfiguracionController.a136b041.js";const Xo=[{name:"empleado",field:"empleado",label:"Empleado",align:"left",sortable:!0},{name:"finalizado",field:"finalizado",label:"Finalizado",align:"left",sortable:!0}];class Yo extends W{constructor(){super(Z.reporte_cuestionario_publico)}}function Y(o,i){const{cargarVista:l,listar:w}=o.useComportamiento(),{listado:C}=o.useReferencias(),{notificarAdvertencia:P}=x(),m=async()=>{await l(async()=>{await w(i),C.value.length||P("Sin resultados")})};async function e(){const u=new Date,g="reporte_cuestionarios_"+i.tipo_cuestionario+"_"+u.toLocaleString(),n=o.getController().getEndpoint(),f=N.URL_BASE+"/"+S.getInstance().getEndpoint(n,{imprimir:!0,formato:"xlsx",...i});X(f,"GET","blob","xlsx",g)}async function _(){const u=new Date,g="respuesta_cuestionarios_"+u.toLocaleString(),n=o.getController().getEndpoint(),f=N.URL_BASE+"/"+S.getInstance().getEndpoint(n,{imprimir:!0,formato:"txt",...i});X(f,"GET","blob","txt",g)}return{consultar:m,listado:C,descagarReporte:e,descargarFpsico:_}}class Wo extends W{constructor(){super(Z.reporte_cuestionario)}}class Zo extends oo{constructor(){super();b(this,"id");b(this,"empleado");b(this,"finalizado");this.id=null,this.empleado=null,this.finalizado=!1}}const xo=[{name:"link",field:"link",label:"Link",align:"left",sortable:!0},{name:"activo",field:"activo",label:"Activo",align:"left",sortable:!0}];class oi extends oo{constructor(){super();b(this,"link");b(this,"activo");this.link=null,this.activo=!0}}var ii=yo({components:{EssentialTable:Ao,ModalEntidad:jo},setup(){const o=Io();Ho().setQuasar(q()),Lo().setQuasar(q());const i=new V(oi,new Jo),{entidad:l,listado:w}=i.useReferencias(),{listar:C,guardar:P,editarParcial:m}=i.useComportamiento(),{prompt:e}=x(),_={links:"Links creados",filtrar:"Filtrar cuestionarios resueltos"},u=h(v.INTERNO),g=h(_.filtrar),p=h([]),n=Ro({fecha_inicio:null,fecha_fin:null,tipo_cuestionario_id:null,link:null}),f=h(!1),T=h([]),io={fecha_inicio:{required:E},fecha_fin:{required:E},tipo_cuestionario_id:{required:E},link:{requiredIf:Do(()=>u.value===v.PUBLICO)}},Q=Ko(io,n),eo={titulo:"Exportar reporte excel",icono:"bi-table",color:"positive",visible:()=>o.can("puede.ver.reporte_cuestionarios_psicosocial"),accion:()=>go()},ao={titulo:"Exportar txt (FPSICO 4.0)",icono:"bi-printer",color:"primary",visible:()=>n.tipo_cuestionario_id===Uo.CUESTIONARIO_PSICOSOCIAL&&o.can("puede.ver.reporte_cuestionarios_psicosocial"),accion:()=>ko()},so={titulo:"Crear link de cuestionario",icono:"bi-plus",color:"primary",visible:()=>o.can("puede.ver.reporte_cuestionarios_psicosocial"),accion:()=>{e({titulo:"Crear link",mensaje:"Ingrese un identificador para el link",tipo:"text",accion:k=>{l.link=k,P(l)}})}},ro={titulo:"Copiar link",icono:"bi-link-45deg",color:"primary",visible:()=>o.can("puede.ver.reporte_cuestionarios_psicosocial"),accion:({entidad:t})=>zo(window.location.origin+"/cuestionarios-publicos/"+encodeURIComponent(t.link))},to={titulo:"Abrir link",icono:"bi-browser-chrome",color:"secondary",visible:()=>o.can("puede.ver.reporte_cuestionarios_psicosocial"),accion:({entidad:t})=>window.open(window.location.origin+"/cuestionarios-publicos/"+t.link,"_blank")},no={titulo:({entidad:t})=>t.activo?"Deshabilitar":"Habilitar",icono:({entidad:t})=>t.activo?"bi-toggle2-on":"bi-toggle2-off",color:({entidad:t})=>t.activo?"negative":"positive",visible:()=>o.can("puede.ver.reporte_cuestionarios_psicosocial"),accion:({entidad:t})=>m(t.id,{activo:!t.activo})},{consultar:lo,listado:co,descagarReporte:uo,descargarFpsico:po}=Y(new V(Go,new Wo),n),{consultar:mo,listado:fo,descagarReporte:bo,descargarFpsico:vo}=Y(new V(Zo,new Yo),n);async function Co(){console.log(n),await Q.value.$validate()&&(u.value===v.INTERNO?(await lo(),p.value=co.value):(await mo(),p.value=fo.value))}async function go(){u.value===v.INTERNO?await uo():await bo()}async function ko(){u.value===v.INTERNO?await po():await vo()}function ho(t,k,gi){f.value=k!=="year"}return F(n,()=>p.value=[]),F(u,()=>{p.value=[],n.link=null}),new Mo().listar().then(t=>{const{result:k}=t;T.value=k}),C(),{v$:Q,listado:p,ConfiguracionColumnasReporteCuestionarioEmpleado:Xo,ConfiguracionColumnasLinksCreados:xo,btnImprimirReporte:eo,btnImprimirRespuestas:ao,btnCrearLinkCuestionario:so,btnCompartirLink:ro,btnDeshabilitarLink:no,btnAbrirLink:to,filtro:n,consultar:Co,isYear:f,checkValue:ho,tiposCuestionarios:T,tabPrivacidadCuestionario:u,opcionesPrivacidadCuestionarios:v,opcionesTabLinksFiltrar:_,tabLinksFiltrar:g,linksCreados:w,accionesTabla:Eo,maskFecha:Vo}}});const ei={class:"q-mt-lg"},ai={class:"row q-col-gutter-sm q-pa-md"},si={class:"col-12"},ri={class:"col-12 col-md-3"},ti={class:"row items-center justify-end"},ni={class:"error-msg"},li={class:"col-12 col-md-3"},ci={class:"row items-center justify-end"},ui={class:"error-msg"},di={class:"col-12 col-md-5"},pi={class:"error-msg"},mi={key:0,class:"col-12 col-md-4"},fi={class:"error-msg"},bi={class:"col-12 col-md-2"},vi={key:0};function Ci(o,i,l,w,C,P){const m=Qo("essential-table");return c(),Bo(Oo,{padding:""},{default:s(()=>[a(_o,{modelValue:o.tabPrivacidadCuestionario,"onUpdate:modelValue":i[0]||(i[0]=e=>o.tabPrivacidadCuestionario=e),align:"left","active-class":"tab-active","indicator-color":"primary",class:"border-bottom","inline-label":"",dense:""},{default:s(()=>[a(B,{name:o.opcionesPrivacidadCuestionarios.INTERNO,label:"Cuestionarios internos",icon:"bi-lock",class:O({"tab-inactive":o.tabPrivacidadCuestionario!==o.opcionesPrivacidadCuestionarios.INTERNO}),"no-caps":""},null,8,["name","class"]),a(B,{name:o.opcionesPrivacidadCuestionarios.PUBLICO,label:"Cuestionarios p\xFAblicos",icon:"bi-unlock",class:O({"tab-inactive":o.tabPrivacidadCuestionario!==o.opcionesPrivacidadCuestionarios.PUBLICO}),"no-caps":""},null,8,["name","class"])]),_:1},8,["modelValue"]),r("div",ei,[L(a($o,{class:"overflow-hidden q-mb-sm rounded bg-desenfoque-2 border-white",label:"Links creados","header-class":"text-bold bg-desenfoque text-primary border-bottom",icon:"bi-link-45deg"},{default:s(()=>[r("div",ai,[r("div",si,[a(m,{titulo:"Cada link es una empresa",configuracionColumnas:[...o.ConfiguracionColumnasLinksCreados,o.accionesTabla],datos:o.linksCreados,"permitir-consultar":!1,"permitir-editar":!1,"permitir-eliminar":!1,"alto-fijo":!1,desplegarDesde:3,accion1Header:o.btnCrearLinkCuestionario,accion1:o.btnCompartirLink,accion2:o.btnAbrirLink,accion3:o.btnDeshabilitarLink},null,8,["configuracionColumnas","datos","accion1Header","accion1","accion2","accion3"])])])]),_:1},512),[[No,o.tabPrivacidadCuestionario===o.opcionesPrivacidadCuestionarios.PUBLICO]]),a(So,{flat:"",class:"q-mb-sm bg-desenfoque border-white"},{default:s(()=>[a(qo,{class:"row q-col-gutter-sm"},{default:s(()=>[r("div",ri,[i[8]||(i[8]=r("label",{class:"q-mb-sm block"},"Fecha de inicio",-1)),a(A,{modelValue:o.filtro.fecha_inicio,"onUpdate:modelValue":i[2]||(i[2]=e=>o.filtro.fecha_inicio=e),error:!!o.v$.fecha_inicio.$errors.length,onBlur:o.v$.fecha_inicio.$touch,outlined:"",dense:""},{append:s(()=>[a(U,{name:"event",class:"cursor-pointer"},{default:s(()=>[a(z,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:s(()=>[a(j,{modelValue:o.filtro.fecha_inicio,"onUpdate:modelValue":i[1]||(i[1]=e=>o.filtro.fecha_inicio=e),mask:o.maskFecha,"today-btn":""},{default:s(()=>[r("div",ti,[L(a(R,{label:"Cerrar",color:"primary",flat:""},null,512),[[G]])])]),_:1},8,["modelValue","mask"])]),_:1})]),_:1})]),error:s(()=>[(c(!0),d($,null,y(o.v$.fecha_inicio.$errors,e=>(c(),d("div",{key:e.$uid},[r("div",ni,I(e.$message),1)]))),128))]),_:1},8,["modelValue","error","onBlur"])]),r("div",li,[i[9]||(i[9]=r("label",{class:"q-mb-sm block"},"Fecha de fin",-1)),a(A,{modelValue:o.filtro.fecha_fin,"onUpdate:modelValue":i[4]||(i[4]=e=>o.filtro.fecha_fin=e),error:!!o.v$.fecha_fin.$errors.length,onBlur:o.v$.fecha_fin.$touch,outlined:"",dense:""},{append:s(()=>[a(U,{name:"event",class:"cursor-pointer"},{default:s(()=>[a(z,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:s(()=>[a(j,{modelValue:o.filtro.fecha_fin,"onUpdate:modelValue":i[3]||(i[3]=e=>o.filtro.fecha_fin=e),mask:o.maskFecha,"today-btn":""},{default:s(()=>[r("div",ci,[L(a(R,{label:"Cerrar",color:"primary",flat:""},null,512),[[G]])])]),_:1},8,["modelValue","mask"])]),_:1})]),_:1})]),error:s(()=>[(c(!0),d($,null,y(o.v$.fecha_fin.$errors,e=>(c(),d("div",{key:e.$uid},[r("div",ui,I(e.$message),1)]))),128))]),_:1},8,["modelValue","error","onBlur"])]),r("div",di,[i[11]||(i[11]=r("label",{class:"q-mb-sm block"},"Tipo cuestionario",-1)),a(K,{modelValue:o.filtro.tipo_cuestionario_id,"onUpdate:modelValue":i[5]||(i[5]=e=>o.filtro.tipo_cuestionario_id=e),options:o.tiposCuestionarios,"transition-show":"scale","transition-hide":"scale",hint:"Obligatorio","options-dense":"",dense:"",outlined:"","option-label":e=>e.titulo,"option-value":e=>e.id,error:!!o.v$.tipo_cuestionario_id.$errors.length,onBlur:o.v$.tipo_cuestionario_id.$touch,"emit-value":"","map-options":""},{"no-option":s(()=>[a(M,null,{default:s(()=>[a(J,{class:"text-grey"},{default:s(()=>i[10]||(i[10]=[D(" No hay resultados ")])),_:1})]),_:1})]),error:s(()=>[(c(!0),d($,null,y(o.v$.tipo_cuestionario_id.$errors,e=>(c(),d("div",{key:e.$uid},[r("div",pi,I(e.$message),1)]))),128))]),_:1},8,["modelValue","options","option-label","option-value","error","onBlur"])]),o.tabPrivacidadCuestionario===o.opcionesPrivacidadCuestionarios.PUBLICO?(c(),d("div",mi,[i[13]||(i[13]=r("label",{class:"q-mb-sm block"},"Link",-1)),a(K,{modelValue:o.filtro.link,"onUpdate:modelValue":i[6]||(i[6]=e=>o.filtro.link=e),options:o.linksCreados,"transition-show":"scale","transition-hide":"scale",hint:"Obligatorio","options-dense":"",dense:"",outlined:"","option-label":e=>e.link,"option-value":e=>e.link,error:!!o.v$.link.$errors.length,onBlur:o.v$.link.$touch,"emit-value":"","map-options":""},{"no-option":s(()=>[a(M,null,{default:s(()=>[a(J,{class:"text-grey"},{default:s(()=>i[12]||(i[12]=[D(" No hay resultados ")])),_:1})]),_:1})]),error:s(()=>[(c(!0),d($,null,y(o.v$.link.$errors,e=>(c(),d("div",{key:e.$uid},[r("div",fi,I(e.$message),1)]))),128))]),_:1},8,["modelValue","options","option-label","option-value","error","onBlur"])])):H("",!0),r("div",bi,[i[14]||(i[14]=r("label",{class:"q-mb-sm block"},"\xA0",-1)),a(R,{color:"primary",label:"Consultar",icon:"bi-search",class:"full-width","no-wrap":"","no-caps":"",onClick:i[7]||(i[7]=e=>o.consultar())})])]),_:1})]),_:1}),a(Fo,{name:"scale",mode:"out-in"},{default:s(()=>[o.listado.length?(c(),d("div",vi,[a(m,{titulo:"Empleados que respondieron el cuestionario en el a\xF1o seleccionado",configuracionColumnas:[...o.ConfiguracionColumnasReporteCuestionarioEmpleado],datos:o.listado,permitirConsultar:!1,permitirEditar:!1,permitirEliminar:!1,accion1Header:o.btnImprimirReporte,accion2Header:o.btnImprimirRespuestas},null,8,["configuracionColumnas","datos","accion1Header","accion2Header"])])):H("",!0)]),_:1})])]),_:1})}var ie=To(ii,[["render",Ci]]);export{ie as default};
