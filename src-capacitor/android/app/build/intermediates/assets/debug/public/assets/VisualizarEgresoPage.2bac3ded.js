import{bw as x,s as R,d as h,m as _,u as aa,$ as ea,c as B,bx as oa,cr as ia,A as z,bE as N,_ as sa,t as O,v as s,P as k,F as u,x as d,z as i,B as p,y as n,J as r,a4 as na,I as c,L as q,G as la,H as ra,K as ta,O as f,D as g}from"./index.6449c167.js";import{Q as da}from"./QForm.ca56f146.js";import{T as ca}from"./TabLayout.0bce4313.js";import{E as ua}from"./EssentialTable.00c17e97.js";import{E as ma}from"./EssentialSelectableTable.5a9cc771.js";import{C as ba}from"./ContenedorSimpleMixin.09c9bed5.js";import{T as pa}from"./Transaccion.ef293505.js";import{a as fa,b as ga,S as va}from"./utils.521b98f3.js";import{u as $}from"./transaccionEgreso.70c202c8.js";import{u as ya}from"./pedido.c5162ee1.js";import{u as Va}from"./transferencia.5b0e0c93.js";const Ea=[{name:"id",field:"id",label:"N\xB0",align:"left",sortable:!0},{name:"created_at",field:"created_at",label:"Fecha",align:"left",sortable:!0},{name:"solicitante",field:"solicitante",label:"Solicitante",align:"left",style:"max-width:250px; overflow: auto;",sortable:!0},{name:"justificacion",field:"justificacion",label:"Justificaci\xF3n",style:"max-width: 300px; overflow: auto;",align:"left",sortable:!0},{name:"responsable",field:"responsable",label:"Responsable",align:"left",style:"max-width:250px; overflow: auto;",sortable:!0},{name:"pedido",field:"pedido",label:"Pedido",align:"left",sortable:!0},{name:"motivo",field:"motivo",label:"Motivo",align:"left",style:"max-width:250px; overflow: auto;",sortable:!0},{name:"sucursal",field:"sucursal",label:"Sucursal",align:"left",style:"max-width:200px; overflow: auto;",sortable:!0},{name:"per_autoriza",field:"per_autoriza",label:"Autoriza",align:"left",style:"max-width:250px; overflow: auto;",sortable:!0},{name:"autorizacion",field:"autorizacion",label:"Autorizaci\xF3n",align:"left",sortable:!0},{name:"firmada",field:"firmada",label:"\xBFFirmada?",align:"left",sortable:!0},{name:"estado_comprobante",field:"estado_comprobante",label:"Estado del comprobante",align:"center",sortable:!0}],Ca=[{name:"producto",field:"producto",label:"Producto",style:"max-width:300px; overflow: auto;",align:"left",sortable:!0,editable:!1,visible:!0},{name:"descripcion",field:"descripcion",label:"Descripci\xF3n",style:"max-width:300px; overflow: auto;",align:"left",sortable:!0,editable:!1,visible:!0},{name:"categoria",field:"categoria",label:"Categoria",align:"left",sortable:!0,editable:!1,visible:!0},{name:"serial",field:"serial",label:"Serial",align:"left",sortable:!0,editable:!1,visible:!0},{name:"condiciones",field:"condiciones",label:"Estado del producto",align:"left",sortable:!1,editable:!1},{name:"cantidad",field:"cantidad",label:"Cantidad",align:"left",sortable:!1},{name:"pendiente",field:"pendiente",label:"Pendiente",align:"left",sortable:!1,editable:!1},{name:"recibido",field:"recibido",label:"Recibido",align:"left",sortable:!1,editable:!1},{name:"acciones",field:"acciones",label:"Acciones",align:"center"}],ka=[{name:"producto",field:"producto",label:"Producto",style:"max-width:300px; overflow: auto;",align:"left",sortable:!0,editable:!1,visible:!0},{name:"descripcion",field:"descripcion",label:"Descripci\xF3n",style:"max-width:300px; overflow: auto;",align:"left",sortable:!0,editable:!1,visible:!0},{name:"categoria",field:"categoria",label:"Categoria",align:"left",sortable:!0,editable:!1,visible:!0},{name:"serial",field:"serial",label:"Serial",align:"left",sortable:!0,editable:!1,visible:!0},{name:"condiciones",field:"condiciones",label:"Estado del producto",align:"left",sortable:!1,editable:!1},{name:"cantidad",field:"cantidad",label:"Cantidad",align:"left",sortable:!1,editable:!1},{name:"recibido",field:"recibido",label:"Recibido",align:"left",sortable:!1,editable:!1},{name:"acciones",field:"acciones",label:"Acciones",align:"center"}];class Pa extends x{constructor(){super(R.transacciones_egresos)}}var qa=h({components:{TabLayout:ca,EssentialTable:ua,EssentialSelectableTable:ma},setup(e,{emit:a}){const T=new ba(pa,new Pa),{entidad:t}=T.useReferencias(),{notificarError:P,notificarCorrecto:S,confirmar:m,prompt:v}=fa();ga().setQuasar(_());const o=aa(),w=new va,y=$(),V=$(),I=ya(),D=Va(),j=ea();let U;y.transaccion&&(t.hydrate(y.transaccion),U=JSON.parse(JSON.stringify(V.transaccion.listadoProductosTransaccion)));const M=o.esBodeguero,L=o.esCoordinador,Q=o.user.roles.filter(l=>l.indexOf("BODEGA")>-1||l.indexOf("COORDINADOR")>-1).length>0,J=B(!1),H=B(!1),G=B(!1);function K(){v({titulo:"Aprobar y firmar",mensaje:"Ingrese motivo de aprobaci\xF3n",accion:async E=>{try{m("Esta acci\xF3n firmar\xE1 el comprobante de egreso ",async()=>{const b={transaccion_id:y.idTransaccion,firmada:!0,estado:"ACEPTADA",observacion:E},C=z.getInstance(),A=N.URL_BASE+"/"+C.getEndpoint(R.comprobantes)+"/"+t.id,F=await C.put(A,b);console.log(F),S("Documento aprobado y firmado correctamente"),a("cerrar-modal",!1),a("guardado","aceptado"),y.resetearTransaccion(),V.resetearTransaccion(),V.estadoPendiente=!1})}catch{P("No se pudo aprobar ni firmar el documento")}}})}function W(){Z()?P("El valor de recibido no puede ser superior a la cantidad despachada"):v({titulo:"Aprobar Recepci\xF3n Parcial",mensaje:"Ingrese motivo de la aprobaci\xF3n parcial",accion:async E=>{try{m("Esta acci\xF3n firmar\xE1 el comprobante de egreso con las cantidades y materiales aceptados ",async()=>{w.activar();const b={transaccion:t,observacion:E},C=z.getInstance(),A=N.URL_BASE+"/"+C.getEndpoint(R.comprobantes)+"/aceptar-parcial/"+t.id,F=await C.put(A,b);console.log(F),S("Documento parcial aprobado y firmado correctamente"),a("cerrar-modal",!1),a("guardado","parcial"),y.resetearTransaccion(),V.resetearTransaccion(),V.estadoPendiente=!1})}catch{P("Ha ocurrido un error")}finally{w.desactivar()}}})}function X(){t.modificar_recepcion=!t.modificar_recepcion,t.modificar_recepcion&&t.estado_comprobante==="PARCIAL"?(t.listadoProductosTransaccion=t.listadoProductosTransaccion.filter(l=>l.cantidad!=l.recibido),t.listadoProductosTransaccion.forEach(l=>{l.cantidad=l.cantidad-l.recibido}),t.listadoProductosTransaccion.forEach(l=>{l.recibido=l.cantidad})):t.listadoProductosTransaccion=JSON.parse(JSON.stringify(U))}function Y({posicion:l}){m("\xBFEst\xE1 seguro de continuar?",()=>t.listadoProductosTransaccion.splice(l,1))}function Z(){return t.listadoProductosTransaccion.some(l=>l.recibido>l.cantidad)}return{mixin:T,transaccion:t,configuracionColumnas:Ea,acciones:oa,pedidoStore:I,transferenciaStore:D,esVisibleAutorizacion:J,esVisibleTarea:H,requiereFecha:G,configuracionColumnasProductosSeleccionadosEgreso:Ca,configuracionColumnasProductosSeleccionadosDespachadoParciales:ka,rolSeleccionado:Q,esBodeguero:M,esCoordinador:L,permitirModificarCantidades:X,aprobarEgreso:K,aprobarEgresoParcial:W,tabGestionarEgresos:ia,cargando:w,route:j,btnEditarCantidad:{titulo:"Cantidad",icono:"bi-pencil",accion:({posicion:l})=>{const E={titulo:"Confirmaci\xF3n",mensaje:"Ingresa la cantidad",defecto:t.listadoProductosTransaccion[l].recibido,tipo:"number",accion:b=>{t.listadoProductosTransaccion[l].recibido=b}};v(E)},visible:()=>t.modificar_recepcion},btnEliminarFila:{titulo:"Eliminar",icono:"bi-trash",color:"negative",accion:({posicion:l})=>{Y({posicion:l})},visible:()=>t.modificar_recepcion}}}});const Ta={key:0,class:"col-12 col-md-12 rounded-card q-py-sm text-center text-accent bg-yellow-2"},Sa={class:"row q-col-gutter-sm q-py-lg"},wa={key:0,class:"col-12 col-md-3"},Aa={key:1,class:"col-12 col-md-3"},Fa={class:"col-12 col-md-3 q-mb-md"},Ba={class:"col-12 col-md-3 q-mb-md"},Ra={key:2,class:"col-12 col-md-3 q-mb-md"},Ua={key:3,class:"col-12 col-md-3"},za={key:4,class:"col-12 col-md-3 q-mb-md"},Na={key:5,class:"col-12 col-md-3"},Oa={key:6,class:"col-12 col-md-3"},$a={class:"error-msg"},Ia={class:"col-12 col-md-3 q-mb-md"},Da={class:"col-12 col-md-3"},ja={key:7,class:"col-12 col-md-3"},Ma={key:8,class:"col-12 col-md-3"},La={key:9,class:"col-12 col-md-3"},Qa={class:"col-12 col-md-3"},Ja={key:10,class:"col-12 col-md-3"},Ha={key:11,class:"col-12 col-md-3"},Ga={class:"col-12 col-md-3"},Ka={key:12,class:"col-12 col-md-3"},Wa={key:13,class:"col-12"},Xa={key:14,class:"col-12"},Ya={key:15,class:"col-12"},Za={key:1,class:"q-pa-md q-gutter-sm flex flex-center"},xa={key:2,class:"q-pa-md q-gutter-sm flex flex-center"};function ha(e,a,T,t,P,S){const m=O("essential-table"),v=O("tab-layout");return s(),k(v,{mixin:e.mixin,configuracionColumnas:e.configuracionColumnas,"titulo-pagina":"Transacciones - Egresos","mostrar-listado":!1,mostrarButtonSubmits:!1},{formulario:u(()=>[e.transaccion.aviso_liquidacion_cliente?(s(),d("div",Ta,[i(p,{name:"bi-exclamation-triangle-fill",class:"q-mr-sm",size:"1em"}),a[26]||(a[26]=n("b",null,"\xA0 Advertencia",-1)),a[27]||(a[27]=n("div",null,"Esta transacci\xF3n no se cargar\xE1 al stock de ning\xFAn empleado",-1))])):r("",!0),i(da,{onSubmit:a[19]||(a[19]=na(()=>{},["prevent"]))},{default:u(()=>[n("div",Sa,[e.transaccion.id?(s(),d("div",wa,[a[28]||(a[28]=n("label",{class:"q-mb-sm block"},"Transacci\xF3n N\xB0",-1)),i(c,{modelValue:e.transaccion.id,"onUpdate:modelValue":a[0]||(a[0]=o=>e.transaccion.id=o),placeholder:"Obligatorio",disable:"",outlined:"",dense:""},null,8,["modelValue"])])):r("",!0),e.transaccion.created_at?(s(),d("div",Aa,[a[29]||(a[29]=n("label",{class:"q-mb-sm block"},"Fecha",-1)),i(c,{modelValue:e.transaccion.created_at,"onUpdate:modelValue":a[1]||(a[1]=o=>e.transaccion.created_at=o),disable:"",outlined:"",dense:""},null,8,["modelValue"])])):r("",!0),n("div",Fa,[a[30]||(a[30]=n("label",{class:"q-mb-sm block"},"Motivo",-1)),i(c,{modelValue:e.transaccion.motivo,"onUpdate:modelValue":a[2]||(a[2]=o=>e.transaccion.motivo=o),autogrow:"",disable:"",outlined:"",dense:""},null,8,["modelValue"])]),n("div",Ba,[a[31]||(a[31]=n("label",{class:"q-mb-sm block"},"Autorizacion",-1)),i(c,{modelValue:e.transaccion.autorizacion,"onUpdate:modelValue":a[3]||(a[3]=o=>e.transaccion.autorizacion=o),disable:"",outlined:"",dense:""},null,8,["modelValue"])]),e.transaccion.es_transferencia?(s(),d("div",Ra,[a[32]||(a[32]=n("label",{class:"q-mb-sm block"},"N\xB0 transferencia",-1)),i(c,{type:"number",modelValue:e.transaccion.transferencia,"onUpdate:modelValue":a[4]||(a[4]=o=>e.transaccion.transferencia=o),placeholder:"Opcional",hint:"Ingresa un numero de transferencia y presiona Enter",outlined:"",dense:""},null,8,["modelValue"])])):r("",!0),e.transaccion.pedido?(s(),d("div",Ua,[i(q,{class:"q-mt-lg q-pt-md",modelValue:e.transaccion.tiene_pedido,"onUpdate:modelValue":a[5]||(a[5]=o=>e.transaccion.tiene_pedido=o),label:"\xBFHay pedido?",outlined:"",disable:"",dense:""},null,8,["modelValue"])])):r("",!0),e.transaccion.tiene_pedido?(s(),d("div",za,[a[33]||(a[33]=n("label",{class:"q-mb-sm block"},"N\xB0 pedido",-1)),i(c,{type:"number",modelValue:e.transaccion.pedido,"onUpdate:modelValue":a[6]||(a[6]=o=>e.transaccion.pedido=o),placeholder:"Opcional",hint:"Ingresa un numero de pedido y presiona Enter",disable:"",outlined:"",dense:""},null,8,["modelValue"])])):r("",!0),e.transaccion.tiene_observacion_aut||e.transaccion.observacion_aut||e.esVisibleAutorizacion?(s(),d("div",Na,[i(q,{class:"q-mt-lg q-pt-md",modelValue:e.transaccion.tiene_observacion_aut,"onUpdate:modelValue":a[7]||(a[7]=o=>e.transaccion.tiene_observacion_aut=o),label:"Tiene observaci\xF3n",disable:"",outlined:"",dense:""},null,8,["modelValue"])])):r("",!0),e.transaccion.tiene_observacion_aut||e.transaccion.observacion_aut?(s(),d("div",Oa,[a[34]||(a[34]=n("label",{class:"q-mb-sm block"},"Observacion",-1)),i(c,{modelValue:e.transaccion.observacion_aut,"onUpdate:modelValue":a[8]||(a[8]=o=>e.transaccion.observacion_aut=o),placeholder:"Obligatorio",disable:"",error:!!e.v$.observacion_aut.$errors.length,outlined:"",dense:""},{error:u(()=>[(s(!0),d(la,null,ra(e.v$.observacion_aut.$errors,o=>(s(),d("div",{key:o.$uid},[n("div",$a,ta(o.$message),1)]))),128))]),_:1},8,["modelValue","error"])])):r("",!0),n("div",Ia,[a[35]||(a[35]=n("label",{class:"q-mb-sm block"},"Sucursal",-1)),i(c,{modelValue:e.transaccion.sucursal,"onUpdate:modelValue":a[9]||(a[9]=o=>e.transaccion.sucursal=o),disable:"",outlined:"",dense:""},null,8,["modelValue"])]),n("div",Da,[a[36]||(a[36]=n("label",{class:"q-mb-sm block"},"Justificaci\xF3n",-1)),i(c,{type:"textarea",autogrow:"",modelValue:e.transaccion.justificacion,"onUpdate:modelValue":a[10]||(a[10]=o=>e.transaccion.justificacion=o),placeholder:"Obligatorio",disable:"",outlined:"",dense:""},null,8,["modelValue"])]),e.transaccion.solicitante?(s(),d("div",ja,[a[37]||(a[37]=n("label",{class:"q-mb-sm block"},"Solicitante",-1)),i(c,{modelValue:e.transaccion.solicitante,"onUpdate:modelValue":a[11]||(a[11]=o=>e.transaccion.solicitante=o),autogrow:"",dense:"",outlined:"",disable:""},null,8,["modelValue"])])):r("",!0),e.transaccion.tarea?(s(),d("div",Ma,[i(q,{class:"q-mt-lg q-pt-md",modelValue:e.transaccion.es_tarea,"onUpdate:modelValue":a[12]||(a[12]=o=>e.transaccion.es_tarea=o),label:"\xBFEs material para tarea?",disable:"",outlined:"",dense:""},null,8,["modelValue"])])):r("",!0),e.esVisibleTarea||e.transaccion.es_tarea?(s(),d("div",La,[a[38]||(a[38]=n("label",{class:"q-mb-sm block"},"Tarea",-1)),i(c,{modelValue:e.transaccion.tarea,"onUpdate:modelValue":a[13]||(a[13]=o=>e.transaccion.tarea=o),dense:"",outlined:"",disable:"",autogrow:""},null,8,["modelValue"])])):r("",!0),n("div",Qa,[a[39]||(a[39]=n("label",{class:"q-mb-sm block"},"Responsable",-1)),i(c,{modelValue:e.transaccion.responsable,"onUpdate:modelValue":a[14]||(a[14]=o=>e.transaccion.responsable=o),autogrow:"",disable:"",outlined:"",dense:""},null,8,["modelValue"])]),e.transaccion.per_retira&&!e.transaccion.es_transferencia&&e.transaccion.retira_tercero||e.transaccion.retira_tercero?(s(),d("div",Ja,[i(q,{class:"q-mt-lg q-pt-md",modelValue:e.transaccion.retira_tercero,"onUpdate:modelValue":a[15]||(a[15]=o=>e.transaccion.retira_tercero=o),label:"\xBFRetira otra persona?",disable:"",outlined:"",dense:""},null,8,["modelValue"])])):r("",!0),e.transaccion.retira_tercero?(s(),d("div",Ha,[a[40]||(a[40]=n("label",{class:"q-mb-sm block"},"Persona que retira",-1)),i(c,{modelValue:e.transaccion.per_retira,"onUpdate:modelValue":a[16]||(a[16]=o=>e.transaccion.per_retira=o),dense:"",outlined:"",disable:""},null,8,["modelValue"])])):r("",!0),n("div",Ga,[a[41]||(a[41]=n("label",{class:"q-mb-sm block"},"Cliente",-1)),i(c,{modelValue:e.transaccion.cliente,"onUpdate:modelValue":a[17]||(a[17]=o=>e.transaccion.cliente=o),disable:"",outlined:"",dense:""},null,8,["modelValue"])]),e.transaccion.estado_comprobante?(s(),d("div",Ka,[a[42]||(a[42]=n("label",{class:"q-mb-sm block"},"Comentario de Aceptaci\xF3n",-1)),i(c,{modelValue:e.transaccion.estado_comprobante,"onUpdate:modelValue":a[18]||(a[18]=o=>e.transaccion.estado_comprobante=o),disable:"",outlined:"",dense:""},null,8,["modelValue"])])):r("",!0),e.transaccion.modificar_recepcion?r("",!0):(s(),d("div",Wa,[i(m,{titulo:"Productos Seleccionados",configuracionColumnas:e.configuracionColumnasProductosSeleccionadosEgreso,datos:e.transaccion.listadoProductosTransaccion,permitirConsultar:!1,permitirEditar:!1,permitirEliminar:!1,mostrarBotones:!1,permitirBuscar:!1,ajustarCeldas:!0,altoFijo:!1},null,8,["configuracionColumnas","datos"])])),e.transaccion.modificar_recepcion&&e.transaccion.estado_comprobante==="PENDIENTE"?(s(),d("div",Xa,[i(m,{titulo:"Productos Seleccionados",configuracionColumnas:e.configuracionColumnasProductosSeleccionadosDespachadoParciales,datos:e.transaccion.listadoProductosTransaccion,permitirConsultar:!1,permitirEditar:!1,permitirEliminar:!1,mostrarBotones:!1,permitirBuscar:!1,ajustarCeldas:!0,altoFijo:!1,accion1:e.btnEditarCantidad,accion2:e.btnEliminarFila},null,8,["configuracionColumnas","datos","accion1","accion2"])])):r("",!0),e.transaccion.modificar_recepcion&&e.transaccion.estado_comprobante==="PARCIAL"?(s(),d("div",Ya,[i(m,{titulo:"Productos Seleccionados",configuracionColumnas:e.configuracionColumnasProductosSeleccionadosDespachadoParciales,datos:e.transaccion.listadoProductosTransaccion,permitirConsultar:!1,permitirEditar:!1,permitirEliminar:!1,mostrarBotones:!1,permitirBuscar:!1,ajustarCeldas:!0,altoFijo:!1,accion1:e.btnEditarCantidad,accion2:e.btnEliminarFila},null,8,["configuracionColumnas","datos","accion1","accion2"])])):r("",!0)])]),_:1}),e.transaccion.estado_comprobante==="PARCIAL"&&e.route.name=="gestionar_egresos"?(s(),d("div",Za,[e.transaccion.modificar_recepcion?(s(),k(f,{key:0,color:"positive",onClick:a[20]||(a[20]=o=>e.aprobarEgresoParcial()),"no-caps":"",glossy:"",push:""},{default:u(()=>[i(p,{name:"bi-check-circle",size:"xs",class:"q-mr-sm"}),a[43]||(a[43]=g(" Aprobar Recepci\xF3n Parcial"))]),_:1})):r("",!0),e.transaccion.modificar_recepcion?r("",!0):(s(),k(f,{key:1,color:"positive",onClick:a[21]||(a[21]=o=>e.aprobarEgreso()),"no-caps":"",glossy:"",push:""},{default:u(()=>[i(p,{name:"bi-check-circle",size:"xs",class:"q-mr-sm"}),a[44]||(a[44]=g(" Aprobar y Firmar"))]),_:1})),i(f,{color:"warning",onClick:a[22]||(a[22]=o=>e.permitirModificarCantidades()),"no-caps":"",glossy:"",push:""},{default:u(()=>[i(p,{name:"bi-pencil",size:"xs",class:"q-mr-sm"}),a[45]||(a[45]=g(" Modificar Recepci\xF3n "))]),_:1})])):r("",!0),e.transaccion.estado_comprobante==="PENDIENTE"&&e.route.name=="gestionar_egresos"?(s(),d("div",xa,[e.transaccion.modificar_recepcion?r("",!0):(s(),k(f,{key:0,color:"positive",onClick:a[23]||(a[23]=o=>e.aprobarEgreso()),"no-caps":"",glossy:"",push:""},{default:u(()=>[i(p,{name:"bi-check-circle",size:"xs",class:"q-mr-sm"}),a[46]||(a[46]=g(" Aprobar y Firmar"))]),_:1})),e.transaccion.modificar_recepcion?(s(),k(f,{key:1,color:"positive",onClick:a[24]||(a[24]=o=>e.aprobarEgresoParcial()),disable:e.cargando.estaCargando,"no-caps":"",glossy:"",push:""},{default:u(()=>[i(p,{name:"bi-check-circle",size:"xs",class:"q-mr-sm"}),a[47]||(a[47]=g(" Aprobar Recepci\xF3n Parcial"))]),_:1},8,["disable"])):r("",!0),i(f,{color:"warning",onClick:a[25]||(a[25]=o=>e.permitirModificarCantidades()),"no-caps":"",glossy:"",push:""},{default:u(()=>[i(p,{name:"bi-pencil",size:"xs",class:"q-mr-sm"}),a[48]||(a[48]=g(" Modificar Recepci\xF3n "))]),_:1})])):r("",!0)]),_:1},8,["mixin","configuracionColumnas"])}var me=sa(qa,[["render",ha]]);export{Pa as T,me as V,Ca as a,Ea as c};
