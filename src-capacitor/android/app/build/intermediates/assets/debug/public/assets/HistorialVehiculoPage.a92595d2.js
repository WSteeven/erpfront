var Z=Object.defineProperty;var x=(o,e,m)=>e in o?Z(o,e,{enumerable:!0,configurable:!0,writable:!0,value:m}):o[e]=m;var f=(o,e,m)=>(x(o,typeof e!="symbol"?e+"":e,m),m);import{Q as ee,a as O}from"./QSelect.6ce302d7.js";import{Q as I,a as _}from"./QItemSection.9a955ec6.js";import{c as E,bw as oe,s as G,d as le,m as T,q as N,A as ae,bE as se,_ as ie,t as te,v as t,P as V,F as i,z as a,y as s,bb as re,M as ne,N as de,D as B,K as b,x as r,G as F,H as P,I as u,B as q,j as M,O as y,cx as ue,J as n}from"./index.6449c167.js";import{Q as A,a as D,C as H}from"./QPopupProxy.72ff1d6d.js";import{E as me,c as ce}from"./EssentialTable.00c17e97.js";import{Q as w}from"./QExpansionItem.e36a6702.js";import{Q as pe}from"./QPage.5d173a8a.js";import{Q as fe,a as be}from"./QLayout.418abf9d.js";import{r as $}from"./i18n-validators.29e2545c.js";import{u as ve}from"./index.490dde02.js";import{E as he}from"./entidadAuditable.75a46700.js";import{C as ge}from"./ContenedorSimpleMixin.09c9bed5.js";import{a as Ve,b as Ce,u as ke,S as qe,x as ye,B as L,C as we}from"./utils.521b98f3.js";import{C as $e}from"./ConductorController.7b773e10.js";import{V as Ee}from"./VehiculoController.5e90ff0e.js";import{u as Qe}from"./filtrosListadosGenerales.c3aa2da3.js";import{o as Se,h as Be}from"./vehiculos.utils.c31e027d.js";import{S as Fe}from"./ServicioController.a8bbd86b.js";import"./QChip.95469f73.js";import"./position-engine.70d0a89f.js";import"./format.8ac60962.js";import"./QToolbar.8dbe891b.js";import"./use-fullscreen.a7661f85.js";import"./QBadge.e6f320cd.js";import"./_commonjsHelpers.8402d862.js";import"./QImg.fd079679.js";import"./QFile.90d9394a.js";import"./VisorImagen.75b3c53f.js";import"./logo.4781eea2.js";import"./seleccionContratacionPersonal.utils.e3e1ed3d.js";import"./QScrollObserver.b4b0444d.js";import"./QResizeObserver.9af84680.js";import"./index.0198dd12.js";const Pe=[{name:"solicitante",field:"solicitante",label:"Empleado Solicitante",align:"left",sortable:!0},{name:"fecha",field:"fecha",label:"Fecha",align:"left",sortable:!0},{name:"servicios",field:"servicios",label:"Servicios",align:"left"},{name:"km_realizado",field:"km_realizado",label:"Km Realizado",align:"left",sortable:!0},{name:"autorizacion",field:"autorizacion",label:"Estado",align:"left",sortable:!0},{name:"observacion",field:"observacion",label:"Observaci\xF3n",align:"left"}],je=[{name:"empleado",field:"empleado",label:"Empleado Realiza",align:"left",sortable:!0},{name:"fecha_realizado",field:"fecha_realizado",label:"Fecha Realizado",align:"left",sortable:!0},{name:"servicio",field:"servicio",label:"Servicio",align:"left",sortable:!0},{name:"km_realizado",field:"km_realizado",label:"Km Realizado",align:"left",sortable:!0},{name:"estado",field:"estado",label:"Estado",align:"left",sortable:!0},{name:"km_retraso",field:"km_retraso",label:"Km Retraso",align:"left",sortable:!0},{name:"observacion",field:"observacion",label:"Observaci\xF3n",align:"left"}],ze=[{name:"fecha_entrega",field:"fecha_entrega",label:"Fecha Entrega",align:"left"},{name:"canton",field:"canton",label:"Ciudad",align:"left"},{name:"entrega",field:"entrega",label:"Entrega",align:"left"},{name:"responsable",field:"responsable",label:"Responsable",align:"left"},{name:"observacion_entrega",field:"observacion_entrega",label:"Observacion Entrega",align:"left"}];class Re extends he{constructor(){super();f(this,"vehiculo");f(this,"fecha_inicio");f(this,"fecha_fin");f(this,"accion");f(this,"opciones");this.vehiculo=null,this.accion=null,this.fecha_inicio=null,this.fecha_fin=null,this.opciones=E(["TODOS"])}}class Ue extends oe{constructor(){super(G.historial_vehiculos)}}const Oe=[{name:"fecha",field:"fecha",label:"Fecha",align:"left",sortable:!0},{name:"persona_reporta",field:"persona_reporta",label:"Persona Reporta",align:"left",sortable:!0},{name:"tipo",field:"tipo",label:"Tipo",align:"left",sortable:!0},{name:"gravedad",field:"gravedad",label:"Gravedad",align:"left",sortable:!0},{name:"descripcion",field:"descripcion",label:"Descripci\xF3n",align:"left"},{name:"aplica_seguro",field:"aplica_seguro",label:"\xBFAplica Seguro?",align:"left",sortable:!0}];var Ie=le({components:{EssentialTable:me},setup(){const o=new ge(Re,new Ue),{entidad:e,listadosAuxiliares:m}=o.useReferencias(),{obtenerListados:j,cargarVista:z,setValidador:R}=o.useComportamiento(),{notificarAdvertencia:c}=Ve();Ce().setQuasar(T()),ke().setQuasar(T());const v=new qe,p=E(),C=E(),h=E(),{vehiculos:l,filtrarVehiculos:K,empleados:J,filtrarEmpleados:W}=Qe(m);z(async()=>{await j({vehiculos:new Ee,empleados:new $e,servicios:{controller:new Fe,params:{tipo:"CORRECTIVO"}}}),e.fecha_fin=ye(N)});const Q=ve({vehiculo:{required:$},fecha_inicio:{required:$},fecha_fin:{required:$},opciones:{required:$}},e);R(Q.value);function X(k){p.value=l.value.filter(d=>d.id===k)[0],console.log(p.value)}async function Y(k){if(await Q.value.$validate())try{v.activar();const d=ae.getInstance(),S=se.URL_BASE+"/"+d.getEndpoint(G.historial_vehiculos)+"/"+e.vehiculo,U="historial_vehiculo_"+p.value.placa;switch(k){case"excel":e.accion="excel",L(S,"POST","blob","xlsx",U,e);break;case"pdf":e.accion="pdf",L(S,"POST","blob","pdf",U,e);break;default:e.accion="";const g=await d.post(S,e);console.log(g),g.data.results?(g.data.results.length<1&&c("No se obtuvieron resultados"),console.log(g.data.results),h.value=g.data.results):console.log(C.value)}}catch(d){await we(d)}finally{v.desactivar()}}return{historial:e,v$:Q,configuracionColumnasCustodios:ze,configuracionColumnasMantenimientosPreventivos:je,configuracionColumnasMantenimientosCorrectivos:Pe,configuracionColumnasIncidentes:Oe,vehiculos:l,filtrarVehiculos:K,empleados:J,filtrarEmpleados:W,opciones:Se,maskFecha:N,resultados:h,buscarReporte:Y,obtenerVehiculoSeleccionado:X,optionCliqueada(k){e.opciones[e.opciones.length-1]===Be.todos?e.opciones=e.opciones.filter(d=>d==="TODOS"):e.opciones=e.opciones.filter(d=>d!=="TODOS")}}}});const _e={class:"col"},Te={class:"row q-col-gutter-sm q-pa-sm q-py-md"},Ne={class:"col-12 col-md-3"},Me={class:"error-msg"},Ae={class:"col-12 col-md-3"},De={class:"row items-center justify-end"},He={class:"error-msg"},Le={class:"col-12 col-md-3"},Ge={class:"row items-center justify-end"},Ke={class:"error-msg"},Je={class:"col-12"},We={class:"col-12 col-md-12 q-mt-md"},Xe={class:"text-center"},Ye={class:"col col-12 q-col-gutter-sm q-pl-md q-pt-lg"},Ze={class:"row q-col-gutter-sm q-pa-sm"},xe={key:0,class:"col-12 col-md-3 q-mb-md"},eo={key:1,class:"col-12 col-md-3 q-mb-md"},oo={key:2,class:"col-12 col-md-3 q-mb-md"},lo={key:3,class:"col-12 col-md-3 q-mb-md"},ao={key:4,class:"col-12 col-md-3 q-mb-md"},so={key:5,class:"col-12 col-md-3 q-mb-md"},io={key:6,class:"col-12 col-md-3 q-mb-md"},to={key:7,class:"col-12 col-md-3 q-mb-md"},ro={class:"row q-col-gutter-sm q-pa-sm"},no={class:"col-12"},uo={class:"row q-col-gutter-sm q-pa-sm"},mo={key:0,class:"col-12"},co={key:1,class:"col-12"},po={class:"row q-col-gutter-sm q-pa-sm"},fo={key:0,class:"col-12"};function bo(o,e,m,j,z,R){const c=te("essential-table");return t(),V(be,null,{default:i(()=>[a(fe,null,{default:i(()=>[a(pe,{padding:""},{default:i(()=>[s("div",_e,[a(re,{class:"rounded-card custom-shadow"},{default:i(()=>{var v,p,C,h;return[s("div",Te,[e[32]||(e[32]=s("div",{class:"col-12"},[s("label",{class:"q-mb-sm block"},"Historial de veh\xEDculos")],-1)),s("div",Ne,[e[18]||(e[18]=s("label",{class:"q-mb-sm block"},"Veh\xEDculo",-1)),a(ee,{modelValue:o.historial.vehiculo,"onUpdate:modelValue":[e[0]||(e[0]=l=>o.historial.vehiculo=l),o.obtenerVehiculoSeleccionado],options:o.vehiculos,"transition-show":"jump-up","transition-hide":"jump-down","options-dense":"",dense:"",outlined:"",onFilter:o.filtrarVehiculos,"error-message":"Debes seleccionar un n\xFAmero de placa",error:!!o.v$.vehiculo.$errors.length,onBlur:o.v$.vehiculo.$touch,"use-input":"","input-debounce":"0","option-value":l=>l.id,"option-label":l=>l.placa,"emit-value":"","map-options":""},{option:i(l=>[a(I,ne(de(l.itemProps)),{default:i(()=>[a(_,null,{default:i(()=>[a(O,null,{default:i(()=>[B(b(l.opt.placa),1)]),_:2},1024),a(O,{caption:""},{default:i(()=>[B(b(l.opt.marca)+": "+b(l.opt.modelo),1)]),_:2},1024)]),_:2},1024)]),_:2},1040)]),"no-option":i(()=>[a(I,null,{default:i(()=>[a(_,{class:"text-grey"},{default:i(()=>e[17]||(e[17]=[B(" No hay resultados ")])),_:1})]),_:1})]),error:i(()=>[(t(!0),r(F,null,P(o.v$.vehiculo.$errors,l=>(t(),r("div",{key:l.$uid},[s("div",Me,b(l.$message),1)]))),128))]),_:1},8,["modelValue","options","onFilter","onUpdate:modelValue","error","onBlur","option-value","option-label"])]),s("div",Ae,[e[19]||(e[19]=s("label",{class:"q-mb-sm block"},"Fecha de inicio",-1)),a(u,{modelValue:o.historial.fecha_inicio,"onUpdate:modelValue":e[2]||(e[2]=l=>o.historial.fecha_inicio=l),error:!!o.v$.fecha_inicio.$errors.length,onBlur:o.v$.fecha_inicio.$touch,outlined:"",dense:""},{append:i(()=>[a(q,{name:"event",class:"cursor-pointer"},{default:i(()=>[a(A,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:i(()=>[a(D,{modelValue:o.historial.fecha_inicio,"onUpdate:modelValue":e[1]||(e[1]=l=>o.historial.fecha_inicio=l),mask:o.maskFecha,"today-btn":""},{default:i(()=>[s("div",De,[M(a(y,{label:"Cerrar",color:"primary",flat:""},null,512),[[H]])])]),_:1},8,["modelValue","mask"])]),_:1})]),_:1})]),error:i(()=>[(t(!0),r(F,null,P(o.v$.fecha_inicio.$errors,l=>(t(),r("div",{key:l.$uid},[s("div",He,b(l.$message),1)]))),128))]),_:1},8,["modelValue","error","onBlur"])]),s("div",Le,[e[20]||(e[20]=s("label",{class:"q-mb-sm block"},"Fecha de fin",-1)),a(u,{modelValue:o.historial.fecha_fin,"onUpdate:modelValue":e[5]||(e[5]=l=>o.historial.fecha_fin=l),error:!!o.v$.fecha_fin.$errors.length,onBlur:o.v$.fecha_fin.$touch,outlined:"",dense:""},{append:i(()=>[a(q,{name:"event",class:"cursor-pointer"},{default:i(()=>[a(A,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:i(()=>[a(D,{modelValue:o.historial.fecha_fin,"onUpdate:modelValue":[e[3]||(e[3]=l=>o.historial.fecha_fin=l),e[4]||(e[4]=l=>o.consultar())],mask:o.maskFecha,"today-btn":""},{default:i(()=>[s("div",Ge,[M(a(y,{label:"Cerrar",color:"primary",flat:""},null,512),[[H]])])]),_:1},8,["modelValue","mask"])]),_:1})]),_:1})]),error:i(()=>[(t(!0),r(F,null,P(o.v$.fecha_fin.$errors,l=>(t(),r("div",{key:l.$uid},[s("div",Ke,b(l.$message),1)]))),128))]),_:1},8,["modelValue","error","onBlur"])]),s("div",Je,[e[21]||(e[21]=s("label",{class:"q-mb-sm block"},"Opciones",-1)),a(ue,{modelValue:o.historial.opciones,"onUpdate:modelValue":[e[6]||(e[6]=l=>o.historial.opciones=l),o.optionCliqueada],options:o.opciones,color:"primary",type:"toggle"},null,8,["modelValue","options","onUpdate:modelValue"])]),s("div",We,[s("div",Xe,[a(ce,{push:""},{default:i(()=>[a(y,{color:"primary",class:"full-width","no-caps":"","no-wrap":"",push:"",glossy:"",onClick:e[7]||(e[7]=l=>o.buscarReporte("consulta"))},{default:i(()=>[a(q,{name:"bi-search",size:"xs",class:"q-pr-sm"}),e[22]||(e[22]=s("span",null,"Buscar",-1))]),_:1}),a(y,{color:"positive",class:"full-width","no-caps":"","no-wrap":"",push:"",glossy:"",onClick:e[8]||(e[8]=l=>o.buscarReporte("excel"))},{default:i(()=>[a(q,{name:"bi-file-earmark-excel-fill",size:"xs",class:"q-mr-sm"}),e[23]||(e[23]=s("span",null,"Excel",-1))]),_:1})]),_:1})])]),s("div",Ye,[((v=o.resultados)==null?void 0:v.vehiculo)!==void 0?(t(),V(w,{key:0,class:"overflow-hidden q-mb-md expansion",label:"Informaci\xF3n del veh\xEDculo","header-class":"text-bold bg-header-collapse","default-opened":""},{default:i(()=>[s("div",Ze,[o.resultados.vehiculo.placa?(t(),r("div",xe,[e[24]||(e[24]=s("label",{class:"q-mb-sm block"},"Placa",-1)),a(u,{modelValue:o.resultados.vehiculo.placa,"onUpdate:modelValue":e[9]||(e[9]=l=>o.resultados.vehiculo.placa=l),disable:"",outlined:"",dense:""},null,8,["modelValue"])])):n("",!0),o.resultados.vehiculo.marca?(t(),r("div",eo,[e[25]||(e[25]=s("label",{class:"q-mb-sm block"},"Marca",-1)),a(u,{modelValue:o.resultados.vehiculo.marca,"onUpdate:modelValue":e[10]||(e[10]=l=>o.resultados.vehiculo.marca=l),disable:"",outlined:"",dense:""},null,8,["modelValue"])])):n("",!0),o.resultados.vehiculo.modelo?(t(),r("div",oo,[e[26]||(e[26]=s("label",{class:"q-mb-sm block"},"Modelo",-1)),a(u,{modelValue:o.resultados.vehiculo.modelo,"onUpdate:modelValue":e[11]||(e[11]=l=>o.resultados.vehiculo.modelo=l),disable:"",outlined:"",dense:""},null,8,["modelValue"])])):n("",!0),o.resultados.vehiculo.num_chasis?(t(),r("div",lo,[e[27]||(e[27]=s("label",{class:"q-mb-sm block"},"N\xB0 Chasis",-1)),a(u,{modelValue:o.resultados.vehiculo.num_chasis,"onUpdate:modelValue":e[12]||(e[12]=l=>o.resultados.vehiculo.num_chasis=l),disable:"",outlined:"",dense:""},null,8,["modelValue"])])):n("",!0),o.resultados.vehiculo.num_motor?(t(),r("div",ao,[e[28]||(e[28]=s("label",{class:"q-mb-sm block"},"N\xB0 Motor",-1)),a(u,{modelValue:o.resultados.vehiculo.num_motor,"onUpdate:modelValue":e[13]||(e[13]=l=>o.resultados.vehiculo.num_motor=l),disable:"",outlined:"",dense:""},null,8,["modelValue"])])):n("",!0),o.resultados.vehiculo.tipo_vehiculo?(t(),r("div",so,[e[29]||(e[29]=s("label",{class:"q-mb-sm block"},"Tipo Veh\xEDculo",-1)),a(u,{modelValue:o.resultados.vehiculo.tipo_vehiculo,"onUpdate:modelValue":e[14]||(e[14]=l=>o.resultados.vehiculo.tipo_vehiculo=l),disable:"",outlined:"",dense:""},null,8,["modelValue"])])):n("",!0),o.resultados.vehiculo.traccion?(t(),r("div",io,[e[30]||(e[30]=s("label",{class:"q-mb-sm block"},"Tracci\xF3n",-1)),a(u,{modelValue:o.resultados.vehiculo.traccion,"onUpdate:modelValue":e[15]||(e[15]=l=>o.resultados.vehiculo.traccion=l),disable:"",outlined:"",dense:""},null,8,["modelValue"])])):n("",!0),o.resultados.vehiculo.cilindraje?(t(),r("div",to,[e[31]||(e[31]=s("label",{class:"q-mb-sm block"},"Cilindraje",-1)),a(u,{modelValue:o.resultados.vehiculo.cilindraje,"onUpdate:modelValue":e[16]||(e[16]=l=>o.resultados.vehiculo.cilindraje=l),disable:"",outlined:"",dense:""},null,8,["modelValue"])])):n("",!0)])]),_:1})):n("",!0),((p=o.resultados)==null?void 0:p.custodios)!==void 0?(t(),V(w,{key:1,class:"overflow-hidden q-mb-md expansion",label:"Historial de Custodios","header-class":"text-bold bg-header-collapse","default-opened":""},{default:i(()=>[s("div",ro,[s("div",no,[a(c,{titulo:"Custodios",configuracionColumnas:o.configuracionColumnasCustodios,datos:o.resultados.custodios,permitirConsultar:!1,permitirEliminar:!1,permitirEditar:!1,mostrarBotones:!1,"permitir-buscar":!1,mostrarCantidadElementos:!1,"alto-fijo":!1,ajustarCeldas:""},null,8,["configuracionColumnas","datos"])])])]),_:1})):n("",!0),((C=o.resultados)==null?void 0:C.mantenimientos)!==void 0?(t(),V(w,{key:2,class:"overflow-hidden q-mb-md expansion",label:"Mantenimientos Realizados","header-class":"text-bold bg-header-collapse","default-opened":""},{default:i(()=>[s("div",uo,[o.resultados.mantenimientos.programados.length>0?(t(),r("div",mo,[a(c,{titulo:"Programados/Preventivos/Periodicos",configuracionColumnas:o.configuracionColumnasMantenimientosPreventivos,datos:o.resultados.mantenimientos.programados,permitirConsultar:!1,permitirEliminar:!1,permitirEditar:!1,mostrarBotones:!1,"permitir-buscar":"","alto-fijo":!1,ajustarCeldas:""},null,8,["configuracionColumnas","datos"])])):n("",!0),o.resultados.mantenimientos.correctivos.length>0?(t(),r("div",co,[a(c,{titulo:"Correctivos",configuracionColumnas:o.configuracionColumnasMantenimientosCorrectivos,datos:o.resultados.mantenimientos.correctivos,permitirConsultar:!1,permitirEliminar:!1,permitirEditar:!1,mostrarBotones:!1,"permitir-buscar":"","alto-fijo":!1,ajustarCeldas:""},null,8,["configuracionColumnas","datos"])])):n("",!0)])]),_:1})):n("",!0),((h=o.resultados)==null?void 0:h.incidentes)!==void 0?(t(),V(w,{key:3,class:"overflow-hidden q-mb-md expansion",label:"Incidentes","header-class":"text-bold bg-header-collapse","default-opened":""},{default:i(()=>[s("div",po,[o.resultados.incidentes.length>0?(t(),r("div",fo,[a(c,{titulo:"Incidentes",configuracionColumnas:o.configuracionColumnasIncidentes,datos:o.resultados.incidentes,permitirConsultar:!1,permitirEliminar:!1,permitirEditar:!1,mostrarBotones:!1,"permitir-buscar":"","alto-fijo":!1,ajustarCeldas:""},null,8,["configuracionColumnas","datos"])])):n("",!0)])]),_:1})):n("",!0)])])]}),_:1})])]),_:1})]),_:1})]),_:1})}var Yo=ie(Ie,[["render",bo]]);export{Yo as default};
