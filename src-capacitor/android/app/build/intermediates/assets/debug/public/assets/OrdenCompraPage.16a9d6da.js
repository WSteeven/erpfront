var de=Object.defineProperty;var te=(o,e,w)=>e in o?de(o,e,{enumerable:!0,configurable:!0,writable:!0,value:w}):o[e]=w;var G=(o,e,w)=>(te(o,typeof e!="symbol"?e+"":e,w),w);import{u as ko,c as V,bf as ue,d as me,m as Co,f as O,E as pe,be as eo,a1 as ce,bx as h,p as be,cv as ve,cu as fe,bZ as yo,_ as ge,t as A,v as d,x as t,z as i,F as s,a4 as Ce,y as l,I as z,J as b,D as m,L as ao,a2 as ro,G as N,H as T,K as f,M as Vo,N as Po,a7 as ye,P as Ve,O as Pe,Q as F}from"./index.6449c167.js";import{Q as g,a as p}from"./QItemSection.9a955ec6.js";import{Q as E,a as K}from"./QSelect.6ce302d7.js";import{Q as ze}from"./use-fullscreen.a7661f85.js";import{Q as we}from"./QForm.ca56f146.js";import{O as io,u as ke,c as Ee}from"./ordenCompra.f2856486.js";import{c as qe}from"./configuracionColumnasProductos.9df91570.js";import{c as zo}from"./configuracionColumnasItemOrdenCompra.236a777f.js";import{a as H,r as so}from"./i18n-validators.29e2545c.js";import{u as Oe}from"./index.490dde02.js";import{T as Ne}from"./TabLayoutFilterTabs2.5e702525.js";import{E as Fe,a5 as Se,a6 as Le,a8 as Ie}from"./EssentialTable.00c17e97.js";import{E as $e}from"./EssentialSelectableTable.5a9cc771.js";import{M as he}from"./ModalEntidad.168b465e.js";import{E as Ae}from"./EssentialPopupEditableTable.e294b26f.js";import{G as Te}from"./GestorArchivos.10722df3.js";import{C as Ue}from"./ContenedorSimpleMixin.09c9bed5.js";import{S as Be,O as wo}from"./SeguimientoOrdenCompraPage.2a56829f.js";import{D as De,a as je,b as Me,u as Qe,a2 as Re,a3 as Ge,a4 as J,a5 as Ke}from"./utils.521b98f3.js";import{P as He}from"./ProveedorController.1318c97c.js";import{u as Je}from"./filtrosListadosGenerales.c3aa2da3.js";import{u as Ze,P as We}from"./preorden.609a5d84.js";import{E as Xe}from"./EmpleadoPermisosController.f2fe35f7.js";import{u as Ye}from"./selector.9691ac4b.js";import{C as _e,a as xe}from"./ComponenteModal.domain.50e59f97.js";import{U as oa}from"./UnidadMedidaController.198e0928.js";import{A as ea}from"./ArchivoController.90dd4f66.js";import{P as aa}from"./ProveedorInternacionalController.c7784137.js";import{u as ra}from"./configuracion_general.37a05c0a.js";import"./QChip.95469f73.js";import"./position-engine.70d0a89f.js";import"./format.8ac60962.js";import"./entidadAuditable.75a46700.js";import"./index.0198dd12.js";import"./QTabs.6c234f27.js";import"./QResizeObserver.9af84680.js";import"./QTabPanels.49d2362a.js";import"./touch.9135741d.js";import"./QPopupProxy.72ff1d6d.js";import"./QPage.5d173a8a.js";import"./EssentialTableTabs.586dbdfc.js";import"./QBadge.e6f320cd.js";import"./EssentialTablePagination.d5c1010a.js";import"./QToolbar.8dbe891b.js";import"./buttonSubmits.fe817da3.js";import"./_commonjsHelpers.8402d862.js";import"./QImg.fd079679.js";import"./QFile.90d9394a.js";import"./VisorImagen.75b3c53f.js";import"./logo.4781eea2.js";import"./seleccionContratacionPersonal.utils.e3e1ed3d.js";import"./QUploader.cca1b7bd.js";import"./QCircularProgress.b24a7ee9.js";import"./configuracionColumnasArchivoSubtarea.215f4ffd.js";import"./TablaFilasDinamicas.318e936a.js";import"./configuracionColumnasSeguimientoOrdenCompra.eb4feb2f.js";import"./SelectorController.de8e1cd0.js";import"./ConfiguracionController.c50d9536.js";const ia=[{name:"id",field:"id",label:"N\xB0",align:"left",sortable:!0},{name:"producto",field:"producto",label:"Producto",align:"left",sortable:!0},{name:"descripcion",field:"descripcion",label:"Descripci\xF3n",align:"left",sortable:!0}];class sa{constructor(e){G(this,"orden");G(this,"store",ko());this.orden=e}async validar(){if(this.orden.listadoProductos.length===0)throw new Error("Debe agregar al menos un producto al listado");if(this.orden.listadoProductos.some(e=>e.cantidad==0||e.cantidad==null))throw new Error("Debe ingresar una cantidad mayor a cero en todos los elementos del listado");if((this.store.esCompras&&this.orden.autorizador==this.store.user.id&&this.orden.completada||this.store.esCompras&&this.orden.autorizacion==2&&this.orden.completada)&&this.orden.listadoProductos.some(e=>e.precio_unitario==0||e.precio_unitario==0))throw new Error("Debes poner precio a todos los elementos del listado");if(!this.orden.listadoProductos.every(e=>e.hasOwnProperty("descripcion")))throw new Error("El campo descripci\xF3n es requerido en todos los elementos del listado");return!0}}function la(o,e){const w=V(),k=V([]),c=V(),q={refListadoSeleccionable:w,listadoSeleccionable:k,endpoint:e,limpiar:()=>{o.id=null,c.value=null},seleccionar:C=>{o.listadoProductos=[...o.listadoProductos,...C],o.listadoProductos.forEach(a=>{a.id=De(o.listadoProductos)+1})}},S=Ye(q);return{refListadoSeleccionable:w,listado:k,listar:C=>S.listar(c.value,C),limpiar:()=>q.limpiar(),seleccionar:C=>{C.forEach(a=>{a.cantidad=1,a.producto=a.nombre,a.porcentaje_descuento=0,a.precio_unitario=0,a.facturable=!0,a.grava_iva=!0}),q.seleccionar(C)},criterioBusqueda:c}}class na{constructor(){G(this,"SeguimientoNovedadesOrdenesCompras");this.SeguimientoNovedadesOrdenesCompras=ue(new _e("Registro de novedades de la orden de compra",Be))}}class da extends xe{constructor(){super(new na)}}var ta=me({name:"OrdenCompraPage",components:{TabLayoutFilterTabs2:Ne,EssentialSelectableTable:$e,EssentialTable:Fe,ModalesEntidad:he,EssentialPopupEditableTable:Ae,GestorArchivos:Te},emits:["actualizar","fila-modificada"],setup(){const o=new Ue(io,new wo,new ea),{entidad:e,disabled:w,accion:k,listadosAuxiliares:c,listado:q,tabs:S}=o.useReferencias(),{setValidador:U,obtenerListados:B,cargarVista:D,listar:C,consultar:a}=o.useComportamiento(),{onReestablecer:Eo,onConsultado:qo,onModificado:Oo,onGuardado:No}=o.useHooks(),{confirmar:L,prompt:lo,notificarCorrecto:Fo,notificarError:no}=je();Me().setQuasar(Co()),Qe().setQuasar(Co());const n=ko(),v=Ze(),P=ke(),to=new da,uo=ra(),mo=O(()=>e.listadoProductos.reduce((r,u)=>r+Re(u),0).toFixed(2)),Z=O(()=>e.listadoProductos.reduce((r,u)=>r+Ge(u),0).toFixed(2)),So=O(()=>e.listadoProductos.reduce((r,u)=>r+parseFloat(u.subtotal),0).toFixed(2)),Lo=O(()=>e.listadoProductos.reduce((r,u)=>r+parseFloat(u.descuento),0).toFixed(2)),po=O(()=>(Z.value*e.iva/100).toFixed(2)),Io=O(()=>(Number(Z.value)+Number(mo.value)+Number(po.value)).toFixed(2)),j=V(),W=V(),co=V("1"),y=V(),M=V(!1),$o=V(),{refListadoSeleccionable:ho,criterioBusqueda:Ao,listado:To,listar:Uo,limpiar:Bo,seleccionar:Do}=la(e,"productos"),{proveedores:bo,filtrarProveedores:jo}=Je(c),Q=V([]),I=V([]),Mo=V([]),$=V([]);D(async()=>{await B({unidades_medidas:new oa,empleados:{controller:new pe,params:{campos:"id,nombres,apellidos,cargo_id",estado:1}},autorizadores:{controller:new Xe,params:{permisos:["puede.autorizar.ordenes_compras"]}},tareas:{controller:new eo,params:{campos:"id,codigo_tarea,titulo,cliente_id",formulario:!0,empleado_id:n.user.id}},proveedores:{controller:new He,params:{}}}),e.autorizacion=1,v.preorden.id&&(e.tiene_preorden=!0,await go()),zo.find(r=>r.field==="unidad_medida").options=c.unidades_medidas.map(r=>({label:r.nombre}))}),ce(()=>{var r;return e.iva=(r=uo.configuracion)==null?void 0:r.iva}),Eo(()=>{var r;e.fecha=J(new Date().getDate().toLocaleString()),e.solicitante=n.user.id,M.value=!1,e.autorizacion=1,e.iva=(r=uo.configuracion)==null?void 0:r.iva,j.value.limpiarListado(),Y(!1)}),qo(()=>{k.value===h.editar&&(n.user.id===e.autorizador||n.esCompras||n.user.id===e.solicitante)?(M.value=!1,Y(!1)):(Y(!0),M.value=!0),setTimeout(()=>{e.id&&j.value.listarArchivosAlmacenados(e.id)},1)}),Oo(r=>{W.value=r,setTimeout(()=>fo(),1),X("1")}),No(r=>{W.value=r,setTimeout(()=>fo(),1)});const Qo={proveedor:{requiredIf:H(()=>n.esCompras&&!e.es_proveedor_internacional)},proveedor_internacional:{requiredIf:H(()=>n.esCompras&&e.es_proveedor_internacional)},autorizador:{required:so},descripcion:{required:so},forma:{requiredIf:H(()=>n.esCompras)},tiempo:{requiredIf:H(()=>n.esCompras&&e.forma!="CONTADO"&&e.forma!="TRANSFERENCIA")},fecha:{required:so}},vo=Oe(Qo,e);U(vo.value);const Ro=new sa(e);o.agregarValidaciones(Ro),e.fecha=J(new Date().getDate().toLocaleString()),e.solicitante=n.user.id;async function fo(){await j.value.subir()}function X(r){switch(co.value=r,y.value=r,r){case"2":C({autorizacion_id:r,estado_id:1,realizada:0,pagada:0,solicitante_id:n.user.id});break;case"3":C({autorizacion_id:r,"or[estado_id]":4,solicitante_id:n.user.id});break;case"4":C({realizada:1,estado_id:2,pagada:0,solicitante_id:n.user.id});break;case"5":C({realizada:1,pagada:1,solicitante_id:n.user.id});break;case"6":C({autorizacion_id:2,estado_id:2,realizada:0,pagada:0,solicitante_id:n.user.id});break;default:C({autorizacion_id:r,estado_id:1,solicitante_id:n.user.id})}}async function Y(r=!1){let u;r?u=await new eo().listar({id:e.tarea,todas:1}):u=await new eo().listar({campos:"id,codigo_tarea,titulo,cliente_id",formulario:!0,empleado_id:n.user.id}),c.tareas=u.result,$.value=c.tareas}async function Go(){const r=await new aa().listar({activo:1});c.proveedores_internacionales=r.result,Q.value=c.proveedores_internacionales}function Ko({posicion:r}){L("\xBFEst\xE1 seguro de continuar?",()=>e.listadoProductos.splice(r,1))}function Ho(){(!e.preorden||e.preorden===0)&&x()}function Jo(r){console.log(r),_(r)}function Zo(r){r?(e.proveedor=null,Q.value.length===0&&Go()):e.proveedor_internacional=null}function Wo(r,u){return Ke(r,u,Q,"nombre",c.proveedores_internacionales)}function _(r){r.precio_unitario=Number(r.precio_unitario).toFixed(4),r.iva=r.grava_iva&&r.facturable?(Number(r.cantidad)*Number(r.precio_unitario)*e.iva/100).toFixed(4):0,r.total=r.facturable?(Number(r.cantidad)*Number(r.precio_unitario)+Number(r.iva)-Number(r.descuento)).toFixed(4):0,r.descuento=r.facturable?(Number(r.subtotal)*Number(r.porcentaje_descuento|0)/100).toFixed(4):0,r.subtotal=r.facturable?(Number(r.cantidad)*Number(r.precio_unitario)).toFixed(4):0}async function go(){e.tiene_preorden=!!v.preorden.id,e.preorden=v.preorden.id,e.solicitante=Number.isInteger(v.preorden.solicitante)?v.preorden.solicitante:v.preorden.solicitante_id,e.autorizador=Number.isInteger(v.preorden.autorizador)?v.preorden.autorizador:v.preorden.autorizador_id,e.autorizacion=Number.isInteger(v.preorden.autorizacion)?v.preorden.autorizacion:v.preorden.autorizacion_id,e.fecha=J(new Date().getDate().toLocaleString()),e.descripcion=v.preorden.justificacion,e.pedido=v.preorden.pedido,e.listadoProductos=v.preorden.listadoProductos,e.listadoProductos.forEach(r=>{r.facturable=!0,r.grava_iva=!0,r.porcentaje_descuento=0,r.descuento=0})}function x(){e.hydrate(new io)}async function Xo(r){try{x(),v.preorden.hydrate(new We),await v.cargarPreorden(r),await go()}catch(u){no(""+u),x()}}function Yo(){e.listadoProductos.forEach(r=>{_(r)})}async function _o(){if(e.id_aux){const{result:r}=await new wo().consultar(e.id_aux);e.hydrate(r),e.id=null,e.solicitante=n.user.id,e.created_at=J(new Date().getDate().toLocaleString()),e.autorizacion=1,e.estado=1,e.causa_anulacion=null,e.codigo=null}else e.hydrate(new io)}const xo={titulo:"Eliminar",icono:"bi-trash",color:"negative",accion:({posicion:r})=>{Ko({posicion:r})},visible:()=>(k.value==h.nuevo||k.value==h.editar)&&(e.autorizacion==1||e.solicitante==n.user.id||n.esCoordinadorBodega||n.esCompras)},oe={titulo:"Imprimir",color:"secondary",icono:"bi-printer",accion:async({entidad:r})=>{P.idOrden=r.id,await P.imprimirPdf()},visible:()=>y.value>=2},ee={titulo:"Anular",color:"negative",icono:"bi-x",accion:async({entidad:r,posicion:u})=>{L("\xBFEst\xE1 seguro de anular la orden de compra?",()=>{lo({titulo:"Causa de anulaci\xF3n",mensaje:"Ingresa el motivo de anulaci\xF3n",accion:async oo=>{try{P.idOrden=r.id,(await P.anularOrden({motivo:oo})).status==200&&(Fo("Se ha anulado correctamente la orden de compra"),q.value.splice(u,1))}catch{no("No se pudo anular, debes ingresar un motivo para la anulaci\xF3n")}}})})},visible:({entidad:r})=>y.value==1||y.value==6?(r.autorizacion_id==1||r.autorizacion_id==2)&&(r.solicitante_id==n.user.id||r.autorizador_id==n.user.id||n.esCompras):y.value==4?n.esCompras:y.value==2&&n.esCompras||y.value==2&&(r.solicitante_id==n.user.id||r.autorizador_id==n.user.id)},ae={titulo:"Novedades",color:"warning",icono:"bi-wrench",accion:async({entidad:r})=>{console.log(r),P.idOrden=r.id,L("\xBFEst\xE1 seguro de abrir el formulario de registro de novedades de la orden de compra?",()=>{P.permitirSubir=!0,to.abrirModalEntidad("SeguimientoNovedadesOrdenesCompras")})},visible:()=>!0},re={titulo:"Enviar al proveedor",color:"primary",icono:"bi-envelope-at",accion:async({entidad:r})=>{P.idOrden=r.id,await P.enviarPdf()},visible:({entidad:r})=>y.value==2||r.estado_id===2&&y.value==6},ie={titulo:"Realizada",color:"positive",icono:"bi-check-circle-fill",accion:async({entidad:r})=>{L("\xBFEst\xE1 seguro de marcar como realizada la orden de compra?",async()=>{lo({titulo:"Observaci\xF3n",mensaje:"\xBFTienes alguna observaci\xF3n al respecto?",accion:async R=>{P.idOrden=r.id,await P.marcarRealizada({observacion_realizada:R})}})})},visible:()=>y.value==6&&n.esCompras},se={titulo:"Pagada",color:"positive",icono:"bi-check-circle-fill",accion:async({entidad:r})=>{L("\xBFEst\xE1 seguro de marcar como pagada la orden de compra?",async()=>{P.idOrden=r.id,await P.marcarPagada(),await X("5")})},visible:()=>y.value==4&&n.esContabilidad},le={titulo:"Editar",icono:"bi-pencil-square",color:"secondary",tooltip:"Editar Orden de Compra",accion:({entidad:r})=>{console.log("diste clic en editar"),k.value=h.editar,a(r),S.value="formulario"},visible:({entidad:r})=>(y.value=="1"||y.value=="2")&&r.autorizacion==yo.pendiente&&(n.esCompras||r.solicitante_id==n.user.id||r.autorizador_id==n.user.id)?!0:(y.value=="1"||y.value=="2")&&r.autorizacion==yo.aprobado&&(n.esCompras||r.autorizador_id==n.user.id)};return I.value=c.empleados,bo.value=c.proveedores,Mo.value=c.autorizadores,$.value=c.tareas,{mixin:o,orden:e,disabled:w,accion:k,v$:vo,acciones:h,configuracionColumnas:Ee,accionesTabla:be,configuracionColumnasDetallesProductos:ia,configuracionColumnasProductos:qe,configuracionColumnasItemOrdenCompra:zo,refItems:$o,empleados:I,proveedores:bo,proveedores_internacionales:Q,autorizaciones:ve,tareas:$,estados:fe,opcionesForma:Se,opcionesTiempo:Le,store:n,preorden:v.preorden,modales:to,soloLectura:M,btnEliminarFila:xo,btnImprimir:oe,btnAnularOrden:ee,btnEnviarMailProveedor:re,btnRegistrarNovedades:ae,btnMarcarRealizada:ie,btnMarcarPagada:se,btnEditarRegistro:le,refListado:ho,criterioBusquedaProducto:Ao,listadoProductos:To,listarProductos:Uo,limpiarProducto:Bo,seleccionarProducto:Do,tabOptionsOrdenCompra:Ie,tabDefecto:co,refArchivo:j,idOrden:W,checkEsProveedorInternacional:Zo,filtrarProveedoresInternacionales:Wo,filtrarOrdenes:X,calcularValores:_,guardarFilaEditada:Jo,filtrarProveedores:jo,llenarOrden:Xo,actualizarPreorden:Ho,actualizarListado:Yo,cargarOrdenBD:_o,filtrarTareas(r,u){r===""&&u(()=>$.value=c.tareas),u(()=>{const R=r.toLowerCase();$.value=c.tareas.filter(oo=>oo.codigo_tarea.toLowerCase().indexOf(R)>-1)})},filtrarAutorizadores(){const r=c.autorizadores.map(u=>u.id);I.value=I.value.filter(u=>r.includes(u.id||e.autorizador))},reestablecerEmpleados(){I.value=c.empleados},subtotal_sin_impuestos:mo,subtotal_con_impuestos:Z,subtotal:So,total:Io,descuento:Lo,iva:po}}});const ua={class:"row q-col-gutter-sm q-py-md"},ma={key:0,class:"col-12 col-md-3"},pa={key:1,class:"col-12 col-md-3"},ca={key:2,class:"col-12 col-md-3"},ba={class:"col-12 col-md-3"},va={key:3,class:"col-12 col-md-3 q-mb-xl"},fa={key:4,class:"col-12 col-md-3"},ga={class:"col-12 col-md-3"},Ca={class:"error-msg"},ya={key:5,class:"col-12 col-md-3 q-mb-md"},Va={key:6,class:"col-12 col-md-3"},Pa={key:7,class:"col-12 col-md-3 q-mb-md"},za={key:8,class:"col-12 col-md-3 q-mb-md"},wa={key:9,class:"col-12 col-md-3"},ka={class:"col-12 col-md-3 col-sm-3"},Ea={key:10,class:"col-12 col-md-3"},qa={key:11,class:"col-12 col-md-3"},Oa={class:"error-msg"},Na={class:"col-12 col-md-6"},Fa={class:"error-msg"},Sa={class:"col-12 col-md-3"},La={class:"error-msg"},Ia={key:12,class:"col-12 col-md-3"},$a={class:"error-msg"},ha={key:13,class:"col-12 col-md-3 q-mb-md"},Aa={key:14,class:"col-12 col-md-3 q-mb-md"},Ta={key:15,class:"col-12 col-md-3 q-mb-xl"},Ua={class:"col-12 col-md-3 q-mb-md"},Ba={key:16,class:"col-12 col-md-3"},Da={key:17,class:"col-12 col-md-3 q-mb-xl"},ja={class:"col-12 q-mb-md"},Ma={class:"col-12 col-md-12"},Qa={class:"row q-col-gutter-x-xs"},Ra={class:"col-12 col-md-10 q-mb-md"},Ga={class:"col-12 col-md-2"},Ka={class:"col-12"},Ha={class:"col-12"},Ja={class:"row q-col-xs-4 q-col-xs-offset-8 flex-end justify-end"};function Za(o,e,w,k,c,q){const S=A("gestor-archivos"),U=A("essential-popup-editable-table"),B=A("essential-selectable-table"),D=A("tab-layout-filter-tabs2"),C=A("modales-entidad");return d(),t(N,null,[i(D,{mixin:o.mixin,configuracionColumnas:o.configuracionColumnas,"titulo-pagina":"Orden de Compra","tab-options":o.tabOptionsOrdenCompra,ajustarCeldas:!0,tabDefecto:o.tabDefecto,filtrar:o.filtrarOrdenes,permitirEditar:!1,permitirEliminar:!1,accion1:o.btnEditarRegistro,accion2:o.btnEnviarMailProveedor,accion3:o.btnAnularOrden,accion4:o.btnMarcarRealizada,accion5:o.btnMarcarPagada,accion6:o.btnRegistrarNovedades,accion7:o.btnImprimir},{formulario:s(()=>[i(we,{onSubmit:e[31]||(e[31]=Ce(()=>{},["prevent"]))},{default:s(()=>[l("div",ua,[o.orden.id?(d(),t("div",ma,[e[32]||(e[32]=l("label",{class:"q-mb-sm block"},"Orden N\xB0",-1)),i(z,{modelValue:o.orden.id,"onUpdate:modelValue":e[0]||(e[0]=a=>o.orden.id=a),placeholder:"Obligatorio",disable:o.disabled||o.soloLectura,readonly:o.disabled||o.soloLectura,outlined:"",dense:""},null,8,["modelValue","disable","readonly"])])):b("",!0),o.orden.created_at?(d(),t("div",pa,[e[33]||(e[33]=l("label",{class:"q-mb-sm block"},"Fecha de creaci\xF3n",-1)),i(z,{modelValue:o.orden.created_at,"onUpdate:modelValue":e[1]||(e[1]=a=>o.orden.created_at=a),disable:"",outlined:"",dense:""},null,8,["modelValue"])])):b("",!0),o.orden.solicitante?(d(),t("div",ca,[e[35]||(e[35]=l("label",{class:"q-mb-sm block"},"Solicitante",-1)),i(E,{modelValue:o.orden.solicitante,"onUpdate:modelValue":e[2]||(e[2]=a=>o.orden.solicitante=a),options:o.empleados,"transition-show":"scale","transition-hide":"scale","options-dense":"",dense:"",outlined:"",disable:!0,readonly:o.disabled||o.soloLectura,"option-label":a=>a.apellidos+" "+a.nombres,"option-value":a=>a.id,"emit-value":"","map-options":""},{"no-option":s(()=>[i(g,null,{default:s(()=>[i(p,{class:"text-grey"},{default:s(()=>e[34]||(e[34]=[m(" No hay resultados ")])),_:1})]),_:1})]),_:1},8,["modelValue","options","readonly","option-label","option-value"])])):b("",!0),l("div",ba,[e[36]||(e[36]=l("label",{class:"q-mb-sm block"},"Fecha",-1)),i(z,{modelValue:o.orden.fecha,"onUpdate:modelValue":e[3]||(e[3]=a=>o.orden.fecha=a),placeholder:"Obligatorio",disable:"",readonly:o.disabled||o.soloLectura,outlined:"",dense:""},null,8,["modelValue","readonly"])]),o.accion===o.acciones.nuevo?(d(),t("div",va,[i(ao,{class:"q-mt-lg q-pt-md",modelValue:o.orden.copia_orden,"onUpdate:modelValue":e[4]||(e[4]=a=>o.orden.copia_orden=a),label:"\xBFCopiar orden de compra?",disable:o.disabled||o.soloLectura,outlined:"",dense:""},null,8,["modelValue","disable"])])):b("",!0),o.orden.copia_orden?(d(),t("div",fa,[e[37]||(e[37]=l("label",{class:"q-mb-sm block"},"Id Orden de Compra",-1)),i(z,{type:"number",modelValue:o.orden.id_aux,"onUpdate:modelValue":e[5]||(e[5]=a=>o.orden.id_aux=a),placeholder:"Obligatorio",hint:"Ingresa un numero de OC y presiona Enter",onKeyup:ro(o.cargarOrdenBD,["enter"]),disable:o.disabled||o.soloLectura||o.orden.autorizador===o.store.user.id,outlined:"",dense:""},null,8,["modelValue","onKeyup","disable"])])):b("",!0),l("div",ga,[e[39]||(e[39]=l("label",{class:"q-mb-sm block"},"Persona que autoriza",-1)),i(E,{modelValue:o.orden.autorizador,"onUpdate:modelValue":e[6]||(e[6]=a=>o.orden.autorizador=a),options:o.empleados,"transition-show":"jump-up","transition-hide":"jump-up","options-dense":"",dense:"",outlined:"",onPopupShow:o.filtrarAutorizadores,onPopupHide:o.reestablecerEmpleados,error:!!o.v$.autorizador.$errors.length,"error-message":"Debes seleccionar al menos una opcion",disable:o.disabled||o.soloLectura||o.orden.tiene_preorden||o.accion==o.acciones.editar&&o.store.esCompras,"option-label":a=>a.nombres+" "+a.apellidos,"option-value":a=>a.id,"emit-value":"","map-options":""},{error:s(()=>[(d(!0),t(N,null,T(o.v$.autorizador.$errors,a=>(d(),t("div",{key:a.$uid},[l("div",Ca,f(a.$message),1)]))),128))]),"no-option":s(()=>[i(g,null,{default:s(()=>[i(p,{class:"text-grey"},{default:s(()=>e[38]||(e[38]=[m(" No hay resultados ")])),_:1})]),_:1})]),_:1},8,["modelValue","options","onPopupShow","onPopupHide","error","disable","option-label","option-value"])]),o.orden.autorizador?(d(),t("div",ya,[e[41]||(e[41]=l("label",{class:"q-mb-sm block"},"Autorizacion",-1)),i(E,{modelValue:o.orden.autorizacion,"onUpdate:modelValue":e[7]||(e[7]=a=>o.orden.autorizacion=a),options:o.autorizaciones,"transition-show":"jum-up","transition-hide":"jump-down","options-dense":"",dense:"",outlined:"",disable:o.disabled||o.orden.tiene_preorden||o.orden.autorizador!==o.store.user.id,"option-value":a=>a.id,"option-label":a=>a.nombre,"emit-value":"","map-options":""},{"no-option":s(()=>[i(g,null,{default:s(()=>[i(p,{class:"text-grey"},{default:s(()=>e[40]||(e[40]=[m(" No hay resultados ")])),_:1})]),_:1})]),_:1},8,["modelValue","options","disable","option-value","option-label"])])):b("",!0),o.store.user.id===o.orden.autorizador||o.orden.observacion_aut?(d(),t("div",Va,[e[42]||(e[42]=l("label",{class:"q-mb-sm block"},"Observacion",-1)),i(z,{autogrow:"",modelValue:o.orden.observacion_aut,"onUpdate:modelValue":e[8]||(e[8]=a=>o.orden.observacion_aut=a),placeholder:"Opcional",disable:o.disabled||o.soloLectura&&!(o.esCoordinador||o.esActivosFijos||o.store.user.id==o.orden.autorizador),outlined:"",dense:""},null,8,["modelValue","disable"])])):b("",!0),o.orden.preorden||o.accion==o.acciones.nuevo?(d(),t("div",Pa,[e[43]||(e[43]=l("label",{class:"q-mb-sm block"},"N\xB0 preorden",-1)),i(z,{type:"number",modelValue:o.orden.preorden,"onUpdate:modelValue":[e[9]||(e[9]=a=>o.orden.preorden=a),o.actualizarPreorden],placeholder:"Opcional",hint:"Ingresa un numero de preorden y presiona Enter",onKeyup:e[10]||(e[10]=ro(a=>o.llenarOrden(o.orden.preorden),["enter"])),disable:o.disabled||o.soloLectura,outlined:"",dense:""},null,8,["modelValue","onUpdate:modelValue","disable"])])):b("",!0),o.orden.pedido||o.accion==o.acciones.nuevo?(d(),t("div",za,[e[44]||(e[44]=l("label",{class:"q-mb-sm block"},"N\xB0 pedido",-1)),i(z,{type:"number",modelValue:o.orden.pedido,"onUpdate:modelValue":e[11]||(e[11]=a=>o.orden.pedido=a),placeholder:"Opcional",hint:"Este es un campo opcional",disable:o.disabled||o.soloLectura,outlined:"",dense:""},null,8,["modelValue","disable"])])):b("",!0),o.orden.tarea||o.accion==o.acciones.nuevo?(d(),t("div",wa,[e[46]||(e[46]=l("label",{class:"q-mb-sm block"},"N\xB0 Tarea",-1)),i(E,{modelValue:o.orden.tarea,"onUpdate:modelValue":e[12]||(e[12]=a=>o.orden.tarea=a),options:o.tareas,"transition-show":"jump-up","transition-hide":"jump-up","options-dense":"",dense:"",outlined:"","use-input":"","input-debounce":"0",onFilter:o.filtrarTareas,hint:"Opcional",disable:o.disabled||o.soloLectura||o.orden.tiene_preorden,"option-label":a=>a.codigo_tarea+" - "+a.titulo,"option-value":a=>a.id,"emit-value":"","map-options":""},{option:s(a=>[i(g,Vo(Po(a.itemProps)),{default:s(()=>[i(p,null,{default:s(()=>[i(K,null,{default:s(()=>[m(f(a.opt.codigo_tarea),1)]),_:2},1024),i(K,{caption:""},{default:s(()=>[m(f(a.opt.titulo),1)]),_:2},1024)]),_:2},1024)]),_:2},1040)]),"no-option":s(()=>[i(g,null,{default:s(()=>[i(p,{class:"text-grey"},{default:s(()=>e[45]||(e[45]=[m(" No hay resultados ")])),_:1})]),_:1})]),_:1},8,["modelValue","options","onFilter","disable","option-label","option-value"])])):b("",!0),l("div",ka,[e[47]||(e[47]=l("label",{class:"q-mb-sm block"},"Tipo de Proveedor",-1)),i(ye,{label:o.orden.es_proveedor_internacional?"INTERNACIONAL":"NACIONAL",modelValue:o.orden.es_proveedor_internacional,"onUpdate:modelValue":[e[13]||(e[13]=a=>o.orden.es_proveedor_internacional=a),o.checkEsProveedorInternacional],color:"primary","keep-color":"",icon:"bi-check2-circle","unchecked-icon":"clear",disable:o.disabled},null,8,["label","modelValue","onUpdate:modelValue","disable"])]),o.orden.es_proveedor_internacional?b("",!0):(d(),t("div",Ea,[e[49]||(e[49]=l("label",{class:"q-mb-sm block"},"Proveedor",-1)),i(E,{modelValue:o.orden.proveedor,"onUpdate:modelValue":e[14]||(e[14]=a=>o.orden.proveedor=a),options:o.proveedores,"transition-show":"jump-up","transition-hide":"jump-up","options-dense":"",dense:"",outlined:"","use-input":"","input-debounce":"0",onFilter:o.filtrarProveedores,error:!!o.v$.proveedor.$errors.length,"error-message":"Debes seleccionar al menos una opcion",disable:o.disabled||o.soloLectura,"option-label":a=>a.razon_social+" - "+a.sucursal,"option-value":a=>a.id,"emit-value":"","map-options":""},{option:s(a=>[i(g,Vo(Po(a.itemProps)),{default:s(()=>[i(p,null,{default:s(()=>[i(K,null,{default:s(()=>[m(f(a.opt.razon_social),1)]),_:2},1024),i(K,{caption:""},{default:s(()=>[m(f(a.opt.nombre_comercial)+" - Sucursal: "+f(a.opt.sucursal||a.opt.direccion),1)]),_:2},1024)]),_:2},1024)]),_:2},1040)]),"no-option":s(()=>[i(g,null,{default:s(()=>[i(p,{class:"text-grey"},{default:s(()=>e[48]||(e[48]=[m(" No hay resultados ")])),_:1})]),_:1})]),_:1},8,["modelValue","options","onFilter","error","disable","option-label","option-value"])])),o.orden.es_proveedor_internacional?(d(),t("div",qa,[e[51]||(e[51]=l("label",{class:"q-mb-sm block"},"Proveedor Internacional",-1)),i(E,{modelValue:o.orden.proveedor_internacional,"onUpdate:modelValue":e[15]||(e[15]=a=>o.orden.proveedor_internacional=a),options:o.proveedores_internacionales,"transition-show":"jump-up","transition-hide":"jump-up","options-dense":"",dense:"",outlined:"","use-input":"","input-debounce":"0",onFilter:o.filtrarProveedoresInternacionales,error:!!o.v$.proveedor_internacional.$errors.length,"error-message":"Debes seleccionar al menos una opcion",disable:o.disabled||o.soloLectura,"option-label":a=>a.nombre,"option-value":a=>a.id,"emit-value":"","map-options":""},{error:s(()=>[(d(!0),t(N,null,T(o.v$.proveedor_internacional.$errors,a=>(d(),t("div",{key:a.$uid},[l("div",Oa,f(a.$message),1)]))),128))]),"no-option":s(()=>[i(g,null,{default:s(()=>[i(p,{class:"text-grey"},{default:s(()=>e[50]||(e[50]=[m(" No hay resultados ")])),_:1})]),_:1})]),_:1},8,["modelValue","options","onFilter","error","disable","option-label","option-value"])])):b("",!0),l("div",Na,[e[52]||(e[52]=l("label",{class:"q-mb-sm block"},"Descripci\xF3n",-1)),i(z,{type:"textarea",autogrow:"",modelValue:o.orden.descripcion,"onUpdate:modelValue":e[16]||(e[16]=a=>o.orden.descripcion=a),placeholder:"Obligatorio",disable:o.disabled||o.soloLectura||o.accion==o.acciones.editar&&o.store.esCompras,error:!!o.v$.descripcion.$errors.length,outlined:"",dense:""},{error:s(()=>[(d(!0),t(N,null,T(o.v$.descripcion.$errors,a=>(d(),t("div",{key:a.$uid},[l("div",Fa,f(a.$message),1)]))),128))]),_:1},8,["modelValue","disable","error"])]),l("div",Sa,[e[54]||(e[54]=l("label",{class:"q-mb-sm block"},"Forma",-1)),i(E,{modelValue:o.orden.forma,"onUpdate:modelValue":e[17]||(e[17]=a=>o.orden.forma=a),options:o.opcionesForma,"transition-show":"jump-up","transition-hide":"jump-up","options-dense":"",dense:"",outlined:"",error:!!o.v$.forma.$errors.length,disable:o.disabled||o.soloLectura,"option-label":a=>a.label,"option-value":a=>a.value,"emit-value":"","map-options":""},{"no-option":s(()=>[i(g,null,{default:s(()=>[i(p,{class:"text-grey"},{default:s(()=>e[53]||(e[53]=[m(" No hay resultados ")])),_:1})]),_:1})]),error:s(()=>[(d(!0),t(N,null,T(o.v$.forma.$errors,a=>(d(),t("div",{key:a.$uid},[l("div",La,f(a.$message),1)]))),128))]),_:1},8,["modelValue","options","error","disable","option-label","option-value"])]),o.orden.tiempo||o.accion==o.acciones.nuevo||o.accion==o.acciones.editar?(d(),t("div",Ia,[e[56]||(e[56]=l("label",{class:"q-mb-sm block"},"Tiempo",-1)),i(E,{modelValue:o.orden.tiempo,"onUpdate:modelValue":e[18]||(e[18]=a=>o.orden.tiempo=a),options:o.opcionesTiempo,"transition-show":"jump-up","transition-hide":"jump-up","options-dense":"",dense:"",outlined:"",error:!!o.v$.tiempo.$errors.length,disable:o.disabled||o.soloLectura,readonly:o.disabled||o.soloLectura,"option-label":a=>a.label,"option-value":a=>a.value,"emit-value":"","map-options":""},{"no-option":s(()=>[i(g,null,{default:s(()=>[i(p,{class:"text-grey"},{default:s(()=>e[55]||(e[55]=[m(" No hay resultados ")])),_:1})]),_:1})]),error:s(()=>[(d(!0),t(N,null,T(o.v$.tiempo.$errors,a=>(d(),t("div",{key:a.$uid},[l("div",$a,f(a.$message),1)]))),128))]),_:1},8,["modelValue","options","error","disable","readonly","option-label","option-value"])])):b("",!0),o.orden.estado||o.accion===o.acciones.consultar?(d(),t("div",ha,[e[57]||(e[57]=l("label",{class:"q-mb-sm block"},"Estado de la Orden de Compra",-1)),i(E,{modelValue:o.orden.estado,"onUpdate:modelValue":e[19]||(e[19]=a=>o.orden.estado=a),options:o.estados,"transition-show":"jum-up","transition-hide":"jump-down","options-dense":"",dense:"",outlined:"",disable:"","option-value":a=>a.id,"option-label":a=>a.nombre,"emit-value":"","map-options":""},null,8,["modelValue","options","option-value","option-label"])])):b("",!0),o.orden.causa_anulacion?(d(),t("div",Aa,[e[58]||(e[58]=l("label",{class:"q-mb-sm block"},"Causa de anulaci\xF3n",-1)),i(z,{modelValue:o.orden.causa_anulacion,"onUpdate:modelValue":e[20]||(e[20]=a=>o.orden.causa_anulacion=a),autogrow:"",outlined:"",dense:"",disable:""},null,8,["modelValue"])])):b("",!0),o.accion==o.acciones.nuevo||o.accion==o.acciones.editar?(d(),t("div",Ta,[i(ao,{class:"q-mt-lg q-pt-md",modelValue:o.orden.modificar_iva,"onUpdate:modelValue":e[21]||(e[21]=a=>o.orden.modificar_iva=a),label:"Modificar IVA establecido",disable:o.disabled||o.soloLectura,outlined:"",dense:""},null,8,["modelValue","disable"])])):b("",!0),l("div",Ua,[e[59]||(e[59]=l("label",{class:"q-mb-sm block"},"IVA general",-1)),i(z,{modelValue:o.orden.iva,"onUpdate:modelValue":[e[22]||(e[22]=a=>o.orden.iva=a),o.actualizarListado],outlined:"",dense:"",type:"number",step:".01",suffix:"%",disable:!o.orden.modificar_iva},null,8,["modelValue","disable","onUpdate:modelValue"])]),o.orden.observacion_realizada?(d(),t("div",Ba,[e[60]||(e[60]=l("label",{class:"q-mb-sm block"},"Observacion realizada",-1)),i(z,{autogrow:"",modelValue:o.orden.observacion_realizada,"onUpdate:modelValue":e[23]||(e[23]=a=>o.orden.observacion_realizada=a),placeholder:"Opcional",disable:"",outlined:"",dense:""},null,8,["modelValue"])])):b("",!0),(o.accion==o.acciones.nuevo||o.accion==o.acciones.editar)&&o.store.esCompras?(d(),t("div",Da,[i(ao,{class:"q-mt-lg q-pt-md",modelValue:o.orden.completada,"onUpdate:modelValue":e[24]||(e[24]=a=>o.orden.completada=a),label:"Marcar como completada",disable:o.disabled,outlined:"",dense:""},null,8,["modelValue","disable"])])):b("",!0),l("div",ja,[i(S,{ref:"refArchivo",label:"Adjuntar archivos/proformas",mixin:o.mixin,disable:o.disabled,listarAlGuardar:!1,"permitir-eliminar":o.accion==o.acciones.nuevo||o.accion==o.acciones.editar,idModelo:o.idOrden},{"boton-subir":s(()=>[b("",!0)]),_:1},8,["mixin","disable","permitir-eliminar","idModelo"])]),l("div",Ma,[e[63]||(e[63]=l("label",{class:"q-mb-sm block"},"Agregar productos",-1)),l("div",Qa,[l("div",Ra,[i(z,{modelValue:o.criterioBusquedaProducto,"onUpdate:modelValue":e[26]||(e[26]=a=>o.criterioBusquedaProducto=a),disable:o.disabled,placeholder:"Nombre de producto",hint:"Presiona Enter para seleccionar un producto",onKeydown:e[27]||(e[27]=ro(a=>o.listarProductos({search:o.criterioBusquedaProducto,filtrarTipo:1}),["enter"])),onBlur:e[28]||(e[28]=a=>o.criterioBusquedaProducto===""?o.limpiarProducto():null),outlined:"",dense:""},null,8,["modelValue","disable"])]),l("div",Ga,[i(Pe,{onClick:e[29]||(e[29]=a=>o.listarProductos({search:o.criterioBusquedaProducto,filtrarTipo:1})),icon:"search",unelevated:"",color:"positive",class:"full-width",style:{height:"40px"},disable:o.disabled,"no-caps":"",glossy:""},{default:s(()=>e[62]||(e[62]=[m("Buscar")])),_:1},8,["disable"])])])]),l("div",Ka,[i(U,{ref:"refItems",titulo:"Productos Seleccionados",configuracionColumnas:o.accion==o.acciones.nuevo||o.accion==o.acciones.editar&&(o.orden.autorizador==o.store.user.id||o.orden.solicitante==o.store.user.id||o.store.esCompras)?[...o.configuracionColumnasItemOrdenCompra,o.accionesTabla]:o.configuracionColumnasItemOrdenCompra,datos:o.orden.listadoProductos,separador:"cell",permitirEditarCeldas:o.accion==o.acciones.nuevo||o.accion==o.acciones.editar&&(o.orden.autorizador==o.store.user.id||o.orden.solicitante==o.store.user.id||o.store.esCompras)&&(o.orden.autorizacion==1||o.store.esCompras),permitirEditarModal:!0,permitirConsultar:!1,permitirEditar:o.accion==o.acciones.nuevo||o.accion==o.acciones.editar&&(o.orden.autorizador==o.store.user.id||o.orden.solicitante==o.store.user.id||o.store.esCompras)&&(o.orden.autorizacion==1||o.store.esCompras),permitirEliminar:!1,altoFijo:!1,accion1:o.btnEliminarFila,onGuardarFila:e[30]||(e[30]=a=>o.guardarFilaEditada(a)),onFilaModificada:o.calcularValores},null,8,["configuracionColumnas","datos","permitirEditarCeldas","permitirEditar","accion1","onFilaModificada"])]),l("div",Ha,[l("div",Ja,[o.orden.listadoProductos.length>0?(d(),Ve(ze,{key:0,bordered:"",separator:"",dense:""},{default:s(()=>[i(g,null,{default:s(()=>[i(p,null,{default:s(()=>e[64]||(e[64]=[m("Subtotal: ")])),_:1}),i(F,{vertical:""}),i(p,{avatar:""},{default:s(()=>[m(f(o.subtotal),1)]),_:1})]),_:1}),i(g,null,{default:s(()=>[i(p,null,{default:s(()=>e[65]||(e[65]=[m("Subtotal 0%: ")])),_:1}),i(F,{vertical:""}),i(p,{avatar:""},{default:s(()=>[m(f(o.subtotal_sin_impuestos),1)]),_:1})]),_:1}),i(g,null,{default:s(()=>[i(p,null,{default:s(()=>[m("Subtotal ("+f(o.orden.iva)+" %): ",1)]),_:1}),i(F,{vertical:""}),i(p,{avatar:""},{default:s(()=>[m(f(o.subtotal_con_impuestos),1)]),_:1})]),_:1}),i(g,null,{default:s(()=>[i(p,{class:"q-mr-md"},{default:s(()=>e[66]||(e[66]=[m("Descuento: ")])),_:1}),i(F,{vertical:""}),i(p,{avatar:""},{default:s(()=>[m(f(o.descuento),1)]),_:1})]),_:1}),i(g,null,{default:s(()=>[i(p,null,{default:s(()=>[m("IVA ("+f(o.orden.iva)+" %): ",1)]),_:1}),i(F,{vertical:""}),i(p,{avatar:""},{default:s(()=>[m(f(o.iva),1)]),_:1})]),_:1}),i(g,null,{default:s(()=>[i(p,null,{default:s(()=>e[67]||(e[67]=[m("Total: ")])),_:1}),i(F,{vertical:""}),i(p,{avatar:""},{default:s(()=>[m(f(o.total),1)]),_:1})]),_:1})]),_:1})):b("",!0)])])])]),_:1}),i(B,{ref:"refListado","configuracion-columnas":o.configuracionColumnasProductos,separador:"cell",datos:o.listadoProductos,"tipo-seleccion":"multiple",onSelected:o.seleccionarProducto},null,8,["configuracion-columnas","datos","onSelected"])]),_:1},8,["mixin","configuracionColumnas","tab-options","tabDefecto","filtrar","accion1","accion2","accion3","accion4","accion5","accion6","accion7"]),i(C,{comportamiento:o.modales,persistente:!1},null,8,["comportamiento"])],64)}var ei=ge(ta,[["render",Za]]);export{ei as default};
