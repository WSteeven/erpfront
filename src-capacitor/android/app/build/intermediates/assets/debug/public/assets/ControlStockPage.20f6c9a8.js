var F=Object.defineProperty;var h=(e,o,a)=>o in e?F(e,o,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[o]=a;var c=(e,o,a)=>(h(e,typeof o!="symbol"?o+"":o,a),a);import{Q as O,a as A}from"./QItemSection.9a955ec6.js";import{Q as S}from"./QSelect.6ce302d7.js";import{bw as Q,s as q,l as R,c as _,A as T,bE as z,d as B,cs as H,_ as G,t as K,v as m,P as j,F as r,z as i,y as s,D as L,x as b,H as w,G as y,I as P,a4 as J,K as $}from"./index.6449c167.js";import{Q as X}from"./QForm.ca56f146.js";import{r as E}from"./index.0198dd12.js";import{u as W}from"./index.490dde02.js";import{T as Y}from"./TabLayout.0bce4313.js";import{M as Z}from"./ModalEntidad.168b465e.js";import{C as x}from"./ContenedorSimpleMixin.09c9bed5.js";import{D as oo}from"./DetalleProductoController.ecbb9995.js";import{E as eo}from"./entidadAuditable.75a46700.js";import{C as lo}from"./ClienteController.33eca86a.js";import{P as so}from"./ProductoController.5697e6d7.js";import{a as M,S as to,w as ao}from"./utils.521b98f3.js";import{u as ro}from"./filtrosListadosGenerales.c3aa2da3.js";import"./QChip.95469f73.js";import"./position-engine.70d0a89f.js";import"./format.8ac60962.js";import"./QTabs.6c234f27.js";import"./QResizeObserver.9af84680.js";import"./QTabPanels.49d2362a.js";import"./touch.9135741d.js";import"./QPopupProxy.72ff1d6d.js";import"./QPage.5d173a8a.js";import"./buttonSubmits.fe817da3.js";import"./EssentialTable.00c17e97.js";import"./QToolbar.8dbe891b.js";import"./use-fullscreen.a7661f85.js";import"./QBadge.e6f320cd.js";import"./_commonjsHelpers.8402d862.js";import"./QImg.fd079679.js";import"./QFile.90d9394a.js";import"./VisorImagen.75b3c53f.js";import"./logo.4781eea2.js";import"./seleccionContratacionPersonal.utils.e3e1ed3d.js";import"./i18n-validators.29e2545c.js";import"./EssentialTablePagination.d5c1010a.js";import"./configuracion_general.37a05c0a.js";import"./ConfiguracionController.c50d9536.js";const io=[{name:"sucursal_id",field:"sucursal_id",label:"sucursal",align:"left",sortable:!0},{name:"detalle_id",field:"detalle_id",label:"detalle",align:"left",sortable:!0},{name:"cliente_id",field:"cliente_id",label:"Cliente",align:"left",sortable:!0},{name:"minimo",field:"minimo",label:"minimo",align:"left",sortable:!0},{name:"reorden",field:"reorden",label:"reorden",align:"left",sortable:!0},{name:"actual",field:"actual",label:"En inventario",align:"left",sortable:!0},{name:"estado",field:"estado",label:"estado",align:"left",sortable:!0}];class no extends Q{constructor(){super(q.control_stocks)}}class uo extends eo{constructor(){super();c(this,"producto");c(this,"sucursal_id");c(this,"detalle_id");c(this,"cliente_id");c(this,"minimo");c(this,"reorden");c(this,"actual");c(this,"estado");this.producto=null,this.sucursal_id=null,this.detalle_id=null,this.cliente_id=null,this.minimo=null,this.reorden=null,this.actual=null,this.estado=null}}const co=R("controlStock",()=>{const e=_([]),{notificarError:o}=M(),a=new to;async function t(){try{a.activar();const n=T.getInstance(),f=z.URL_BASE+"/"+n.getEndpoint(q.items_control_stocks_consolidados),l=await n.get(f);e.value=l.data.results}catch(n){o(n)}finally{a.desactivar()}}async function k(n){console.log("Diste clic en crearOrdenCompraConsolidada"),console.log("Data recibida",n)}return{listadoItems:e,consolidarItems:t,crearOrdenCompraConsolidada:k}});var mo=B({components:{TabLayout:Y,ModalesEntidad:Z},setup(){const e=new x(uo,new no),{entidad:o,disabled:a,listadosAuxiliares:t}=e.useReferencias(),{setValidador:k,obtenerListados:n,cargarVista:f,listar:l}=e.useComportamiento();M(),co();const v=_([]),C=_([]),p=_([]),{clientes:I}=ro(t);f(async()=>{await n({sucursales:{controller:new H,params:{campos:"id,lugar,cliente_id"}},productos:{controller:new so,params:{campos:"id,nombre"}},detalles:{controller:new oo,params:{campos:"id,producto_id,descripcion,modelo_id,serial"}},clientes:{controller:new lo,params:{campos:"id,razon_social",requiere_bodega:1,estado:1}}})});const D=W({sucursal_id:{required:E},detalle_id:{required:E},cliente_id:{required:E}},o);k(D.value);const N={titulo:"Actualizar",tooltip:"Actualizar listado",icono:"bi-arrow-clockwise",accion:()=>{l()}},U=[{nombre:"SUFICIENTE",valor:"STOCK SUFICIENTE"},{nombre:"REORDEN",valor:"PROXIMO A AGOTARSE"},{nombre:"MINIMO",valor:"DEBAJO DEL MINIMO"}];return v.value=t.sucursales,C.value=t.productos,p.value=t.detalles,I.value=t.clientes,{mixin:e,stock:o,v$:D,disabled:a,configuracionColumnas:io,opciones_estados:U,opciones_sucursales:v,opciones_productos:C,opciones_detalles:p,clientes:I,ordenarLista:ao,filtroProductos(d,u){if(d===""){u(()=>{C.value=t.productos});return}u(()=>{const g=d.toLowerCase();C.value=t.productos.filter(V=>V.nombre.toLowerCase().indexOf(g)>-1)})},seleccionarDetalle(d){p.value=t.detalles.filter(u=>u.producto_id===d),o.detalle_id=null,p.value.length<1&&(o.detalle_id=null),p.value.length==1&&(o.detalle_id=p.value[0].id)},seleccionarPropietario(d){const u=v.value.filter(g=>g.id===d);o.cliente_id=u[0].cliente_id},filtrarSucursales(d,u){if(d===""){u(()=>{v.value=t.sucursales});return}u(()=>{const g=d.toLowerCase();v.value=t.sucursales.filter(V=>V.lugar.toLowerCase().indexOf(g)>-1)})},btnActualizarStock:N}}});const po={class:"row q-col-gutter-sm q-py-md"},bo={class:"col-12 col-md-6"},fo={class:"col-12 col-md-6"},vo={class:"error-msg"},go={class:"col-12 col-md-6 q-mb-md"},ko={class:"error-msg"},Co={class:"col-12 col-md-6 q-mb-md"},So={class:"error-msg"},_o={class:"col-12 col-md-6"},Vo={class:"col-12 col-md-6"};function wo(e,o,a,t,k,n){const f=K("tab-layout");return m(),j(f,{mixin:e.mixin,configuracionColumnas:e.configuracionColumnas,"titulo-pagina":"Control de stock",ajustarCeldas:!0,accion1Header:e.btnActualizarStock},{formulario:r(()=>[i(X,{onSubmit:o[7]||(o[7]=J(()=>{},["prevent"]))},{default:r(()=>[s("div",po,[s("div",bo,[o[9]||(o[9]=s("label",{class:"q-mb-sm block"},"Producto",-1)),i(S,{modelValue:e.stock.producto,"onUpdate:modelValue":[o[0]||(o[0]=l=>e.stock.producto=l),e.seleccionarDetalle],options:e.opciones_productos,"transition-show":"scale","transition-hide":"scale","options-dense":"",dense:"",outlined:"","use-input":"","input-debounce":"0",onFilter:e.filtroProductos,"option-label":l=>l.nombre,"option-value":l=>l.id,"emit-value":"","map-options":""},{"no-option":r(()=>[i(O,null,{default:r(()=>[i(A,{class:"text-grey"},{default:r(()=>o[8]||(o[8]=[L(" No hay resultados ")])),_:1})]),_:1})]),_:1},8,["modelValue","options","onFilter","onUpdate:modelValue","option-label","option-value"])]),s("div",fo,[o[11]||(o[11]=s("label",{class:"q-mb-sm block"},"Detalle",-1)),i(S,{modelValue:e.stock.detalle_id,"onUpdate:modelValue":o[1]||(o[1]=l=>e.stock.detalle_id=l),options:e.opciones_detalles,"transition-show":"scale","transition-hide":"scale","options-dense":"",dense:"",outlined:"",error:!!e.v$.detalle_id.$errors.length,"error-message":"Debes seleccionar un detalle de producto","option-label":l=>l.id&&l.serial?l.modelo+" \xA0 | \xA0 "+l.descripcion+" \xA0 | \xA0 "+l.serial:l.id?l.modelo+" | "+l.descripcion:null,"option-value":l=>l.id,"emit-value":"","map-options":""},{error:r(()=>[(m(!0),b(y,null,w(e.v$.detalle_id.$errors,l=>(m(),b("div",{key:l.$uid},[s("div",vo,$(l.$message),1)]))),128))]),"no-option":r(()=>[i(O,null,{default:r(()=>[i(A,{class:"text-grey"},{default:r(()=>o[10]||(o[10]=[L(" No hay resultados ")])),_:1})]),_:1})]),_:1},8,["modelValue","options","error","option-label","option-value"])]),s("div",go,[o[12]||(o[12]=s("label",{class:"q-mb-sm block"},"Sucursal",-1)),i(S,{modelValue:e.stock.sucursal_id,"onUpdate:modelValue":[o[2]||(o[2]=l=>e.stock.sucursal_id=l),e.seleccionarPropietario],options:e.opciones_sucursales,"transition-show":"scale","transition-hide":"scale","options-dense":"",dense:"",outlined:"","use-input":"","input-debounce":"0",onFilter:e.filtrarSucursales,onPopupShow:o[3]||(o[3]=l=>e.ordenarLista(e.opciones_sucursales,"lugar")),error:!!e.v$.sucursal_id.$errors.length,"error-message":"Debes seleccionar una sucursal","option-label":l=>l.lugar,"option-value":l=>l.id,"emit-value":"","map-options":""},{error:r(()=>[(m(!0),b(y,null,w(e.v$.sucursal_id.$errors,l=>(m(),b("div",{key:l.$uid},[s("div",ko,$(l.$message),1)]))),128))]),_:1},8,["modelValue","options","onFilter","onUpdate:modelValue","error","option-label","option-value"])]),s("div",Co,[o[13]||(o[13]=s("label",{class:"q-mb-sm block"},"Propietario",-1)),i(S,{modelValue:e.stock.cliente_id,"onUpdate:modelValue":o[4]||(o[4]=l=>e.stock.cliente_id=l),options:e.clientes,"transition-show":"scale","transition-hide":"scale","options-dense":"",dense:"",disable:"",outlined:"",error:!!e.v$.cliente_id.$errors.length,"error-message":"Debes seleccionar el propietario del producto","option-label":l=>l.razon_social,"option-value":l=>l.id,"emit-value":"","map-options":""},{error:r(()=>[(m(!0),b(y,null,w(e.v$.cliente_id.$errors,l=>(m(),b("div",{key:l.$uid},[s("div",So,$(l.$message),1)]))),128))]),_:1},8,["modelValue","options","error","option-label","option-value"])]),s("div",_o,[o[14]||(o[14]=s("label",{class:"q-mb-sm block"},"Minimo",-1)),i(P,{type:"number",mask:"####","unmasked-value":"",modelValue:e.stock.minimo,"onUpdate:modelValue":o[5]||(o[5]=l=>e.stock.minimo=l),placeholder:"Obligatorio",readonly:e.disabled,outlined:"",dense:""},null,8,["modelValue","readonly"])]),s("div",Vo,[o[15]||(o[15]=s("label",{class:"q-mb-sm block"},"Reorden",-1)),i(P,{type:"number",mask:"####","unmasked-value":"",modelValue:e.stock.reorden,"onUpdate:modelValue":o[6]||(o[6]=l=>e.stock.reorden=l),placeholder:"Obligatorio",readonly:e.disabled,outlined:"",dense:""},null,8,["modelValue","readonly"])])])]),_:1})]),_:1},8,["mixin","configuracionColumnas","accion1Header"])}var ce=G(mo,[["render",wo]]);export{ce as default};
