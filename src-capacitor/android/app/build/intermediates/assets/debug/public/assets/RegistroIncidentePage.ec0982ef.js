var z=Object.defineProperty;var H=(e,o,t)=>o in e?z(e,o,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[o]=t;var l=(e,o,t)=>(H(e,typeof o!="symbol"?o+"":o,t),t);import{Q as c,a as R}from"./QSelect.6ce302d7.js";import{Q as h,a as V}from"./QItemSection.9a955ec6.js";import{bw as J,s as K,d as W,u as X,c as k,E as Y,q as Z,bx as _,_ as x,t as D,v as n,P as ee,F as a,z as i,a4 as oe,y as r,x as d,J as se,M as ie,N as ae,D as b,K as p,I as L,B as re,j as le,O as te,G as q,H as Q,L as ne}from"./index.6449c167.js";import{Q as de,a as pe,C as ue}from"./QPopupProxy.72ff1d6d.js";import{Q as me}from"./QForm.ca56f146.js";import{s as U,n as ce}from"./vehiculos.utils.c31e027d.js";import{r as u}from"./i18n-validators.29e2545c.js";import{a as be,S as ge,w as ve}from"./utils.521b98f3.js";import{u as fe}from"./index.490dde02.js";import{G as he}from"./GestorArchivos.10722df3.js";import{T as Ve}from"./TabLayout.0bce4313.js";import{C as we}from"./ContenedorSimpleMixin.09c9bed5.js";import{E as $e}from"./entidadAuditable.75a46700.js";import{V as ye}from"./VehiculoController.5e90ff0e.js";import{u as Ce}from"./filtrosListadosGenerales.c3aa2da3.js";import"./QChip.95469f73.js";import"./position-engine.70d0a89f.js";import"./format.8ac60962.js";import"./index.0198dd12.js";import"./QUploader.cca1b7bd.js";import"./QCircularProgress.b24a7ee9.js";import"./QFile.90d9394a.js";import"./configuracionColumnasArchivoSubtarea.215f4ffd.js";import"./EssentialTable.00c17e97.js";import"./QToolbar.8dbe891b.js";import"./use-fullscreen.a7661f85.js";import"./QBadge.e6f320cd.js";import"./_commonjsHelpers.8402d862.js";import"./QImg.fd079679.js";import"./VisorImagen.75b3c53f.js";import"./logo.4781eea2.js";import"./seleccionContratacionPersonal.utils.e3e1ed3d.js";import"./QTabs.6c234f27.js";import"./QResizeObserver.9af84680.js";import"./QTabPanels.49d2362a.js";import"./touch.9135741d.js";import"./QPage.5d173a8a.js";import"./buttonSubmits.fe817da3.js";import"./EssentialTablePagination.d5c1010a.js";const ke=[{name:"vehiculo",field:"vehiculo",label:"Veh\xEDculo",align:"left",sortable:!0},{name:"fecha",field:"fecha",label:"Fecha",align:"left",sortable:!0},{name:"tipo",field:"tipo",label:"Tipo",align:"left",sortable:!0},{name:"gravedad",field:"gravedad",label:"Gravedad",align:"left",sortable:!0},{name:"persona_reporta",field:"persona_reporta",label:"Persona Reporta",align:"left",sortable:!0}];class qe extends $e{constructor(){super();l(this,"vehiculo");l(this,"fecha");l(this,"descripcion");l(this,"tipo");l(this,"gravedad");l(this,"persona_reporta");l(this,"persona_registra");l(this,"aplica_seguro");this.vehiculo=null,this.fecha=null,this.descripcion=null,this.tipo=null,this.gravedad=null,this.persona_reporta=null,this.persona_registra=null,this.aplica_seguro=!1}}class Qe extends J{constructor(){super(K.registros_incidentes)}}var Ie=W({components:{TabLayout:Ve,GestorArchivos:he},setup(){const e=new we(qe,new Qe),{entidad:o,disabled:t,listadosAuxiliares:g,accion:I}=e.useReferencias(),{setValidador:P,cargarVista:w,obtenerListados:$}=e.useComportamiento(),{onReestablecer:s,onConsultado:E,onModificado:T,onGuardado:B}=e.useHooks();be();const v=X();new ge;const y=k(),f=k(),C=k(),{vehiculos:j,filtrarVehiculos:N,empleados:S,filtrarEmpleados:G}=Ce(g);w(async()=>{await $({vehiculos:new ye,empleados:{controller:new Y,params:{estado:1}}}),j.value=g.vehiculos,S.value=g.empleados,o.persona_registra=v.user.id,o.persona_reporta=v.user.id});const F=fe({vehiculo:{required:u},fecha:{required:u},tipo:{required:u},gravedad:{required:u},descripcion:{required:u},persona_reporta:{required:u}},o);P(F.value),s(()=>{o.persona_registra=v.user.id,o.persona_reporta=v.user.id,f.value.limpiarListado()}),E(()=>{setTimeout(()=>{f.value.listarArchivosAlmacenados(o.id)},1),y.value=U}),B(m=>{C.value=m,setTimeout(async()=>{await A()},1)}),T(m=>{C.value=m,setTimeout(async()=>{await A()},1)});async function A(){await f.value.subir()}function M(m){y.value=U.filter(O=>O.tipo.indexOf(m)>-1)}return{mixin:e,registro:o,v$:F,accion:I,disabled:t,configuracionColumnas:ke,maskFecha:Z,acciones:_,refArchivo:f,idRegistro:C,vehiculos:j,filtrarVehiculos:N,empleados:S,filtrarEmpleados:G,tiposIncidentes:ce,subtipos:y,filtrarSubtipos:M,ordenarLista:ve}}});const Pe={class:"row q-col-gutter-sm q-py-md"},je={key:0,class:"col-12 col-md-3"},Se={class:"col-12 col-md-3"},Fe={class:"col-12 col-md-3"},Ae={class:"row items-center justify-end"},Re={class:"error-msg"},De={class:"col-12 col-md-3"},Le={class:"col-12 col-md-3"},Ue={class:"col-12 col-md-3 q-mb-xl"},Ee={class:"col-12 col-md-3"},Te={class:"error-msg"},Be={class:"col-12 col-md-12"},Ne={class:"error-msg"},Ge={class:"col-12 q-mb-md"};function Me(e,o,t,g,I,P){const w=D("gestor-archivos"),$=D("tab-layout");return n(),ee($,{mixin:e.mixin,configuracionColumnas:e.configuracionColumnas,"titulo-pagina":"Registro de incidentes"},{formulario:a(()=>[i(me,{onSubmit:o[10]||(o[10]=oe(()=>{},["prevent"]))},{default:a(()=>[r("div",Pe,[e.registro.persona_registra?(n(),d("div",je,[o[11]||(o[11]=r("label",{class:"q-mb-sm block"},"Persona que registra",-1)),i(c,{modelValue:e.registro.persona_registra,"onUpdate:modelValue":o[0]||(o[0]=s=>e.registro.persona_registra=s),options:e.empleados,"transition-show":"jump-up","transition-hide":"jump-up","options-dense":"",dense:"",outlined:"",disable:"","option-label":s=>s.apellidos+" "+s.nombres,"option-value":s=>s.id,"emit-value":"","map-options":""},null,8,["modelValue","options","option-label","option-value"])])):se("",!0),r("div",Se,[o[13]||(o[13]=r("label",{class:"q-mb-sm block"},"Placa",-1)),i(c,{modelValue:e.registro.vehiculo,"onUpdate:modelValue":o[1]||(o[1]=s=>e.registro.vehiculo=s),options:e.vehiculos,"transition-show":"jump-up","transition-hide":"jump-down",disable:e.disabled,"options-dense":"",dense:"",outlined:"",onFilter:e.filtrarVehiculos,"error-message":"Debes seleccionar un n\xFAmero de placa","use-input":"","input-debounce":"0","option-value":s=>s.id,"option-label":s=>s.placa,"emit-value":"","map-options":""},{option:a(s=>[i(h,ie(ae(s.itemProps)),{default:a(()=>[i(V,null,{default:a(()=>[i(R,null,{default:a(()=>[b(p(s.opt.placa),1)]),_:2},1024),i(R,{caption:""},{default:a(()=>[b(p(s.opt.marca)+": "+p(s.opt.modelo),1)]),_:2},1024)]),_:2},1024)]),_:2},1040)]),"no-option":a(()=>[i(h,null,{default:a(()=>[i(V,{class:"text-grey"},{default:a(()=>o[12]||(o[12]=[b(" No hay resultados ")])),_:1})]),_:1})]),_:1},8,["modelValue","options","disable","onFilter","option-value","option-label"])]),r("div",Fe,[o[14]||(o[14]=r("label",{class:"q-mb-sm block"},"Fecha del incidente",-1)),i(L,{modelValue:e.registro.fecha,"onUpdate:modelValue":o[3]||(o[3]=s=>e.registro.fecha=s),placeholder:"Obligatorio",value:e.registro.fecha,error:!!e.v$.fecha.$errors.length,disable:e.disabled,onBlur:e.v$.fecha.$touch,outlined:"",dense:""},{append:a(()=>[i(re,{name:"event",class:"cursor-pointer"},{default:a(()=>[i(de,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:a(()=>[i(pe,{modelValue:e.registro.fecha,"onUpdate:modelValue":o[2]||(o[2]=s=>e.registro.fecha=s),mask:e.maskFecha,"today-btn":""},{default:a(()=>[r("div",Ae,[le(i(te,{label:"Cerrar",color:"primary",flat:""},null,512),[[ue]])])]),_:1},8,["modelValue","mask"])]),_:1})]),_:1})]),error:a(()=>[(n(!0),d(q,null,Q(e.v$.fecha.$errors,s=>(n(),d("div",{key:s.$uid},[r("div",Re,p(s.$message),1)]))),128))]),_:1},8,["modelValue","value","error","disable","onBlur"])]),r("div",De,[o[15]||(o[15]=r("label",{class:"q-mb-sm block"},"Tipo de incidente",-1)),i(c,{modelValue:e.registro.tipo,"onUpdate:modelValue":[o[4]||(o[4]=s=>e.registro.tipo=s),e.filtrarSubtipos],options:e.tiposIncidentes,"transition-show":"jump-up","transition-hide":"jump-down",disable:e.disabled,"options-dense":"",dense:"",outlined:"",clearable:"","error-message":"Debes seleccionar un tipo de incidente","option-value":s=>s.value,"option-label":s=>s.label,"emit-value":"","map-options":""},null,8,["modelValue","options","disable","onUpdate:modelValue","option-value","option-label"])]),r("div",Le,[o[17]||(o[17]=r("label",{class:"q-mb-sm block"},"Gravedad",-1)),i(c,{modelValue:e.registro.gravedad,"onUpdate:modelValue":o[5]||(o[5]=s=>e.registro.gravedad=s),options:e.subtipos,"transition-show":"jump-up","transition-hide":"jump-down",disable:e.disabled,"options-dense":"",dense:"",outlined:"","error-message":"Debes seleccionar un elemento","option-value":s=>s.value,"option-label":s=>s.label,"emit-value":"","map-options":""},{"no-option":a(()=>[i(h,null,{default:a(()=>[i(V,{class:"text-grey"},{default:a(()=>o[16]||(o[16]=[b(" Primero selecciona un tipo de incidente ")])),_:1})]),_:1})]),_:1},8,["modelValue","options","disable","option-value","option-label"])]),r("div",Ue,[i(ne,{class:"q-mt-lg q-pt-md",modelValue:e.registro.aplica_seguro,"onUpdate:modelValue":o[6]||(o[6]=s=>e.registro.aplica_seguro=s),label:"\xBFAplic\xF3 el seguro?",disable:e.disabled,outlined:"",dense:""},null,8,["modelValue","disable"])]),r("div",Ee,[o[19]||(o[19]=r("label",{class:"q-mb-sm block"},"Persona que reporta",-1)),i(c,{modelValue:e.registro.persona_reporta,"onUpdate:modelValue":o[7]||(o[7]=s=>e.registro.persona_reporta=s),options:e.empleados,"transition-show":"jump-up","transition-hide":"jump-up","options-dense":"",dense:"",outlined:"","use-input":"","input-debounce":"0",onFilter:e.filtrarEmpleados,onPopupShow:o[8]||(o[8]=s=>e.ordenarLista(e.empleados,"apellidos")),"error-message":"Debes seleccionar un empleado",error:!!e.v$.persona_reporta.$errors.length,disable:e.disabled,"option-label":s=>s.apellidos+" "+s.nombres,"option-value":s=>s.id,"emit-value":"","map-options":""},{"no-option":a(()=>[i(h,null,{default:a(()=>[i(V,{class:"text-grey"},{default:a(()=>o[18]||(o[18]=[b(" No hay resultados ")])),_:1})]),_:1})]),error:a(()=>[(n(!0),d(q,null,Q(e.v$.persona_reporta.$errors,s=>(n(),d("div",{key:s.$uid},[r("div",Te,p(s.$message),1)]))),128))]),_:1},8,["modelValue","options","onFilter","error","disable","option-label","option-value"])]),r("div",Be,[o[20]||(o[20]=r("label",{class:"q-mb-sm block"},"Descripci\xF3n del incidente",-1)),i(L,{type:"textarea",autogrow:"",modelValue:e.registro.descripcion,"onUpdate:modelValue":o[9]||(o[9]=s=>e.registro.descripcion=s),placeholder:"Obligatorio",disable:e.disabled,error:!!e.v$.descripcion.$errors.length,outlined:"",dense:""},{error:a(()=>[(n(!0),d(q,null,Q(e.v$.descripcion.$errors,s=>(n(),d("div",{key:s.$uid},[r("div",Ne,p(s.$message),1)]))),128))]),_:1},8,["modelValue","disable","error"])]),r("div",Ge,[i(w,{ref:"refArchivo",label:"Im\xE1genes o archivos adjuntos",mixin:e.mixin,disable:e.disabled,listarAlGuardar:!1,"permitir-eliminar":e.accion==e.acciones.nuevo||e.accion==e.acciones.editar,idModelo:e.idRegistro},null,8,["mixin","disable","permitir-eliminar","idModelo"])])])]),_:1})]),_:1},8,["mixin","configuracionColumnas"])}var Fo=x(Ie,[["render",Me]]);export{Fo as default};
