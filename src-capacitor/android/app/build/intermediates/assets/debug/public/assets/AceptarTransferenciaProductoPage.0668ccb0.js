var ae=Object.defineProperty;var oe=(e,a,t)=>a in e?ae(e,a,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[a]=t;var z=(e,a,t)=>(oe(e,typeof a!="symbol"?a+"":a,t),t);import{Q as ie}from"./QPage.5d173a8a.js";import{T as re,a as se,c as te}from"./TransferenciaProductoEmpleado.d1dccd03.js";import{j as w,k as ne}from"./tareas.utils.309e0dff.js";import{u as I}from"./transaccionEgreso.70c202c8.js";import{d as N,m as q,u as Q,c as y,$ as le,bx as de,cr as ce,_ as R,t as T,v as c,P as A,F as V,z as r,a4 as me,y as s,x as p,I as u,J as f,O as F,B as j,D as $,K as ue,bf as fe,h as pe,p as be}from"./index.6449c167.js";import{b as U,a as ge,u as Ce}from"./utils.521b98f3.js";import{E as ve}from"./EssentialTableTabs.586dbdfc.js";import{M as Ve}from"./ModalEntidad.168b465e.js";import{C as Te}from"./ContenedorSimpleMixin.09c9bed5.js";import{C as Ee,a as Pe}from"./ComponenteModal.domain.50e59f97.js";import{Q as ye}from"./QForm.ca56f146.js";import{u as ke}from"./transferencia.5b0e0c93.js";import{u as Se}from"./transaccion.2fe6f8e8.js";import{u as we}from"./pedido.c5162ee1.js";import{i as S}from"./iconos.5bc406be.js";import{E as qe}from"./EssentialSelectableTable.5a9cc771.js";import{S as Ae}from"./SimpleLayout.3a4276ec.js";import{E as De}from"./EssentialTable.00c17e97.js";import{C as _e}from"./CalloutComponent.a81d1558.js";import"./entidadAuditable.75a46700.js";import"./Transaccion.ef293505.js";import"./format.8ac60962.js";import"./QBadge.e6f320cd.js";import"./QTabs.6c234f27.js";import"./QResizeObserver.9af84680.js";import"./QSelect.6ce302d7.js";import"./QChip.95469f73.js";import"./QItemSection.9a955ec6.js";import"./position-engine.70d0a89f.js";import"./EssentialTablePagination.d5c1010a.js";import"./QToolbar.8dbe891b.js";import"./use-fullscreen.a7661f85.js";import"./configuracion_general.37a05c0a.js";import"./ConfiguracionController.c50d9536.js";import"./Transferencia.f2b64659.js";import"./buttonSubmits.fe817da3.js";import"./QPopupProxy.72ff1d6d.js";import"./_commonjsHelpers.8402d862.js";import"./QImg.fd079679.js";import"./QFile.90d9394a.js";import"./VisorImagen.75b3c53f.js";import"./logo.4781eea2.js";import"./seleccionContratacionPersonal.utils.e3e1ed3d.js";import"./i18n-validators.29e2545c.js";import"./index.0198dd12.js";const Be=[{name:"producto",field:"producto",label:"Producto",style:"max-width:300px; overflow: auto;",align:"left",sortable:!0,editable:!1,visible:!0},{name:"descripcion",field:"descripcion",label:"Descripci\xF3n",style:"max-width:300px; overflow: auto;",align:"left",sortable:!0,editable:!1,visible:!0},{name:"categoria",field:"categoria",label:"Categoria",align:"left",sortable:!0,editable:!1,visible:!0},{name:"serial",field:"serial",label:"Serial",align:"left",sortable:!0,editable:!1,visible:!0},{name:"cantidad",field:"cantidad",label:"Cantidad enviada",align:"left",sortable:!1},{name:"recibido",field:"recibido",label:"Cantidad recibida",align:"left",sortable:!1,editable:!1}],Me=[{name:"producto",field:"producto",label:"Producto",style:"max-width:300px; overflow: auto;",align:"left",sortable:!0,editable:!1,visible:!0},{name:"descripcion",field:"descripcion",label:"Descripci\xF3n",style:"max-width:300px; overflow: auto;",align:"left",sortable:!0,editable:!1,visible:!0},{name:"categoria",field:"categoria",label:"Categoria",align:"left",sortable:!0,editable:!1,visible:!0},{name:"serial",field:"serial",label:"Serial",align:"left",sortable:!0,editable:!1,visible:!0},{name:"cantidad",field:"cantidad",label:"Cantidad enviada",align:"left",sortable:!1,editable:!1},{name:"recibido",field:"recibido",label:"Cantidad recibida",align:"left",sortable:!1,editable:!1},{name:"acciones",field:"acciones",label:"Acciones",align:"center"}];var Oe=N({components:{SimpleLayout:Ae,EssentialTable:De,EssentialSelectableTable:qe,CalloutComponent:_e},props:{datos:Object},setup(e,{emit:a}){var _,B,M,O;U().setQuasar(q());const t=Q();Se(),I();const C=we(),v=ke(),{entidad:n}=(_=e.datos)==null?void 0:_.mixin.useReferencias(),{consultar:l,editarParcial:m}=(B=e.datos)==null?void 0:B.mixin.useComportamiento(),{onConsultado:b,onBeforeModificar:o}=(M=e.datos)==null?void 0:M.mixin.useHooks(),{notificarError:k,notificarCorrecto:d,confirmar:L,prompt:D}=ge(),G=t.esBodeguero,J=t.esCoordinador,H=t.user.roles.filter(i=>i.indexOf("BODEGA")>-1||i.indexOf("COORDINADOR")>-1).length>0;let K=y(!1),W=y(!1),X=y(!1);const Y=le();function Z(){D({titulo:"Aprobar y firmar",mensaje:"Novedades al recibir los productos.",accion:async E=>{try{L("Esta acci\xF3n completar\xE1 la transferencia. \xBFDesea continuar?",async()=>{const P={autorizacion_id:2,novedades_transferencia_recibida:E,listado_productos:n.listado_productos.filter(g=>g.recibido)};await m(n.id,P),d("Transferencia aprobada y firmada correctamente."),a("cerrar-modal",!1),a("guardado","aceptado")})}catch{k("No se pudo aprobar ni firmar la transferencia.")}}})}function x(){n.modificar_recepcion=!n.modificar_recepcion,n.listado_productos.forEach(i=>i.recibido=i.cantidad)}const h={titulo:"Cantidad",icono:S.editar,accion:({entidad:i,posicion:E})=>{const P={titulo:"Confirmaci\xF3n",mensaje:"Ingresa la cantidad",defecto:n.listado_productos[E].recibido,tipo:"number",validacion:g=>!!g&&g>=0&&g<=i.cantidad,accion:g=>n.listado_productos[E].recibido=g};D(P)}},ee={titulo:({entidad:i})=>i.recibido===0?"S\xED se recibi\xF3":"No se recibi\xF3",icono:({entidad:i})=>i.recibido===0?"bi-check":S.cancelar,color:({entidad:i})=>i.recibido===0?"positive":"negative",accion:({entidad:i})=>i.recibido=i.recibido===0?i.cantidad:0};return b(()=>{n.autorizacion==w.VALIDADO&&n.listado_productos.forEach(i=>i.recibido=i.cantidad)}),l(n),{mixin:(O=e.datos)==null?void 0:O.mixin,transferencia:n,acciones:de,pedidoStore:C,transferenciaStore:v,esVisibleAutorizacion:K,esVisibleTarea:W,requiereFecha:X,configuracionColumnasProductosRecibidos:Be,configuracionColumnasProductosRecibidosParcial:Me,rolSeleccionado:H,esBodeguero:G,esCoordinador:J,permitirModificarCantidades:x,aprobarTransferencia:Z,tabGestionarEgresos:ce,route:Y,btnEditarCantidad:h,btnLlego:ee,iconos:S}}});const ze={class:"row q-col-gutter-sm q-py-lg"},Fe={key:0,class:"col-12 col-md-3"},je={key:1,class:"col-12 col-md-3"},$e={key:2,class:"col-12 col-md-3"},Ie={class:"col-12 col-md-3"},Ne={key:3,class:"col-12 col-md-3"},Qe={key:4,class:"col-12 col-md-3"},Re={class:"col-12 col-md-3"},Ue={class:"col-12 col-md-3"},Le={class:"col-12 col-md-6 q-mb-md"},Ge={class:"col-12"},Je={class:"col-12"},He={key:5,class:"col-12"},Ke={key:6,class:"col-12"},We={key:0,class:"q-pa-md q-gutter-sm flex flex-center"};function Xe(e,a,t,C,v,n){const l=T("callout-component"),m=T("essential-table"),b=T("simple-layout");return c(),A(b,{mixin:e.mixin,mostrarButtonSubmits:!1},{formulario:V(()=>[r(ye,{onSubmit:a[9]||(a[9]=me(()=>{},["prevent"]))},{default:V(()=>[s("div",ze,[e.transferencia.id?(c(),p("div",Fe,[a[12]||(a[12]=s("label",{class:"q-mb-sm block"},"Transferencia N\xB0",-1)),r(u,{modelValue:e.transferencia.id,"onUpdate:modelValue":a[0]||(a[0]=o=>e.transferencia.id=o),placeholder:"Obligatorio",disable:"",outlined:"",dense:""},null,8,["modelValue"])])):f("",!0),e.transferencia.created_at?(c(),p("div",je,[a[13]||(a[13]=s("label",{class:"q-mb-sm block"},"Fecha de solicitud",-1)),r(u,{modelValue:e.transferencia.created_at,"onUpdate:modelValue":a[1]||(a[1]=o=>e.transferencia.created_at=o),disable:"",outlined:"",dense:""},null,8,["modelValue"])])):f("",!0),e.transferencia.solicitante?(c(),p("div",$e,[a[14]||(a[14]=s("label",{class:"q-mb-sm block"},"Solicitante",-1)),r(u,{modelValue:e.transferencia.nombre_solicitante,"onUpdate:modelValue":a[2]||(a[2]=o=>e.transferencia.nombre_solicitante=o),dense:"",outlined:"",disable:""},null,8,["modelValue"])])):f("",!0),s("div",Ie,[a[15]||(a[15]=s("label",{class:"q-mb-sm block"},"Cliente",-1)),r(u,{modelValue:e.transferencia.nombre_cliente,"onUpdate:modelValue":a[3]||(a[3]=o=>e.transferencia.nombre_cliente=o),disable:"",outlined:"",dense:""},null,8,["modelValue"])]),e.transferencia.nombre_tarea_origen?(c(),p("div",Ne,[a[16]||(a[16]=s("label",{class:"q-mb-sm block"},"Tarea origen",-1)),r(u,{modelValue:e.transferencia.nombre_tarea_origen,"onUpdate:modelValue":a[4]||(a[4]=o=>e.transferencia.nombre_tarea_origen=o),dense:"",outlined:"",disable:""},null,8,["modelValue"])])):f("",!0),e.transferencia.nombre_tarea_destino?(c(),p("div",Qe,[a[17]||(a[17]=s("label",{class:"q-mb-sm block"},"Tarea destino",-1)),r(u,{modelValue:e.transferencia.nombre_tarea_destino,"onUpdate:modelValue":a[5]||(a[5]=o=>e.transferencia.nombre_tarea_destino=o),dense:"",outlined:"",disable:""},null,8,["modelValue"])])):f("",!0),s("div",Re,[a[18]||(a[18]=s("label",{class:"q-mb-sm block"},"Empleado que env\xEDa",-1)),r(u,{modelValue:e.transferencia.nombre_empleado_origen,"onUpdate:modelValue":a[6]||(a[6]=o=>e.transferencia.nombre_empleado_origen=o),autogrow:"",disable:"",outlined:"",dense:""},null,8,["modelValue"])]),s("div",Ue,[a[19]||(a[19]=s("label",{class:"q-mb-sm block"},"Empleado que recibe",-1)),r(u,{modelValue:e.transferencia.nombre_empleado_destino,"onUpdate:modelValue":a[7]||(a[7]=o=>e.transferencia.nombre_empleado_destino=o),autogrow:"",disable:"",outlined:"",dense:""},null,8,["modelValue"])]),s("div",Le,[a[20]||(a[20]=s("label",{class:"q-mb-sm block"},"Justificaci\xF3n",-1)),r(u,{autogrow:"",modelValue:e.transferencia.justificacion,"onUpdate:modelValue":a[8]||(a[8]=o=>e.transferencia.justificacion=o),placeholder:"Obligatorio",disable:"",outlined:"",dense:""},null,8,["modelValue"])]),s("div",Ge,[e.transferencia.tarea_destino?f("",!0):(c(),A(l,{key:0,mensaje:"Al aceptar la transferencia el material se asignar\xE1 a su stock personal."}))]),s("div",Je,[r(l,{mensaje:"Si un producto no le permite aceptar la transferencia, m\xE1rquelo como <b>no recibido</b>. Para lograrlo primero presione el bot\xF3n <b>Modificar las cantidades recibidas</b>.",tipo:"info"})]),e.transferencia.modificar_recepcion?f("",!0):(c(),p("div",He,[r(m,{titulo:"Productos Seleccionados",configuracionColumnas:e.configuracionColumnasProductosRecibidos,datos:e.transferencia.listado_productos,permitirConsultar:!1,permitirEditar:!1,permitirEliminar:!1,mostrarBotones:!1,permitirBuscar:!1,ajustarCeldas:!0,altoFijo:!1},null,8,["configuracionColumnas","datos"])])),e.transferencia.modificar_recepcion?(c(),p("div",Ke,[r(m,{titulo:"Productos Seleccionados",configuracionColumnas:e.configuracionColumnasProductosRecibidosParcial,datos:e.transferencia.listado_productos,permitirConsultar:!1,permitirEditar:!1,permitirEliminar:!1,mostrarBotones:!1,permitirBuscar:!1,ajustarCeldas:!0,altoFijo:!1,accion1:e.btnEditarCantidad,accion2:e.btnLlego},null,8,["configuracionColumnas","datos","accion1","accion2"])])):f("",!0)])]),_:1}),e.transferencia.autorizacion===4?(c(),p("div",We,[r(F,{color:"positive",onClick:a[10]||(a[10]=o=>e.aprobarTransferencia()),"no-caps":"",glossy:"",push:""},{default:V(()=>[r(j,{name:"bi-check-circle",size:"xs",class:"q-mr-sm"}),a[21]||(a[21]=$(" Aprobar"))]),_:1}),r(F,{color:e.transferencia.modificar_recepcion?"negative":"amber-8",onClick:a[11]||(a[11]=o=>e.permitirModificarCantidades()),"no-caps":"",glossy:"",push:""},{default:V(()=>[r(j,{name:e.iconos.editar,size:"xs",class:"q-mr-sm"},null,8,["name"]),$(" "+ue(e.transferencia.modificar_recepcion?"Cancelar modificaci\xF3n de las cantidades recibidas":"Modificar las cantidades recibidas"),1)]),_:1},8,["color"])])):f("",!0)]),_:1},8,["mixin"])}var Ye=R(Oe,[["render",Xe]]);class Ze{constructor(){z(this,"VisualizarTransferenciaProductoPage");this.VisualizarTransferenciaProductoPage=fe(new Ee("Aceptar transferencia de productos",Ye))}}class xe extends Pe{constructor(){super(new Ze)}}var he=N({name:"aceptar_transferencia_producto",components:{EssentialTableTabs:ve,ModalEntidad:Ve},setup(){const e=Q();U().setQuasar(q()),Ce().setQuasar(q()),I();const a=new xe,t=new Te(re,new se),{entidad:C,listado:v}=t.useReferencias(),{listar:n}=t.useComportamiento(),l=y(w.VALIDADO);function m(d){l.value=d,n({autorizacion_id:d,empleado_destino_id:e.user.id,filtrar:!0})}const b={titulo:"Visualizar para aceptar",icono:"bi-eye",color:"primary",accion:async({entidad:d})=>{C.id=d.id,a.abrirModalEntidad("VisualizarTransferenciaProductoPage",{mixin:t})}},o={titulo:"Imprimir",color:"positive",icono:"bi-printer",accion:async({entidad:d})=>n({export:"pdf",id:d.id,titulo:"Tranferencia #"+d.id})};function k(d){d=="aceptado"&&(l.value=w.VALIDADO,m(l.value))}return pe(()=>m(l.value)),{mixin:t,listado:v,configuracionColumnas:te,guardado:k,tabOptionsAceptarTransferenciasProductos:ne,tabDefecto:l,filtrarTabs:m,botonVerTransaccion:b,accionesTabla:be,modales:a,botonImprimir:o}}});function ea(e,a,t,C,v,n){const l=T("essential-table-tabs"),m=T("modal-entidad");return c(),A(ie,{padding:""},{default:V(()=>[a[1]||(a[1]=s("div",{class:"text-h5 text-bold q-mb-md"}," Aceptar transferencia de productos ",-1)),r(l,{titulo:"Transferencias realizadas",configuracionColumnas:[...e.configuracionColumnas,e.accionesTabla],datos:e.listado,permitirConsultar:!1,permitirEditar:!1,permitirEliminar:!1,"tab-options":e.tabOptionsAceptarTransferenciasProductos,mostrarFooter:!1,onTabSeleccionado:e.filtrarTabs,accion1:e.botonVerTransaccion,accion2:e.botonImprimir,ajustarCeldas:!0,tabDefecto:e.tabDefecto,class:"borde custom-shadow rounded"},null,8,["configuracionColumnas","datos","tab-options","onTabSeleccionado","accion1","accion2","tabDefecto"]),r(m,{comportamiento:e.modales,persistente:!1,mostrarListado:!1,onGuardado:a[0]||(a[0]=b=>e.guardado(b))},null,8,["comportamiento"])]),_:1})}var Ka=R(he,[["render",ea]]);export{Ka as default};
