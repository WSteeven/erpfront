var ve=Object.defineProperty;var Ce=(e,o,t)=>o in e?ve(e,o,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[o]=t;var B=(e,o,t)=>(Ce(e,typeof o!="symbol"?o+"":o,t),t);import{bw as Pe,s as Ee,d as Z,c as i,_ as K,t as V,v as m,x as b,z as l,F as r,O as U,a3 as Q,B as R,y as s,c8 as ye,G as W,bf as we,m as H,u as Ve,Z as Se,E as ke,bx as G,w as qe,a0 as Fe,p as ze,b_ as J,a4 as Ie,I as w,J as v,D as d,P as Le,Q as F,K as z}from"./index.6449c167.js";import{Q as E,a as u}from"./QItemSection.9a955ec6.js";import{Q as I}from"./QSelect.6ce302d7.js";import{Q as Ne}from"./use-fullscreen.a7661f85.js";import{Q as Qe}from"./QForm.ca56f146.js";import{c as Te}from"./configuracionColumnasItemOrdenCompra.236a777f.js";import{r as Oe}from"./i18n-validators.29e2545c.js";import{u as $e}from"./index.490dde02.js";import{T as De}from"./TabLayoutFilterTabs2.5e702525.js";import{E as X,a5 as Me,a6 as je,a7 as Ae}from"./EssentialTable.00c17e97.js";import{E as Y}from"./EssentialSelectableTable.5a9cc771.js";import{M as Be}from"./ModalEntidad.168b465e.js";import{E as Ue}from"./EssentialPopupEditableTable.e294b26f.js";import{C as Re}from"./ContenedorSimpleMixin.09c9bed5.js";import{a as He,b as Ge,u as Je,S as Ze,w as Ke}from"./utils.521b98f3.js";import{u as h,P as We}from"./preorden.609a5d84.js";import{P as Xe}from"./PedidoController.15257cbc.js";import{u as Ye}from"./filtrosListadosGenerales.c3aa2da3.js";import{C as he,a as xe}from"./ComponenteModal.domain.50e59f97.js";import{E as _e}from"./EmpleadoRolesController.16111958.js";import"./QChip.95469f73.js";import"./position-engine.70d0a89f.js";import"./format.8ac60962.js";import"./index.0198dd12.js";import"./QTabs.6c234f27.js";import"./QResizeObserver.9af84680.js";import"./QTabPanels.49d2362a.js";import"./touch.9135741d.js";import"./QPopupProxy.72ff1d6d.js";import"./QPage.5d173a8a.js";import"./EssentialTableTabs.586dbdfc.js";import"./QBadge.e6f320cd.js";import"./EssentialTablePagination.d5c1010a.js";import"./QToolbar.8dbe891b.js";import"./buttonSubmits.fe817da3.js";import"./_commonjsHelpers.8402d862.js";import"./QImg.fd079679.js";import"./QFile.90d9394a.js";import"./VisorImagen.75b3c53f.js";import"./logo.4781eea2.js";import"./seleccionContratacionPersonal.utils.e3e1ed3d.js";import"./configuracion_general.37a05c0a.js";import"./ConfiguracionController.c50d9536.js";import"./entidadAuditable.75a46700.js";const eo=[{name:"id",field:"id",label:"N\xB0",align:"left",sortable:!0},{name:"created_at",field:"created_at",label:"Fecha de creaci\xF3n",align:"left",sortable:!0},{name:"solicitante",field:"solicitante",label:"Solicitante",align:"left",sortable:!0},{name:"pedido",field:"pedido",label:"Pedido",align:"left",sortable:!0},{name:"autorizacion",field:"autorizacion",label:"Autorizaci\xF3n",align:"left",sortable:!0},{name:"autorizador",field:"autorizador",label:"Autorizador",align:"left",sortable:!0},{name:"estado",field:"estado",label:"Estado",align:"left",sortable:!0}],oo=[{name:"cantidad",field:"cantidad",label:"Cantidad",align:"left",type:"number",sortable:!0,editable:!0},{name:"producto",field:"producto",label:"Producto",align:"left",sortable:!0},{name:"descripcion",field:"descripcion",label:"Descripci\xF3n",align:"left",sortable:!0},{name:"unidad_medida",field:"unidad_medida",label:"Medida",align:"left",sortable:!0},{name:"precio_unitario",field:"precio_unitario",label:"Precio U",hint:"Precio unitario",align:"center",sortable:!0},{name:"iva",field:"iva",label:"IVA",align:"left",type:"number",editable:!1,sortable:!0},{name:"subtotal",field:"subtotal",label:"Subtotal",align:"left",type:"number",editable:!1,sortable:!0},{name:"total",field:"total",label:"Total",align:"left",type:"number",editable:!1,sortable:!0}];class ao extends Pe{constructor(){super(Ee.preordenes_compras)}}const lo=[{name:"producto",field:"producto",label:"Producto",align:"left",sortable:!0},{name:"descripcion",field:"descripcion",label:"Descripci\xF3n",align:"left",sortable:!0},{name:"preordenes",field:"preordenes",label:"Preordenes",align:"left",sortable:!0},{name:"unidad_medida",field:"unidad_medida",label:"Medida",align:"left",sortable:!0},{name:"cantidad",field:"cantidad",label:"Cantidad",align:"left",type:"number",sortable:!0,editable:!0}];var ro=Z({components:{EssentialSelectableTable:Y,EssentialTable:X},emits:["cerrar-modal","guardado"],setup(e,{emit:o}){const t=h(),f=i([]),p=i(),C=i([]);C.value=t.listadoItems;function g(){f.value=p.value.selected,t.crearPreordenConsolida(f.value),c(!1),o("guardado")}function c(y=!0){o("cerrar-modal",y)}return{listado:C,configuracionColumnasItemsPreorden:lo,seleccionar:g,cerrarModal:c,refListado:p}}});function so(e,o,t,f,p,C){const g=V("essential-selectable-table"),c=V("essential-table");return m(),b(W,null,[l(g,{"configuracion-columnas":e.configuracionColumnasItemsPreorden,datos:e.listado},null,8,["configuracion-columnas","datos"]),l(c,{ref:"refListado",titulo:"Listado de items",configuracionColumnas:e.configuracionColumnasItemsPreorden,datos:e.listado,"tipo-seleccion":"multiple",permitirConsultar:!0,permitirEditar:!1,permitirEliminar:!1,permitirFiltrar:!1,ajustarCeldas:!0},null,8,["configuracionColumnas","datos"]),l(ye,{class:Q(["q-gutter-xs",{"justify-end":!e.$q.screen.xs}])},{default:r(()=>[l(U,{color:"primary",class:Q({"full-width":e.$q.screen.xs}),"no-caps":"",push:"",onClick:e.seleccionar},{default:r(()=>[l(R,{name:"bi-save",size:"xs",class:"q-pr-sm"}),o[0]||(o[0]=s("span",null,"Seleccionar",-1))]),_:1},8,["class","onClick"]),l(U,{color:"negative",class:Q({"full-width":e.$q.screen.xs}),"no-caps":"",push:"",onClick:e.cerrarModal},{default:r(()=>[l(R,{name:"bi-x-lg",size:"xs",class:"q-pr-sm"}),o[1]||(o[1]=s("span",null,"Cancelar",-1))]),_:1},8,["class","onClick"])]),_:1},8,["class"])],64)}var no=K(ro,[["render",so]]);class io{constructor(){B(this,"ConsolidarPreordenPage");this.ConsolidarPreordenPage=we(new he("Consolidar Preordenes de Compras",no))}}class to extends xe{constructor(){super(new io)}}var uo=Z({name:"PreordenCompra",components:{TabLayoutFilterTabs2:De,EssentialSelectableTable:Y,EssentialTable:X,ModalesEntidad:Be,EssentialPopupEditableTable:Ue},setup(){const e=new Re(We,new ao),{entidad:o,disabled:t,accion:f,listadosAuxiliares:p,listado:C}=e.useReferencias(),{setValidador:g,obtenerListados:c,cargarVista:y,listar:a}=e.useComportamiento(),{onConsultado:x}=e.useHooks(),{confirmar:S,prompt:_,notificarCorrecto:ee,notificarError:oe}=He(),T=new to;Ge().setQuasar(H()),Je().setQuasar(H());const L=Ve(),k=h(),ae=Se();new Ze;const le=i(0),re=i(0),se=i(0),ne=i(0);let P=i(),O=i(!1),N=i(!1);const $=i(),D=i([]),M=i([]);y(async()=>{await c({empleados:{controller:new ke,params:{campos:"id,nombres,apellidos,cargo_id",estado:1}},autorizadores:{controller:new _e,params:{roles:["AUTORIZADOR"]}},pedidos:{controller:new Xe,params:{autorizacion_id:2}}})});const j=$e({autorizador:{required:Oe}},o);g(j.value),x(()=>{f.value==G.editar&&(O.value=!0)});function ie(n){P.value=n,n==="PENDIENTE"?N.value=!0:N.value=!1,a({solicitante_id:L.user.id,estado:n})}function te({posicion:n}){S("\xBFEst\xE1 seguro de continuar?",()=>o.listadoProductos.splice(n,1))}const{empleados:A,filtrarEmpleados:de}=Ye(p);async function ue(n){console.log(n),await a({solicitante_id:L.user.id,estado:P.value})}const me={titulo:"Eliminar",icono:"bi-x",color:"negative",accion:({entidad:n,posicion:q})=>{te({posicion:q})}},pe={titulo:"Generar OC",color:"primary",icono:"bi-pencil-square",accion:({entidad:n,posicion:q})=>{k.preorden=n,ae.push("ordenes-compras")},visible:()=>P.value==="PENDIENTE"},ce={titulo:"Anular",color:"negative",icono:"bi-x",accion:async({entidad:n,posicion:q})=>{S("\xBFEst\xE1 seguro de anular la orden de compra?",()=>{_({titulo:"Causa de anulaci\xF3n",mensaje:"Ingresa el motivo de anulaci\xF3n",accion:async fe=>{try{k.idPreorden=n.id,(await k.anularPreorden({motivo:fe})).status==200&&(ee("Se ha anulado correctamente la preorden de compra"),C.value.splice(q,1))}catch{oe("No se pudo anular, debes ingresar un motivo para la anulaci\xF3n")}}})})},visible:({entidad:n})=>P.value==J.pendiente},be={titulo:"Consolidar",tooltip:"Consolida varias preordenes en una sola preorden de compra",icono:"bi-box-arrow-in-down",accion:async()=>{S("\xBFEst\xE1 seguro de consolidar preordenes de compras?",async()=>{S("Esto anular las preordenes existentes y crear\xE1 nuevas preordenes con la sumatoria de los items encontrados. \xBFDesea continuar?",async()=>{await k.consolidarPreordenes(),await T.abrirModalEntidad("ConsolidarPreordenPage")})})},visible:()=>P.value==J.pendiente};return qe($,()=>{console.log("modificacion"),console.log($.value)}),A.value=p.empleados,D.value=p.categorias,M.value=JSON.parse(Fe.getItem("autorizaciones").toString()),{mixin:e,preorden:o,disabled:t,accion:f,v$:j,acciones:G,configuracionColumnas:eo,accionesTabla:ze,configuracionColumnasDetallesProductos:oo,configuracionColumnasItemOrdenCompra:Te,empleados:A,filtrarEmpleados:de,categorias:D,autorizaciones:M,opcionesForma:Me,opcionesTiempo:je,store:L,modales:T,btnEliminarFila:me,btnHacerOrdenCompra:pe,btnAnularPreorden:ce,btnConsolidarPreordenes:be,tabOptionsPreordenCompra:Ae,tabSeleccionado:P,puedeEditar:N,soloLectura:O,filtrarPreordenes:ie,ordenarLista:Ke,guardado:ue,subtotal:le,total:ne,descuento:re,iva:se}}});const mo={class:"row q-col-gutter-sm q-py-md"},po={key:0,class:"col-12 col-md-3"},co={key:1,class:"col-12 col-md-3"},bo={key:2,class:"col-12 col-md-3"},fo={key:3,class:"col-12 col-md-3"},go={class:"col-12 col-md-6"},vo={class:"col-12 col-md-3"},Co={class:"col-12 col-md-3 q-mb-md"},Po={key:4,class:"col-12 col-md-3 q-mb-md"},Eo={key:5,class:"col-12 col-md-9"},yo={class:"col-12"},wo={class:"col-12"},Vo={class:"row q-col-xs-4 q-col-xs-offset-8 flex-end justify-end"};function So(e,o,t,f,p,C){const g=V("essential-popup-editable-table"),c=V("tab-layout-filter-tabs2"),y=V("modales-entidad");return m(),b(W,null,[l(c,{mixin:e.mixin,configuracionColumnas:e.configuracionColumnas,"titulo-pagina":"Preorden de Compra","tab-options":e.tabOptionsPreordenCompra,tabDefecto:"PENDIENTE",filtrar:e.filtrarPreordenes,permitirEditar:e.puedeEditar,accion1:e.btnHacerOrdenCompra,accion2:e.btnAnularPreorden,accion1Header:e.btnConsolidarPreordenes},{formulario:r(()=>[l(Qe,{onSubmit:o[10]||(o[10]=Ie(()=>{},["prevent"]))},{default:r(()=>[s("div",mo,[e.preorden.id?(m(),b("div",po,[o[12]||(o[12]=s("label",{class:"q-mb-sm block"},"Orden N\xB0",-1)),l(w,{modelValue:e.preorden.id,"onUpdate:modelValue":o[0]||(o[0]=a=>e.preorden.id=a),placeholder:"Obligatorio",disable:e.disabled||e.soloLectura,readonly:e.disabled||e.soloLectura,outlined:"",dense:""},null,8,["modelValue","disable","readonly"])])):v("",!0),e.preorden.created_at?(m(),b("div",co,[o[13]||(o[13]=s("label",{class:"q-mb-sm block"},"Fecha de creaci\xF3n",-1)),l(w,{modelValue:e.preorden.created_at,"onUpdate:modelValue":o[1]||(o[1]=a=>e.preorden.created_at=a),disable:"",outlined:"",dense:""},null,8,["modelValue"])])):v("",!0),e.preorden.pedido?(m(),b("div",bo,[o[14]||(o[14]=s("label",{class:"q-mb-sm block"},"N\xB0 Pedido",-1)),l(w,{modelValue:e.preorden.pedido,"onUpdate:modelValue":o[2]||(o[2]=a=>e.preorden.pedido=a),placeholder:"Obligatorio",disable:e.disabled||e.soloLectura,readonly:e.disabled||e.soloLectura,outlined:"",dense:""},null,8,["modelValue","disable","readonly"])])):v("",!0),e.preorden.solicitante?(m(),b("div",fo,[o[16]||(o[16]=s("label",{class:"q-mb-sm block"},"Solicitante",-1)),l(I,{modelValue:e.preorden.solicitante,"onUpdate:modelValue":o[3]||(o[3]=a=>e.preorden.solicitante=a),options:e.empleados,"transition-show":"scale","transition-hide":"scale","options-dense":"",dense:"",outlined:"",disable:!0,readonly:e.disabled||e.soloLectura,"option-label":a=>a.apellidos+" "+a.nombres,"option-value":a=>a.id,"emit-value":"","map-options":""},{"no-option":r(()=>[l(E,null,{default:r(()=>[l(u,{class:"text-grey"},{default:r(()=>o[15]||(o[15]=[d(" No hay resultados ")])),_:1})]),_:1})]),_:1},8,["modelValue","options","readonly","option-label","option-value"])])):v("",!0),s("div",go,[o[17]||(o[17]=s("label",{class:"q-mb-sm block"},"Justificaci\xF3n",-1)),l(w,{type:"textarea",autogrow:"",modelValue:e.preorden.justificacion,"onUpdate:modelValue":o[4]||(o[4]=a=>e.preorden.justificacion=a),placeholder:"Obligatorio",disable:e.disabled||e.soloLectura,outlined:"",dense:""},null,8,["modelValue","disable"])]),s("div",vo,[o[18]||(o[18]=s("label",{class:"q-mb-sm block"},"Persona que autoriza",-1)),l(I,{modelValue:e.preorden.autorizador,"onUpdate:modelValue":o[5]||(o[5]=a=>e.preorden.autorizador=a),options:e.empleados,"transition-show":"jump-up","transition-hide":"jump-up","options-dense":"",dense:"",outlined:"",onFilter:e.filtrarEmpleados,onPopupShow:o[6]||(o[6]=a=>e.ordenarLista(e.empleados,"apellidos")),disable:e.disabled||e.soloLectura,"option-label":a=>a.apellidos+" "+a.nombres,"option-value":a=>a.id,"emit-value":"","map-options":""},null,8,["modelValue","options","onFilter","disable","option-label","option-value"])]),s("div",Co,[o[20]||(o[20]=s("label",{class:"q-mb-sm block"},"Autorizacion",-1)),l(I,{modelValue:e.preorden.autorizacion,"onUpdate:modelValue":o[7]||(o[7]=a=>e.preorden.autorizacion=a),options:e.autorizaciones,"transition-show":"jum-up","transition-hide":"jump-down","options-dense":"",dense:"",outlined:"",disable:e.disabled||e.soloLectura,"option-value":a=>a.id,"option-label":a=>a.nombre,"emit-value":"","map-options":""},{"no-option":r(()=>[l(E,null,{default:r(()=>[l(u,{class:"text-grey"},{default:r(()=>o[19]||(o[19]=[d(" No hay resultados ")])),_:1})]),_:1})]),_:1},8,["modelValue","options","disable","option-value","option-label"])]),e.preorden.estado||e.accion===e.acciones.consultar?(m(),b("div",Po,[o[21]||(o[21]=s("label",{class:"q-mb-sm block"},"Estado de la Preorden de Compra",-1)),l(I,{modelValue:e.preorden.estado,"onUpdate:modelValue":o[8]||(o[8]=a=>e.preorden.estado=a),options:e.tabOptionsPreordenCompra,"transition-show":"jum-up","transition-hide":"jump-down","options-dense":"",dense:"",outlined:"",disable:"","option-value":a=>a.value,"option-label":a=>a.value,"emit-value":"","map-options":""},null,8,["modelValue","options","option-value","option-label"])])):v("",!0),e.preorden.causa_anulacion?(m(),b("div",Eo,[o[22]||(o[22]=s("label",{class:"q-mb-sm block"},"Causa de anulaci\xF3n",-1)),l(w,{type:"textarea",autogrow:"",modelValue:e.preorden.causa_anulacion,"onUpdate:modelValue":o[9]||(o[9]=a=>e.preorden.causa_anulacion=a),placeholder:"Obligatorio",disable:e.disabled||e.soloLectura,outlined:"",dense:""},null,8,["modelValue","disable"])])):v("",!0),s("div",yo,[l(g,{ref:"refItems",titulo:"Productos Seleccionados",configuracionColumnas:e.accion==e.acciones.consultar?e.configuracionColumnasDetallesProductos:[...e.configuracionColumnasDetallesProductos,e.accionesTabla],datos:e.preorden.listadoProductos,separador:"cell",permitirEditarCeldas:e.accion==e.acciones.nuevo||e.accion==e.acciones.editar,permitirConsultar:!1,permitirEditar:!1,permitirEliminar:!1,altoFijo:!1,accion1:e.btnEliminarFila},null,8,["configuracionColumnas","datos","permitirEditarCeldas","accion1"])]),s("div",wo,[s("div",Vo,[e.preorden.listadoProductos.length>0?(m(),Le(Ne,{key:0,bordered:"",separator:"",dense:""},{default:r(()=>[l(E,null,{default:r(()=>[l(u,null,{default:r(()=>o[23]||(o[23]=[d("Subtotal: ")])),_:1}),l(F,{vertical:""}),l(u,{avatar:""},{default:r(()=>[d(z(e.subtotal),1)]),_:1})]),_:1}),l(E,null,{default:r(()=>[l(u,{class:"q-mr-md"},{default:r(()=>o[24]||(o[24]=[d("Descuento: ")])),_:1}),l(F,{vertical:""}),l(u,{avatar:""},{default:r(()=>[d(z(e.descuento),1)]),_:1})]),_:1}),l(E,null,{default:r(()=>[l(u,null,{default:r(()=>o[25]||(o[25]=[d("IVA (12%): ")])),_:1}),l(F,{vertical:""}),l(u,{avatar:""},{default:r(()=>[d(z(e.iva),1)]),_:1})]),_:1}),l(E,null,{default:r(()=>[l(u,null,{default:r(()=>o[26]||(o[26]=[d("Total: ")])),_:1}),l(F,{vertical:""}),l(u,{avatar:""},{default:r(()=>[d(z(e.total),1)]),_:1})]),_:1})]),_:1})):v("",!0)])])])]),_:1})]),_:1},8,["mixin","configuracionColumnas","tab-options","filtrar","permitirEditar","accion1","accion2","accion1Header"]),l(y,{comportamiento:e.modales,persistente:!1,onGuardado:o[11]||(o[11]=a=>e.guardado(a))},null,8,["comportamiento"])],64)}var Ca=K(uo,[["render",So]]);export{Ca as default};
