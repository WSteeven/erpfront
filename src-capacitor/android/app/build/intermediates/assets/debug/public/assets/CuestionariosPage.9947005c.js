var ee=Object.defineProperty;var oe=(e,n,u)=>n in e?ee(e,n,{enumerable:!0,configurable:!0,writable:!0,value:u}):e[n]=u;var U=(e,n,u)=>(oe(e,typeof n!="symbol"?n+"":n,u),u);import{aa as ae,b1 as te,aK as ne,b2 as re,bI as se,c as E,f as L,o as ie,k as P,aU as le,B as H,g as ue,bK as ce,ag as Q,bw as X,s as Y,d as de,m as me,_ as fe,t as N,v as i,P as m,F as f,z as y,bb as R,bc as M,y as A,x as V,H as z,G,J as _,T as K,bF as ge,O as J,D as W,K as j,I as be}from"./index.6449c167.js";import{b as ve}from"./format.8ac60962.js";import{Q as ye}from"./QSelect.6ce302d7.js";import{Q as Ce}from"./QPage.5d173a8a.js";import{b as he,S as Se,a as Ae,i as _e}from"./utils.521b98f3.js";import{u as pe}from"./EssentialTable.00c17e97.js";import{r as Ie}from"./i18n-validators.29e2545c.js";import{u as Le}from"./index.490dde02.js";import Ve from"./CuestionarioDiagnosticoConsumoDrogasPage.99df73eb.js";import we from"./CuestionarioPsicosocialPage.0391c908.js";import{T as xe}from"./TabLayout.0bce4313.js";import{B as qe}from"./buttonSubmits.fe817da3.js";import{C as ke}from"./ContenedorSimpleMixin.09c9bed5.js";import{T as $e,R as Ee}from"./RespuestaCuestionarioEmpleado.5e0d10dd.js";var He=ae({name:"QRating",props:{...te,...ne,modelValue:{type:Number,required:!0},max:{type:[String,Number],default:5},icon:[String,Array],iconHalf:[String,Array],iconSelected:[String,Array],iconAriaLabel:[String,Array],color:[String,Array],colorHalf:[String,Array],colorSelected:[String,Array],noReset:Boolean,noDimming:Boolean,readonly:Boolean,disable:Boolean},emits:["update:modelValue"],setup(e,{slots:n,emit:u}){const{proxy:{$q:p}}=ue(),w=re(e),x=se(e),C=ce(x),l=E(0);let g={};const r=L(()=>e.readonly!==!0&&e.disable!==!0),v=L(()=>`q-rating row inline items-center q-rating--${r.value===!0?"":"non-"}editable`+(e.noDimming===!0?" q-rating--no-dimming":"")+(e.disable===!0?" disabled":"")+(e.color!==void 0&&Array.isArray(e.color)===!1?` text-${e.color}`:"")),h=L(()=>{const t=Array.isArray(e.icon)===!0?e.icon.length:0,a=Array.isArray(e.iconSelected)===!0?e.iconSelected.length:0,c=Array.isArray(e.iconHalf)===!0?e.iconHalf.length:0,d=Array.isArray(e.color)===!0?e.color.length:0,b=Array.isArray(e.colorSelected)===!0?e.colorSelected.length:0,o=Array.isArray(e.colorHalf)===!0?e.colorHalf.length:0;return{iconLen:t,icon:t>0?e.icon[t-1]:e.icon,selIconLen:a,selIcon:a>0?e.iconSelected[a-1]:e.iconSelected,halfIconLen:c,halfIcon:c>0?e.iconHalf[a-1]:e.iconHalf,colorLen:d,color:d>0?e.color[d-1]:e.color,selColorLen:b,selColor:b>0?e.colorSelected[b-1]:e.colorSelected,halfColorLen:o,halfColor:o>0?e.colorHalf[o-1]:e.colorHalf}}),B=L(()=>{if(typeof e.iconAriaLabel=="string"){const t=e.iconAriaLabel.length!==0?`${e.iconAriaLabel} `:"";return a=>`${t}${a}`}if(Array.isArray(e.iconAriaLabel)===!0){const t=e.iconAriaLabel.length;if(t>0)return a=>e.iconAriaLabel[Math.min(a,t)-1]}return(t,a)=>`${a} ${t}`}),I=L(()=>{const t=[],a=h.value,c=Math.ceil(e.modelValue),d=r.value===!0?0:null,b=e.iconHalf===void 0||c===e.modelValue?-1:c;for(let o=1;o<=e.max;o++){const s=l.value===0&&e.modelValue>=o||l.value>0&&l.value>=o,S=b===o&&l.value<o,T=l.value>0&&(S===!0?c:e.modelValue)>=o&&l.value<o,F=S===!0?o<=a.halfColorLen?e.colorHalf[o-1]:a.halfColor:a.selColor!==void 0&&s===!0?o<=a.selColorLen?e.colorSelected[o-1]:a.selColor:o<=a.colorLen?e.color[o-1]:a.color,Z=(S===!0?o<=a.halfIconLen?e.iconHalf[o-1]:a.halfIcon:a.selIcon!==void 0&&(s===!0||T===!0)?o<=a.selIconLen?e.iconSelected[o-1]:a.selIcon:o<=a.iconLen?e.icon[o-1]:a.icon)||p.iconSet.rating.icon;t.push({name:(S===!0?o<=a.halfIconLen?e.iconHalf[o-1]:a.halfIcon:a.selIcon!==void 0&&(s===!0||T===!0)?o<=a.selIconLen?e.iconSelected[o-1]:a.selIcon:o<=a.iconLen?e.icon[o-1]:a.icon)||p.iconSet.rating.icon,attrs:{tabindex:d,role:"radio","aria-checked":e.modelValue===o?"true":"false","aria-label":B.value(o,Z)},iconClass:"q-rating__icon"+(s===!0||S===!0?" q-rating__icon--active":"")+(T===!0?" q-rating__icon--exselected":"")+(l.value===o?" q-rating__icon--hovered":"")+(F!==void 0?` text-${F}`:"")})}return t}),D=L(()=>{const t={role:"radiogroup"};return e.disable===!0&&(t["aria-disabled"]="true"),e.readonly===!0&&(t["aria-readonly"]="true"),t});function q(t){if(r.value===!0){const a=ve(parseInt(t,10),1,parseInt(e.max,10)),c=e.noReset!==!0&&e.modelValue===a?0:a;c!==e.modelValue&&u("update:modelValue",c),l.value=0}}function k(t){r.value===!0&&(l.value=t)}function O(t,a){switch(t.keyCode){case 13:case 32:return q(a),Q(t);case 37:case 40:return g[`rt${a-1}`]&&g[`rt${a-1}`].focus(),Q(t);case 39:case 38:return g[`rt${a+1}`]&&g[`rt${a+1}`].focus(),Q(t)}}function $(){l.value=0}return ie(()=>{g={}}),()=>{const t=[];return I.value.forEach(({iconClass:a,name:c,attrs:d},b)=>{const o=b+1;t.push(P("div",{key:o,ref:s=>{g[`rt${o}`]=s},class:"q-rating__icon-container flex flex-center",...d,onClick(){q(o)},onMouseover(){k(o)},onMouseout:$,onFocus(){k(o)},onBlur:$,onKeyup(s){O(s,o)}},le(n[`tip-${o}`],[P(H,{class:a,name:c})])))}),e.name!==void 0&&e.disable!==!0&&C(t,"push"),P("div",{class:v.value,style:w.value,...D.value},t)}}});class Be{constructor(n){U(this,"respuestaCuestionarioEmpleado");this.respuestaCuestionarioEmpleado=n}async validar(){const n=this.respuestaCuestionarioEmpleado.cuestionario.filter(u=>u.id_cuestionario);if(this.respuestaCuestionarioEmpleado.cuestionario.length!==n.length)throw new Error("No ha llenado todo el cuestionario!");return!0}}class Oe extends X{constructor(){super(Y.respuestas_cuestionarios_empleados)}}class Te extends X{constructor(){super(Y.preguntas)}}var Pe=de({components:{TabLayout:xe,ButtonSubmits:qe,CuestionarioPsicosocialHeader:we,CuestionarioDiagnosticoConsumoDrogasHeader:Ve},props:{mixin:{type:Object,required:!1}},setup(e){var b;he().setQuasar(me());const n=E([]),u=new Se,p=E(),{confirmar:w}=Ae(),x=new $e,C=(b=e.mixin)!=null?b:new ke(Ee,new Oe),{obtenerListados:l,cargarVista:g,setValidador:r,guardar:v}=C.useComportamiento(),{entidad:h,accion:B,listadosAuxiliares:I}=C.useReferencias();g(async()=>{await l({preguntas:[]})}),x.listar().then(o=>{const{result:s}=o;n.value=s});const q=Le({cuestionario:{required:Ie}},h);r(q.value);const k=new Be(h);C.agregarValidaciones(k);function O(o){return o.map(s=>({label:s.respuesta,value:s.id}))}const $=()=>h.cuestionario=I.preguntas.map(o=>({respuesta_texto:typeof o.respuesta=="string"?o.respuesta:null,id_cuestionario:typeof o.respuesta=="string"?o.cuestionario[0].id:o.respuesta})),t=async()=>{w("Las respuestas ser\xE1n enviadas y no podr\xE1n ser modificadas. \xBFDesea continuar?",async()=>{try{$(),await v(h),I.preguntas=[],d.value="Gracias por completar el cuestionario."}catch(o){console.log(o)}})};async function a(o){p.value=o,u.activar();try{const{result:s}=await c.listar({tipo_cuestionario_id:o});I.preguntas=s}catch(s){if(_e(s)){const S=s.erroresValidacion;d.value=S[0]}}finally{u.desactivar()}}const c=new Te,d=E();return{consultarPreguntas:a,mapearCuestionario:O,listadosAuxiliares:I,tiposCuestionarios:n,mensaje:d,accion:B,guardarCuestionario:t,tipoCuestionarioSeleccionado:p,opcionesTiposCuestionarios:pe}}});const Qe={class:"text-center full-width"},Ne={key:0},Re={key:2,class:"col-12 text-positive text-bold text-h5"},Me={class:"q-mb-md"},je={class:"row q-col-gutter-x-sm"},De={class:"q-mb-sm block"},Fe={class:"row full-width justify-center"};function Ue(e,n,u,p,w,x){const C=N("cuestionario-psicosocial-header"),l=N("cuestionario-diagnostico-consumo-drogas-header"),g=N("button-submits");return i(),m(Ce,{padding:""},{default:f(()=>[y(K,{name:"scale",mode:"out-in"},{default:f(()=>[e.listadosAuxiliares.preguntas.length?_("",!0):(i(),m(R,{key:0,flat:"",class:"q-mb-sm bg-desenfoque border-white"},{default:f(()=>[y(M,{class:"row q-col-gutter-sm text-center"},{default:f(()=>[n[2]||(n[2]=A("div",{class:"full-width text-bold"},"Cuestionarios disponibles",-1)),n[3]||(n[3]=A("small",{class:"block text-center full-width q-mb-md"},"Los cuestionarios que no puede seleccionar ya han sido completados por usted",-1)),A("div",Qe,[(i(!0),V(G,null,z(e.tiposCuestionarios,(r,v)=>(i(),m(J,{key:v,class:"full-width text-primary bg-white q-mb-sm","no-caps":"",unelevated:"",disable:r.finalizado,onClick:h=>e.consultarPreguntas(r.id)},{default:f(()=>[r.finalizado?(i(),m(H,{key:0,name:"bi-check-circle-fill",class:"q-mr-sm",color:"positive"})):(i(),m(H,{key:1,name:"bi-check-circle",class:"q-mr-sm",color:"positive"})),W(" "+j(r.titulo),1)]),_:2},1032,["disable","onClick"]))),128))])]),_:1})]),_:1}))]),_:1}),y(K,{name:"scale",mode:"out-in"},{default:f(()=>[e.listadosAuxiliares.preguntas.length?(i(),V("div",Ne,[y(R,{flat:"",class:"q-mb-sm bg-desenfoque border-white"},{default:f(()=>[ge(e.$slots,"persona"),y(M,null,{default:f(()=>[y(J,{color:"primary","no-caps":"",unelevated:"",square:"",onClick:n[0]||(n[0]=r=>e.listadosAuxiliares.preguntas=[])},{default:f(()=>[y(H,{name:"bi-arrow-left",class:"q-mr-sm"}),n[4]||(n[4]=W(" Volver a ver los cuestionarios disponibles"))]),_:1})]),_:1})]),_:3}),e.listadosAuxiliares.preguntas.length?(i(),m(R,{key:0,flat:"",class:"q-mb-sm border-white"},{default:f(()=>[y(M,{class:"row q-col-gutter-sm text-center"},{default:f(()=>[e.tipoCuestionarioSeleccionado===e.opcionesTiposCuestionarios.CUESTIONARIO_PSICOSOCIAL?(i(),m(C,{key:0})):_("",!0),e.tipoCuestionarioSeleccionado===e.opcionesTiposCuestionarios.CUESTIONARIO_DIAGNOSTICO_CONSUMO_DE_DROGAS?(i(),m(l,{key:1})):_("",!0),e.mensaje?(i(),V("div",Re,[A("div",Me,j(e.mensaje),1),y(He,{"model-value":5,name:"bi-star-fill",maz:"5",color:"amber"})])):_("",!0),A("div",je,[(i(!0),V(G,null,z(e.listadosAuxiliares.preguntas,r=>(i(),V("div",{key:r.id,class:"col-12 col-md-6 text-bold text-justify q-mb-md"},[A("label",De,j(r.codigo+".- "+r.pregunta),1),r.cuestionario[0].respuesta?(i(),m(ye,{key:0,modelValue:r.respuesta,"onUpdate:modelValue":v=>r.respuesta=v,options:e.mapearCuestionario(r.cuestionario),color:"primary",outlined:"",dense:"","options-dense":"","emit-value":"","map-options":""},null,8,["modelValue","onUpdate:modelValue","options"])):(i(),m(be,{key:1,modelValue:r.respuesta,"onUpdate:modelValue":v=>r.respuesta=v,placeholder:"Escriba...",outlined:"",dense:""},null,8,["modelValue","onUpdate:modelValue"]))]))),128))]),A("div",Fe,[e.listadosAuxiliares.preguntas.length?(i(),m(g,{key:0,accion:e.accion,"label-guardar":"Guardar y enviar respuestas",permitirCancelar:!1,onGuardar:n[1]||(n[1]=r=>e.guardarCuestionario())},null,8,["accion"])):_("",!0)])]),_:1})]),_:1})):_("",!0)])):_("",!0)]),_:3})]),_:3})}var ze=fe(Pe,[["render",Ue]]),lo=Object.freeze(Object.defineProperty({__proto__:null,default:ze},Symbol.toStringTag,{value:"Module"}));export{ze as C,Te as P,He as Q,lo as a};
