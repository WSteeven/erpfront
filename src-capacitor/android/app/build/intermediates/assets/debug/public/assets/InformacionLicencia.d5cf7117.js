var se=Object.defineProperty;var ne=(m,p,r)=>p in m?se(m,p,{enumerable:!0,configurable:!0,writable:!0,value:r}):m[p]=r;var y=(m,p,r)=>(ne(m,typeof p!="symbol"?p+"":p,r),r);import{bf as re,d as ce,c as de,h as ue,bm as me,v as d,P as T,F as l,y as s,z as i,x as u,H as M,U as e,G as V,I as E,M as pe,N as fe,K as _,D as w,a7 as ge,Q as ve,J as F,B as Q,O as P,bx as C,q as k,j as S,p as _e}from"./index.6449c167.js";import{a as be,Q as he}from"./QSelect.6ce302d7.js";import{Q as D,a as B}from"./QItemSection.9a955ec6.js";import{Q as Ce}from"./QChip.95469f73.js";import{Q as N,a as O,C as A}from"./QPopupProxy.72ff1d6d.js";import{a as ye}from"./QToolbar.8dbe891b.js";import{Q as Me}from"./QExpansionItem.e36a6702.js";import{M as Ve}from"./ModalEntidad.168b465e.js";import{S as $e}from"./SolicitarFecha.980c51b6.js";import{E as qe}from"./EssentialTable.00c17e97.js";import{t as we}from"./vehiculos.utils.c31e027d.js";import{a as g,c as ke,d as xe}from"./i18n-validators.29e2545c.js";import{u as z}from"./index.490dde02.js";import{C as Ee,a as Fe}from"./ComponenteModal.domain.50e59f97.js";import{M as Qe,u as Pe,a as Be}from"./MultaConductorPage.f2b21cd7.js";import{a as Ie,H as R,K as Ue,I as je}from"./utils.521b98f3.js";import{E as Le}from"./entidadAuditable.75a46700.js";import{f as H}from"./index.0198dd12.js";const G=[{name:"fecha_infraccion",field:"fecha_infraccion",label:"Fecha Infraccion",align:"left",sortable:!0},{name:"placa",field:"placa",label:"Placa",align:"left",sortable:!0,editable:!1},{name:"puntos",field:"puntos",label:"Puntos",align:"left",sortable:!0},{name:"total",field:"total",label:"T. a Pagar",align:"left",sortable:!0},{name:"estado",field:"estado",label:"Estado",align:"left",type:"toggle",sortable:!0},{name:"fecha_pago",field:"fecha_pago",label:"Fecha pago",align:"left",sortable:!0},{name:"comentario",field:"comentario",label:"Comentario",align:"left"}];class Te{constructor(){y(this,"MultaConductorPage");this.MultaConductorPage=re(new Ee("Multas",Qe))}}class Se extends Fe{constructor(){super(new Te)}}class De extends Le{constructor(){super();y(this,"tipo_licencia");y(this,"inicio_vigencia");y(this,"fin_vigencia");this.tipo_licencia=null,this.inicio_vigencia=null,this.fin_vigencia=null}}const Ne={class:"row q-col-gutter-sm q-pa-sm"},Oe={class:"col-12 col-md-3"},Ae={class:"col-12 col-md-12"},ze={class:"error-msg"},Re={class:"col-12 col-md-12 q-mt-lg"},He={class:"error-msg"},Ge={class:"col-12 col-md-8"},Ke={key:0,class:"col-12 col-md-12"},We={class:"col-2 col-md-2"},Je={class:"col-6 col-md-4"},Ye={class:"row items-center justify-end"},Xe={class:"error-msg"},Ze={class:"col-6 col-md-4"},ea={class:"row items-center justify-end"},aa={class:"error-msg"},oa={class:"col-12 col-md-12"},ia={key:1,class:"col-12 col-md-12"},$a=ce({__name:"InformacionLicencia",props:{mixin:{type:Object,required:!0},conductor:{type:Object,required:!0},identificacion:{type:String,required:!1},consultarMultas:{type:Boolean,default:!0},validar:{type:Boolean,default:!1}},emits:["guardado"],setup(m,{emit:p}){const r=m,K=p,{disabled:$,accion:b}=r.mixin.useReferencias(),{setValidador:I}=r.mixin.useComportamiento(),{confirmar:W,prompt:J}=Ie(),U=new Se,j=Pe(),n=r.conductor,x=de(!1),h={fecha_pago:null,comentario:null};let q;ue(()=>console.log("InformacionLicencia -> Montado")),me(()=>{console.log("InformacionLicencia -> Desmontado"),q={tipo_licencia:{required:g(!1)},puntos:{required:g(!1)},licencias:{$each:H.forEach({tipo_licencia:{required:g(()=>!1)},inicio_vigencia:{required:g(()=>!1)},fin_vigencia:{required:g(()=>!1)}})}};const t=z(q,n);I(t.value)}),q={tipo_licencia:{required:g(()=>r.validar)},puntos:{required:g(()=>r.validar),maximo:ke(30),minimo:xe(0)},licencias:{$each:H.forEach({tipo_licencia:{required:g(()=>r.validar)},inicio_vigencia:{required:g(()=>r.validar)},fin_vigencia:{required:g(()=>r.validar)}})}};const f=z(q,n);I(f.value);async function Y(t){switch(t){case"MultaConductorPage":r.consultarMultas&&await L(),K("guardado","MultaConductorPage");break;default:console.log("No se recibio data")}}function X(t){n.licencias[t].fin_vigencia=R(Ue(n.licencias[t].inicio_vigencia,5),k),n.licencias[t].fin_vigencia=R(je(n.licencias[t].fin_vigencia,-1),k)}function Z(){r.identificacion?window.open(`https://consultaweb.ant.gob.ec/PortalWEB/paginas/clientes/clp_grid_citaciones.jsp?ps_tipo_identificacion=CED&ps_identificacion=${r.identificacion}&ps_placa=`,"_blank"):window.open("https://consultaweb.ant.gob.ec/PortalWEB/paginas/clientes/clp_criterio_consulta.jsp","_blank")}async function L(){const{result:t}=await new Be().listar({empleado_id:n.empleado});n.multas=t}async function ee(t){h.fecha_pago=t,await j.pagarMulta(h)&&await L()}function ae(t){console.log(t);const o=new De;o.tipo_licencia=t.value,n.licencias.push(o)}function oe(t){n.licencias.splice(t.index,1)}const ie={titulo:"Agregar multa",icono:"bi-file-text",color:"positive",tooltip:"Agregar multa asociado al conductor",accion:()=>{U.abrirModalEntidad("MultaConductorPage")},visible:()=>b.value==C.editar},le={titulo:"Editar",icono:"bi-pencil-square",color:"secondary",tooltip:"Editar",accion:({entidad:t})=>{W("\xBFEst\xE1 seguro de marcar como pagada la multa?",async()=>{J({titulo:"Fecha de pago",mensaje:"\xBFTienes alguna observaci\xF3n al respecto?",validacion:a=>a!=null,accion:async a=>{j.idMulta=t.id,h.comentario=a,h.fecha_pago==null&&(x.value=!0)}})}),h.comentario=null,h.fecha_pago=null},visible:({entidad:t})=>(b.value==C.nuevo||b.value==C.editar)&&!t.estado};return(t,o)=>(d(),T(Me,{class:"overflow-hidden q-mb-md expansion",label:"Informaci\xF3n de Licencia","header-class":"text-bold bg-header-collapse","default-opened":""},{default:l(()=>[s("div",Ne,[s("div",Oe,[s("div",Ae,[o[4]||(o[4]=s("label",{class:"q-mb-sm block"},"Puntos",-1)),i(E,{modelValue:e(n).puntos,"onUpdate:modelValue":o[0]||(o[0]=a=>e(n).puntos=a),type:"number",step:".5",disable:e($),error:!!e(f).puntos.$errors.length,hint:"Todo conductor debe tener un puntaje mayor o igual a 20 pts","error-message":"Debe ingresar un valor entre 0 y 30",onBlur:e(f).puntos.$touch,outlined:"",dense:""},{error:l(()=>[(d(!0),u(V,null,M(e(f).puntos.$errors,a=>(d(),u("div",{key:a.$uid},[s("div",ze,_(a.$message),1)]))),128))]),_:1},8,["modelValue","disable","error","onBlur"])]),s("div",Re,[o[6]||(o[6]=s("label",{class:"q-mb-sm block"},"Tipo de Licencia",-1)),i(he,{modelValue:e(n).tipo_licencia,"onUpdate:modelValue":o[1]||(o[1]=a=>e(n).tipo_licencia=a),options:e(we),"transition-show":"jump-up","transition-hide":"jump-down",hint:"Obligatorio",disable:e($),"options-dense":"",dense:"",outlined:"","use-chips":"",multiple:"",error:!!e(f).tipo_licencia.$errors.length,"error-message":"Debes seleccionar un tipo de licencia",onAdd:ae,onRemove:oe,"option-value":a=>a.value,"option-label":a=>a.label,"emit-value":"","map-options":""},{option:l(({itemProps:a,opt:v,selected:c,toggleOption:te})=>[i(D,pe(fe(a)),{default:l(()=>[i(B,null,{default:l(()=>[i(be,null,{default:l(()=>[s("strong",null,_(v.label),1),w(" - "+_(v.caption),1)]),_:2},1024)]),_:2},1024),i(B,{side:""},{default:l(()=>[i(ge,{"model-value":c,"onUpdate:modelValue":la=>te(v)},null,8,["model-value","onUpdate:modelValue"])]),_:2},1024)]),_:2},1040)]),error:l(()=>[(d(!0),u(V,null,M(e(f).tipo_licencia.$errors,a=>(d(),u("div",{key:a.$uid},[s("div",He,_(a.$message),1)]))),128))]),"no-option":l(()=>[i(D,null,{default:l(()=>[i(B,{class:"text-grey"},{default:l(()=>o[5]||(o[5]=[w(" No hay resultados ")])),_:1})]),_:1})]),_:1},8,["modelValue","options","disable","error","option-value","option-label"])])]),e(n).licencias!==void 0?(d(),T(ve,{key:0,class:"q-mx-sm block",vertical:""})):F("",!0),s("div",Ge,[e(n).licencias!==void 0?(d(),u("div",Ke,[(d(!0),u(V,null,M(e(n).licencias,(a,v)=>(d(),u("div",{class:"row q-col-gutter-sm",key:a.tipo_licencia},[s("div",We,[o[7]||(o[7]=s("label",{class:"q-mb-sm block"},"Tipo",-1)),i(Ce,null,{default:l(()=>[w(_(a.tipo_licencia),1)]),_:2},1024)]),s("div",Je,[o[8]||(o[8]=s("label",{class:"q-mb-sm block"},"Fecha Inicial Vigencia",-1)),i(E,{modelValue:a.inicio_vigencia,"onUpdate:modelValue":c=>a.inicio_vigencia=c,placeholder:"Obligatorio",disable:e($),error:!!e(f).licencias.$each.$response.$errors[v].inicio_vigencia.length,outlined:"",dense:""},{append:l(()=>[i(Q,{name:"event",class:"cursor-pointer"},{default:l(()=>[i(N,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:l(()=>[i(O,{modelValue:a.inicio_vigencia,"onUpdate:modelValue":[c=>a.inicio_vigencia=c,c=>X(v)],mask:e(k),"today-btn":""},{default:l(()=>[s("div",Ye,[S(i(P,{label:"Cerrar",color:"primary",flat:""},null,512),[[A]])])]),_:2},1032,["modelValue","onUpdate:modelValue","mask"])]),_:2},1024)]),_:2},1024)]),error:l(()=>[(d(!0),u(V,null,M(e(f).licencias.$each.$response.$errors[v].inicio_vigencia,c=>(d(),u("div",{key:c.$uid},[s("div",Xe,_(c.$message),1)]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","disable","error"])]),s("div",Ze,[o[9]||(o[9]=s("label",{class:"q-mb-sm block"},"Fecha Final Vigencia",-1)),i(E,{modelValue:a.fin_vigencia,"onUpdate:modelValue":c=>a.fin_vigencia=c,placeholder:"Obligatorio",error:!!e(f).licencias.$each.$response.$errors[v].fin_vigencia.length,disable:e($),outlined:"",dense:""},{append:l(()=>[i(Q,{name:"event",class:"cursor-pointer"},{default:l(()=>[i(N,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:l(()=>[i(O,{modelValue:a.fin_vigencia,"onUpdate:modelValue":c=>a.fin_vigencia=c,mask:e(k),"today-btn":""},{default:l(()=>[s("div",ea,[S(i(P,{label:"Cerrar",color:"primary",flat:""},null,512),[[A]])])]),_:2},1032,["modelValue","onUpdate:modelValue","mask"])]),_:2},1024)]),_:2},1024)]),error:l(()=>[(d(!0),u(V,null,M(e(f).licencias.$each.$response.$errors[v].fin_vigencia,c=>(d(),u("div",{key:c.$uid},[s("div",aa,_(c.$message),1)]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","error","disable"])])]))),128))])):F("",!0)]),s("div",oa,[i(P,{color:"primary",dense:"",rounded:"","no-caps":"","no-wrap":"",unelevated:"",class:"q-px-sm",onClick:Z},{default:l(()=>[i(Q,{name:"bi-search",size:"xs",class:"q-mr-xs"}),o[11]||(o[11]=s("span",null,"Consultar multas ",-1)),i(ye,null,{default:l(()=>o[10]||(o[10]=[w("Consultar puntos y vigencia de licencia del chofer")])),_:1})]),_:1})]),e(b)==e(C).editar||e(b)==e(C).consultar?(d(),u("div",ia,[i(qe,{ref:"refMultas",titulo:"Multas del Conductor",configuracionColumnas:e(b)==e(C).editar?[...e(G),e(_e)]:e(G),datos:e(n).multas,accion1Header:ie,permitirBuscar:!1,permitirConsultar:!1,permitirEditar:!1,permitirEliminar:!1,mostrarBotones:!1,mostrarCantidadElementos:!1,permitirEditarModal:!0,modalMaximized:!1,"alto-fijo":!1,ajustarCeldas:"",mostrarFooter:!1,accion1:le},null,8,["configuracionColumnas","datos"])])):F("",!0)]),i($e,{mostrar:x.value,reason:"mask",label:"Fecha de pago",confirmar:ee,onCerrar:o[2]||(o[2]=a=>x.value=!1)},null,8,["mostrar"]),i(Ve,{comportamiento:e(U),persistente:!1,onGuardado:o[3]||(o[3]=a=>Y(a))},null,8,["comportamiento"])]),_:1}))}});export{Se as C,$a as _,G as c};
