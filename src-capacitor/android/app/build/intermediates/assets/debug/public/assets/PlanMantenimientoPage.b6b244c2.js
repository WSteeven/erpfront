var se=Object.defineProperty;var te=(e,o,n)=>o in e?se(e,o,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[o]=n;var u=(e,o,n)=>(te(e,typeof o!="symbol"?o+"":o,n),n);import{Q as re,a as T}from"./QSelect.6ce302d7.js";import{Q as L,a as K}from"./QItemSection.9a955ec6.js";import{bw as ne,s as de,c as k,bf as ce,d as ue,m as R,u as me,e as pe,bx as m,p as ve,_ as fe,t as M,v as p,x as v,z as l,F as t,a4 as be,y as s,M as ge,N as Se,D as q,K as Q,I as P,J as w,G as U,H as Ve,a7 as he,a2 as Ce,O as Ee}from"./index.6449c167.js";import{Q as ye}from"./QForm.ca56f146.js";import{S as Me,c as f}from"./ServicioPage.c3bfd6ce.js";import{r as O}from"./i18n-validators.29e2545c.js";import{u as qe}from"./index.490dde02.js";import{T as Pe}from"./TabLayout.0bce4313.js";import{E as we}from"./EssentialTable.00c17e97.js";import{E as ke}from"./EssentialSelectableTable.5a9cc771.js";import{M as Be}from"./ModalEntidad.168b465e.js";import{C as Ae}from"./ContenedorSimpleMixin.09c9bed5.js";import{E as Ne}from"./entidadAuditable.75a46700.js";import{V as Fe}from"./VehiculoController.5e90ff0e.js";import{u as Qe}from"./filtrosListadosGenerales.c3aa2da3.js";import{u as $e}from"./selector.9691ac4b.js";import{a as Ie,b as Te,u as Le}from"./utils.521b98f3.js";import{C as Ke,a as Re}from"./ComponenteModal.domain.50e59f97.js";import{V as j}from"./Vehiculo.34ef9eb5.js";import"./QChip.95469f73.js";import"./position-engine.70d0a89f.js";import"./format.8ac60962.js";import"./TabLayoutFilterTabs2.5e702525.js";import"./QTabs.6c234f27.js";import"./QResizeObserver.9af84680.js";import"./QTabPanels.49d2362a.js";import"./touch.9135741d.js";import"./QPopupProxy.72ff1d6d.js";import"./QPage.5d173a8a.js";import"./EssentialTableTabs.586dbdfc.js";import"./QBadge.e6f320cd.js";import"./EssentialTablePagination.d5c1010a.js";import"./QToolbar.8dbe891b.js";import"./use-fullscreen.a7661f85.js";import"./buttonSubmits.fe817da3.js";import"./ServicioController.a8bbd86b.js";import"./vehiculos.utils.c31e027d.js";import"./index.0198dd12.js";import"./_commonjsHelpers.8402d862.js";import"./QImg.fd079679.js";import"./QFile.90d9394a.js";import"./VisorImagen.75b3c53f.js";import"./logo.4781eea2.js";import"./seleccionContratacionPersonal.utils.e3e1ed3d.js";import"./configuracion_general.37a05c0a.js";import"./ConfiguracionController.c50d9536.js";import"./SelectorController.de8e1cd0.js";const Ue=[{name:"vehiculo",field:"vehiculo",label:"Placa",align:"left",sortable:!0},{name:"aplicar_desde",field:"aplicar_desde",label:"Aplicar desde (km)",align:"left",sortable:!0},{name:"cantidad_servicios",field:"cantidad_servicios",label:"Cant. Servicios",align:"left",sortable:!0}];class D extends Ne{constructor(){super();u(this,"vehiculo");u(this,"aplicar_desde");u(this,"listadoServicios");u(this,"cantidad_servicios");u(this,"activo");this.vehiculo=null,this.aplicar_desde=null,this.listadoServicios=[],this.cantidad_servicios=null,this.activo=!0}}class Oe extends ne{constructor(){super(de.planes_mantenimientos)}}function je(e,o){const n=k(),r=k([]),b=k(),d={refListadoSeleccionable:n,listadoSeleccionable:r,endpoint:o,limpiar:()=>{e.id=null,b.value=null},seleccionar:i=>{e.listadoServicios=[...e.listadoServicios,...i]}},S=$e(d);return{refListadoSeleccionable:n,listado:r,listar:i=>S.listar(b.value,i),limpiar:()=>d.limpiar(),seleccionar:i=>{let y=[];y=e.listadoServicios.map(g=>g.id);const B=i.filter(g=>!y.includes(g.id));d.seleccionar(B)},criterioBusqueda:b}}class De{constructor(){u(this,"ServicioPage");this.ServicioPage=ce(new Ke("Nuevo Servicio",Me))}}class He extends Re{constructor(){super(new De)}}var ze=ue({components:{TabLayout:Pe,EssentialTable:we,EssentialSelectableTable:ke,ModalesEntidad:Be},setup(){const e=new Ae(D,new Oe),{entidad:o,listado:n,accion:r,disabled:b,listadosAuxiliares:d}=e.useReferencias(),{setValidador:S,obtenerListados:h,cargarVista:C}=e.useComportamiento(),{onConsultado:E,onReestablecer:i,onBeforeConsultar:y}=e.useHooks(),{confirmar:B,prompt:g,notificarCorrecto:so,notificarError:to}=Ie();Te().setQuasar(R()),Le().setQuasar(R());const A=me(),H=k(),N=pe(new j),$=new He,{refListadoSeleccionable:z,criterioBusqueda:G,listado:J,listar:W,limpiar:X,seleccionar:Y}=je(o,"servicios");y(()=>{o.hydrate(new D)}),E(()=>{const a=F.value.filter(c=>c.id===o.vehiculo)[0];console.log(a),N.hydrate(a)}),i(()=>{N.hydrate(new j)});const{vehiculos:F,filtrarVehiculos:Z}=Qe(d);C(async()=>{await h({vehiculos:{controller:new Fe,params:{campos:"id,placa,modelo_id"}}}),F.value=d.vehiculos});const I=qe({vehiculo:{required:O},aplicar_desde:{required:O}},o);S(I.value);function _({posicion:a}){B("\xBFEst\xE1 seguro de continuar?",()=>o.listadoServicios.splice(a,1))}function x(a){console.log(a),a.formulario=="ServicioPage"&&o.listadoServicios.push(a.modelo)}const ee={titulo:"Eliminar",icono:"bi-trash",color:"negative",accion:({entidad:a,posicion:c})=>{_({posicion:c})},visible:()=>(r.value==m.nuevo||r.value==m.editar)&&(A.esAdministradorVehiculos||A.esAdministrador)},oe={titulo:"Cantidad",icono:"bi-pencil",accion:({posicion:a})=>{const c={titulo:"Modifica",mensaje:"Ingresa cada cu\xE1ntos  KM se aplicar\xE1 este servicio",tipo:"number",defecto:o.listadoServicios[a].intervalo,accion:V=>o.listadoServicios[a].intervalo=V};g(c)},visible:()=>r.value!=m.consultar},ie={titulo:"Notificaci\xF3n",color:"positive",icono:"bi-bell-fill",accion:({posicion:a})=>{const c={titulo:"Modifica",mensaje:"Ingresa los KM faltantes donde se realizar\xE1 la notificaci\xF3n autom\xE1tica",tipo:"number",validacion:V=>Number.isInteger(parseFloat(V)),defecto:o.listadoServicios[a].notificar_antes,accion:V=>o.listadoServicios[a].notificar_antes=V};g(c)},visible:()=>r.value!=m.consultar},ae={titulo:"Agregar Servicio",icono:"bi-plus",tooltip:"Agregar nuevo servicio",accion:()=>{$.abrirModalEntidad("ServicioPage")},visible:()=>r.value==m.nuevo||r.value==m.editar};f.splice(4,1),f.find(a=>a.field=="nombre").editable=!1,f.find(a=>a.field=="intervalo").editable=!0,f.find(a=>a.field=="intervalo").type="number",f.find(a=>a.field=="notificar_antes").editable=!0,f.find(a=>a.field=="notificar_antes").type="number";const le=[...f,{name:"datos_adicionales",field:"datos_adicionales",label:"Datos adicionales",align:"left",editable:!0}];return{mixin:e,v$:I,plan:o,disabled:b,accion:r,acciones:m,configuracionColumnas:Ue,configuracionColumnasServicios:le,accionesTabla:ve,modales:$,vehiculo:N,vehiculos:F,filtrarVehiculos:Z,serviciosSeleccionados:H,adminVehiculos:A.esAdministradorVehiculos,refListado:z,criterioBusqueda:G,listadoServicios:J,listarServicios:W,limpiarServicios:X,seleccionarServicio:Y,guardado:x,btnEditarFila:oe,btnEliminarFila:ee,btnAgregarServicio:ae,btnEditarNotificar:ie}}});const Ge={class:"row q-col-gutter-sm q-py-md"},Je={class:"col-12 col-md-3 q-mb-md"},We={key:0,class:"col-12 col-md-3 q-mb-md"},Xe={key:1,class:"col-12 col-md-3 q-mb-md"},Ye={class:"col-12 col-md-3 q-mb-md"},Ze={class:"error-msg"},_e={key:2,class:"col-12 col-md-3"},xe={class:"col-12 col-md-12"},eo={class:"row q-col-gutter-x-xs"},oo={class:"col-12 col-md-10 q-mb-md"},io={class:"col-12 col-md-2"},ao={key:3,class:"col-12"};function lo(e,o,n,r,b,d){const S=M("essential-table"),h=M("essential-selectable-table"),C=M("tab-layout"),E=M("modales-entidad");return p(),v(U,null,[l(C,{mixin:e.mixin,configuracionColumnas:e.configuracionColumnas,"titulo-pagina":"Control diario de veh\xEDculos"},{formulario:t(()=>[l(ye,{onSubmit:o[9]||(o[9]=be(()=>{},["prevent"]))},{default:t(()=>[s("div",Ge,[s("div",Je,[o[12]||(o[12]=s("label",{class:"q-mb-sm block"},"Veh\xEDculo",-1)),l(re,{modelValue:e.plan.vehiculo,"onUpdate:modelValue":o[0]||(o[0]=i=>e.plan.vehiculo=i),options:e.vehiculos,hint:"Agregue elementos desde el panel de veh\xEDculos","transition-show":"scale","transition-hide":"scale","options-dense":"",clearable:"",dense:"",outlined:"",readonly:e.disabled,disable:e.disabled,"use-input":"","input-debounce":"0",onFilter:e.filtrarVehiculos,"option-label":i=>i.placa,"option-value":i=>i.id,"emit-value":"","map-options":""},{option:t(i=>[l(L,ge(Se(i.itemProps)),{default:t(()=>[l(K,null,{default:t(()=>[l(T,null,{default:t(()=>[q(Q(i.opt.placa),1)]),_:2},1024),l(T,{caption:""},{default:t(()=>[q(Q(i.opt.marca+" "+i.opt.modelo),1)]),_:2},1024)]),_:2},1024)]),_:2},1040)]),"no-option":t(()=>[l(L,null,{default:t(()=>[l(K,{class:"text-grey"},{default:t(()=>o[11]||(o[11]=[q(" No hay resultados ")])),_:1})]),_:1})]),_:1},8,["modelValue","options","readonly","disable","onFilter","option-label","option-value"])]),e.vehiculo.marca?(p(),v("div",We,[o[13]||(o[13]=s("label",{class:"q-mb-sm block"},"Marca",-1)),l(P,{modelValue:e.vehiculo.marca,"onUpdate:modelValue":o[1]||(o[1]=i=>e.vehiculo.marca=i),disable:"",outlined:"",dense:""},null,8,["modelValue"])])):w("",!0),e.vehiculo.modelo?(p(),v("div",Xe,[o[14]||(o[14]=s("label",{class:"q-mb-sm block"},"Modelo",-1)),l(P,{modelValue:e.vehiculo.modelo,"onUpdate:modelValue":o[2]||(o[2]=i=>e.vehiculo.modelo=i),disable:"",outlined:"",dense:""},null,8,["modelValue"])])):w("",!0),s("div",Ye,[o[15]||(o[15]=s("label",{class:"q-mb-sm block"},"Aplicar desde (Km)",-1)),l(P,{modelValue:e.plan.aplicar_desde,"onUpdate:modelValue":o[3]||(o[3]=i=>e.plan.aplicar_desde=i),placeholder:"Obligatorio",type:"number",min:"0",disable:e.disabled,error:!!e.v$.aplicar_desde.$errors.length,outlined:"",dense:""},{error:t(()=>[(p(!0),v(U,null,Ve(e.v$.aplicar_desde.$errors,i=>(p(),v("div",{key:i.$uid},[s("div",Ze,Q(i.$message),1)]))),128))]),_:1},8,["modelValue","disable","error"])]),e.accion==e.acciones.editar||e.accion==e.acciones.consultar?(p(),v("div",_e,[o[16]||(o[16]=s("br",null,null,-1)),l(he,{modelValue:e.plan.activo,"onUpdate:modelValue":o[4]||(o[4]=i=>e.plan.activo=i),"checked-icon":"check",disable:e.disabled,label:e.plan.activo?"Plan Activo":"Plan Inactivo",color:"positive"},null,8,["modelValue","disable","label"])])):w("",!0),s("div",xe,[o[18]||(o[18]=s("label",{class:"q-mb-sm block"},"Agregar Servicios",-1)),s("div",eo,[s("div",oo,[l(P,{modelValue:e.criterioBusqueda,"onUpdate:modelValue":o[5]||(o[5]=i=>e.criterioBusqueda=i),disable:e.disabled,placeholder:"Nombre del servicio",hint:"Presiona Enter para seleccionar un servicio",onKeydown:o[6]||(o[6]=Ce(i=>e.listarServicios({search:e.criterioBusqueda,tipo:"PREVENTIVO",estado:1}),["enter"])),onBlur:o[7]||(o[7]=i=>e.criterioBusqueda===""?e.limpiarServicios():null),outlined:"",dense:""},null,8,["modelValue","disable"])]),s("div",io,[l(Ee,{onClick:o[8]||(o[8]=i=>e.listarServicios({search:e.criterioBusqueda,tipo:"PREVENTIVO",estado:1})),icon:"search",unelevated:"",color:"positive",class:"full-width",style:{height:"40px"},disable:e.disabled,"no-caps":"",glossy:""},{default:t(()=>o[17]||(o[17]=[q("Buscar")])),_:1},8,["disable"])])])]),e.plan.listadoServicios.length>0?(p(),v("div",ao,[l(S,{titulo:"Productos Seleccionados",configuracionColumnas:e.accion==e.acciones.nuevo||e.accion==e.acciones.editar?[...e.configuracionColumnasServicios,e.accionesTabla]:e.configuracionColumnasServicios,datos:e.plan.listadoServicios,separador:"cell",desplegarDesde:3,permitirConsultar:!1,permitirEditar:!1,"permitir-editar-celdas":"",disable:e.disabled,permitirEliminar:!1,mostrarBotones:!1,ajustarCeldas:!0,altoFijo:!1,accion1Header:e.btnAgregarServicio,accion1:e.btnEliminarFila},null,8,["configuracionColumnas","datos","disable","accion1Header","accion1"])])):w("",!0)])]),_:1}),l(h,{ref:"refListado","configuracion-columnas":e.configuracionColumnasServicios,datos:e.listadoServicios,"tipo-seleccion":"multiple",onSelected:e.seleccionarServicio},null,8,["configuracion-columnas","datos","onSelected"])]),_:1},8,["mixin","configuracionColumnas"]),l(E,{comportamiento:e.modales,persistente:!1,mostrarListado:!1,onGuardado:o[10]||(o[10]=i=>e.guardado(i))},null,8,["comportamiento"])],64)}var ai=fe(ze,[["render",lo]]);export{ai as default};
