var ho=Object.defineProperty;var $o=(o,e,c)=>e in o?ho(o,e,{enumerable:!0,configurable:!0,writable:!0,value:c}):o[e]=c;var l=(o,e,c)=>($o(o,typeof e!="symbol"?e+"":e,c),c);import{bw as X,s as S,A as yo,bD as wo,d as Ao,m as Vo,c as k,u as Co,E as Fo,a1 as G,bx as H,q as _o,d3 as ko,d4 as So,_ as qo,t as D,v as r,P as J,F as n,z as t,y as s,x as d,I as A,B,j as Eo,O as I,G as h,H as $,D as f,J as V,a6 as Do,K as g,a4 as Bo}from"./index.6449c167.js";import{Q as Io,a as Qo,C as Oo}from"./QPopupProxy.72ff1d6d.js";import{Q,a as O}from"./QItemSection.9a955ec6.js";import{Q as L}from"./QSelect.6ce302d7.js";import{Q as Lo}from"./QChip.95469f73.js";import{a as To}from"./QToolbar.8dbe891b.js";import{Q as No}from"./QForm.ca56f146.js";import{E as Uo}from"./entidadAuditable.75a46700.js";import{T as Mo}from"./TabLayoutFilterTabs2.5e702525.js";import{b as jo,S as Po,a as Ro,w as Yo,O as zo,x as K}from"./utils.521b98f3.js";import{u as Go}from"./index.490dde02.js";import{r as y,c as Ho}from"./i18n-validators.29e2545c.js";import{C as Z}from"./ContenedorSimpleMixin.09c9bed5.js";import{T as Jo}from"./TipoFonfoController.f781a23b.js";import{u as Ko}from"./filtrosListadosGenerales.c3aa2da3.js";import{O as Zo}from"./OptionGroupComponent.71cce103.js";import{G as Wo}from"./GestorDocumentos.59a805e5.js";import"./format.8ac60962.js";import"./position-engine.70d0a89f.js";import"./QTabs.6c234f27.js";import"./QResizeObserver.9af84680.js";import"./QTabPanels.49d2362a.js";import"./touch.9135741d.js";import"./QPage.5d173a8a.js";import"./EssentialTableTabs.586dbdfc.js";import"./QBadge.e6f320cd.js";import"./EssentialTablePagination.d5c1010a.js";import"./EssentialTable.00c17e97.js";import"./use-fullscreen.a7661f85.js";import"./_commonjsHelpers.8402d862.js";import"./QImg.fd079679.js";import"./QFile.90d9394a.js";import"./VisorImagen.75b3c53f.js";import"./logo.4781eea2.js";import"./seleccionContratacionPersonal.utils.e3e1ed3d.js";import"./buttonSubmits.fe817da3.js";import"./index.0198dd12.js";import"./QUploader.cca1b7bd.js";import"./QCircularProgress.b24a7ee9.js";class T extends Uo{constructor(){super();l(this,"id_tipo_saldo");l(this,"tipo_saldo");l(this,"id_saldo");l(this,"tipo_saldo_info");l(this,"id_tipo_fondo");l(this,"tipo_fondo_info");l(this,"tipo_fondo");l(this,"estado");l(this,"descripcion_acreditacion");l(this,"saldo_anterior");l(this,"saldo_depositado");l(this,"monto");l(this,"motivo");l(this,"saldo_actual");l(this,"fecha_inicio");l(this,"fecha_fin");l(this,"id_usuario");l(this,"usuario");l(this,"empleado_info");l(this,"id_estatus");l(this,"estatus");l(this,"estatus_info");l(this,"transcriptor");l(this,"fecha_trans");l(this,"fecha");this.id_tipo_saldo=null,this.id_saldo=null,this.tipo_saldo_info=null,this.tipo_saldo=null,this.id_tipo_fondo=null,this.tipo_fondo_info=null,this.estado=null,this.tipo_fondo=null,this.descripcion_acreditacion=null,this.saldo_anterior=null,this.saldo_depositado=null,this.saldo_actual=null,this.motivo=null,this.monto=null,this.fecha_inicio=null,this.fecha_fin=null,this.id_usuario=null,this.usuario=null,this.empleado_info=null,this.id_estatus=null,this.estatus_info=null,this.estatus=null,this.transcriptor=null,this.fecha_trans=null,this.fecha=null}}class W extends X{constructor(){super(S.acreditacion)}}const Xo=[{name:"fecha",field:"fecha",label:"Fecha Fondo",align:"left",sortable:!0},{name:"descripcion_acreditacion",field:"descripcion_acreditacion",label:"Descripcion",align:"left",sortable:!0},{name:"estado",field:"estado",label:"Estado",align:"left",sortable:!0},{name:"motivo",field:"motivo",label:"Motivo Anulacion",align:"left",sortable:!0},{name:"monto",field:"monto",label:"Monto",align:"left",sortable:!0},{name:"empleado_info",field:"empleado_info",label:"Usuario",align:"left",sortable:!0}];class xo extends X{constructor(){super(S.tipo_saldo)}}class oe{constructor(){l(this,"axios");this.axios=yo.getInstance()}async anularAcreditacion(e){try{await this.axios.post(this.axios.getEndpoint(S.anular_acreditacion),e)}catch(c){const C=c;throw new wo(C)}}}var ee=Ao({components:{GestorDocumentos:Wo,OptionGroupComponent:Zo,TabLayoutFilterTabs2:Mo},setup(){jo().setQuasar(Vo());const o=new Po,e=k(),c=new Z(T,new W),C=new Z(T,new W),{entidad:m,disabled:N,accion:w,listadosAuxiliares:p,listado:q,tabs:i,filtros:U}=c.useReferencias(),{setValidador:x,obtenerListados:oo,cargarVista:eo,listar:io}=c.useComportamiento(),{confirmar:ao,prompt:M,notificarCorrecto:so,notificarAdvertencia:lo,notificarError:j}=Ro(),to={usuario:{required:y},tipo_fondo:{required:y},tipo_saldo:{required:y},id_saldo:{required:y},descripcion_acreditacion:{required:y},monto:{maxValue:Ho(9999),required:y}},P=Go(to,m);x(P.value);const R=k(!0),{empleados:Y,filtrarEmpleados:no}=Ko(p),F=k([]),_=k([]),ro=Co(),z=new oe;eo(async()=>{await oo({empleados:{controller:new Fo,params:{campos:"id,nombres,apellidos",estado:1}},tiposFondos:{controller:new Jo,params:{campos:"id,descripcion"}},tiposSaldos:{controller:new xo,params:{campos:"id,descripcion"}}}),Y.value=p.empleados,F.value=p.tiposFondos,_.value=p.tiposSaldos});function uo(a,u){if(a===""){u(()=>{F.value=p.tiposFondos});return}u(()=>{const b=a.toLowerCase();F.value=p.tiposFondos.filter(v=>v.descripcion.toLowerCase().indexOf(b)>-1)})}function co(a,u){if(a===""){u(()=>{_.value=p.tiposSaldos});return}u(()=>{const b=a.toLowerCase();_.value=p.tiposSaldos.filter(v=>v.descripcion.toLowerCase().indexOf(b)>-1)})}async function mo(){const a=new So;if(m.usuario){const{response:u}=await a.consultar(parseInt(m.usuario));m.saldo_anterior=u.data.saldo_actual}}function po(a){ao("\xBFEst\xE1 seguro de anular la acreditacion?",()=>{M({titulo:"Anular Acreditacion",mensaje:"Ingrese motivo de anulacion",accion:async b=>{try{o.activar(),a.descripcion_acreditacion=b,await z.anularAcreditacion(a),lo("Se anulado Acreditacion Exitosamente"),await E("2"),w.value=H.nuevo,m.hydrate(new T),o.desactivar()}catch{j("No se pudo anular, debes ingresar un motivo para la anulaci\xF3n")}}})})}function fo(a){const u=zo(K(),0,0,-15,"YYYY/MM/DD");return a>=u&&a<=K("YYYY/MM/DD")}async function bo(){try{await e.value.subir(),e.value.quiero_subir_archivos=!1,R.value=!0,setTimeout(async()=>{var a;(a=e.value)==null||a.limpiarListado(),i.value="listado",await E("1")},1e3)}catch(a){console.error(`Error es: ${a}`)}}const vo={titulo:"",icono:"bi-trash",color:"negative",visible:()=>ro.can("puede.eliminar.acreditacion"),accion:({entidad:a,posicion:u})=>{w.value="ELIMINAR",go({entidad:a,posicion:u})}};async function go({entidad:a,posicion:u}){try{M({titulo:"Eliminar Acreditacion",mensaje:"Ingrese motivo de eliminacion",accion:async v=>{a.estado=!1,a.motivo=v,a.descripcion_acreditacion=v,await z.anularAcreditacion(a),so("Se ha eliminado Acreditacion"),q.value.splice(u,1)}})}catch{j("No se pudo anular, debes ingresar un motivo para la anulacion")}}async function E(a){await io({id_estado:a,paginate:!0},!1),U.fields={id_estado:a}}return G(()=>m.saldo_actual=parseFloat(m.saldo_anterior!==null?m.saldo_anterior.toString():"0")+parseFloat(m.monto!==null?m.monto.toString():"0")),{mixin:c,mixin2:C,acreditacion:m,options:[{label:"INDIVIDUAL",value:!0},{label:"POR LOTES",value:!1}],disabled:N,accion:w,acciones:H,refArchivo:e,v$:P,tiposFondos:F,tiposSaldos:_,maskFecha:_o,modoIndividual:R,endpoint:S.acreditaciones_lotes,ordenarLista:Yo,optionsFecha:fo,saldo_anterior:mo,empleados:Y,filtrarEmpleados:no,filtrarTiposFondos:uo,filtrarTiposSaldos:co,filtrarAcreditacion:E,btnEliminarAcreditacion:vo,tabAcreditacion:ko,anularAcreditacion:po,subirArchivos:bo,watchEffect:G,configuracionColumnas:Xo}}});const ie={class:"row q-col-gutter-sm q-mb-md"},ae={class:"col-12 col-md-4"},se={key:0,class:"row q-col-gutter-sm q-mb-md"},le={class:"col-12 col-md-3"},te={class:"row items-center justify-end"},ne={class:"col-12 col-md-3 q-mb-md"},re={class:"error-msg"},de={class:"col-12 col-md-3 q-mb-md"},ue={class:"error-msg"},ce={class:"col-12 col-md-3 q-mb-md"},me={class:"error-msg"},pe={class:"col-12 col-md-3"},fe={class:"error-msg"},be={class:"col-12 col-md-3"},ve={class:"error-msg"},ge={key:0,class:"col-12 col-md-3"},he={class:"col-12 col-md-3"},$e={class:"error-msg"},ye={key:1,class:"col-12 col-md-3"},we={key:1,class:"row q-col-gutter-sm q-mb-md"},Ae={key:0,class:"col-12 col-md-12"},Ve={class:"q-mb-sm block"},Ce={key:0,class:"q-pa-md q-gutter-sm flex flex-center"};function Fe(o,e,c,C,m,N){const w=D("option-group-component"),p=D("gestor-documentos"),q=D("tab-layout-filter-tabs2");return r(),J(q,{mixin:o.mixin,configuracionColumnas:o.configuracionColumnas,accion1:o.btnEliminarAcreditacion,permitirEliminar:!1,tabOptions:o.tabAcreditacion,filtrar:o.filtrarAcreditacion,tabDefecto:"1",forzarListar:!0,paginate:"",ajustarCeldas:""},{formulario:n(()=>[t(No,{onSubmit:e[13]||(e[13]=Bo(()=>{},["prevent"]))},{default:n(()=>[s("div",ie,[s("div",ae,[e[15]||(e[15]=s("label",{class:"q-mb-sm block"},"Modo de carga",-1)),t(w,{modelValue:o.modoIndividual,"onUpdate:modelValue":e[0]||(e[0]=i=>o.modoIndividual=i),disable:o.disabled,options:o.options},null,8,["modelValue","disable","options"])])]),o.modoIndividual?(r(),d("div",se,[s("div",le,[e[16]||(e[16]=s("label",{class:"q-mb-sm block"},"Fecha",-1)),t(A,{modelValue:o.acreditacion.fecha,"onUpdate:modelValue":e[2]||(e[2]=i=>o.acreditacion.fecha=i),placeholder:"Opcional",disable:o.disabled,outlined:"",dense:""},{append:n(()=>[t(B,{name:"event",class:"cursor-pointer"},{default:n(()=>[t(Io,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:n(()=>[t(Qo,{modelValue:o.acreditacion.fecha,"onUpdate:modelValue":e[1]||(e[1]=i=>o.acreditacion.fecha=i),mask:o.maskFecha,options:o.optionsFecha,"today-btn":""},{default:n(()=>[s("div",te,[Eo(t(I,{label:"Cerrar",color:"primary",flat:""},null,512),[[Oo]])])]),_:1},8,["modelValue","mask","options"])]),_:1})]),_:1})]),_:1},8,["modelValue","disable"])]),s("div",ne,[e[18]||(e[18]=s("label",{class:"q-mb-sm block"},"Empleado",-1)),t(L,{autogrow:"",modelValue:o.acreditacion.usuario,"onUpdate:modelValue":[e[3]||(e[3]=i=>o.acreditacion.usuario=i),e[5]||(e[5]=i=>o.saldo_anterior())],options:o.empleados,"transition-show":"jump-up","transition-hide":"jump-down","options-dense":"",dense:"",outlined:"",disable:o.disabled,readonly:o.disabled,error:!!o.v$.usuario.$errors.length,onBlur:o.v$.usuario.$touch,"error-message":"Debes seleccionar un empleado","use-input":"","input-debounce":"0",onPopupShow:e[4]||(e[4]=i=>o.ordenarLista(o.empleados,"apellidos")),onFilter:o.filtrarEmpleados,"option-value":i=>i.id,"option-label":i=>i.apellidos+" "+i.nombres,"emit-value":"","map-options":""},{error:n(()=>[(r(!0),d(h,null,$(o.v$.usuario.$errors,i=>(r(),d("div",{key:i.$uid},[s("div",re,g(i.$message),1)]))),128))]),"no-option":n(()=>[t(Q,null,{default:n(()=>[t(O,{class:"text-grey"},{default:n(()=>e[17]||(e[17]=[f(" No hay resultados ")])),_:1})]),_:1})]),_:1},8,["modelValue","options","disable","readonly","error","onBlur","onFilter","option-value","option-label"])]),s("div",de,[e[20]||(e[20]=s("label",{class:"q-mb-sm block"},"Tipo Fondo",-1)),t(L,{modelValue:o.acreditacion.tipo_fondo,"onUpdate:modelValue":e[6]||(e[6]=i=>o.acreditacion.tipo_fondo=i),options:o.tiposFondos,"transition-show":"jump-up","transition-hide":"jump-down","options-dense":"",dense:"",outlined:"",disable:o.disabled,readonly:o.disabled,error:!!o.v$.tipo_fondo.$errors.length,"error-message":"Debes seleccionar un tipo de fondo","use-input":"","input-debounce":"0",onFilter:o.filtrarTiposFondos,"option-value":i=>i.id,onBlur:o.v$.tipo_fondo.$touch,"option-label":i=>i.descripcion,"emit-value":"","map-options":""},{error:n(()=>[(r(!0),d(h,null,$(o.v$.tipo_fondo.$errors,i=>(r(),d("div",{key:i.$uid},[s("div",ue,g(i.$message),1)]))),128))]),"no-option":n(()=>[t(Q,null,{default:n(()=>[t(O,{class:"text-grey"},{default:n(()=>e[19]||(e[19]=[f(" No hay resultados ")])),_:1})]),_:1})]),_:1},8,["modelValue","options","disable","readonly","error","onFilter","option-value","onBlur","option-label"])]),s("div",ce,[e[22]||(e[22]=s("label",{class:"q-mb-sm block"},"Tipo Saldo",-1)),t(L,{modelValue:o.acreditacion.tipo_saldo,"onUpdate:modelValue":e[7]||(e[7]=i=>o.acreditacion.tipo_saldo=i),options:o.tiposSaldos,"transition-show":"jump-up","transition-hide":"jump-down","options-dense":"",dense:"",outlined:"",disable:o.disabled,readonly:o.disabled,error:!!o.v$.tipo_saldo.$errors.length,"error-message":"Debes seleccionar un tipo de saldo","use-input":"",onBlur:o.v$.tipo_saldo.$touch,"input-debounce":"0",onFilter:o.filtrarTiposSaldos,"option-value":i=>i.id,"option-label":i=>i.descripcion,"emit-value":"","map-options":""},{error:n(()=>[(r(!0),d(h,null,$(o.v$.tipo_saldo.$errors,i=>(r(),d("div",{key:i.$uid},[s("div",me,g(i.$message),1)]))),128))]),"no-option":n(()=>[t(Q,null,{default:n(()=>[t(O,{class:"text-grey"},{default:n(()=>e[21]||(e[21]=[f(" No hay resultados ")])),_:1})]),_:1})]),_:1},8,["modelValue","options","disable","readonly","error","onBlur","onFilter","option-value","option-label"])]),s("div",pe,[e[23]||(e[23]=s("label",{class:"q-mb-sm block"},"Referencia:",-1)),t(A,{autogrow:"",modelValue:o.acreditacion.id_saldo,"onUpdate:modelValue":e[8]||(e[8]=i=>o.acreditacion.id_saldo=i),placeholder:"Obligatorio",disable:o.disabled,error:!!o.v$.id_saldo.$errors.length,onBlur:o.v$.id_saldo.$touch,outlined:"",dense:""},{error:n(()=>[(r(!0),d(h,null,$(o.v$.id_saldo.$errors,i=>(r(),d("div",{key:i.$uid},[s("div",fe,g(i.$message),1)]))),128))]),_:1},8,["modelValue","disable","error","onBlur"])]),s("div",be,[e[24]||(e[24]=s("label",{class:"q-mb-sm block"},"Descripci\xF3n del Saldo:",-1)),t(A,{modelValue:o.acreditacion.descripcion_acreditacion,"onUpdate:modelValue":e[9]||(e[9]=i=>o.acreditacion.descripcion_acreditacion=i),placeholder:"Obligatorio",disable:o.disabled,error:!!o.v$.descripcion_acreditacion.$errors.length,onBlur:o.v$.descripcion_acreditacion.$touch,outlined:"",dense:""},{error:n(()=>[(r(!0),d(h,null,$(o.v$.descripcion_acreditacion.$errors,i=>(r(),d("div",{key:i.$uid},[s("div",ve,g(i.$message),1)]))),128))]),_:1},8,["modelValue","disable","error","onBlur"])]),o.accion!==o.acciones.consultar?(r(),d("div",ge,[e[25]||(e[25]=s("label",{class:"q-mb-sm block"},"Saldo Anterior(*):",-1)),t(A,{modelValue:o.acreditacion.saldo_anterior,"onUpdate:modelValue":e[10]||(e[10]=i=>o.acreditacion.saldo_anterior=i),placeholder:"Obligatorio",disable:"",outlined:"",dense:"",type:"number"},null,8,["modelValue"])])):V("",!0),s("div",he,[e[26]||(e[26]=s("label",{class:"q-mb-sm block"},"Monto:",-1)),t(A,{modelValue:o.acreditacion.monto,"onUpdate:modelValue":e[11]||(e[11]=i=>o.acreditacion.monto=i),placeholder:"Obligatorio",disable:o.disabled,error:!!o.v$.monto.$errors.length,onBlur:o.v$.monto.$touch,outlined:"",dense:"",type:"number"},{error:n(()=>[(r(!0),d(h,null,$(o.v$.monto.$errors,i=>(r(),d("div",{key:i.$uid},[s("div",$e,g(i.$message),1)]))),128))]),_:1},8,["modelValue","disable","error","onBlur"])]),o.accion!==o.acciones.consultar?(r(),d("div",ye,[e[27]||(e[27]=s("label",{class:"q-mb-sm block"},"Saldo Disponible:",-1)),t(Lo,{square:""},{default:n(()=>[t(Do,{icon:"bi-currency-dollar",color:"green","text-color":"white"}),f(" "+g(o.acreditacion.saldo_actual.toFixed(2)),1)]),_:1})])):V("",!0)])):(r(),d("div",we,[o.accion==o.acciones.nuevo?(r(),d("div",Ae,[s("label",Ve,[e[29]||(e[29]=f("Reporte de Produbanco ")),e[30]||(e[30]=s("i",{class:"bi bi-info-circle"},null,-1)),t(To,{class:"bg-light-blue-7"},{default:n(()=>e[28]||(e[28]=[f("Suba el reporte emitido por PRODUBANCO")])),_:1})]),t(p,{ref:"refArchivo",mixin:o.mixin2,endpoint:o.endpoint,disable:o.disabled,"permitir-eliminar":!1,"mostrar-listado":!1,"listar-al-guardar":!1,esMultiple:!1},{"boton-subir":n(()=>{var i;return[(i=o.refArchivo)!=null&&i.quiero_subir_archivos?(r(),J(I,{key:0,color:"positive",push:"","no-caps":"",class:"full-width q-mb-lg",onClick:e[12]||(e[12]=U=>o.subirArchivos())},{default:n(()=>[t(B,{name:"bi-upload",class:"q-mr-sm",size:"xs"}),e[31]||(e[31]=f(" Subir archivos seleccionados"))]),_:1})):V("",!0)]}),_:1},8,["mixin","endpoint","disable"])])):V("",!0)]))]),_:1}),o.accion===o.acciones.consultar&&o.acreditacion.estado=="REALIZADO"?(r(),d("div",Ce,[t(I,{color:"negative",onClick:e[14]||(e[14]=i=>o.anularAcreditacion(o.acreditacion))},{default:n(()=>[t(B,{class:"q-pr-sm",name:"bi-x-circle",size:"xs"}),e[32]||(e[32]=f("Anular"))]),_:1})])):V("",!0)]),_:1},8,["mixin","configuracionColumnas","accion1","tabOptions","filtrar"])}var pi=qo(ee,[["render",Fe]]);export{pi as default};
