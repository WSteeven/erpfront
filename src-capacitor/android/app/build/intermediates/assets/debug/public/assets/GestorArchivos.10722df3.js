import{d as V,c,h as z,p as G,_ as Q,t as D,v as d,x as u,y as U,z as h,a7 as L,J as y,bF as I,G as J}from"./index.6449c167.js";import{Q as O}from"./QUploader.cca1b7bd.js";import{c as P}from"./configuracionColumnasArchivoSubtarea.215f4ffd.js";import{a as H,r as K}from"./utils.521b98f3.js";import{E as W}from"./EssentialTable.00c17e97.js";var X=V({components:{EssentialTable:W},props:{mixin:{type:Object,required:!0},permitirEliminar:{type:Boolean,default:!0},listarAlGuardar:{type:Boolean,default:!0},disable:{type:Boolean,default:!1},permitirSubir:{type:Boolean,default:!0},quieroSubirArchivos:{type:Boolean,default:!1},idModelo:{type:Number,required:!1},label:{type:String,required:!1},formato:{type:String,default:"*"},maxFiles:{type:Number,default:15},maxTamanioBytes:{type:Number,default:10485760}},emits:["inicializado"],setup(e,{emit:t}){const{listadoArchivos:n,entidad:m}=e.mixin.useReferencias(),{eliminarArchivo:E,listarArchivos:g,guardarArchivos:f}=e.mixin.useComportamiento(),{notificarError:r,notificarAdvertencia:x,notificarInformacion:B,confirmar:q}=H();async function k(a,o){await g(a,o)}const p=c(0),b=c(0);let v;const $={titulo:"Eliminar",icono:"bi-trash3",color:"negative",visible:()=>e.permitirEliminar,accion:async({entidad:a})=>{q("Esta operaci\xF3n es irreversible. El archivo se eliminar\xE1 de forma instant\xE1nea.",()=>E(a)),a.isComponentFilesModified=!0}},C={titulo:"Ver/Descargar",icono:"bi-eye",color:"positive",accion:({entidad:a})=>{K(a.ruta)}},s=c();z(()=>{t("inicializado")});const F=c(e.quieroSubirArchivos);async function M(a){var l;const o=new FormData;o.append("file",a[0]);for(const i in v)o.append(i,v[i]);try{const i=await f(e.idModelo,o);a.value=[],e.listarAlGuardar&&n.value.push(i.data.modelo),F.value=!1}catch(i){r((l=i.response)==null?void 0:l.data.mensaje)}}async function w(a){console.log("sueiendo..."),v=a,s.value&&(await s.value.upload(),await s.value.reset(),await s.value.removeUploadedFiles(),await s.value.removeQueuedFiles())}function S(a){a.forEach(o=>{switch(o.failedPropValidation){case"accept":r(`El archivo ${o.file.name}  debe ser de un formato v\xE1lido.`),B(`Formato/s aceptado/s ${e.formato}`);break;case"duplicate":r(`El archivo ${o.file.name} ya est\xE1 adjuntado.`);break;case"max-files":r(`No se pudo agregar el archivo ${o.file.name} porque solo se permite un m\xE1ximo de ${e.maxFiles} archivo/s.`);break;case"max-total-size":r(`El archivo ${o.file.name} excede el tama\xF1o m\xE1ximo permitido.`);break;default:x("El tama\xF1o total de los archivos no debe exceder los 10mb.")}})}function R(){n.value=[]}function T(a){for(let o=0;o<a.length;o++)p.value+=1;b.value+=A(a),m.isComponentFilesModified=!0}function j(a){p.value-=1,b.value-=A(a),m.isComponentFilesModified=!0}function A(a){return a.reduce((l,i)=>l+i.size,0)}function N(a){return a===0?"0 MB":(a/(1024*1024)).toFixed(2)+" MB"}return{listadoArchivos:n,refGestor:s,quiero_subir_archivos:F,columnas:[...P,G],onRejected:S,btnEliminar:$,btnDescargar:C,onFileAdded:T,onFileRemoved:j,tamanioListado:b,cantElementos:p,factoryFn:M,subir:w,limpiarListado:R,listarArchivosAlmacenados:k,bytesToMB:N}}});const Y={key:0,class:"col-12 col-md-3 q-mb-lg"},Z={key:1,class:"col-12 q-mb-sm"},_={key:2,class:"col-12 q-mb-sm"};function ee(e,t,n,m,E,g){const f=D("essential-table");return d(),u(J,null,[e.permitirSubir?(d(),u("div",Y,[t[1]||(t[1]=U("br",null,null,-1)),h(L,{modelValue:e.quiero_subir_archivos,"onUpdate:modelValue":t[0]||(t[0]=r=>e.quiero_subir_archivos=r),label:e.label||"Quiero compartir archivos",disable:e.disable,color:"positive","checked-icon":"bi-eye",outlined:"",dense:""},null,8,["modelValue","label","disable"])])):y("",!0),e.quiero_subir_archivos?(d(),u("div",Z,[h(O,{accept:e.formato,"max-files":e.maxFiles,ref:"refGestor",label:"Selecciona o arrastra tus archivos aqu\xED (M\xE1ximo "+e.bytesToMB(e.maxTamanioBytes)+")",multiple:"",style:{width:"100%"},flat:"",factory:e.factoryFn,class:"bg-header-collapse expansion",color:"white","text-color":"black","max-total-size":e.maxTamanioBytes,onRejected:e.onRejected,onAdded:e.onFileAdded,onRemoved:e.onFileRemoved,"hide-upload-btn":""},null,8,["accept","max-files","label","factory","max-total-size","onRejected","onAdded","onRemoved"])])):y("",!0),I(e.$slots,"boton-subir"),e.listadoArchivos.length?(d(),u("div",_,[h(f,{titulo:`Existen ${e.listadoArchivos.length} archivos compartidos hasta el momento`,configuracionColumnas:e.columnas,datos:e.listadoArchivos,"alto-fijo":!1,permitirConsultar:!1,permitirEditar:!1,permitirEliminar:!1,"mostrar-footer":!1,"mostrar-botones":!1,"permitir-buscar":!1,accion1:e.btnDescargar,accion2:e.btnEliminar},null,8,["titulo","configuracionColumnas","datos","accion1","accion2"])])):y("",!0)],64)}var ne=Q(X,[["render",ee]]);export{ne as G};
