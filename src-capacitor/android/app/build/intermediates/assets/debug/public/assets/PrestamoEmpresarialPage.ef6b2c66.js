var Ao=Object.defineProperty;var To=(a,o,b)=>o in a?Ao(a,o,{enumerable:!0,configurable:!0,writable:!0,value:b}):a[o]=b;var f=(a,o,b)=>(To(a,typeof o!="symbol"?o+"":o,b),b);import{Q as L,a as Y}from"./QItemSection.9a955ec6.js";import{Q as R}from"./QSelect.6ce302d7.js";import{bw as Oo,s as to,A as qo,bD as jo,d as Uo,c as h,u as Qo,f as D,E as Lo,a1 as H,bx as Yo,q as Ro,dz as Ho,p as Go,_ as Jo,t as G,v as p,P as J,F as i,z as m,a4 as Ko,y as n,x as c,G as y,H as $,K as V,D as K,I as P,B as W,j as X,O as Z,J as x}from"./index.6449c167.js";import{Q as oo,a as ao,C as eo}from"./QPopupProxy.72ff1d6d.js";import{Q as Wo}from"./QForm.ca56f146.js";import{r as C,a as Xo}from"./i18n-validators.29e2545c.js";import{c as Zo,d as xo}from"./index.0198dd12.js";import{u as oa}from"./index.490dde02.js";import{T as aa}from"./TabLayoutFilterTabs2.5e702525.js";import{S as ea,E as ta}from"./EssentialTable.00c17e97.js";import{C as la}from"./ContenedorSimpleMixin.09c9bed5.js";import{E as ra}from"./entidadAuditable.75a46700.js";import{a as sa,A as ia,N as na,H as ma}from"./utils.521b98f3.js";import{M as ua}from"./MotivoPermisoEmpleadoController.65b87105.js";import{u as pa}from"./recursosHumanos.ecfe9e4d.js";import{P as da}from"./PeriodoController.537f75e0.js";import{u as ca}from"./filtrosListadosGenerales.c3aa2da3.js";import"./QChip.95469f73.js";import"./position-engine.70d0a89f.js";import"./format.8ac60962.js";import"./QTabs.6c234f27.js";import"./QResizeObserver.9af84680.js";import"./QTabPanels.49d2362a.js";import"./touch.9135741d.js";import"./QPage.5d173a8a.js";import"./EssentialTableTabs.586dbdfc.js";import"./QBadge.e6f320cd.js";import"./EssentialTablePagination.d5c1010a.js";import"./QToolbar.8dbe891b.js";import"./use-fullscreen.a7661f85.js";import"./buttonSubmits.fe817da3.js";import"./_commonjsHelpers.8402d862.js";import"./QImg.fd079679.js";import"./QFile.90d9394a.js";import"./VisorImagen.75b3c53f.js";import"./logo.4781eea2.js";import"./seleccionContratacionPersonal.utils.e3e1ed3d.js";const fa=[{name:"fecha",field:"fecha",label:"Fecha",align:"left",sortable:!0},{name:"solicitante_info",field:"solicitante_info",label:"Solicitante",align:"left",sortable:!0},{name:"monto",field:"monto",label:"monto",align:"left",sortable:!0},{name:"plazo",field:"plazo",label:"Plazo",align:"left",sortable:!0}],va=[{name:"num_cuota",field:"num_cuota",label:"N\xFAmero de Cuota",align:"left",sortable:!0},{name:"fecha_vencimiento",field:"fecha_vencimiento",label:"Fecha de Vencimiento",align:"left",sortable:!0},{name:"fecha_pago",field:"fecha_pago",label:"Fecha de Pago",align:"left",sortable:!0},{name:"valor_couta",field:"valor_couta",label:"Valor Couta",align:"left",sortable:!0},{name:"valor_pagado",field:"valor_pagado",label:"Valor a Pagado",align:"left",sortable:!0},{name:"valor_a_pagar",field:"valor_a_pagar",label:"Valor a Pagar",align:"left",sortable:!0},{name:"pago_couta",field:"pago_couta",label:"Pago",align:"left",sortable:!0}];class ba extends Oo{constructor(){super(to.prestamo_empresarial)}}class ga extends ra{constructor(){super();f(this,"id");f(this,"solicitante");f(this,"solicitante_info");f(this,"fecha");f(this,"vencimiento");f(this,"periodo");f(this,"valor_utilidad");f(this,"monto");f(this,"plazo");f(this,"plazos");this.id=null,this.solicitante=null,this.solicitante_info=null,this.fecha=null,this.vencimiento=null,this.periodo=null,this.valor_utilidad=null,this.monto=null,this.plazo=null,this.plazos=null}}class ha{constructor(){f(this,"axios");this.axios=qo.getInstance()}async anularPrestamoEmpresarial(o){try{await this.axios.post(this.axios.getEndpoint(to.anular_prestamo_empresarial),o)}catch(b){const v=b;throw new jo(v)}}}var za=Uo({components:{TabLayoutFilterTabs2:aa,SelectorImagen:ea,EssentialTable:ta},setup(){const a=new la(ga,new ba),{entidad:o,disabled:b,accion:v,listadosAuxiliares:z,listado:N}=a.useReferencias(),{setValidador:F,obtenerListados:S,cargarVista:t,listar:lo}=a.useComportamiento(),{onBeforeModificar:ro}=a.useHooks(),{confirmar:I,prompt:w,notificarCorrecto:so,notificarAdvertencia:io,notificarError:_}=sa(),B=h(0),M=h([]),no=h([{id:1,nombre:"Prestamo Descuento"},{id:2,nombre:"Anticipo"}]),A=h(!1);ro(()=>A.value=!0);const mo=h(),T=h(!1),{empleados:O,filtrarEmpleados:uo}=ca(z),E=h(),q=pa(),po=Qo(),k=D(()=>(q.obtenerSueldoBasico(),q.sueldo_basico)),co=new ha,fo=D(()=>v.value==="NUEVO");t(async()=>{await S({motivos:new ua,empleados:{controller:new Lo,params:{campos:"id,nombres,apellidos",estado:1}},periodos:{controller:new da,params:{campos:"id,nombre",activo:1}}}),O.value=z.empleados,E.value=z.periodos,M.value=z.motivos}),mo.value=parseInt(k.value)*2;const vo=D(()=>({solicitante:{required:C},fecha:{required:C},vencimiento:{required:C},monto:{required:C},valor_utilidad:{requiredIf:Xo(o.periodo!=null)},plazo:{required:C,minValue:Zo(1),maxValue:xo(12)},plazos:{required:C}}));o.plazos=[];const bo=h({id:0,vencimiento:"",plazo:0});function go(){B.value++,B.value>=1&&(o.plazos=[]);const e=o.monto!==null?o.monto:0,s=o.plazo!=null?o.plazo:0;if(e/s<=200)for(let l=1;l<=o.plazo;l++){const u={id:l-1,num_cuota:l,fecha_vencimiento:ho(l,"meses"),valor_couta:(e/s).toFixed(2),pago_couta:!1};o.plazos.push(u)}}function ho(e,s){const d=na(o.fecha!==null?o.fecha:new Date().toString(),"YYYY-MM-DD");switch(s){case"dias":d.setDate(d.getDate()+e);break;case"semanas":d.setDate(d.getTime()+6048e5*e);break;case"meses":d.setDate(30),d.setMonth(d.getMonth()+e-1);break;case"anios":d.setDate(d.getTime()+290304e5*e);break}return ma(d,"YYYY-MM-DD")}const j=oa(vo,o);F(j.value),H(()=>{try{if(v.value==Yo.nuevo){if(o.plazo!=null){const e=o.monto!==null?o.monto:0,s=o.plazo!=null?o.plazo:0;e/s<=200&&o.plazo>0&&o.plazo<=12?(go(),o.vencimiento=o.plazos!=null?o.plazos[o.plazo-1].fecha_vencimiento:null,o.valor_utilidad!=null&&U()):o.plazo>0&&_("Las Coutas no deben exeder al 40% del sueldo del empleado")}}else o.vencimiento=o.plazos!=null?o.plazos[o.plazo-1].fecha_vencimiento:null}catch{}});function U(){const e=o.valor_utilidad==null?0:o.valor_utilidad,s=o.monto==null?0:o.monto;if(e>0){const r=o.plazos.findIndex(u=>u.num_cuota===o.plazo+1);if(r==-1){const u=E.value.find(d=>d.id===o.periodo),g={num_cuota:o.plazos.length+1,fecha_vencimiento:u.nombre.split("-")[0]+"-04-15",valor_couta:o.valor_utilidad,pago_couta:!1};o.plazos.push(g)}else o.plazos[r].valor_couta=o.valor_utilidad;const l=s/o.plazo;wo(e,s,l)}}const zo={titulo:"editar",icono:"bi-pencil-square",color:"secondary",accion:({posicion:e})=>{console.log(e),Co(e)},visible:()=>v.value=="NUEVO"},_o={titulo:"pagar",icono:"bi-cash",color:"primary",accion:({posicion:e})=>{ko(e)},visible:()=>v.value=="EDITAR"},yo={titulo:"Aplazar",icono:"bi-cash-stack",color:"warning",accion:({posicion:e})=>{Vo(e)},visible:()=>v.value=="EDITAR"},$o={titulo:"Editar Valor a Pagar",icono:"bi-pencil-square",color:"warning",accion:({posicion:e})=>{Eo(e)},visible:()=>v.value=="EDITAR"};function Vo(e){const s=o.plazos[o.plazo-1].fecha_vencimiento,[r,l,u]=s.split("-"),g=new Date(r,l-1,u);g.setMonth(g.getMonth()+1);const d=g.getDate(),Bo=g.getMonth()+1,Mo=`${g.getFullYear()}-${Bo.toString().padStart(2,"0")}-${d.toString().padStart(2,"0")}`;o.plazos[e].fecha_vencimiento=Mo}function Co(e){I("\xBFEst\xE1 seguro de modificar la couta N"+(e+1)+"?",()=>{w({titulo:"Modificar couta",mensaje:"Ingrese nuevo valor de la couta",accion:async r=>{var l;try{const u=(l=o.monto)!=null?l:0;r>u&&(T.value=!0,io("La suma de todas las coutas no debe superar al valor del prestamo")),o.plazos[e].valor_couta=r,Po(e,u)}catch{_("No se pudo modificar, debes ingresar monto")}}})})}function Eo(e){I("\xBFEst\xE1 seguro de modificar la couta?",()=>{w({titulo:"Modificar couta",mensaje:"Ingrese nuevo valor total de la couta",accion:async r=>{try{o.plazos[e].valor_a_pagar=r}catch{_("No se pudo modificar, debes ingresar monto")}}})})}function Po(e,s){const r=o.plazos[e].num_cuota;o.plazos.map(l=>(l.num_cuota!==r&&(l.valor_couta=((parseFloat(s.toString())-o.plazos[e].valor_couta)/(o.plazo-1)).toFixed(2)),l))}function wo(e,s,r){if(e>0){let l;e!==0?l=parseFloat(e.toString())/parseFloat(s.toString()):l=0,o.plazos.slice(0,-1).map(u=>(u.valor_couta=(r-r*l).toFixed(2),u))}}function ko(e){I("\xBFEst\xE1 seguro de pagar la couta?",()=>{w({titulo:"Pagar couta",mensaje:"Ingrese valor de la couta a pagar",accion:async r=>{try{if(r>parseFloat(o.plazos[e].valor_couta)){_("No se pudo pagar, debes ingresar monto menor o igual a "+o.plazos[e].valor_couta);return}const l=new Date;r==parseFloat(o.plazos[e].valor_couta)&&(o.plazos[e].pago_couta=!0,o.plazos[e].fecha_pago=l.toISOString().slice(0,10),Fo(e+1)),o.plazos[e].fecha_pago=l.toISOString().slice(0,10),o.plazos[e].valor_pagado=parseFloat(r),o.plazos[e].valor_a_pagar=(o.plazos[e].valor_couta-r).toFixed(2)}catch(l){_("No se pudo pagar, a ocurido un error: "+l)}}})})}function Fo(e){o.plazos.slice(e).forEach(s=>{const r=new Date(s.fecha_vencimiento);r.setMonth(r.getMonth()-1),s.fecha_vencimiento=r.toISOString().slice(0,10)})}function So(e,s){if(e===""){s(()=>{E.value=z.periodos});return}s(()=>{const r=e.toLowerCase();E.value=z.periodos.filter(l=>l.nombre.toLowerCase().indexOf(r)>-1)})}const Io={titulo:"",icono:"bi-trash",color:"negative",visible:()=>po.can("puede.eliminar.prestamo_empresarial")&&Q=="ACTIVO",accion:({entidad:e,posicion:s})=>{v.value="ELIMINAR",Do({entidad:e,posicion:s})}};async function Do({entidad:e,posicion:s}){try{w({titulo:"Eliminar PrestamoEmpresarial",mensaje:"Ingrese motivo de eliminacion",accion:async l=>{e.estado=!1,e.motivo=l,e.descripcion_prestamoempresarial=l,await co.anularPrestamoEmpresarial(e),so("Se ha eliminado PrestamoEmpresarial"),N.value.splice(s,1)}})}catch{_("No se pudo anular, debes ingresar un motivo para la anulacion")}}let Q="ACTIVO";function No(e){lo({estado:e},!1),Q=e}return{removeAccents:ia,mixin:a,prestamo:o,empleados:O,sueldo_basico:k,periodos:E,watchEffect:H,filtrarEmpleados:uo,filtrarPeriodo:So,filtrarPrestamoEmpresarial:No,recargar_tabla:U,esMayorPrestamo:T,maximoValorPrestamo:[e=>e&&e<=parseInt(k.value)*2||"Solo se permite prestamo menor o igual a 2 SBU ("+parseInt(k.value)*2+")"],btnModificarCouta:zo,btnPagarCouta:_o,btnEditarTotalCouta:$o,btnAplazarCouta:yo,btnEliminarPrestamoEmpresarial:Io,esNuevo:fo,configuracionColumnasPlazoPrestamo:va,esConsultado:A,plazo_pago:bo,motivos:M,tipos:no,maskFecha:Ro,v$:j,disabled:b,tabPrestamoEmpresarial:Ho,configuracionColumnas:fa,accion:v,accionesTabla:Go}}});const _a={class:"row q-col-gutter-sm q-py-md"},ya={class:"col-12 col-md-3"},$a={class:"error-msg"},Va={class:"col-12 col-md-3"},Ca={class:"row items-center justify-end"},Ea={class:"error-msg"},Pa={class:"col-12 col-md-3"},wa={class:"error-msg"},ka={class:"col-12 col-md-3"},Fa={class:"error-msg"},Sa={class:"col-12 col-md-3"},Ia={class:"row items-center justify-end"},Da={class:"error-msg"},Na={class:"col-12 col-md-3"},Ba={key:0,class:"col-12 col-md-3"},Ma={class:"error-msg"};function Aa(a,o,b,v,z,N){const F=G("essential-table"),S=G("tab-layout-filter-tabs2");return p(),J(S,{mixin:a.mixin,configuracionColumnas:a.configuracionColumnas,permitirEliminar:!1,accion1:a.btnEliminarPrestamoEmpresarial,tabOptions:a.tabPrestamoEmpresarial,filtrar:a.filtrarPrestamoEmpresarial,tabDefecto:"ACTIVO",forzarListar:!0},{formulario:i(()=>[m(Wo,{onSubmit:o[9]||(o[9]=Ko(()=>{},["prevent"]))},{default:i(()=>[n("div",_a,[n("div",ya,[o[11]||(o[11]=n("label",{class:"q-mb-sm block"},"Empleado",-1)),m(R,{modelValue:a.prestamo.solicitante,"onUpdate:modelValue":o[0]||(o[0]=t=>a.prestamo.solicitante=t),options:a.empleados,"transition-show":"jump-up","transition-hide":"jump-down","options-dense":"",dense:"",outlined:"",disable:!a.esNuevo,readonly:a.disabled,error:!!a.v$.solicitante.$errors.length,"error-message":"Debes seleccionar un empleado","use-input":"","input-debounce":"0",onFilter:a.filtrarEmpleados,"option-value":t=>t.id,"option-label":t=>t.nombres+" "+t.apellidos,"emit-value":"","map-options":""},{error:i(()=>[(p(!0),c(y,null,$(a.v$.solicitante.$errors,t=>(p(),c("div",{key:t.$uid},[n("div",$a,V(t.$message),1)]))),128))]),"no-option":i(()=>[m(L,null,{default:i(()=>[m(Y,{class:"text-grey"},{default:i(()=>o[10]||(o[10]=[K(" No hay resultados ")])),_:1})]),_:1})]),_:1},8,["modelValue","options","disable","readonly","error","onFilter","option-value","option-label"])]),n("div",Va,[o[12]||(o[12]=n("label",{class:"q-mb-sm block"},"Fecha",-1)),m(P,{modelValue:a.prestamo.fecha,"onUpdate:modelValue":o[2]||(o[2]=t=>a.prestamo.fecha=t),placeholder:"Obligatorio",error:!!a.v$.fecha.$errors.length,disable:!a.esNuevo,onBlur:a.v$.fecha.$touch,outlined:"",dense:""},{append:i(()=>[m(W,{name:"event",class:"cursor-pointer"},{default:i(()=>[m(oo,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:i(()=>[m(ao,{modelValue:a.prestamo.fecha,"onUpdate:modelValue":o[1]||(o[1]=t=>a.prestamo.fecha=t),mask:a.maskFecha,"today-btn":""},{default:i(()=>[n("div",Ca,[X(m(Z,{label:"Cerrar",color:"primary",flat:""},null,512),[[eo]])])]),_:1},8,["modelValue","mask"])]),_:1})]),_:1})]),error:i(()=>[(p(!0),c(y,null,$(a.v$.fecha.$errors,t=>(p(),c("div",{key:t.$uid},[n("div",Ea,V(t.$message),1)]))),128))]),_:1},8,["modelValue","error","disable","onBlur"])]),n("div",Pa,[o[13]||(o[13]=n("label",{class:"q-mb-sm block"},"Valor ",-1)),m(P,{modelValue:a.prestamo.monto,"onUpdate:modelValue":o[3]||(o[3]=t=>a.prestamo.monto=t),placeholder:"Obligatorio",type:"number",disable:!a.esNuevo,error:!!a.v$.monto.$errors.length,onBlur:a.v$.monto.$touch,hint:"Solo se permite prestamo menor o igual a 2 SBU ("+parseInt(a.sueldo_basico)*2+")",outlined:"",dense:""},{error:i(()=>[(p(!0),c(y,null,$(a.v$.monto.$errors,t=>(p(),c("div",{key:t.$uid},[n("div",wa,V(t.$message),1)]))),128))]),_:1},8,["modelValue","disable","error","onBlur","hint"])]),n("div",ka,[o[14]||(o[14]=n("label",{class:"q-mb-sm block"},"Plazo ",-1)),m(P,{modelValue:a.prestamo.plazo,"onUpdate:modelValue":o[4]||(o[4]=t=>a.prestamo.plazo=t),type:"number",disable:!a.esNuevo,error:!!a.v$.plazo.$errors.length,onBlur:a.v$.plazo.$touch,outlined:"",dense:""},{error:i(()=>[(p(!0),c(y,null,$(a.v$.plazo.$errors,t=>(p(),c("div",{key:t.$uid},[n("div",Fa,V(t.$message),1)]))),128))]),_:1},8,["modelValue","disable","error","onBlur"])]),n("div",Sa,[o[15]||(o[15]=n("label",{class:"q-mb-sm block"},"Vence",-1)),m(P,{modelValue:a.prestamo.vencimiento,"onUpdate:modelValue":o[6]||(o[6]=t=>a.prestamo.vencimiento=t),error:!!a.v$.vencimiento.$errors.length,disable:"",onBlur:a.v$.vencimiento.$touch,outlined:"",dense:""},{append:i(()=>[m(W,{name:"event",class:"cursor-pointer"},{default:i(()=>[m(oo,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:i(()=>[m(ao,{modelValue:a.prestamo.vencimiento,"onUpdate:modelValue":o[5]||(o[5]=t=>a.prestamo.vencimiento=t),mask:a.maskFecha,"today-btn":""},{default:i(()=>[n("div",Ia,[X(m(Z,{label:"Cerrar",color:"primary",flat:""},null,512),[[eo]])])]),_:1},8,["modelValue","mask"])]),_:1})]),_:1})]),error:i(()=>[(p(!0),c(y,null,$(a.v$.vencimiento.$errors,t=>(p(),c("div",{key:t.$uid},[n("div",Da,V(t.$message),1)]))),128))]),_:1},8,["modelValue","error","onBlur"])]),n("div",Na,[o[17]||(o[17]=n("label",{class:"q-mb-sm block"},"Periodo",-1)),m(R,{modelValue:a.prestamo.periodo,"onUpdate:modelValue":o[7]||(o[7]=t=>a.prestamo.periodo=t),options:a.periodos,"transition-show":"jump-up","transition-hide":"jump-down","options-dense":"",dense:"",outlined:"",disable:a.disabled,readonly:a.disabled,"use-input":"","input-debounce":"0",onFilter:a.filtrarPeriodo,"option-value":t=>t.id,"option-label":t=>t.nombre,"emit-value":"","map-options":""},{"no-option":i(()=>[m(L,null,{default:i(()=>[m(Y,{class:"text-grey"},{default:i(()=>o[16]||(o[16]=[K(" No hay resultados ")])),_:1})]),_:1})]),_:1},8,["modelValue","options","disable","readonly","onFilter","option-value","option-label"])]),a.prestamo.periodo!=null?(p(),c("div",Ba,[o[18]||(o[18]=n("label",{class:"q-mb-sm block"},"Valor Utilidades ",-1)),m(P,{modelValue:a.prestamo.valor_utilidad,"onUpdate:modelValue":o[8]||(o[8]=t=>a.prestamo.valor_utilidad=t),placeholder:"Obligatorio",type:"number",disable:!a.esNuevo,error:!!a.v$.valor_utilidad.$errors.length,onBlur:a.v$.valor_utilidad.$touch,outlined:"",dense:""},{error:i(()=>[(p(!0),c(y,null,$(a.v$.valor_utilidad.$errors,t=>(p(),c("div",{key:t.$uid},[n("div",Ma,V(t.$message),1)]))),128))]),_:1},8,["modelValue","disable","error","onBlur"])])):x("",!0)])]),_:1}),a.prestamo.plazo>0&&a.prestamo.plazo<=12?(p(),J(F,{key:0,titulo:"Plazo de Prestamo",configuracionColumnas:[...a.configuracionColumnasPlazoPrestamo,a.accionesTabla],datos:a.prestamo.plazos,permitirConsultar:!1,permitirEditar:!1,permitirEliminar:!1,accion1:a.btnModificarCouta,accion2:a.btnPagarCouta,accion3:a.btnAplazarCouta,accion4:a.btnEditarTotalCouta,altoFijo:!1},null,8,["configuracionColumnas","datos","accion1","accion2","accion3","accion4"])):x("",!0)]),_:1},8,["mixin","configuracionColumnas","accion1","tabOptions","filtrar"])}var $e=Jo(za,[["render",Aa]]);export{$e as default};
