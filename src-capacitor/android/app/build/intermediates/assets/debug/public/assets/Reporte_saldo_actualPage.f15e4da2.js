var eo=Object.defineProperty;var so=(o,e,n)=>e in o?eo(o,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):o[e]=n;var $=(o,e,n)=>(so(o,typeof e!="symbol"?e+"":e,n),n);import{bw as j,s as w,d as ao,m as L,u as ro,c as y,Z as lo,E as I,d4 as to,A as io,bE as U,_ as no,v as i,P as B,F as r,z as a,bc as R,y as c,x as u,G as q,H as N,D as v,J as b,a6 as uo,K as k,L as T,Q as po,c8 as mo,O as S,B as Q,bb as co}from"./index.6449c167.js";import{Q as z,a as F}from"./QItemSection.9a955ec6.js";import{Q as O}from"./QSelect.6ce302d7.js";import{Q as fo}from"./QChip.95469f73.js";import{Q as vo}from"./QPage.5d173a8a.js";import{T as bo}from"./TabLayout.0bce4313.js";import{b as go,u as yo,a as Co,P as _o,B as P,i as wo,n as $o}from"./utils.521b98f3.js";import{u as ko}from"./index.490dde02.js";import{C as So}from"./ContenedorSimpleMixin.09c9bed5.js";import{E as Qo}from"./entidadAuditable.75a46700.js";import"./position-engine.70d0a89f.js";import"./format.8ac60962.js";import"./QTabs.6c234f27.js";import"./QResizeObserver.9af84680.js";import"./QTabPanels.49d2362a.js";import"./touch.9135741d.js";import"./QPopupProxy.72ff1d6d.js";import"./buttonSubmits.fe817da3.js";import"./EssentialTable.00c17e97.js";import"./QToolbar.8dbe891b.js";import"./use-fullscreen.a7661f85.js";import"./QBadge.e6f320cd.js";import"./_commonjsHelpers.8402d862.js";import"./QImg.fd079679.js";import"./QFile.90d9394a.js";import"./VisorImagen.75b3c53f.js";import"./logo.4781eea2.js";import"./seleccionContratacionPersonal.utils.e3e1ed3d.js";import"./i18n-validators.29e2545c.js";import"./index.0198dd12.js";import"./EssentialTablePagination.d5c1010a.js";class Vo extends Qo{constructor(){super();$(this,"usuario");$(this,"saldo_anterior");this.usuario=null,this.saldo_anterior=0}}class Ao extends j{constructor(){super(w.reporte_saldo_actual_pdf)}}class Eo extends j{constructor(){super(w.cortar_saldo)}}var Lo=ao({components:{TabLayout:bo},setup(){go().setQuasar(L()),yo().setQuasar(L());const o=ro(),e=Co(),n=new So(Vo,new Ao),C=y(!1),{entidad:d,disabled:V,accion:s,listadosAuxiliares:f}=n.useReferencias(),{setValidador:D,obtenerListados:G,cargarVista:H}=n.useComportamiento(),M=lo(),A=ko({usuario:{required:!0,minLength:3,maxLength:50}},d);D(A.value);const g=y(),_=y(),J=y("false"),K=y("false");H(async()=>{await G({usuarios:{controller:new I,params:{estado:1}},usuariosInactivos:{controller:new I,params:{estado:0}}}),g.value=_o(f.usuarios),f.usuarios=g.value,_.value=f.usuariosInactivos});function Z(l,t){if(l===""){t(()=>{g.value=f.usuarios});return}t(()=>{const p=l.toLowerCase();g.value=f.usuarios.filter(m=>m.nombres.toLowerCase().indexOf(p)>-1||m.apellidos.toLowerCase().indexOf(p)>-1)})}function W(l,t){if(l===""){t(()=>{_.value=f.usuariosInactivos});return}t(()=>{const p=l.toLowerCase();_.value=f.usuariosInactivos.filter(m=>m.nombres.toLowerCase().indexOf(p)>-1||m.apellidos.toLowerCase().indexOf(p)>-1)})}function X(){d.usuario=null}async function Y(l,t){const p=io.getInstance(),m="reporte_saldo_actual"+new Date().getTime();switch(t){case"excel":const h=U.URL_BASE+"/"+p.getEndpoint(w.reporte_saldo_actual_excel);P(h,"POST","blob","xlsx",m,l);break;case"pdf":const oo=U.URL_BASE+"/"+p.getEndpoint(w.reporte_saldo_actual_pdf);P(oo,"POST","blob","pdf",m,l);break}}o.can("puede.buscar.saldo.usuarios")==!1&&(d.usuario=o.user.id,C.value=!0,E());async function E(){const l=new to;if(d.usuario){const{response:t}=await l.consultar(d.usuario);C.value=!0,d.saldo_anterior=t.data.saldo_actual}}async function x(){try{await new Eo().listar(),M.push("acreditacion-semana")}catch(l){if(wo(l)){const t=l.erroresValidacion;await $o(t,e)}}}return{mixin:n,store:o,reporte_saldo_actual:d,cortar_saldo:x,saldoAnterior:E,disabled:V,accion:s,v$:A,usuarios:g,usuariosInactivos:_,is_all_users:J,is_inactivo:K,mostrarUsuarios:X,generar_reporte:Y,filtrarUsuarios:Z,filtrarUsuariosInactivos:W,visualizar_saldo_usuario:C}}});const Io={key:0,class:"col-12 col-md-3"},Uo={class:"error-msg"},Bo={key:1,class:"col-12 col-md-3"},Ro={class:"error-msg"},qo={key:2,class:"col-12 col-md-3"},No={key:3,class:"col-12 col-md-3"},To={key:4,class:"col-12 col-md-3"};function zo(o,e,n,C,d,V){return i(),B(vo,{class:"flex flex-center"},{default:r(()=>[a(co,{flat:"",bordered:"",class:"my-card bg-grey-1"},{default:r(()=>[a(R,null,{default:r(()=>e[10]||(e[10]=[c("div",{class:"row items-center no-wrap"},[c("div",{class:"col"},[c("div",{class:"text-h6"},"Generar Reporte Saldo Actual")])],-1)])),_:1}),a(R,null,{default:r(()=>[o.is_all_users=="false"&&o.store.can("puede.buscar.saldo.usuarios")&&o.is_inactivo=="false"?(i(),u("div",Io,[e[12]||(e[12]=c("label",{class:"q-mb-sm block"},"Empleado",-1)),a(O,{modelValue:o.reporte_saldo_actual.usuario,"onUpdate:modelValue":[e[0]||(e[0]=s=>o.reporte_saldo_actual.usuario=s),e[1]||(e[1]=s=>o.saldoAnterior())],options:o.usuarios,"transition-show":"jump-up","transition-hide":"jump-down","options-dense":"",dense:"",outlined:"",disable:o.disabled,readonly:o.disabled,error:!!o.v$.usuario.$errors.length,"error-message":"Debes seleccionar un empleado","use-input":"","input-debounce":"0",onFilter:o.filtrarUsuarios,"option-value":s=>s.id,"option-label":s=>s.nombres+" "+s.apellidos,"emit-value":"","map-options":""},{error:r(()=>[(i(!0),u(q,null,N(o.v$.usuario.$errors,s=>(i(),u("div",{key:s.$uid},[c("div",Uo,k(s.$message),1)]))),128))]),"no-option":r(()=>[a(z,null,{default:r(()=>[a(F,{class:"text-grey"},{default:r(()=>e[11]||(e[11]=[v(" No hay resultados ")])),_:1})]),_:1})]),_:1},8,["modelValue","options","disable","readonly","error","onFilter","option-value","option-label"])])):b("",!0),o.is_all_users=="false"&&o.store.can("puede.buscar.saldo.usuarios")&&o.is_inactivo=="true"?(i(),u("div",Bo,[e[14]||(e[14]=c("label",{class:"q-mb-sm block"},"Empleado",-1)),a(O,{modelValue:o.reporte_saldo_actual.usuario,"onUpdate:modelValue":[e[2]||(e[2]=s=>o.reporte_saldo_actual.usuario=s),e[3]||(e[3]=s=>o.saldoAnterior())],options:o.usuariosInactivos,"transition-show":"jump-up","transition-hide":"jump-down","options-dense":"",dense:"",outlined:"",disable:o.disabled,readonly:o.disabled,error:!!o.v$.usuario.$errors.length,"error-message":"Debes seleccionar un empleado","use-input":"","input-debounce":"0",onFilter:o.filtrarUsuariosInactivos,"option-value":s=>s.id,"option-label":s=>s.nombres+" "+s.apellidos,"emit-value":"","map-options":""},{error:r(()=>[(i(!0),u(q,null,N(o.v$.usuario.$errors,s=>(i(),u("div",{key:s.$uid},[c("div",Ro,k(s.$message),1)]))),128))]),"no-option":r(()=>[a(z,null,{default:r(()=>[a(F,{class:"text-grey"},{default:r(()=>e[13]||(e[13]=[v(" No hay resultados ")])),_:1})]),_:1})]),_:1},8,["modelValue","options","disable","readonly","error","onFilter","option-value","option-label"])])):b("",!0),o.visualizar_saldo_usuario==!0&&o.is_all_users=="false"?(i(),u("div",qo,[e[15]||(e[15]=c("label",{class:"q-mb-sm block"},"Saldo:",-1)),a(fo,{square:""},{default:r(()=>[a(uo,{icon:"bi-currency-dollar",color:"green","text-color":"white"}),v(" "+k(o.reporte_saldo_actual.saldo_anterior),1)]),_:1})])):b("",!0),o.store.can("puede.buscar.saldo.usuarios")?(i(),u("div",No,[a(T,{modelValue:o.is_all_users,"onUpdate:modelValue":[e[4]||(e[4]=s=>o.is_all_users=s),e[5]||(e[5]=s=>o.mostrarUsuarios())],color:"secondary",label:"Todos los empleados","true-value":"true","false-value":"false"},null,8,["modelValue"])])):b("",!0),o.store.can("puede.buscar.saldo.usuarios")?(i(),u("div",To,[a(T,{modelValue:o.is_inactivo,"onUpdate:modelValue":e[6]||(e[6]=s=>o.is_inactivo=s),color:"secondary",label:"Inactivo","true-value":"true","false-value":"false"},null,8,["modelValue"])])):b("",!0)]),_:1}),a(po),a(mo,{align:"around"},{default:r(()=>[a(S,{color:"positive",onClick:e[7]||(e[7]=s=>o.generar_reporte(o.reporte_saldo_actual,"excel"))},{default:r(()=>[a(Q,{name:"bi-file-earmark-excel-fill",size:"xs",class:"q-mr-sm"}),e[16]||(e[16]=v("Excel"))]),_:1}),a(S,{color:"negative",onClick:e[8]||(e[8]=s=>o.generar_reporte(o.reporte_saldo_actual,"pdf"))},{default:r(()=>[a(Q,{name:"bi-file-earmark-pdf-fill",size:"xs",class:"q-mr-sm"}),e[17]||(e[17]=v("PDF"))]),_:1}),o.store.can("puede.ver.acreditacion_semana")?(i(),B(S,{key:0,color:"warning",onClick:e[9]||(e[9]=s=>o.cortar_saldo())},{default:r(()=>[a(Q,{name:"bi-scissors",size:"xs",class:"q-mr-sm"}),e[18]||(e[18]=v("Cortar Saldo "))]),_:1})):b("",!0)]),_:1})]),_:1})]),_:1})}var ge=no(Lo,[["render",zo]]);export{ge as default};
