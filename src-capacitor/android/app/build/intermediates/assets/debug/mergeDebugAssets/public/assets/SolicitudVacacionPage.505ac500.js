var po=Object.defineProperty;var bo=(o,e,m)=>e in o?po(o,e,{enumerable:!0,configurable:!0,writable:!0,value:m}):o[e]=m;var d=(o,e,m)=>(bo(o,typeof e!="symbol"?e+"":e,m),m);import{Q as z,a as R}from"./QSelect.a8f2bfb2.js";import{Q as fo,a as vo}from"./QItemSection.c6f2640c.js";import{bz as Vo,t as F,c as go,U as $o,be as ho,p as T,u as yo,e as y,E as zo,g as Eo,A as Q,d9 as Fo,da as So,s as M,bA as qo,bH as H,v as wo,x as U,y as B,S as ko,H as l,D as a,a7 as Co,B as n,O as Ao,P as Do,G as E,M as Y,K as p,F as G,k as K,R as J,z as W,L as X}from"./index.976e8f3c.js";import{Q as Z,a as _,C as x}from"./QPopupProxy.d8ef7a42.js";import{a as Io}from"./QToolbar.cff7174f.js";import{Q as Qo}from"./QForm.ed6f6690.js";import{r as v,c as Uo,d as Bo,a as Lo}from"./i18n-validators.06eef631.js";import{u as No}from"./index.ed676411.js";import{T as Po}from"./TabLayoutFilterTabs2.f1a01a4e.js";import{C as jo}from"./ContenedorSimpleMixin.5a0b06ab.js";import{E as Oo}from"./entidadAuditable.75a46700.js";import{u as Ro,S as To,s as Mo,L as Ho,M as Yo,Q as Go,v as Ko,A as Jo}from"./utils.30e08aa2.js";import{E as Wo}from"./EssentialTable.d8e6954a.js";import{u as Xo}from"./filtrosListadosGenerales.31e9eb2c.js";import{E as Zo}from"./ErrorComponent.b482e77d.js";import{N as _o}from"./NoOptionComponent.ffe820c8.js";import"./QChip.334d746c.js";import"./QMenu.410ae527.js";import"./position-engine.2f1d750c.js";import"./format.8ac60962.js";import"./index.95f5a0db.js";import"./QTabs.3c726b04.js";import"./QResizeObserver.6ec10d95.js";import"./QTabPanels.1c8c4baa.js";import"./touch.9135741d.js";import"./QPage.ed5d79ca.js";import"./EssentialTableTabs.c7e98bba.js";import"./QBadge.1ddeabfd.js";import"./EssentialTablePagination.f449a738.js";import"./QTable.048b8be8.js";import"./use-fullscreen.0ccd26e6.js";import"./QBtnGroup.7d0835e4.js";import"./buttonSubmits.2eb37d38.js";import"./QFile.e27868da.js";import"./_commonjsHelpers.8402d862.js";import"./QImg.e0fb285c.js";import"./VisorImagen.e7965569.js";import"./seleccionContratacionPersonal.utils.e3e1ed3d.js";const xo=[{name:"empleado",field:"empleado",label:"Empleado",align:"left",sortable:!0},{name:"periodo",field:"periodo",label:"Periodo",align:"left",sortable:!0},{name:"autorizador",field:"autorizador",label:"Autoriza",align:"left"},{name:"fecha_inicio",field:"fecha_inicio",label:"Fecha Inicio",align:"left",sortable:!0},{name:"fecha_fin",field:"fecha_fin",label:"Fecha Fin",align:"left",sortable:!0},{name:"autorizacion",field:"autorizacion",label:"Estado",align:"left",sortable:!0}];class oe extends Vo{constructor(){super(F.solicitudes_vacaciones)}}class ee extends Oo{constructor(){super();d(this,"empleado");d(this,"autorizador");d(this,"autorizacion");d(this,"dias_solicitados");d(this,"periodo");d(this,"fecha_inicio");d(this,"fecha_fin");d(this,"estado");d(this,"reemplazo");d(this,"funciones");d(this,"observacion");this.empleado=null,this.autorizador=null,this.autorizacion=null,this.dias_solicitados=null,this.periodo=null,this.fecha_inicio=null,this.fecha_fin=null,this.estado=null,this.reemplazo=null,this.funciones=null,this.observacion=null}}var ie=go({components:{NoOptionComponent:_o,ErrorComponent:Zo,TabLayoutFilterTabs2:Po,EssentialTable:Wo},setup(){const o=new jo(ee,new oe),{entidad:e,disabled:m,accion:S,listadosAuxiliares:q}=o.useReferencias(),{setValidador:L,obtenerListados:u,consultar:V,cargarVista:w,listar:i}=o.useComportamiento(),{onConsultado:oo,onReestablecer:eo}=o.useHooks(),{confirmar:io,prompt:ao,notificarAdvertencia:g,notificarCorrecto:so,notificarError:lo}=$o();ho().setQuasar(T()),Ro().setQuasar(T());const c=yo(),b=new To,k=y(!1),$=y(0),C=y(0),A=y([]),f=y("1"),{empleados:N,filtrarEmpleados:no}=Xo(q);w(async()=>{await u({empleados:{controller:new zo,params:{estado:1}}}),e.empleado=c.user.id,N.value=q.empleados,await D(c.user.id)});const ro={reemplazo:{required:v},funciones:{required:v},dias_solicitados:{required:v,minValue:Uo(1),maxValue:Bo(Eo(()=>$.value))},periodo:{required:v},observacion:{required:Lo(()=>k.value)},fecha_inicio:{required:v},fecha_fin:{required:v}},P=No(ro,e);L(P.value),oo(async()=>{await D(Number(e.empleado)),j(),C.value=$.value-Number(e.dias_solicitados),k.value=c.user.id==e.autorizador}),eo(async()=>{e.empleado=c.user.id,await D(c.user.id)});async function D(s){try{b.activar();const t=Q.getInstance(),r=t.getEndpoint(F.derecho_vacaciones)+"/"+s,h=await t.get(r);A.value=h.data.results}catch(t){g("Error "+t)}finally{b.desactivar()}}const j=()=>{const s=A.value.filter(t=>t.periodo===e.periodo)[0];$.value=s?s.dias_disponibles:0},to=()=>{var s;C.value=$.value-(e.dias_solicitados||0),e.fecha_inicio!==null&&((s=e.dias_solicitados)!=null?s:0)>0&&(e.fecha_fin=Ho(Yo(e.fecha_inicio,(e.dias_solicitados||0)-1),M))};function O(s){i({autorizacion_id:s},!1),f.value=s}function uo(s){const t=Go(Ko(),0,0,-15,"YYYY/MM/DD");return s>=t}async function mo(s,t){try{b.activar();const r=Q.getInstance(),h=H.URL_BASE+"/"+r.getEndpoint(F.solicitudes_vacaciones)+"/imprimir/"+s;await Jo(h,"GET","blob","pdf",t)}catch(r){g("Error al imprimir el documento. "+r)}finally{b.desactivar()}}async function co(s,t){try{b.activar();const r=Q.getInstance(),h=H.URL_BASE+"/"+r.getEndpoint(F.solicitudes_vacaciones)+"/anular/"+s,I=await r.patch(h,{motivo:t});I.status===200?(so(I.data.mensaje),O(f.value)):lo(I.data.mensaje)}catch(r){console.error(r),r.response?r.response.status===422?g(r.response.data.message||"Error de validaci\xF3n"):g("Error al anular la solicitud de vacaciones."):g("Error de red o inesperado.")}finally{b.desactivar()}}return{mixin:o,solicitud:e,autorizaciones:Fo,tabOptionsVacaciones:So,esAutorizador:k,maskFecha:M,v$:P,disabled:m,configuracionColumnas:xo,accion:S,acciones:qo,tabDefecto:f,dias_disponibles:$,dias_restantes:C,optionsFechaInicio:uo,filtrarSolicitudes:O,calcularFechaFin:to,ordenarLista:Mo,periodoSeleccionado:j,empleados:N,filtrarEmpleados:no,periodos:A,editarVacacion:{titulo:" ",icono:"bi-pencil-square",color:"secondary",visible:({entidad:s})=>s.autorizador_id===c.user.id&&Number(f.value)==1,accion:({entidad:s})=>{S.value="EDITAR",V(s)}},btnImprimir:{titulo:"Imprimir",color:"secondary",icono:"bi-printer",accion:async({entidad:s})=>{await mo(s.id,`Solicitud vacaciones ${s.periodo} ${s.empleado}`)},visible:()=>["1","2"].includes(f.value)},btnAnular:{titulo:"Anular",color:"negative",icono:"bi-x",accion:({entidad:s})=>{io("\xBFEst\xE1 seguro que desea anular esta solicitud de vacaci\xF3n?",async()=>{ao({titulo:"Motivo",mensaje:"Ingrese un motivo de anulaci\xF3n",requerido:!0,accion:async r=>{await co(s.id,r)}})})},visible:()=>c.esRecursosHumanos&&f.value==="2"}}}});const ae={class:"row q-col-gutter-sm q-mb-md q-mt-md q-mx-md q-py-sm"},se={class:"col-12 col-md-3 q-mb-md"},le={class:"col-12 col-md-3"},ne={class:"col-4 col-md-3 col-sm-6"},re={class:"col-4 col-md-3 col-sm-6"},te={class:"col-12 col-md-3"},de={class:"col-12 col-md-3"},ue={class:"row items-center justify-end"},me={class:"col-12 col-md-3"},ce={class:"row items-center justify-end"},pe={key:0,class:"col-12 col-md-3"},be={key:1,class:"col-12 col-md-3"},fe={class:"col-12 col-md-3 q-mb-md"},ve={class:"q-mb-sm block"},Ve={class:"col-12 col-md-6"};function ge(o,e,m,S,q,L){const u=U("error-component"),V=U("no-option-component"),w=U("tab-layout-filter-tabs2");return B(),ko(w,{mixin:o.mixin,configuracionColumnas:o.configuracionColumnas,tabOptions:o.tabOptionsVacaciones,full:!0,permitirEditar:!1,permitirEliminar:!1,mostrarButtonSubmits:!0,filtrar:o.filtrarSolicitudes,tabDefecto:o.tabDefecto,forzarListar:!0,"ajustar-celdas":"",accion1:o.editarVacacion,accion2:o.btnAnular,accion3:o.btnImprimir},{formulario:l(()=>[a(Qo,{onSubmit:e[14]||(e[14]=Co(()=>{},["prevent"]))},{default:l(()=>[n("div",ae,[n("div",se,[e[15]||(e[15]=n("label",{class:"q-mb-sm block"},"Empleado ",-1)),a(z,{modelValue:o.solicitud.empleado,"onUpdate:modelValue":e[0]||(e[0]=i=>o.solicitud.empleado=i),options:o.empleados,"options-dense":"",clearable:"",dense:"",outlined:"",disable:"","option-label":i=>i.apellidos+" "+i.nombres,"option-value":i=>i.id,"map-options":""},null,8,["modelValue","options","option-label","option-value"])]),n("div",le,[e[16]||(e[16]=n("label",{class:"q-mb-sm block"},"Periodo",-1)),a(z,{modelValue:o.solicitud.periodo,"onUpdate:modelValue":[e[1]||(e[1]=i=>o.solicitud.periodo=i),o.periodoSeleccionado],options:o.periodos,"transition-show":"jump-up","transition-hide":"jump-down","options-dense":"",dense:"",outlined:"",disable:o.accion!==o.acciones.nuevo,readonly:o.disabled,error:!!o.v$.periodo.$errors.length,"error-message":"Debes seleccionar un periodo","use-input":"",onBlur:o.v$.periodo.$touch,"input-debounce":"0","option-value":i=>i.periodo,"option-label":i=>i.periodo,"emit-value":"","map-options":""},{option:l(i=>[a(fo,Ao(Do(i.itemProps)),{default:l(()=>[a(vo,null,{default:l(()=>[a(R,null,{default:l(()=>[E(Y(i.opt.periodo),1)]),_:2},1024),a(R,{caption:""},{default:l(()=>[E("D\xEDas disponibles: "+Y(i.opt.dias_disponibles),1)]),_:2},1024)]),_:2},1024)]),_:2},1040)]),error:l(()=>[a(u,{clave:"periodo",v$:o.v$},null,8,["v$"])]),"no-option":l(()=>[a(V)]),_:1},8,["modelValue","options","disable","readonly","error","onBlur","onUpdate:modelValue","option-value","option-label"])]),n("div",ne,[e[17]||(e[17]=n("label",{class:"q-mb-sm block"},"D\xEDas disponibles para tomar",-1)),a(p,{modelValue:o.dias_disponibles,"onUpdate:modelValue":e[2]||(e[2]=i=>o.dias_disponibles=i),disable:"",outlined:"",dense:""},null,8,["modelValue"])]),n("div",re,[e[18]||(e[18]=n("label",{class:"q-mb-sm block"},"D\xEDas restantes",-1)),a(p,{modelValue:o.dias_restantes,"onUpdate:modelValue":e[3]||(e[3]=i=>o.dias_restantes=i),disable:"",outlined:"",dense:""},null,8,["modelValue"])]),n("div",te,[e[19]||(e[19]=n("label",{class:"q-mb-sm block"},"D\xEDas que voy a tomar",-1)),a(p,{modelValue:o.solicitud.dias_solicitados,"onUpdate:modelValue":[e[4]||(e[4]=i=>o.solicitud.dias_solicitados=i),o.calcularFechaFin],disable:o.disabled,min:"0",max:o.dias_disponibles,type:"number",error:!!o.v$.dias_solicitados.$errors.length,"error-message":"Solo puedes ingresar m\xE1ximo "+o.dias_disponibles+" d\xEDa/s",outlined:"",dense:""},{error:l(()=>[a(u,{clave:"dias_solicitados",v$:o.v$},null,8,["v$"])]),_:1},8,["modelValue","disable","max","error","error-message","onUpdate:modelValue"])]),n("div",de,[e[20]||(e[20]=n("label",{class:"q-mb-sm block"},"Fecha Inicio",-1)),a(p,{modelValue:o.solicitud.fecha_inicio,"onUpdate:modelValue":e[6]||(e[6]=i=>o.solicitud.fecha_inicio=i),placeholder:"Obligatorio",error:!!o.v$.fecha_inicio.$errors.length,disable:o.disabled,readonly:"",onBlur:o.v$.fecha_inicio.$touch,outlined:"",dense:""},{append:l(()=>[a(G,{name:"event",class:"cursor-pointer"},{default:l(()=>[a(Z,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:l(()=>[a(_,{modelValue:o.solicitud.fecha_inicio,"onUpdate:modelValue":[e[5]||(e[5]=i=>o.solicitud.fecha_inicio=i),o.calcularFechaFin],mask:o.maskFecha,options:o.optionsFechaInicio,"today-btn":""},{default:l(()=>[n("div",ue,[K(a(J,{label:"Cerrar",color:"primary",flat:""},null,512),[[x]])])]),_:1},8,["modelValue","mask","options","onUpdate:modelValue"])]),_:1})]),_:1})]),error:l(()=>[a(u,{clave:"fecha_inicio",v$:o.v$},null,8,["v$"])]),_:1},8,["modelValue","error","disable","onBlur"])]),n("div",me,[e[21]||(e[21]=n("label",{class:"q-mb-sm block"},"Fecha Fin",-1)),a(p,{modelValue:o.solicitud.fecha_fin,"onUpdate:modelValue":e[8]||(e[8]=i=>o.solicitud.fecha_fin=i),error:!!o.v$.fecha_fin.$errors.length,disable:"",onBlur:o.v$.fecha_fin.$touch,outlined:"",dense:""},{append:l(()=>[a(G,{name:"event",class:"cursor-pointer"},{default:l(()=>[a(Z,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:l(()=>[a(_,{modelValue:o.solicitud.fecha_fin,"onUpdate:modelValue":e[7]||(e[7]=i=>o.solicitud.fecha_fin=i),mask:o.maskFecha,"today-btn":""},{default:l(()=>[n("div",ce,[K(a(J,{label:"Cerrar",color:"primary",flat:""},null,512),[[x]])])]),_:1},8,["modelValue","mask"])]),_:1})]),_:1})]),error:l(()=>[a(u,{clave:"fecha_fin",v$:o.v$},null,8,["v$"])]),_:1},8,["modelValue","error","onBlur"])]),o.esAutorizador?(B(),W("div",pe,[e[22]||(e[22]=n("label",{class:"q-mb-sm block"},"Observacion",-1)),a(p,{modelValue:o.solicitud.observacion,"onUpdate:modelValue":e[9]||(e[9]=i=>o.solicitud.observacion=i),placeholder:"Obligatorio",disable:!o.esAutorizador,error:!!o.v$.observacion.$errors.length,outlined:"",dense:""},{error:l(()=>[a(u,{clave:"observacion",v$:o.v$},null,8,["v$"])]),_:1},8,["modelValue","disable","error"])])):X("",!0),o.accion==o.acciones.editar&&o.esAutorizador?(B(),W("div",be,[e[23]||(e[23]=n("label",{color:"light-green-2",class:"text-positive text-bold q-mb-sm inline-block bg-light-green-2 rounded q-px-md"},"Autorizaci\xF3n ",-1)),a(z,{modelValue:o.solicitud.autorizacion,"onUpdate:modelValue":e[10]||(e[10]=i=>o.solicitud.autorizacion=i),options:o.autorizaciones,"transition-show":"jump-up","transition-hide":"jump-down","options-dense":"",dense:"",outlined:"",disable:!o.esAutorizador,"option-value":i=>i.id,"option-label":i=>i.nombre,"emit-value":"","map-options":""},{"no-option":l(()=>[a(V)]),_:1},8,["modelValue","options","disable","option-value","option-label"])])):X("",!0),n("div",fe,[n("label",ve,[e[25]||(e[25]=E("Reemplazo ")),e[26]||(e[26]=n("i",{class:"bi bi-info-circle"},null,-1)),a(Io,{class:"bg-dark"},{default:l(()=>e[24]||(e[24]=[E("La persona que cubrira su puesto durante sus vacaciones")])),_:1})]),a(z,{modelValue:o.solicitud.reemplazo,"onUpdate:modelValue":e[11]||(e[11]=i=>o.solicitud.reemplazo=i),options:o.empleados,"options-dense":"",clearable:"",dense:"",outlined:"",disable:o.disabled,"use-input":"","input-debounce":"0",onPopupShow:e[12]||(e[12]=i=>o.ordenarLista(o.empleados,"apellidos")),onFilter:o.filtrarEmpleados,"option-label":i=>i.apellidos+" "+i.nombres,"option-value":i=>i.id,error:!!o.v$.reemplazo.$errors.length,"emit-value":"","map-options":""},{error:l(()=>[a(u,{clave:"reemplazo",v$:o.v$},null,8,["v$"])]),"no-option":l(()=>[a(V)]),_:1},8,["modelValue","options","disable","onFilter","option-label","option-value","error"])]),n("div",Ve,[e[27]||(e[27]=n("label",{class:"q-mb-sm block"},"Funciones (reemplazo)",-1)),a(p,{modelValue:o.solicitud.funciones,"onUpdate:modelValue":e[13]||(e[13]=i=>o.solicitud.funciones=i),placeholder:"Obligatorio",autogrow:"",disable:o.disabled,error:!!o.v$.funciones.$errors.length,outlined:"",dense:""},{error:l(()=>[a(u,{clave:"funciones",v$:o.v$},null,8,["v$"])]),_:1},8,["modelValue","disable","error"])])])]),_:1})]),_:1},8,["mixin","configuracionColumnas","tabOptions","filtrar","tabDefecto","accion1","accion2","accion3"])}var ri=wo(ie,[["render",ge]]);export{ri as default};
