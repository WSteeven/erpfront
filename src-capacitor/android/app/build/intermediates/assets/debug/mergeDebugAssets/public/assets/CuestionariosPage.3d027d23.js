var ee=Object.defineProperty;var oe=(e,n,u)=>n in e?ee(e,n,{enumerable:!0,configurable:!0,writable:!0,value:u}):e[n]=u;var F=(e,n,u)=>(oe(e,typeof n!="symbol"?n+"":n,u),u);import{ad as ae,b4 as te,av as ne,b5 as re,bL as se,e as E,g as I,o as ie,l as O,aF as le,F as H,h as ue,bN as ce,aj as Q,bz as X,t as Y,c as de,be as me,p as fe,U as ge,v as be,x as R,y as i,S as m,H as f,D as y,bf as M,bg as P,B as A,z as V,J as U,I as G,L as _,T as K,bI as ve,R as J,G as W,M as j,K as ye}from"./index.976e8f3c.js";import{b as Ce}from"./format.8ac60962.js";import{Q as he}from"./QSelect.a8f2bfb2.js";import{Q as Se}from"./QPage.ed5d79ca.js";import{S as Ae,i as _e}from"./utils.30e08aa2.js";import{n as pe}from"./EssentialTable.d8e6954a.js";import{r as Le}from"./i18n-validators.06eef631.js";import{u as Ie}from"./index.ed676411.js";import Ve from"./CuestionarioDiagnosticoConsumoDrogasPage.2a50759e.js";import xe from"./CuestionarioPsicosocialPage.d59c2f16.js";import{T as qe}from"./TabLayout.d6dcc414.js";import{B as we}from"./buttonSubmits.2eb37d38.js";import{C as ke}from"./ContenedorSimpleMixin.5a0b06ab.js";import{T as $e,R as Ee}from"./RespuestaCuestionarioEmpleado.98eac578.js";var He=ae({name:"QRating",props:{...te,...ne,modelValue:{type:Number,required:!0},max:{type:[String,Number],default:5},icon:[String,Array],iconHalf:[String,Array],iconSelected:[String,Array],iconAriaLabel:[String,Array],color:[String,Array],colorHalf:[String,Array],colorSelected:[String,Array],noReset:Boolean,noDimming:Boolean,readonly:Boolean,disable:Boolean},emits:["update:modelValue"],setup(e,{slots:n,emit:u}){const{proxy:{$q:p}}=ue(),x=re(e),q=se(e),C=ce(q),l=E(0);let g={};const r=I(()=>e.readonly!==!0&&e.disable!==!0),v=I(()=>`q-rating row inline items-center q-rating--${r.value===!0?"":"non-"}editable`+(e.noDimming===!0?" q-rating--no-dimming":"")+(e.disable===!0?" disabled":"")+(e.color!==void 0&&Array.isArray(e.color)===!1?` text-${e.color}`:"")),h=I(()=>{const t=Array.isArray(e.icon)===!0?e.icon.length:0,a=Array.isArray(e.iconSelected)===!0?e.iconSelected.length:0,c=Array.isArray(e.iconHalf)===!0?e.iconHalf.length:0,d=Array.isArray(e.color)===!0?e.color.length:0,b=Array.isArray(e.colorSelected)===!0?e.colorSelected.length:0,o=Array.isArray(e.colorHalf)===!0?e.colorHalf.length:0;return{iconLen:t,icon:t>0?e.icon[t-1]:e.icon,selIconLen:a,selIcon:a>0?e.iconSelected[a-1]:e.iconSelected,halfIconLen:c,halfIcon:c>0?e.iconHalf[a-1]:e.iconHalf,colorLen:d,color:d>0?e.color[d-1]:e.color,selColorLen:b,selColor:b>0?e.colorSelected[b-1]:e.colorSelected,halfColorLen:o,halfColor:o>0?e.colorHalf[o-1]:e.colorHalf}}),B=I(()=>{if(typeof e.iconAriaLabel=="string"){const t=e.iconAriaLabel.length!==0?`${e.iconAriaLabel} `:"";return a=>`${t}${a}`}if(Array.isArray(e.iconAriaLabel)===!0){const t=e.iconAriaLabel.length;if(t>0)return a=>e.iconAriaLabel[Math.min(a,t)-1]}return(t,a)=>`${a} ${t}`}),L=I(()=>{const t=[],a=h.value,c=Math.ceil(e.modelValue),d=r.value===!0?0:null,b=e.iconHalf===void 0||c===e.modelValue?-1:c;for(let o=1;o<=e.max;o++){const s=l.value===0&&e.modelValue>=o||l.value>0&&l.value>=o,S=b===o&&l.value<o,N=l.value>0&&(S===!0?c:e.modelValue)>=o&&l.value<o,z=S===!0?o<=a.halfColorLen?e.colorHalf[o-1]:a.halfColor:a.selColor!==void 0&&s===!0?o<=a.selColorLen?e.colorSelected[o-1]:a.selColor:o<=a.colorLen?e.color[o-1]:a.color,Z=(S===!0?o<=a.halfIconLen?e.iconHalf[o-1]:a.halfIcon:a.selIcon!==void 0&&(s===!0||N===!0)?o<=a.selIconLen?e.iconSelected[o-1]:a.selIcon:o<=a.iconLen?e.icon[o-1]:a.icon)||p.iconSet.rating.icon;t.push({name:(S===!0?o<=a.halfIconLen?e.iconHalf[o-1]:a.halfIcon:a.selIcon!==void 0&&(s===!0||N===!0)?o<=a.selIconLen?e.iconSelected[o-1]:a.selIcon:o<=a.iconLen?e.icon[o-1]:a.icon)||p.iconSet.rating.icon,attrs:{tabindex:d,role:"radio","aria-checked":e.modelValue===o?"true":"false","aria-label":B.value(o,Z)},iconClass:"q-rating__icon"+(s===!0||S===!0?" q-rating__icon--active":"")+(N===!0?" q-rating__icon--exselected":"")+(l.value===o?" q-rating__icon--hovered":"")+(z!==void 0?` text-${z}`:"")})}return t}),D=I(()=>{const t={role:"radiogroup"};return e.disable===!0&&(t["aria-disabled"]="true"),e.readonly===!0&&(t["aria-readonly"]="true"),t});function w(t){if(r.value===!0){const a=Ce(parseInt(t,10),1,parseInt(e.max,10)),c=e.noReset!==!0&&e.modelValue===a?0:a;c!==e.modelValue&&u("update:modelValue",c),l.value=0}}function k(t){r.value===!0&&(l.value=t)}function T(t,a){switch(t.keyCode){case 13:case 32:return w(a),Q(t);case 37:case 40:return g[`rt${a-1}`]&&g[`rt${a-1}`].focus(),Q(t);case 39:case 38:return g[`rt${a+1}`]&&g[`rt${a+1}`].focus(),Q(t)}}function $(){l.value=0}return ie(()=>{g={}}),()=>{const t=[];return L.value.forEach(({iconClass:a,name:c,attrs:d},b)=>{const o=b+1;t.push(O("div",{key:o,ref:s=>{g[`rt${o}`]=s},class:"q-rating__icon-container flex flex-center",...d,onClick(){w(o)},onMouseover(){k(o)},onMouseout:$,onFocus(){k(o)},onBlur:$,onKeyup(s){T(s,o)}},le(n[`tip-${o}`],[O(H,{class:a,name:c})])))}),e.name!==void 0&&e.disable!==!0&&C(t,"push"),O("div",{class:v.value,style:x.value,...D.value},t)}}});class Be{constructor(n){F(this,"respuestaCuestionarioEmpleado");this.respuestaCuestionarioEmpleado=n}async validar(){const n=this.respuestaCuestionarioEmpleado.cuestionario.filter(u=>u.id_cuestionario);if(this.respuestaCuestionarioEmpleado.cuestionario.length!==n.length)throw new Error("No ha llenado todo el cuestionario!");return!0}}class Te extends X{constructor(){super(Y.respuestas_cuestionarios_empleados)}}class Ne extends X{constructor(){super(Y.preguntas)}}var Oe=de({components:{TabLayout:qe,ButtonSubmits:we,CuestionarioPsicosocialHeader:xe,CuestionarioDiagnosticoConsumoDrogasHeader:Ve},props:{mixin:{type:Object,required:!1}},setup(e){var b;me().setQuasar(fe());const n=E([]),u=new Ae,p=E(),{confirmar:x}=ge(),q=new $e,C=(b=e.mixin)!=null?b:new ke(Ee,new Te),{obtenerListados:l,cargarVista:g,setValidador:r,guardar:v}=C.useComportamiento(),{entidad:h,accion:B,listadosAuxiliares:L}=C.useReferencias();g(async()=>{await l({preguntas:[]})}),q.listar().then(o=>{const{result:s}=o;n.value=s});const w=Ie({cuestionario:{required:Le}},h);r(w.value);const k=new Be(h);C.agregarValidaciones(k);function T(o){return o.map(s=>({label:s.respuesta,value:s.id}))}const $=()=>h.cuestionario=L.preguntas.map(o=>({respuesta_texto:typeof o.respuesta=="string"?o.respuesta:null,id_cuestionario:typeof o.respuesta=="string"?o.cuestionario[0].id:o.respuesta})),t=async()=>{x("Las respuestas ser\xE1n enviadas y no podr\xE1n ser modificadas. \xBFDesea continuar?",async()=>{try{$(),await v(h),L.preguntas=[],d.value="Gracias por completar el cuestionario."}catch(o){console.log(o)}})};async function a(o){p.value=o,u.activar();try{const{result:s}=await c.listar({tipo_cuestionario_id:o});L.preguntas=s}catch(s){if(_e(s)){const S=s.erroresValidacion;d.value=S[0]}}finally{u.desactivar()}}const c=new Ne,d=E();return{consultarPreguntas:a,mapearCuestionario:T,listadosAuxiliares:L,tiposCuestionarios:n,mensaje:d,accion:B,guardarCuestionario:t,tipoCuestionarioSeleccionado:p,opcionesTiposCuestionarios:pe}}});const Qe={class:"text-center full-width"},Re={key:0},Me={key:2,class:"col-12 text-positive text-bold text-h5"},Pe={class:"q-mb-md"},je={class:"row q-col-gutter-x-sm"},De={class:"q-mb-sm block"},ze={class:"row full-width justify-center"};function Fe(e,n,u,p,x,q){const C=R("cuestionario-psicosocial-header"),l=R("cuestionario-diagnostico-consumo-drogas-header"),g=R("button-submits");return i(),m(Se,{padding:""},{default:f(()=>[y(K,{name:"scale",mode:"out-in"},{default:f(()=>[e.listadosAuxiliares.preguntas.length?_("",!0):(i(),m(M,{key:0,flat:"",class:"q-mb-sm bg-desenfoque border-white"},{default:f(()=>[y(P,{class:"row q-col-gutter-sm text-center"},{default:f(()=>[n[2]||(n[2]=A("div",{class:"full-width text-bold"},"Cuestionarios disponibles",-1)),n[3]||(n[3]=A("small",{class:"block text-center full-width q-mb-md"},"Los cuestionarios que no puede seleccionar ya han sido completados por usted",-1)),A("div",Qe,[(i(!0),V(G,null,U(e.tiposCuestionarios,(r,v)=>(i(),m(J,{key:v,class:"full-width text-primary bg-white q-mb-sm","no-caps":"",unelevated:"",disable:r.finalizado,onClick:h=>e.consultarPreguntas(r.id)},{default:f(()=>[r.finalizado?(i(),m(H,{key:0,name:"bi-check-circle-fill",class:"q-mr-sm",color:"positive"})):(i(),m(H,{key:1,name:"bi-check-circle",class:"q-mr-sm",color:"positive"})),W(" "+j(r.titulo),1)]),_:2},1032,["disable","onClick"]))),128))])]),_:1})]),_:1}))]),_:1}),y(K,{name:"scale",mode:"out-in"},{default:f(()=>[e.listadosAuxiliares.preguntas.length?(i(),V("div",Re,[y(M,{flat:"",class:"q-mb-sm bg-desenfoque border-white"},{default:f(()=>[ve(e.$slots,"persona"),y(P,null,{default:f(()=>[y(J,{color:"primary","no-caps":"",unelevated:"",square:"",onClick:n[0]||(n[0]=r=>e.listadosAuxiliares.preguntas=[])},{default:f(()=>[y(H,{name:"bi-arrow-left",class:"q-mr-sm"}),n[4]||(n[4]=W(" Volver a ver los cuestionarios disponibles"))]),_:1})]),_:1})]),_:3}),e.listadosAuxiliares.preguntas.length?(i(),m(M,{key:0,flat:"",class:"q-mb-sm border-white"},{default:f(()=>[y(P,{class:"row q-col-gutter-sm text-center"},{default:f(()=>[e.tipoCuestionarioSeleccionado===e.opcionesTiposCuestionarios.CUESTIONARIO_PSICOSOCIAL?(i(),m(C,{key:0})):_("",!0),e.tipoCuestionarioSeleccionado===e.opcionesTiposCuestionarios.CUESTIONARIO_DIAGNOSTICO_CONSUMO_DE_DROGAS?(i(),m(l,{key:1})):_("",!0),e.mensaje?(i(),V("div",Me,[A("div",Pe,j(e.mensaje),1),y(He,{"model-value":5,name:"bi-star-fill",maz:"5",color:"amber"})])):_("",!0),A("div",je,[(i(!0),V(G,null,U(e.listadosAuxiliares.preguntas,r=>(i(),V("div",{key:r.id,class:"col-12 col-md-6 text-bold text-justify q-mb-md"},[A("label",De,j(r.codigo+".- "+r.pregunta),1),r.cuestionario[0].respuesta?(i(),m(he,{key:0,modelValue:r.respuesta,"onUpdate:modelValue":v=>r.respuesta=v,options:e.mapearCuestionario(r.cuestionario),color:"primary",outlined:"",dense:"","options-dense":"","emit-value":"","map-options":""},null,8,["modelValue","onUpdate:modelValue","options"])):(i(),m(ye,{key:1,modelValue:r.respuesta,"onUpdate:modelValue":v=>r.respuesta=v,placeholder:"Escriba...",outlined:"",dense:""},null,8,["modelValue","onUpdate:modelValue"]))]))),128))]),A("div",ze,[e.listadosAuxiliares.preguntas.length?(i(),m(g,{key:0,accion:e.accion,"label-guardar":"Guardar y enviar respuestas",permitirCancelar:!1,onGuardar:n[1]||(n[1]=r=>e.guardarCuestionario())},null,8,["accion"])):_("",!0)])]),_:1})]),_:1})):_("",!0)])):_("",!0)]),_:3})]),_:3})}var Ue=be(Oe,[["render",Fe]]),lo=Object.freeze(Object.defineProperty({__proto__:null,default:Ue},Symbol.toStringTag,{value:"Module"}));export{Ue as C,Ne as P,He as Q,lo as a};
