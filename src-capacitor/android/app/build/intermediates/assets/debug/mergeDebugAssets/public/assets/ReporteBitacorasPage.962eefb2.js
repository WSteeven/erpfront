import{Q as S,a as D}from"./QSelect.a8f2bfb2.js";import{Q as ae,a as le}from"./QItemSection.c6f2640c.js";import{c as se,U as re,be as ie,p as E,f as te,e as w,i as ne,a3 as R,bp as ue,s as y,q as me,A as de,bH as ce,t as pe,v as fe,x as C,y as _,S as F,H as s,D as a,B as r,bf as L,z as be,O as ve,P as he,G as U,M as A,L as N,K as $,F as c,k as O,R as p}from"./index.976e8f3c.js";import{Q as T,a as M,C as j}from"./QPopupProxy.d8ef7a42.js";import{Q as ge}from"./QBtnGroup.7d0835e4.js";import{Q as Ve}from"./QPage.ed5d79ca.js";import{Q as ke,a as we}from"./QLayout.732b3e1b.js";import{u as ye,S as Ce,W as z,M as _e,L as H,A as K}from"./utils.30e08aa2.js";import{u as $e}from"./index.ed676411.js";import{E as qe}from"./ErrorComponent.b482e77d.js";import{N as Qe}from"./NoOptionComponent.ffe820c8.js";import{E as Be}from"./EssentialTable.d8e6954a.js";import{B as Ie,a as Pe,u as Se}from"./Functions.c8bc5a31.js";import{V as De}from"./VehiculoController.fd9db948.js";import{C as Ee}from"./ContenedorSimpleMixin.5a0b06ab.js";import{u as Re}from"./filtrosListadosGenerales.31e9eb2c.js";import{r as G,a as Fe}from"./i18n-validators.06eef631.js";import"./QChip.334d746c.js";import"./QMenu.410ae527.js";import"./position-engine.2f1d750c.js";import"./format.8ac60962.js";import"./QScrollObserver.cb4b92b2.js";import"./QResizeObserver.6ec10d95.js";import"./QFile.e27868da.js";import"./QTable.048b8be8.js";import"./use-fullscreen.0ccd26e6.js";import"./QToolbar.cff7174f.js";import"./QBadge.1ddeabfd.js";import"./_commonjsHelpers.8402d862.js";import"./QImg.e0fb285c.js";import"./VisorImagen.e7965569.js";import"./seleccionContratacionPersonal.utils.e3e1ed3d.js";import"./entidadAuditable.75a46700.js";import"./index.95f5a0db.js";const Le=[{name:"id",field:"id",label:"Bit\xE1cora",align:"left",sortable:!0},{name:"vehiculo",field:"vehiculo",label:"Placa",align:"left",sortable:!0},{name:"chofer",field:"chofer",label:"Chofer",align:"left",sortable:!0},{name:"fecha",field:"fecha",label:"fecha",align:"left",sortable:!0},{name:"hora_salida",field:"hora_salida",label:"H Salida",align:"left",sortable:!0},{name:"hora_llegada",field:"hora_llegada",label:"H. Llegada",align:"left",sortable:!0},{name:"km_inicial",field:"km_inicial",label:"Km Inicio",align:"left",sortable:!0},{name:"km_final",field:"km_final",label:"Km Final",align:"left",sortable:!0},{name:"km_recorridos",field:"km_recorridos",label:"Km Recorridos",align:"left",sortable:!0},{name:"tareas",field:"tareas",label:"Tareas",align:"left",sortable:!0}];var Ue=se({name:"ReporteBitacorasPage",components:{EssentialTable:Be,ErrorComponent:qe,NoOptionComponent:Qe},setup(){const o=new Ee(Ie,new Pe),{listadosAuxiliares:e}=o.useReferencias(),{cargarVista:q,obtenerListados:v}=o.useComportamiento(),{notificarError:Q,notificarAdvertencia:B}=re();ie().setQuasar(E()),ye().setQuasar(E());const u=new Ce,n=te({tipo:null,fecha_inicio:"",fecha_fin:"",vehiculo:null,todos:!1}),h="todos",l="individual",W=[h,l],m=w(),f=w([]),{vehiculos:g,filtrarVehiculos:J}=Re(e),{imprimirPdf:X}=Se();q(async()=>{await v({vehiculos:[]}),g.value=e.vehiculos;const t=z(new Date),i=_e(t,-1),d=z(i);n.fecha_inicio=H(d,y),n.fecha_fin=H(i,y)});const Y={tipo:{required:G},vehiculo:{required:Fe(()=>n.tipo==l)},fecha_inicio:{required:G}},I=$e(Y,n);ne(()=>{var t;m.value=(t=R.getItem("umbral_km_consumidos"))!=null?t:5200}),ue(()=>{R.set("umbral_km_consumidos",m.value)});async function Z(t){t==l&&(await v({vehiculos:{controller:new De,params:{estado:1}}}),g.value=e.vehiculos)}async function x(t,i,d){if(await I.value.$validate())try{u.activar();const b=de.getInstance(),V=ce.URL_BASE+"/"+b.getEndpoint(pe.reporte_bitacoras),P="reporte_bitacoras";switch(t){case"excel":return i.accion="excel",i.umbral=m.value,await K(V,"POST","blob","xlsx",P,i),d;case"pdf":return i.accion="pdf",i.umbral=m.value,await K(V,"POST","blob","pdf",P,i),d;default:i.accion="";const k=await b.post(V,i);return k.data.results?(k.data.results.length<1&&B("No se obtuvieron resultados"),k.data.results):d}}catch(b){console.log(b),Q("Error al obtener el reporte")}finally{u.desactivar()}}async function ee(t){const i=w([]);i.value=await x(t,n,f.value),f.value=i.value,console.log(i.value),console.log(f.value)}const oe={titulo:"Imprimir",icono:"bi-printer",color:"secondary",accion:async({entidad:t})=>{await X(t.id)}};return{v$:I,listado:f,listadosAuxiliares:e,mixin:o,reporte:n,maskFecha:y,INDIVIDUAL:l,configuracionColumnas:[...Le,me],umbral_km_consumidos:m,vehiculos:g,filtrarVehiculos:J,opciones:W,btnImprimir:oe,buscarReporte:ee,consultarListado:Z}}});const Ae={class:"col"},Ne={class:"row q-col-gutter-sm q-pa-sm q-py-md"},Oe={class:"col-12 col-md-3"},Te={key:0,class:"col-12 col-md-3 q-mb-md"},Me={class:"col-12 col-md-3"},je={class:"row items-center justify-end"},ze={class:"col-12 col-md-3"},He={class:"row items-center justify-end"},Ke={class:"col-12 col-md-3"},Ge={class:"col-12 col-md-12 q-mt-md"},We={class:"text-center"},Je={class:"row q-col-gutter-sm q-py-md q-mb-lg"},Xe={class:"col-12"};function Ye(o,e,q,v,Q,B){const u=C("error-component"),n=C("no-option-component"),h=C("essential-table");return _(),F(we,null,{default:s(()=>[a(ke,null,{default:s(()=>[a(Ve,{padding:""},{default:s(()=>[r("div",Ae,[a(L,{class:"col rounded no-border q-pb-md"},{default:s(()=>[r("div",Ne,[r("div",Oe,[e[11]||(e[11]=r("label",{class:"q-mb-sm block"},"Tipo de reporte",-1)),a(S,{modelValue:o.reporte.tipo,"onUpdate:modelValue":[e[0]||(e[0]=l=>o.reporte.tipo=l),e[1]||(e[1]=l=>o.consultarListado(o.reporte.tipo))],options:o.opciones,"transition-show":"scale","transition-hide":"scale","options-dense":"",dense:"",outlined:"",error:!!o.v$.tipo.$errors.length,"emit-value":"","map-options":""},{error:s(()=>[a(u,{clave:"tipo",v$:o.v$},null,8,["v$"])]),_:1},8,["modelValue","options","error"])]),o.reporte.tipo==o.INDIVIDUAL?(_(),be("div",Te,[e[12]||(e[12]=r("label",{class:"q-mb-sm block"},"Veh\xEDculo",-1)),a(S,{modelValue:o.reporte.vehiculo,"onUpdate:modelValue":e[2]||(e[2]=l=>o.reporte.vehiculo=l),options:o.vehiculos,hint:"Agregue elementos desde el panel de veh\xEDculos","transition-show":"scale","transition-hide":"scale","options-dense":"",clearable:"",dense:"",outlined:"","use-input":"","input-debounce":"0",onFilter:o.filtrarVehiculos,"option-label":l=>l.placa,"option-value":l=>l.id,error:!!o.v$.vehiculo.$errors.length,onBlur:o.v$.vehiculo.$touch,"emit-value":"","map-options":""},{option:s(l=>[a(ae,ve(he(l.itemProps)),{default:s(()=>[a(le,null,{default:s(()=>[a(D,null,{default:s(()=>[U(A(l.opt.placa),1)]),_:2},1024),a(D,{caption:""},{default:s(()=>[U(A(l.opt.marca+" "+l.opt.modelo),1)]),_:2},1024)]),_:2},1024)]),_:2},1040)]),"no-option":s(()=>[a(n)]),error:s(()=>[a(u,{clave:"vehiculo",v$:o.v$},null,8,["v$"])]),_:1},8,["modelValue","options","onFilter","option-label","option-value","error","onBlur"])])):N("",!0),r("div",Me,[e[13]||(e[13]=r("label",{class:"q-mb-sm block"},"Fecha de inicio",-1)),a($,{modelValue:o.reporte.fecha_inicio,"onUpdate:modelValue":e[4]||(e[4]=l=>o.reporte.fecha_inicio=l),error:!!o.v$.fecha_inicio.$errors.length,placeholder:"Opcional",outlined:"",dense:""},{append:s(()=>[a(c,{name:"event",class:"cursor-pointer"},{default:s(()=>[a(T,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:s(()=>[a(M,{modelValue:o.reporte.fecha_inicio,"onUpdate:modelValue":e[3]||(e[3]=l=>o.reporte.fecha_inicio=l),mask:o.maskFecha,"today-btn":""},{default:s(()=>[r("div",je,[O(a(p,{label:"Cerrar",color:"primary",flat:""},null,512),[[j]])])]),_:1},8,["modelValue","mask"])]),_:1})]),_:1})]),error:s(()=>[a(u,{clave:"fecha_inicio",v$:o.v$},null,8,["v$"])]),_:1},8,["modelValue","error"])]),r("div",ze,[e[14]||(e[14]=r("label",{class:"q-mb-sm block"},"Fecha fin ",-1)),a($,{modelValue:o.reporte.fecha_fin,"onUpdate:modelValue":e[6]||(e[6]=l=>o.reporte.fecha_fin=l),placeholder:"Opcional",outlined:"",dense:""},{append:s(()=>[a(c,{name:"event",class:"cursor-pointer"},{default:s(()=>[a(T,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:s(()=>[a(M,{modelValue:o.reporte.fecha_fin,"onUpdate:modelValue":e[5]||(e[5]=l=>o.reporte.fecha_fin=l),mask:o.maskFecha,"today-btn":""},{default:s(()=>[r("div",He,[O(a(p,{label:"Cerrar",color:"primary",flat:""},null,512),[[j]])])]),_:1},8,["modelValue","mask"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),r("div",Ke,[e[15]||(e[15]=r("label",{class:"q-mb-sm block"},"Umbral Kilometraje ",-1)),a($,{modelValue:o.umbral_km_consumidos,"onUpdate:modelValue":e[7]||(e[7]=l=>o.umbral_km_consumidos=l),type:"number",placeholder:"Opcional",outlined:"",dense:""},null,8,["modelValue"])]),r("div",Ge,[r("div",We,[a(ge,{push:""},{default:s(()=>[a(p,{color:"primary",class:"full-width","no-caps":"","no-wrap":"",push:"",glossy:"",onClick:e[8]||(e[8]=l=>o.buscarReporte("consulta"))},{default:s(()=>[a(c,{name:"bi-search",size:"xs",class:"q-pr-sm"}),e[16]||(e[16]=r("span",null,"Buscar",-1))]),_:1}),a(p,{color:"positive",class:"full-width","no-caps":"","no-wrap":"",push:"",glossy:"",onClick:e[9]||(e[9]=l=>o.buscarReporte("excel"))},{default:s(()=>[a(c,{name:"bi-file-earmark-excel-fill",size:"xs",class:"q-mr-sm"}),e[17]||(e[17]=r("span",null,"Excel",-1))]),_:1}),a(p,{color:"negative",class:"full-width","no-caps":"","no-wrap":"",push:"",glossy:"",onClick:e[10]||(e[10]=l=>o.buscarReporte("pdf"))},{default:s(()=>[a(c,{name:"bi-file-earmark-pdf-fill",size:"xs",class:"q-mr-sm"}),e[18]||(e[18]=r("span",null,"PDF",-1))]),_:1})]),_:1})])])])]),_:1}),e[19]||(e[19]=r("br",null,null,-1)),o.listado?(_(),F(L,{key:0,class:"q-mb-md q-mt-sm rounded no-border custom-shadow"},{default:s(()=>[r("div",Je,[r("div",Xe,[a(h,{titulo:"Bit\xE1coras de veh\xEDculos",configuracionColumnas:o.configuracionColumnas,datos:o.listado,altoFijo:!1,accion1:o.btnImprimir,permitirConsultar:!1,permitirEditar:!1,permitirEliminar:!1,permitirBuscar:!0,"ajustar-celdas":""},null,8,["configuracionColumnas","datos","accion1"])])])]),_:1})):N("",!0)])]),_:1})]),_:1})]),_:1})}var Eo=fe(Ue,[["render",Ye]]);export{Eo as default};
