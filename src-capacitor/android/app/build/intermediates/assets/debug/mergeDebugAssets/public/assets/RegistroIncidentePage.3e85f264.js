var z=Object.defineProperty;var H=(e,o,t)=>o in e?z(e,o,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[o]=t;var l=(e,o,t)=>(H(e,typeof o!="symbol"?o+"":o,t),t);import{Q as c,a as R}from"./QSelect.a8f2bfb2.js";import{Q as h,a as V}from"./QItemSection.c6f2640c.js";import{bz as J,t as K,c as W,U as X,u as Y,e as C,E as Z,s as _,bA as x,v as ee,x as U,y as n,S as oe,H as a,D as i,a7 as se,B as r,z as d,L as ie,O as ae,P as re,G as b,M as p,K as D,F as le,k as te,R as ne,I as q,J as Q,N as de}from"./index.976e8f3c.js";import{Q as pe,a as ue,C as me}from"./QPopupProxy.d8ef7a42.js";import{Q as ce}from"./QForm.ed6f6690.js";import{s as L,n as be}from"./vehiculos.utils.c31e027d.js";import{r as u}from"./i18n-validators.06eef631.js";import{S as ge,s as ve}from"./utils.30e08aa2.js";import{u as fe}from"./index.ed676411.js";import{G as he}from"./GestorArchivos.f1319a4d.js";import{T as Ve}from"./TabLayout.d6dcc414.js";import{C as $e}from"./ContenedorSimpleMixin.5a0b06ab.js";import{E as we}from"./entidadAuditable.75a46700.js";import{V as ye}from"./VehiculoController.fd9db948.js";import{u as ke}from"./filtrosListadosGenerales.31e9eb2c.js";import"./QChip.334d746c.js";import"./QMenu.410ae527.js";import"./position-engine.2f1d750c.js";import"./format.8ac60962.js";import"./index.95f5a0db.js";import"./QUploader.43bbdad9.js";import"./QCircularProgress.4d1a2735.js";import"./QFile.e27868da.js";import"./configuracionColumnasArchivoSubtarea.215f4ffd.js";import"./EssentialTable.d8e6954a.js";import"./QTable.048b8be8.js";import"./use-fullscreen.0ccd26e6.js";import"./QToolbar.cff7174f.js";import"./QBtnGroup.7d0835e4.js";import"./QBadge.1ddeabfd.js";import"./_commonjsHelpers.8402d862.js";import"./QImg.e0fb285c.js";import"./VisorImagen.e7965569.js";import"./seleccionContratacionPersonal.utils.e3e1ed3d.js";import"./ErrorComponent.b482e77d.js";import"./QTabs.3c726b04.js";import"./QResizeObserver.6ec10d95.js";import"./QTabPanels.1c8c4baa.js";import"./touch.9135741d.js";import"./QPage.ed5d79ca.js";import"./buttonSubmits.2eb37d38.js";import"./EssentialTablePagination.f449a738.js";const Ce=[{name:"vehiculo",field:"vehiculo",label:"Veh\xEDculo",align:"left",sortable:!0},{name:"fecha",field:"fecha",label:"Fecha",align:"left",sortable:!0},{name:"tipo",field:"tipo",label:"Tipo",align:"left",sortable:!0},{name:"gravedad",field:"gravedad",label:"Gravedad",align:"left",sortable:!0},{name:"persona_reporta",field:"persona_reporta",label:"Persona Reporta",align:"left",sortable:!0}];class qe extends we{constructor(){super();l(this,"vehiculo");l(this,"fecha");l(this,"descripcion");l(this,"tipo");l(this,"gravedad");l(this,"persona_reporta");l(this,"persona_registra");l(this,"aplica_seguro");this.vehiculo=null,this.fecha=null,this.descripcion=null,this.tipo=null,this.gravedad=null,this.persona_reporta=null,this.persona_registra=null,this.aplica_seguro=!1}}class Qe extends J{constructor(){super(K.registros_incidentes)}}var Ie=W({components:{TabLayout:Ve,GestorArchivos:he},setup(){const e=new $e(qe,new Qe),{entidad:o,disabled:t,listadosAuxiliares:g,accion:I}=e.useReferencias(),{setValidador:P,cargarVista:$,obtenerListados:w}=e.useComportamiento(),{onReestablecer:s,onConsultado:E,onModificado:T,onGuardado:B}=e.useHooks();X();const v=Y();new ge;const y=C(),f=C(),k=C(),{vehiculos:S,filtrarVehiculos:N,empleados:j,filtrarEmpleados:G}=ke(g);$(async()=>{await w({vehiculos:new ye,empleados:{controller:new Z,params:{estado:1}}}),S.value=g.vehiculos,j.value=g.empleados,o.persona_registra=v.user.id,o.persona_reporta=v.user.id});const A=fe({vehiculo:{required:u},fecha:{required:u},tipo:{required:u},gravedad:{required:u},descripcion:{required:u},persona_reporta:{required:u}},o);P(A.value),s(()=>{o.persona_registra=v.user.id,o.persona_reporta=v.user.id,f.value.limpiarListado()}),E(()=>{setTimeout(()=>{f.value.listarArchivosAlmacenados(o.id)},1),y.value=L}),B(m=>{k.value=m,setTimeout(async()=>{await F()},1)}),T(m=>{k.value=m,setTimeout(async()=>{await F()},1)});async function F(){await f.value.subir()}function M(m){y.value=L.filter(O=>O.tipo.indexOf(m)>-1)}return{mixin:e,registro:o,v$:A,accion:I,disabled:t,configuracionColumnas:Ce,maskFecha:_,acciones:x,refArchivo:f,idRegistro:k,vehiculos:S,filtrarVehiculos:N,empleados:j,filtrarEmpleados:G,tiposIncidentes:be,subtipos:y,filtrarSubtipos:M,ordenarLista:ve}}});const Pe={class:"row q-col-gutter-sm q-py-md"},Se={key:0,class:"col-12 col-md-3"},je={class:"col-12 col-md-3"},Ae={class:"col-12 col-md-3"},Fe={class:"row items-center justify-end"},Re={class:"error-msg"},Ue={class:"col-12 col-md-3"},De={class:"col-12 col-md-3"},Le={class:"col-12 col-md-3 q-mb-xl"},Ee={class:"col-12 col-md-3"},Te={class:"error-msg"},Be={class:"col-12 col-md-12"},Ne={class:"error-msg"},Ge={class:"col-12 q-mb-md"};function Me(e,o,t,g,I,P){const $=U("gestor-archivos"),w=U("tab-layout");return n(),oe(w,{mixin:e.mixin,configuracionColumnas:e.configuracionColumnas,"titulo-pagina":"Registro de incidentes"},{formulario:a(()=>[i(ce,{onSubmit:o[10]||(o[10]=se(()=>{},["prevent"]))},{default:a(()=>[r("div",Pe,[e.registro.persona_registra?(n(),d("div",Se,[o[11]||(o[11]=r("label",{class:"q-mb-sm block"},"Persona que registra",-1)),i(c,{modelValue:e.registro.persona_registra,"onUpdate:modelValue":o[0]||(o[0]=s=>e.registro.persona_registra=s),options:e.empleados,"transition-show":"jump-up","transition-hide":"jump-up","options-dense":"",dense:"",outlined:"",disable:"","option-label":s=>s.apellidos+" "+s.nombres,"option-value":s=>s.id,"emit-value":"","map-options":""},null,8,["modelValue","options","option-label","option-value"])])):ie("",!0),r("div",je,[o[13]||(o[13]=r("label",{class:"q-mb-sm block"},"Placa",-1)),i(c,{modelValue:e.registro.vehiculo,"onUpdate:modelValue":o[1]||(o[1]=s=>e.registro.vehiculo=s),options:e.vehiculos,"transition-show":"jump-up","transition-hide":"jump-down",disable:e.disabled,"options-dense":"",dense:"",outlined:"",onFilter:e.filtrarVehiculos,"error-message":"Debes seleccionar un n\xFAmero de placa","use-input":"","input-debounce":"0","option-value":s=>s.id,"option-label":s=>s.placa,"emit-value":"","map-options":""},{option:a(s=>[i(h,ae(re(s.itemProps)),{default:a(()=>[i(V,null,{default:a(()=>[i(R,null,{default:a(()=>[b(p(s.opt.placa),1)]),_:2},1024),i(R,{caption:""},{default:a(()=>[b(p(s.opt.marca)+": "+p(s.opt.modelo),1)]),_:2},1024)]),_:2},1024)]),_:2},1040)]),"no-option":a(()=>[i(h,null,{default:a(()=>[i(V,{class:"text-grey"},{default:a(()=>o[12]||(o[12]=[b(" No hay resultados ")])),_:1})]),_:1})]),_:1},8,["modelValue","options","disable","onFilter","option-value","option-label"])]),r("div",Ae,[o[14]||(o[14]=r("label",{class:"q-mb-sm block"},"Fecha del incidente",-1)),i(D,{modelValue:e.registro.fecha,"onUpdate:modelValue":o[3]||(o[3]=s=>e.registro.fecha=s),placeholder:"Obligatorio",value:e.registro.fecha,error:!!e.v$.fecha.$errors.length,disable:e.disabled,onBlur:e.v$.fecha.$touch,outlined:"",dense:""},{append:a(()=>[i(le,{name:"event",class:"cursor-pointer"},{default:a(()=>[i(pe,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:a(()=>[i(ue,{modelValue:e.registro.fecha,"onUpdate:modelValue":o[2]||(o[2]=s=>e.registro.fecha=s),mask:e.maskFecha,"today-btn":""},{default:a(()=>[r("div",Fe,[te(i(ne,{label:"Cerrar",color:"primary",flat:""},null,512),[[me]])])]),_:1},8,["modelValue","mask"])]),_:1})]),_:1})]),error:a(()=>[(n(!0),d(q,null,Q(e.v$.fecha.$errors,s=>(n(),d("div",{key:s.$uid},[r("div",Re,p(s.$message),1)]))),128))]),_:1},8,["modelValue","value","error","disable","onBlur"])]),r("div",Ue,[o[15]||(o[15]=r("label",{class:"q-mb-sm block"},"Tipo de incidente",-1)),i(c,{modelValue:e.registro.tipo,"onUpdate:modelValue":[o[4]||(o[4]=s=>e.registro.tipo=s),e.filtrarSubtipos],options:e.tiposIncidentes,"transition-show":"jump-up","transition-hide":"jump-down",disable:e.disabled,"options-dense":"",dense:"",outlined:"",clearable:"","error-message":"Debes seleccionar un tipo de incidente","option-value":s=>s.value,"option-label":s=>s.label,"emit-value":"","map-options":""},null,8,["modelValue","options","disable","onUpdate:modelValue","option-value","option-label"])]),r("div",De,[o[17]||(o[17]=r("label",{class:"q-mb-sm block"},"Gravedad",-1)),i(c,{modelValue:e.registro.gravedad,"onUpdate:modelValue":o[5]||(o[5]=s=>e.registro.gravedad=s),options:e.subtipos,"transition-show":"jump-up","transition-hide":"jump-down",disable:e.disabled,"options-dense":"",dense:"",outlined:"","error-message":"Debes seleccionar un elemento","option-value":s=>s.value,"option-label":s=>s.label,"emit-value":"","map-options":""},{"no-option":a(()=>[i(h,null,{default:a(()=>[i(V,{class:"text-grey"},{default:a(()=>o[16]||(o[16]=[b(" Primero selecciona un tipo de incidente ")])),_:1})]),_:1})]),_:1},8,["modelValue","options","disable","option-value","option-label"])]),r("div",Le,[i(de,{class:"q-mt-lg q-pt-md",modelValue:e.registro.aplica_seguro,"onUpdate:modelValue":o[6]||(o[6]=s=>e.registro.aplica_seguro=s),label:"\xBFAplic\xF3 el seguro?",disable:e.disabled,outlined:"",dense:""},null,8,["modelValue","disable"])]),r("div",Ee,[o[19]||(o[19]=r("label",{class:"q-mb-sm block"},"Persona que reporta",-1)),i(c,{modelValue:e.registro.persona_reporta,"onUpdate:modelValue":o[7]||(o[7]=s=>e.registro.persona_reporta=s),options:e.empleados,"transition-show":"jump-up","transition-hide":"jump-up","options-dense":"",dense:"",outlined:"","use-input":"","input-debounce":"0",onFilter:e.filtrarEmpleados,onPopupShow:o[8]||(o[8]=s=>e.ordenarLista(e.empleados,"apellidos")),"error-message":"Debes seleccionar un empleado",error:!!e.v$.persona_reporta.$errors.length,disable:e.disabled,"option-label":s=>s.apellidos+" "+s.nombres,"option-value":s=>s.id,"emit-value":"","map-options":""},{"no-option":a(()=>[i(h,null,{default:a(()=>[i(V,{class:"text-grey"},{default:a(()=>o[18]||(o[18]=[b(" No hay resultados ")])),_:1})]),_:1})]),error:a(()=>[(n(!0),d(q,null,Q(e.v$.persona_reporta.$errors,s=>(n(),d("div",{key:s.$uid},[r("div",Te,p(s.$message),1)]))),128))]),_:1},8,["modelValue","options","onFilter","error","disable","option-label","option-value"])]),r("div",Be,[o[20]||(o[20]=r("label",{class:"q-mb-sm block"},"Descripci\xF3n del incidente",-1)),i(D,{type:"textarea",autogrow:"",modelValue:e.registro.descripcion,"onUpdate:modelValue":o[9]||(o[9]=s=>e.registro.descripcion=s),placeholder:"Obligatorio",disable:e.disabled,error:!!e.v$.descripcion.$errors.length,outlined:"",dense:""},{error:a(()=>[(n(!0),d(q,null,Q(e.v$.descripcion.$errors,s=>(n(),d("div",{key:s.$uid},[r("div",Ne,p(s.$message),1)]))),128))]),_:1},8,["modelValue","disable","error"])]),r("div",Ge,[i($,{ref:"refArchivo",label:"Im\xE1genes o archivos adjuntos",mixin:e.mixin,disable:e.disabled,listarAlGuardar:!1,"permitir-eliminar":e.accion==e.acciones.nuevo||e.accion==e.acciones.editar,idModelo:e.idRegistro},null,8,["mixin","disable","permitir-eliminar","idModelo"])])])]),_:1})]),_:1},8,["mixin","configuracionColumnas"])}var Uo=ee(Ie,[["render",Me]]);export{Uo as default};
