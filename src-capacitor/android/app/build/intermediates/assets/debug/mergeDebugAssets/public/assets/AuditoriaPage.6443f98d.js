var x=Object.defineProperty;var ee=(a,e,u)=>e in a?x(a,e,{enumerable:!0,configurable:!0,writable:!0,value:u}):a[e]=u;var f=(a,e,u)=>(ee(a,typeof e!="symbol"?e+"":e,u),u);import{bz as oe,t as ae,c as se,e as F,E as le,A as te,s as N,bH as ie,v as re,y as i,S as b,H as t,D as l,bg as w,B as s,F as v,G as n,N as de,z as r,K as q,L as A,J as g,I as y,k as L,R as Q,bf as C,M as d,Q as V}from"./index.976e8f3c.js";import{Q as U,a as z}from"./QItemSection.c6f2640c.js";import{Q as M,a as P}from"./QSelect.a8f2bfb2.js";import{Q as D,a as R,C as T}from"./QPopupProxy.d8ef7a42.js";import{Q as H,a as J}from"./QTimeline.3e0f1fbc.js";import{Q as ne}from"./QPage.ed5d79ca.js";import{a as S}from"./i18n-validators.06eef631.js";import{C as ue}from"./ContenedorSimpleMixin.5a0b06ab.js";import{E as me}from"./entidadAuditable.75a46700.js";import{u as pe}from"./filtrosListadosGenerales.31e9eb2c.js";import{u as ce}from"./index.ed676411.js";import{S as fe,v as be}from"./utils.30e08aa2.js";import"./QChip.334d746c.js";import"./QMenu.410ae527.js";import"./position-engine.2f1d750c.js";import"./format.8ac60962.js";import"./index.95f5a0db.js";class ve extends me{constructor(){super();f(this,"empleado");f(this,"fecha_inicio");f(this,"fecha_fin");f(this,"auditable_type");f(this,"auditable_id");this.empleado=null,this.fecha_inicio=null,this.fecha_fin=null,this.auditable_type=null,this.auditable_id=null}}class ge extends oe{constructor(){super(ae.auditorias)}}var ye=se({components:{},setup(){const a=new ue(ve,new ge),{entidad:e,listado:u,listadosAuxiliares:p}=a.useReferencias(),{listar:E,cargarVista:I,obtenerListados:o}=a.useComportamiento(),m=new fe,h=F(!1),$=F([]);I(async()=>{await o({empleados:{controller:new le,params:{campos:"id,nombres,apellidos,cargo_id",estado:1}}}),await G(),e.fecha_fin=be(N)});const O={empleado:{requiredIf:S(h.value)},fecha_inicio:{requiredIf:S(h.value)},fecha_fin:{requiredIf:S(h.value)}},B=ce(O,e);async function j(){if(await B.value.$validate())try{m.activar(),await E(e)}catch(c){console.log(c)}finally{m.desactivar()}}async function G(){m.activar();const c=te.getInstance(),k=ie.URL_BASE+"/api/modelos-auditorias",_=await c.get(k);p.modelosAuditables=_.data.results,$.value=p.modelosAuditables,console.log(_),m.desactivar()}async function K(c,k){if(c===""){k(()=>$.value=p.modelosAuditables);return}k(()=>{const _=c.toLowerCase();$.value=p.modelosAuditables.filter(Z=>Z.toLowerCase().indexOf(_)>-1)})}const{empleados:W,filtrarEmpleados:X,ordenarEmpleados:Y}=pe(p);return{mixin:a,listado:u,v$:B,maskFecha:N,auditoria:e,checkAuditable:h,empleados:W,filtrarEmpleados:X,ordenarEmpleados:Y,modelosAuditables:$,filtrarModelosAuditables:K,consultar:j}}});const he={class:"border-1 text-primary text-bold q-mb-lg"},$e={class:"row q-col-gutter-sm q-mb-md"},ke={class:"col-12 col-md-3"},_e={key:0,class:"col-12 col-md-3"},we={class:"col-12 col-md-3"},Ve={class:"error-msg"},qe={class:"col-12 col-md-3"},Ae={class:"row items-center justify-end"},Qe={class:"error-msg"},Ce={class:"col-12 col-md-3"},Se={class:"row items-center justify-end"},Ee={class:"error-msg"},Ie={class:"col-12 col-md-3"},Be={class:"error-msg"},Fe={class:"col-12 col-md-12 q-mt-md"},Ne={class:"text-center"},Le={class:"row q-col-gutter-sm q-pa-sm"},Ue={class:"col-12 q-px-lg q-py-md"},ze={class:"row q-col-gutter-sm q-pa-sm"},Me={class:"col-12 col-md-12"},Pe={style:{"white-space":"break-spaces"}},De={style:{"white-space":"break-spaces"}},Re={class:"text-center q-my-lg text-negative text-subtitle2"};function Te(a,e,u,p,E,I){return i(),b(ne,{padding:""},{default:t(()=>[l(C,{class:"q-mb-md rounded no-border custom-shadow"},{default:t(()=>[l(w,null,{default:t(()=>[s("div",he,[l(v,{name:"bi-file-text",class:"q-mr-sm"}),e[10]||(e[10]=n(" Logs de Auditorias por Empleado "))]),s("div",$e,[s("div",ke,[l(de,{class:"q-mt-lg q-pt-md",modelValue:a.checkAuditable,"onUpdate:modelValue":[e[0]||(e[0]=o=>a.checkAuditable=o),e[1]||(e[1]=()=>a.auditoria.auditable_id=null)],label:"\xBFAuditable?",outlined:"",dense:""},null,8,["modelValue"])]),a.checkAuditable?(i(),r("div",_e,[e[11]||(e[11]=s("label",{class:"q-mb-sm block"},"Auditable ID ",-1)),l(q,{modelValue:a.auditoria.auditable_id,"onUpdate:modelValue":e[2]||(e[2]=o=>a.auditoria.auditable_id=o),outlined:"",dense:"",type:"number"},null,8,["modelValue"])])):A("",!0),s("div",we,[e[13]||(e[13]=s("label",{class:"q-mb-sm block"},"Seleccione un empleado",-1)),l(M,{modelValue:a.auditoria.empleado,"onUpdate:modelValue":e[3]||(e[3]=o=>a.auditoria.empleado=o),options:a.empleados,"transition-show":"scale","transition-hide":"scale","options-dense":"",error:!!a.v$.empleado.$errors.length,dense:"",outlined:"",clearable:"","use-input":"","input-debounce":"0",onFilter:a.filtrarEmpleados,onBlur:a.v$.empleado.$touch,onPopupShow:a.ordenarEmpleados,"option-label":o=>o.apellidos+" "+o.nombres,"option-value":o=>o.id,"emit-value":"","map-options":""},{"no-option":t(()=>[l(U,null,{default:t(()=>[l(z,{class:"text-grey"},{default:t(()=>e[12]||(e[12]=[n(" No hay resultados ")])),_:1})]),_:1})]),error:t(()=>[(i(!0),r(y,null,g(a.v$.empleado.$errors,o=>(i(),r("div",{key:o.$uid},[s("div",Ve,d(o.$message),1)]))),128))]),_:1},8,["modelValue","options","error","onFilter","onBlur","onPopupShow","option-label","option-value"])]),s("div",qe,[e[14]||(e[14]=s("label",{class:"q-mb-sm block"},"Fecha de inicio",-1)),l(q,{modelValue:a.auditoria.fecha_inicio,"onUpdate:modelValue":e[5]||(e[5]=o=>a.auditoria.fecha_inicio=o),error:!!a.v$.fecha_inicio.$errors.length,onBlur:a.v$.fecha_inicio.$touch,outlined:"",dense:""},{append:t(()=>[l(v,{name:"event",class:"cursor-pointer"},{default:t(()=>[l(D,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:t(()=>[l(R,{modelValue:a.auditoria.fecha_inicio,"onUpdate:modelValue":e[4]||(e[4]=o=>a.auditoria.fecha_inicio=o),mask:a.maskFecha,"today-btn":""},{default:t(()=>[s("div",Ae,[L(l(Q,{label:"Cerrar",color:"primary",flat:""},null,512),[[T]])])]),_:1},8,["modelValue","mask"])]),_:1})]),_:1})]),error:t(()=>[(i(!0),r(y,null,g(a.v$.fecha_inicio.$errors,o=>(i(),r("div",{key:o.$uid},[s("div",Qe,d(o.$message),1)]))),128))]),_:1},8,["modelValue","error","onBlur"])]),s("div",Ce,[e[15]||(e[15]=s("label",{class:"q-mb-sm block"},"Fecha fin ",-1)),l(q,{modelValue:a.auditoria.fecha_fin,"onUpdate:modelValue":e[7]||(e[7]=o=>a.auditoria.fecha_fin=o),error:!!a.v$.fecha_fin.$errors.length,onBlur:a.v$.fecha_fin.$touch,outlined:"",dense:""},{append:t(()=>[l(v,{name:"event",class:"cursor-pointer"},{default:t(()=>[l(D,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:t(()=>[l(R,{modelValue:a.auditoria.fecha_fin,"onUpdate:modelValue":e[6]||(e[6]=o=>a.auditoria.fecha_fin=o),mask:a.maskFecha,"today-btn":""},{default:t(()=>[s("div",Se,[L(l(Q,{label:"Cerrar",color:"primary",flat:""},null,512),[[T]])])]),_:1},8,["modelValue","mask"])]),_:1})]),_:1})]),error:t(()=>[(i(!0),r(y,null,g(a.v$.fecha_fin.$errors,o=>(i(),r("div",{key:o.$uid},[s("div",Ee,d(o.$message),1)]))),128))]),_:1},8,["modelValue","error","onBlur"])]),s("div",Ie,[e[17]||(e[17]=s("label",{class:"q-mb-sm block"},"Modelo",-1)),l(M,{modelValue:a.auditoria.auditable_type,"onUpdate:modelValue":e[8]||(e[8]=o=>a.auditoria.auditable_type=o),options:a.modelosAuditables,"transition-show":"scale","transition-hide":"scale","options-dense":"",dense:"",outlined:"",clearable:"","use-input":"","input-debounce":"0",onFilter:a.filtrarModelosAuditables,"option-label":o=>o,"option-value":o=>o},{"no-option":t(()=>[l(U,null,{default:t(()=>[l(z,{class:"text-grey"},{default:t(()=>e[16]||(e[16]=[n(" No hay resultados ")])),_:1})]),_:1})]),error:t(()=>[(i(!0),r(y,null,g(a.v$.empleado.$errors,o=>(i(),r("div",{key:o.$uid},[s("div",Be,d(o.$message),1)]))),128))]),_:1},8,["modelValue","options","onFilter","option-label","option-value"])]),s("div",Fe,[s("div",Ne,[l(Q,{color:"primary",class:"full-width","no-caps":"","no-wrap":"",push:"",onClick:e[9]||(e[9]=o=>a.consultar())},{default:t(()=>[l(v,{name:"bi-search",size:"xs",class:"q-pr-sm"}),e[18]||(e[18]=s("span",null,"Consultar",-1))]),_:1})])])])]),_:1})]),_:1}),l(C,{class:"q-mb-md rounded no-border custom-shadow"},{default:t(()=>[s("div",Le,[s("div",Ue,[a.listado.length>0?(i(),b(H,{key:0,color:"primary"},{default:t(()=>[l(J,{title:"Registros de cambios realizados"}),(i(!0),r(y,null,g(a.listado,(o,m)=>(i(),b(J,{key:o.id,title:`Evento: ${o.event}`,color:`${o.event=="created"?"green":o.event=="updated"?"orange":o.event=="deleted"?"red":"gray"}`,subtitle:`[${o.updated_at}], ${o.user_name} [${o.ip_address}] ${o.event=="created"?"ha creado un registro":o.event=="updated"?"ha actualizado un registro":o.event=="deleted"?"ha eliminado un registro":o.event=="sync"?"ha sincronizado un registro":"ha restaurado un registro"}`},{default:t(()=>[s("p",null,[e[19]||(e[19]=n(" Modelo afectado: ")),s("strong",null,d(o.auditable_type),1),e[20]||(e[20]=n()),e[21]||(e[21]=s("br",null,null,-1)),n(" Url: "+d(o.url),1)]),s("p",null,[n(" Id de registro: "+d(o.auditable_id)+" ",1),e[22]||(e[22]=s("br",null,null,-1)),n("Ingreso desde: "+d(o.user_agent),1)]),s("div",ze,[s("div",Me,[l(C,{class:"my-card",bordered:""},{default:t(()=>[l(w,{horizontal:""},{default:t(()=>[o.event!=="created"?(i(),b(w,{key:0,class:"col-6 col-md-6"},{default:t(()=>[l(P,null,{default:t(()=>e[23]||(e[23]=[s("strong",null,"Antiguos valores",-1)])),_:1}),l(V),s("pre",Pe,d(JSON.stringify(o.old_values,null,2)),1)]),_:2},1024)):A("",!0),l(V,{vertical:""}),l(w,{class:"col-6 col-md-6"},{default:t(()=>[l(P,null,{default:t(()=>e[24]||(e[24]=[s("strong",null,"Nuevos valores",-1)])),_:1}),l(V),s("pre",De,d(JSON.stringify(o.new_values,null,2)),1)]),_:2},1024)]),_:2},1024)]),_:2},1024)])]),m<a.listado.length-1&&o.updated_at!==a.listado[m+1].updated_at?(i(),b(V,{key:0,color:"grey-5",size:"4px",spaced:"10px"})):A("",!0)]),_:2},1032,["title","color","subtitle"]))),128))]),_:1})):(i(),b(H,{key:1},{default:t(()=>[s("div",Re,[l(v,{name:"bi-exclamation-triangle-fill",class:"q-mr-sm"}),e[25]||(e[25]=n(" No se encontraron registros para el empleado y rango de fechas seleccionado "))])]),_:1}))])])]),_:1})]),_:1})}var ro=re(ye,[["render",Te]]);export{ro as default};
