import{bz as _,t as x,c as oo,e as C,be as eo,p as N,u as ao,a1 as io,g,bA as z,d1 as w,ct as so,w as lo,bZ as I,s as ro,d7 as to,v as no,x as B,y as u,S as uo,H as r,D as i,a7 as mo,B as l,z as p,K as d,L as c,F as po,k as co,R as bo,N as vo,G as fo,M as Po}from"./index.976e8f3c.js";import{Q as Vo,a as go,C as $o}from"./QPopupProxy.d8ef7a42.js";import{Q}from"./QSelect.a8f2bfb2.js";import{Q as So}from"./QForm.ed6f6690.js";import{r as O,d as F,a as $}from"./i18n-validators.06eef631.js";import{u as Co}from"./index.ed676411.js";import{N as zo}from"./NoOptionComponent.ffe820c8.js";import{S as yo}from"./EssentialTable.d8e6954a.js";import{E as ko}from"./ErrorComponent.b482e77d.js";import{C as qo}from"./ContenedorSimpleMixin.5a0b06ab.js";import{S as Ao,u as wo}from"./recursosHumanos.46548bde.js";import{T as Bo}from"./TabLayoutFilterTabs2.f1a01a4e.js";import{P as Oo}from"./PeriodoController.8e5f401e.js";import{u as Do}from"./filtrosListadosGenerales.31e9eb2c.js";import{u as Eo}from"./utils.30e08aa2.js";import"./format.8ac60962.js";import"./QMenu.410ae527.js";import"./position-engine.2f1d750c.js";import"./QChip.334d746c.js";import"./QItemSection.c6f2640c.js";import"./index.95f5a0db.js";import"./QFile.e27868da.js";import"./QTable.048b8be8.js";import"./use-fullscreen.0ccd26e6.js";import"./QToolbar.cff7174f.js";import"./QBtnGroup.7d0835e4.js";import"./QBadge.1ddeabfd.js";import"./_commonjsHelpers.8402d862.js";import"./QImg.e0fb285c.js";import"./VisorImagen.e7965569.js";import"./seleccionContratacionPersonal.utils.e3e1ed3d.js";import"./entidadAuditable.75a46700.js";import"./QTabs.3c726b04.js";import"./QResizeObserver.6ec10d95.js";import"./QTabPanels.1c8c4baa.js";import"./touch.9135741d.js";import"./QPage.ed5d79ca.js";import"./EssentialTableTabs.c7e98bba.js";import"./EssentialTablePagination.f449a738.js";import"./buttonSubmits.2eb37d38.js";class ho extends _{constructor(){super(x.solicitud_prestamo_empresarial)}}const Uo=[{name:"fecha",field:"fecha",label:"Fecha",align:"left",sortable:!0},{name:"solicitante_info",field:"solicitante_info",label:"Solicitante",align:"left",sortable:!0},{name:"monto",field:"monto",label:"Monto",align:"left",sortable:!0},{name:"plazo",field:"plazo",label:"Plazo",align:"left",sortable:!0},{name:"observacion",field:"observacion",label:"Observaci\xF3n",align:"left",sortable:!0},{name:"estado_info",field:"estado_info",label:"Estado",align:"left",sortable:!0},{name:"gestionada",field:"gestionada",label:"Gestionada",align:"left",sortable:!0}];var No=oo({components:{ErrorComponent:ko,NoOptionComponent:zo,TabLayoutFilterTabs2:Bo,SelectorImagen:yo},setup(){const o=new qo(Ao,new ho),{entidad:e,disabled:y,accion:b,listadosAuxiliares:m}=o.useReferencias(),{setValidador:D,cargarVista:t,obtenerListados:S,listar:k}=o.useComportamiento(),{onConsultado:a}=o.useHooks(),L=C(!0);eo().setQuasar(N()),Eo().setQuasar(N());const n=wo(),v=ao(),P=C(),j=io(),H=g(()=>{let s=!1;return f.value&&(s=V.value==="1"),q.value&&(s=V.value==="4"),s}),M=g(()=>b.value===z.editar?e.estado===w.CANCELADO||v.user.id!==e.solicitante:y.value),E=C(0),T=[s=>s<=parseInt(n.sueldo_basico)*2||"Solo se permite prestamo menor o igual a 2 SBU ($ "+parseInt(n.sueldo_basico)*2+")"],V=C("1"),f=g(()=>v.can("puede.ver.campo.validado")),q=g(()=>v.can("puede.autorizar.solicitud_prestamo_empresarial")),{periodos:h,filtrarPeriodos:G}=Do(m);t(async()=>{var s;await n.obtenerSueldoBasico(),await n.nivelEndeudamiento((s=e.solicitante)!=null?s:v.user.id),await S({periodos:{controller:new Oo,params:{campos:"id,nombre",activo:1}},autorizaciones:{controller:new so,params:{campos:"id,nombre",es_validado:!1,es_modulo_rhh:!0}}}),P.value=m.autorizaciones,h.value=m.periodos,E.value=parseInt(n.sueldo_basico)*2}),a(async()=>{var s;L.value=!1,await n.nivelEndeudamiento((s=e.solicitante)!=null?s:v.user.id)});const R=g(()=>({fecha:{required:O},monto:{required:O,maxValue:F(E)},motivo:{required:O},estado:{required:$(()=>f.value)},observacion:{required:$(()=>f.value)},periodo:{requiredIf:$(()=>e.cargo_utilidad)},valor_utilidad:{required:$(()=>e.cargo_utilidad)},plazo:{maxValue:F(12),required:$(()=>f.value&&e.estado!==w.CANCELADO)}})),U=Co(R,e);D(U.value),lo(b,()=>{P.value=m.autorizaciones,b.value===z.editar&&f&&(P.value=m.autorizaciones.filter(s=>s.nombre!==I.aprobado)),b.value===z.editar&&q.value&&(P.value=m.autorizaciones.filter(s=>s.nombre!==I.pendiente))});function K(s){const A=new Date,Z=A.getFullYear(),J=String(A.getMonth()+1).padStart(2,"0"),W=String(A.getDate()).padStart(2,"0"),X=`${Z}/${J}/${W}`;return s>=X}async function Y(s){await k({estado:s}),V.value=s}return{mixin:o,solicitudPrestamo:e,periodos:h,filtrarPeriodos:G,esValidador:f,esAutorizador:q,optionsSolicitudPrestamo:K,filtrarSolicitudPrestamo:Y,maximoValorsolicitudPrestamo:T,autorizaciones:P,autorizacionesId:w,maskFecha:ro,v$:U,disabled:y,recursosHumanosStore:n,tabOptionsSolicitudPrestamo:to,accion:b,configuracionColumnas:Uo,tabSolicitudPrestamo:V,ver_boton_editar:H,acciones:z,restringirMotivo:M,btnGestionar:{titulo:"Gestionar",color:"primary",icono:"bi-pencil-square",accion:({entidad:s})=>{n.solicitudPrestamo=s,console.log("Solicitud de pr\xE9stamo a gestionar es: ",n.solicitudPrestamo),j.push("prestamo-empresarial")},visible:({entidad:s})=>!s.gestionada&&V.value==2&&v.can("puede.gestionar.solicitud_prestamo_empresarial")}}}});const Io={class:"row q-col-gutter-sm q-mb-md q-mt-md q-mx-md q-py-sm"},Qo={key:0,class:"col-12 col-md-3"},Fo={class:"col-12 col-md-3"},Lo={class:"row items-center justify-end"},jo={class:"col-12 col-md-3"},Ho={key:1,class:"col-12 col-md-3"},Mo={class:"col-12 col-md-3"},To={key:2,class:"col-12 col-md-3"},Go={class:"col-12 col-md-3"},Ro={key:3,class:"col-12 col-md-3"},Ko={key:4,class:"col-12 col-md-3"},Yo={key:5,class:"col-12 col-md-3"},Zo={class:"col-12 col-md-3"},Jo={class:"col-12 col-md-3"},Wo={class:"col-12 col-md-3"},Xo={key:0,class:"q-mb-sm text-red text-h6 block"};function _o(o,e,y,b,m,D){const t=B("error-component"),S=B("no-option-component"),k=B("tab-layout-filter-tabs2");return u(),uo(k,{mixin:o.mixin,configuracionColumnas:o.configuracionColumnas,tabOptions:o.tabOptionsSolicitudPrestamo,permitirEditar:(o.esValidador||o.esAutorizador)&&o.ver_boton_editar,permitirEliminar:!1,filtrar:o.filtrarSolicitudPrestamo,tabDefecto:o.tabSolicitudPrestamo,accion1:o.btnGestionar,"ajustar-celdas":""},{formulario:r(()=>[i(So,{onSubmit:e[13]||(e[13]=mo(()=>{},["prevent"]))},{default:r(()=>[l("div",Io,[[o.acciones.consultar,o.acciones.editar].includes(o.accion)?(u(),p("div",Qo,[e[14]||(e[14]=l("label",{class:"q-mb-sm block"},"Solicitante",-1)),i(d,{modelValue:o.solicitudPrestamo.solicitante_info,"onUpdate:modelValue":e[0]||(e[0]=a=>o.solicitudPrestamo.solicitante_info=a),placeholder:"Obligatorio",disable:"",outlined:"",dense:""},null,8,["modelValue"])])):c("",!0),l("div",Fo,[e[15]||(e[15]=l("label",{class:"q-mb-sm block"},"Fecha",-1)),i(d,{modelValue:o.solicitudPrestamo.fecha,"onUpdate:modelValue":e[2]||(e[2]=a=>o.solicitudPrestamo.fecha=a),placeholder:"Obligatorio",error:!!o.v$.fecha.$errors.length,disable:!(o.accion.value!==o.acciones.nuevo&&o.solicitudPrestamo.estado!==o.autorizacionesId.CANCELADO)||o.disabled,onBlur:o.v$.fecha.$touch,outlined:"",dense:""},{append:r(()=>[i(po,{name:"event",class:"cursor-pointer"},{default:r(()=>[i(Vo,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:r(()=>[i(go,{modelValue:o.solicitudPrestamo.fecha,"onUpdate:modelValue":e[1]||(e[1]=a=>o.solicitudPrestamo.fecha=a),mask:o.maskFecha,options:o.optionsSolicitudPrestamo,"today-btn":""},{default:r(()=>[l("div",Lo,[co(i(bo,{label:"Cerrar",color:"primary",flat:""},null,512),[[$o]])])]),_:1},8,["modelValue","mask","options"])]),_:1})]),_:1})]),error:r(()=>[i(t,{clave:"fecha",v$:o.v$},null,8,["v$"])]),_:1},8,["modelValue","error","disable","onBlur"])]),l("div",jo,[e[16]||(e[16]=l("label",{class:"q-mb-sm block"},"Valor ",-1)),i(d,{modelValue:o.solicitudPrestamo.monto,"onUpdate:modelValue":e[3]||(e[3]=a=>o.solicitudPrestamo.monto=a),placeholder:"Obligatorio",type:"number",disable:!(o.accion.value!==o.acciones.nuevo&&o.solicitudPrestamo.estado!==o.autorizacionesId.CANCELADO)||o.disabled,error:!!o.v$.monto.$errors.length,"lazy-rules":"",rules:o.maximoValorsolicitudPrestamo,onBlur:o.v$.monto.$touch,outlined:"",dense:""},{error:r(()=>[i(t,{clave:"monto",v$:o.v$},null,8,["v$"])]),_:1},8,["modelValue","disable","error","rules","onBlur"])]),o.esValidador||o.esAutorizador?(u(),p("div",Ho,[e[17]||(e[17]=l("label",{class:"q-mb-sm block"},"Plazo (Meses) ",-1)),i(d,{modelValue:o.solicitudPrestamo.plazo,"onUpdate:modelValue":e[4]||(e[4]=a=>o.solicitudPrestamo.plazo=a),type:"number",disable:!(o.accion.value!==o.acciones.nuevo&&o.solicitudPrestamo.estado!==o.autorizacionesId.CANCELADO)||o.disabled,error:!!o.v$.plazo.$errors.length,placeholder:"Obligatorio",onBlur:o.v$.plazo.$touch,outlined:"",dense:""},{error:r(()=>[i(t,{clave:"plazo",v$:o.v$},null,8,["v$"])]),_:1},8,["modelValue","disable","error","onBlur"])])):c("",!0),l("div",Mo,[e[18]||(e[18]=l("label",{class:"q-mb-sm block"},"Motivo ",-1)),i(d,{modelValue:o.solicitudPrestamo.motivo,"onUpdate:modelValue":e[5]||(e[5]=a=>o.solicitudPrestamo.motivo=a),placeholder:"Obligatorio",disable:o.restringirMotivo,type:"textarea",error:!!o.v$.motivo.$errors.length,onBlur:o.v$.motivo.$touch,autogrow:"",outlined:"",dense:""},{error:r(()=>[i(t,{clave:"motivo",v$:o.v$},null,8,["v$"])]),_:1},8,["modelValue","disable","error","onBlur"])]),o.esValidador||o.esAutorizador?(u(),p("div",To,[e[19]||(e[19]=l("label",{class:"q-mb-sm block"},"Observacion ",-1)),i(d,{modelValue:o.solicitudPrestamo.observacion,"onUpdate:modelValue":e[6]||(e[6]=a=>o.solicitudPrestamo.observacion=a),placeholder:"Obligatorio",disable:!o.esValidador||o.disabled,type:"textarea",error:!!o.v$.observacion.$errors.length,onBlur:o.v$.observacion.$touch,autogrow:"",outlined:"",dense:""},{error:r(()=>[i(t,{clave:"observacion",v$:o.v$},null,8,["v$"])]),_:1},8,["modelValue","disable","error","onBlur"])])):c("",!0),l("div",Go,[i(vo,{class:"q-mt-lg q-pt-md",modelValue:o.solicitudPrestamo.cargo_utilidad,"onUpdate:modelValue":e[7]||(e[7]=a=>o.solicitudPrestamo.cargo_utilidad=a),label:"Cargo a Utilidades",disable:!(o.accion.value!==o.acciones.nuevo&&o.solicitudPrestamo.estado!==o.autorizacionesId.CANCELADO)||o.disabled,outlined:"",dense:""},null,8,["modelValue","disable"])]),o.solicitudPrestamo.cargo_utilidad?(u(),p("div",Ro,[e[20]||(e[20]=l("label",{class:"q-mb-sm block"},"Periodo",-1)),i(Q,{modelValue:o.solicitudPrestamo.periodo,"onUpdate:modelValue":e[8]||(e[8]=a=>o.solicitudPrestamo.periodo=a),options:o.periodos,"transition-show":"jump-up","transition-hide":"jump-down","options-dense":"",dense:"",outlined:"",disable:!(o.accion.value!==o.acciones.nuevo&&o.solicitudPrestamo.estado!==o.autorizacionesId.CANCELADO)||o.disabled,readonly:o.disabled,"use-input":"","input-debounce":"0",onFilter:o.filtrarPeriodos,error:!!o.v$.periodo.$errors.length,onBlur:o.v$.periodo.$touch,"option-value":a=>a.id,"option-label":a=>a.nombre,"emit-value":"","map-options":""},{"no-option":r(()=>[i(S)]),error:r(()=>[i(t,{clave:"periodo",v$:o.v$},null,8,["v$"])]),_:1},8,["modelValue","options","disable","readonly","onFilter","error","onBlur","option-value","option-label"])])):c("",!0),o.solicitudPrestamo.periodo!=null?(u(),p("div",Ko,[e[21]||(e[21]=l("label",{class:"q-mb-sm block"},"Valor Utilidades ",-1)),i(d,{modelValue:o.solicitudPrestamo.valor_utilidad,"onUpdate:modelValue":e[9]||(e[9]=a=>o.solicitudPrestamo.valor_utilidad=a),placeholder:"Obligatorio",type:"number",disable:!(o.accion.value!==o.acciones.nuevo&&o.solicitudPrestamo.estado!==o.autorizacionesId.CANCELADO)||o.disabled,error:!!o.v$.valor_utilidad.$errors.length,onBlur:o.v$.valor_utilidad.$touch,outlined:"",dense:""},{error:r(()=>[i(t,{clave:"valor_utilidad",v$:o.v$},null,8,["v$"])]),_:1},8,["modelValue","disable","error","onBlur"])])):c("",!0),o.accion==o.acciones.editar&&(o.esValidador||o.esAutorizador)?(u(),p("div",Yo,[e[22]||(e[22]=l("label",{class:"q-mb-sm block"},"Autorizacion",-1)),i(Q,{modelValue:o.solicitudPrestamo.estado,"onUpdate:modelValue":e[10]||(e[10]=a=>o.solicitudPrestamo.estado=a),options:o.autorizaciones,"transition-show":"jump-up","transition-hide":"jump-down","options-dense":"",dense:"",outlined:"",disable:o.disabled,readonly:o.disabled,"use-input":"","input-debounce":"0","option-value":a=>a.id,"option-label":a=>a.nombre,"emit-value":"","map-options":""},{"no-option":r(()=>[i(S)]),_:1},8,["modelValue","options","disable","readonly","option-value","option-label"])])):c("",!0),l("div",Zo,[e[23]||(e[23]=l("label",{class:"q-mb-sm block"},"Total de Descuentos ",-1)),i(d,{modelValue:o.recursosHumanosStore.total_descuento,"onUpdate:modelValue":e[11]||(e[11]=a=>o.recursosHumanosStore.total_descuento=a),type:"number",disable:"",outlined:"",dense:""},null,8,["modelValue"])]),l("div",Jo,[e[25]||(e[25]=l("label",{class:"q-mb-sm block"},"Porcentaje de Descuentos ",-1)),i(d,{modelValue:o.recursosHumanosStore.porcentaje_endeudamiento,"onUpdate:modelValue":e[12]||(e[12]=a=>o.recursosHumanosStore.porcentaje_endeudamiento=a),disable:"",outlined:"",dense:""},{after:r(()=>e[24]||(e[24]=[fo(" % ")])),_:1},8,["modelValue"])]),l("div",Wo,[o.recursosHumanosStore.mensaje?(u(),p("label",Xo,Po(o.recursosHumanosStore.mensaje),1)):c("",!0)])])]),_:1})]),_:1},8,["mixin","configuracionColumnas","tabOptions","permitirEditar","filtrar","tabDefecto","accion1"])}var je=no(No,[["render",_o]]);export{je as default};
