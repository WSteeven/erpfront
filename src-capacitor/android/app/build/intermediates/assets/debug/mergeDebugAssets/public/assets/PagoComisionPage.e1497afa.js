var oo=Object.defineProperty;var ao=(o,a,n)=>a in o?oo(o,a,{enumerable:!0,configurable:!0,writable:!0,value:n}):o[a]=n;var f=(o,a,n)=>(ao(o,typeof a!="symbol"?a+"":a,n),n);import{bz as eo,t as _,m as io,f as so,e as y,U as H,A as P,bH as S,c as no,be as to,p as M,g as F,bA as ro,q as lo,s as co,v as mo,x as U,y as l,S as uo,H as b,D as c,B as u,z as d,R as D,k as q,L as g,K as E,I as Q,J as j,a7 as po,M as L}from"./index.976e8f3c.js";import{Q as fo,a as bo,C as O}from"./QPopupProxy.d8ef7a42.js";import{Q as go}from"./QForm.ed6f6690.js";import{r as G}from"./i18n-validators.06eef631.js";import{u as vo}from"./index.ed676411.js";import{T as ho}from"./TabLayoutFilterTabs2.f1a01a4e.js";import{S as Co,E as Eo}from"./EssentialTable.d8e6954a.js";import{E as yo}from"./EssentialTableTabs.c7e98bba.js";import{M as ko}from"./ModalEntidad.84100166.js";import{C as Vo}from"./ContenedorSimpleMixin.5a0b06ab.js";import{S as wo,A as Po,u as So}from"./utils.30e08aa2.js";import{E as _o}from"./entidadAuditable.75a46700.js";import{b as $o}from"./ventas.utils.b757673b.js";import"./format.8ac60962.js";import"./QMenu.410ae527.js";import"./position-engine.2f1d750c.js";import"./index.95f5a0db.js";import"./QTabs.3c726b04.js";import"./QResizeObserver.6ec10d95.js";import"./QSelect.a8f2bfb2.js";import"./QChip.334d746c.js";import"./QItemSection.c6f2640c.js";import"./QTabPanels.1c8c4baa.js";import"./touch.9135741d.js";import"./QPage.ed5d79ca.js";import"./buttonSubmits.2eb37d38.js";import"./QFile.e27868da.js";import"./QTable.048b8be8.js";import"./use-fullscreen.0ccd26e6.js";import"./QToolbar.cff7174f.js";import"./QBtnGroup.7d0835e4.js";import"./QBadge.1ddeabfd.js";import"./_commonjsHelpers.8402d862.js";import"./QImg.e0fb285c.js";import"./VisorImagen.e7965569.js";import"./seleccionContratacionPersonal.utils.e3e1ed3d.js";import"./ErrorComponent.b482e77d.js";import"./EssentialTablePagination.f449a738.js";import"./configuracion_general.ef04b031.js";import"./ConfiguracionController.65de3fc5.js";const Bo=[{name:"nombre",field:"nombre",label:"Corte",align:"left",sortable:!1},{name:"fecha_inicio",field:"fecha_inicio",label:"Fecha de Inicio",align:"left",sortable:!0},{name:"fecha_fin",field:"fecha_fin",label:"Fecha de Inicio",align:"left",sortable:!0},{name:"estado",field:"estado",label:"Estado",align:"left",sortable:!0}],Fo=[{name:"vendedor_info",field:"vendedor_info",label:"Vendedor",align:"left",sortable:!1},{name:"tipo_vendedor",field:"tipo_vendedor",label:"Modalidad",align:"left",sortable:!0},{name:"fecha_inicio",field:"fecha_inicio",label:"Fecha de Inicio",align:"left",sortable:!0},{name:"fecha_fin",field:"fecha_fin",label:"Fecha de Inicio",align:"left",sortable:!0},{name:"ventas",field:"ventas",label:"Ventas",align:"left",sortable:!0},{name:"chargeback",field:"chargeback",label:"Chargeback",align:"left",sortable:!0},{name:"valor",field:"valor",label:"Valor Comisi\xF3n",align:"left",sortable:!0},{name:"pagado",field:"pagado",label:"Pagado",align:"left",sortable:!0}];class A extends _o{constructor(){super();f(this,"id");f(this,"nombre");f(this,"fecha_inicio");f(this,"fecha_fin");f(this,"estado");f(this,"causa_anulacion");f(this,"listadoEmpleados");this.id=null,this.nombre=null,this.fecha_inicio=null,this.fecha_fin=null,this.estado=null,this.causa_anulacion=null,this.listadoEmpleados=[]}}class Do extends eo{constructor(){super(_.cortes_pagos_comisiones)}}const Ao=io("cortes-comisiones",()=>{const o=so(new A),a=new A,n=y(),{notificarCorrecto:k,notificarAdvertencia:V,notificarError:v}=H(),r=new wo;async function C(){try{r.activar();const s=P.getInstance(),t=S.URL_BASE+"/api/ventas-claro/obtener-fechas-disponibles-cortes";return(await s.get(t)).data.results}catch(s){v(s)}finally{r.desactivar()}}async function e(){r.activar();const s=P.getInstance(),t=S.URL_BASE+"/"+s.getEndpoint(_.cortes_pagos_comisiones)+"/imprimir-excel/"+n.value;await Po(t,"GET","blob","xlsx",o.nombre+"_"+Date.now()),r.desactivar()}async function $(s){try{r.activar();const t=P.getInstance(),p=S.URL_BASE+"/"+t.getEndpoint(_.cortes_pagos_comisiones)+"/anular/"+n.value;return await t.post(p,s)}catch(t){v(t)}finally{r.desactivar()}}async function B(){try{r.activar();const s=P.getInstance(),t=S.URL_BASE+"/"+s.getEndpoint(_.cortes_pagos_comisiones)+"/marcar-completada/"+n.value,p=await s.get(t);p.status===200?k(p.data.mensaje):V(p.data.mensaje)}catch(s){v("Error al marcar como completado el corte de pago de comisiones "+s)}finally{r.desactivar()}}return{corte:o,idCorte:n,corteReset:a,obtenerFechasDisponiblesCortes:C,marcarCompletada:B,imprimirExcel:e,anularCorte:$}});var Io=no({components:{TabLayoutFilterTabs2:ho,ModalesEntidad:ko,SelectorImagen:Co,EssentialTable:Eo,EssentialTableTabs:yo},setup(){const o=new Vo(A,new Do),{entidad:a,accion:n,disabled:k,listado:V}=o.useReferencias(),{setValidador:v,cargarVista:r,listar:C}=o.useComportamiento(),{onGuardado:e,onReestablecer:$}=o.useHooks(),{notificarCorrecto:B,notificarError:s,confirmar:t,prompt:p}=H();to().setQuasar(M()),So().setQuasar(M());const m=Ao(),I=y("PENDIENTE"),h=y();y();const w=y(),z=F(()=>h.value.from),K=F(()=>h.value.to),J=F(()=>"Pago de comisiones desde "+h.value.from+" al "+h.value.to);r(async()=>{const i=Object.values(await m.obtenerFechasDisponiblesCortes());w.value=i});const T=vo({fecha_inicio:{required:G},fecha_fin:{required:G}},a);v(T.value),e(()=>{console.log("guardado")}),$(async()=>{const i=Object.values(await m.obtenerFechasDisponiblesCortes());w.value=i});function N(i){I.value=i,C({estado:i})}function W(i){return w.value.includes(i)}function X(){h.value=w.value[0]}function Y(){a.nombre=J.value,a.fecha_inicio=z.value,a.fecha_fin=K.value}return{mixin:o,v$:T,pago:a,accion:n,acciones:ro,accionesTabla:lo,disabled:k,fecha:h,maskFecha:co,configuracionColumnas:Bo,configuracionColumnasPagoComisionEmpleado:Fo,tabDefecto:I,tabOptionsPagosComisiones:$o,btnAnular:{titulo:"Anular",color:"negative",icono:"bi-x",accion:async({entidad:i,posicion:R})=>{t("\xBFEst\xE1 seguro de anular el corte?",()=>{p({titulo:"Causa de anulaci\xF3n",mensaje:"Ingresa el motivo de anulaci\xF3n",accion:async Z=>{try{m.idCorte=i.id,(await m.anularCorte({causa_anulacion:Z})).status==200&&(B("Se ha anulado correctamente el corte de pagos"),V.value.splice(R,1))}catch{s("No se pudo anular, debes ingresar un motivo para la anulaci\xF3n")}}})})},visible:({entidad:i})=>i.estado=="PENDIENTE"},btnMarcarPagado:{titulo:"Completada",color:"primary",icono:"bi-check-circle-fill",accion:async({entidad:i})=>{t("\xBFEst\xE1 seguro de marcar como completado el corte de pago de comisiones?",async()=>{m.idCorte=i.id,await m.marcarCompletada(),await N("COMPLETA")})},visible:({entidad:i})=>i.estado=="PENDIENTE"},btnGenerarReporteExcel:{titulo:"Generar Reporte",color:"positive",icono:"bi-file-earmark-excel-fill",accion:async({entidad:i,posicion:R})=>{m.corte.nombre=i.nombre,m.idCorte=i.id,await m.imprimirExcel()}},options:W,updateProxy:X,save:Y,filtrarCortesComisiones:N}}});const To={class:"row q-col-gutter-sm"},No={key:0,class:"col-12 col-md-4"},Ro={class:"row items-center justify-end q-gutter-sm"},Mo={key:1,class:"col-12 col-md-4"},Uo={key:2,class:"col-12 col-md-4"},qo={class:"error-msg"},Qo={key:3,class:"col-12 col-md-4"},jo={class:"error-msg"},Lo={key:4,class:"col-12 col-md-4"},Oo={key:5,class:"col-12 col-md-4"},Go={key:6,class:"col-12 col-md-12"};function Ho(o,a,n,k,V,v){const r=U("essential-table"),C=U("tab-layout-filter-tabs2");return l(),uo(C,{mixin:o.mixin,configuracionColumnas:o.configuracionColumnas,ajustarCeldas:"","tab-options":o.tabOptionsPagosComisiones,tabDefecto:o.tabDefecto,permitirEditar:!1,filtrar:o.filtrarCortesComisiones,accion1:o.btnAnular,accion2:o.btnGenerarReporteExcel,accion3:o.btnMarcarPagado},{formulario:b(()=>[c(go,{onSubmit:a[6]||(a[6]=po(()=>{},["prevent"]))},{default:b(()=>[u("div",To,[o.accion==o.acciones.nuevo?(l(),d("div",No,[a[7]||(a[7]=u("label",{class:"q-mb-sm block"},"Selecciona un rango de fechas",-1)),c(D,{icon:"event",round:"",color:"primary"},{default:b(()=>[c(fo,{onBeforeShow:o.updateProxy,cover:"","transition-show":"scale","transition-hide":"scale"},{default:b(()=>[c(bo,{modelValue:o.fecha,"onUpdate:modelValue":a[0]||(a[0]=e=>o.fecha=e),mask:o.maskFecha,range:"",options:o.options},{default:b(()=>[u("div",Ro,[q(c(D,{label:"Cancel",color:"primary",flat:""},null,512),[[O]]),q(c(D,{label:"OK",color:"primary",flat:"",onClick:o.save},null,8,["onClick"]),[[O]])])]),_:1},8,["modelValue","mask","options"])]),_:1},8,["onBeforeShow"])]),_:1})])):g("",!0),o.accion!=o.acciones.nuevo?(l(),d("div",Mo,[a[8]||(a[8]=u("label",{class:"q-mb-sm block"},"Nombre",-1)),c(E,{modelValue:o.pago.nombre,"onUpdate:modelValue":a[1]||(a[1]=e=>o.pago.nombre=e),placeholder:"Obligatorio",autogrow:"",disable:"",outlined:"",dense:""},null,8,["modelValue"])])):g("",!0),o.pago.fecha_inicio?(l(),d("div",Uo,[a[9]||(a[9]=u("label",{class:"q-mb-sm block"},"Desde",-1)),c(E,{modelValue:o.pago.fecha_inicio,"onUpdate:modelValue":a[2]||(a[2]=e=>o.pago.fecha_inicio=e),placeholder:"Obligatorio",error:!!o.v$.fecha_inicio.$errors.length,disable:"",onBlur:o.v$.fecha_inicio.$touch,outlined:"",dense:"","emit-value":""},{error:b(()=>[(l(!0),d(Q,null,j(o.v$.fecha_inicio.$errors,e=>(l(),d("div",{key:e.$uid},[u("div",qo,L(e.$message),1)]))),128))]),_:1},8,["modelValue","error","onBlur"])])):g("",!0),o.pago.fecha_fin?(l(),d("div",Qo,[a[10]||(a[10]=u("label",{class:"q-mb-sm block"},"Hasta",-1)),c(E,{modelValue:o.pago.fecha_fin,"onUpdate:modelValue":a[3]||(a[3]=e=>o.pago.fecha_fin=e),placeholder:"Obligatorio",error:!!o.v$.fecha_fin.$errors.length,disable:"",onBlur:o.v$.fecha_fin.$touch,outlined:"",dense:"","emit-value":""},{error:b(()=>[(l(!0),d(Q,null,j(o.v$.fecha_fin.$errors,e=>(l(),d("div",{key:e.$uid},[u("div",jo,L(e.$message),1)]))),128))]),_:1},8,["modelValue","error","onBlur"])])):g("",!0),o.accion!=o.acciones.nuevo?(l(),d("div",Lo,[a[11]||(a[11]=u("label",{class:"q-mb-sm block"},"Estado",-1)),c(E,{modelValue:o.pago.estado,"onUpdate:modelValue":a[4]||(a[4]=e=>o.pago.estado=e),disable:"",outlined:"",dense:""},null,8,["modelValue"])])):g("",!0),o.accion!=o.acciones.nuevo&&o.pago.causa_anulacion?(l(),d("div",Oo,[a[12]||(a[12]=u("label",{class:"q-mb-sm block"},"Causa anulaci\xF3n",-1)),c(E,{modelValue:o.pago.causa_anulacion,"onUpdate:modelValue":a[5]||(a[5]=e=>o.pago.causa_anulacion=e),disable:"",outlined:"",dense:""},null,8,["modelValue"])])):g("",!0),o.accion!==o.acciones.nuevo&&o.pago.listadoEmpleados.length>0?(l(),d("div",Go,[c(r,{titulo:"Comisiones de Empleados",configuracionColumnas:o.accion===o.acciones.editar?[...o.configuracionColumnasPagoComisionEmpleado,o.accionesTabla]:o.configuracionColumnasPagoComisionEmpleado,datos:o.pago.listadoEmpleados,permitirConsultar:!1,permitirEditar:!1,permitirEliminar:!1,mostrarBotones:!1,ajustarCeldas:!0,altoFijo:!1},null,8,["configuracionColumnas","datos"])])):g("",!0)])]),_:1})]),_:1},8,["mixin","configuracionColumnas","tab-options","tabDefecto","filtrar","accion1","accion2","accion3"])}var Ua=mo(Io,[["render",Ho]]);export{Ua as default};
