var K=Object.defineProperty;var W=(e,o,b)=>o in e?K(e,o,{enumerable:!0,configurable:!0,writable:!0,value:b}):e[o]=b;var d=(e,o,b)=>(W(e,typeof o!="symbol"?o+"":o,b),b);import{E as X}from"./entidadAuditable.75a46700.js";import{bz as S,t as B,c as Y,u as Z,e as x,a3 as V,s as ee,g as oe,bA as w,v as ae,x as se,y as r,z as u,B as i,D as n,H as m,S as q,L as c,T as $,F as g,G as f,k as F,a6 as ie,R as A,b3 as te,I as le,J as ne,M as L,K as C}from"./index.976e8f3c.js";import{Q as k}from"./QSelect.a8f2bfb2.js";import{a as Q}from"./QToolbar.cff7174f.js";import{Q as de,a as re,C as me}from"./QPopupProxy.d8ef7a42.js";import{Q as ue}from"./QChip.334d746c.js";import{S as ce}from"./SimpleLayout.0978ce6a.js";import{D as pe}from"./DetallePaciente.c22aedbd.js";import{L as be}from"./LaboratorioClinicoController.c565aa29.js";import{S as ve}from"./utils.30e08aa2.js";import{u as fe}from"./filtrosListadosGenerales.31e9eb2c.js";import{E as ge}from"./EmpleadoPermisosController.f86af0cf.js";import{w as he,s as qe}from"./EssentialTable.d8e6954a.js";class no extends X{constructor(){super();d(this,"codigo");d(this,"observacion");d(this,"observacion_autorizador");d(this,"registro_empleado_examen");d(this,"estado_solicitud_examen");d(this,"cantidad_examenes_solicitados");d(this,"examenes_solicitados");d(this,"empleado");d(this,"empleado_id");d(this,"departamento");d(this,"canton");d(this,"autorizador");d(this,"solicitante");d(this,"autorizacion");d(this,"generar_orden_compra",!1);this.codigo=null,this.observacion=null,this.observacion_autorizador=null,this.registro_empleado_examen=null,this.estado_solicitud_examen=null,this.cantidad_examenes_solicitados=null,this.examenes_solicitados=[],this.empleado=null,this.empleado_id=null,this.departamento=null,this.canton=null,this.autorizador=null,this.solicitante=null,this.autorizacion=null}}class ro extends S{constructor(){super(B.solicitudes_examenes)}}class Ce extends S{constructor(){super(B.examenes)}}var Ve=Y({components:{DetallePaciente:pe,SimpleLayout:ce},props:{mixin:{type:Object,required:!0},empleado:{type:Object,required:!0}},emits:["guardado","cerrar-modal"],setup(e,{emit:o}){const b=Z(),h=e.empleado,_=new ve,y=new be,E=x([]),a=x(!1),{entidad:t,listadosAuxiliares:s,accion:z,disabled:N}=e.mixin.useReferencias(),{cargarVista:O,obtenerListados:D,guardar:I}=e.mixin.useComportamiento(),{onBeforeGuardar:P,onBeforeModificar:H}=e.mixin.useHooks();O(async()=>{const l=V.getItem("examenes")?JSON.parse(V.getItem("examenes").toString()):[];await D({laboratoriosClinicos:{controller:y,params:{canton_id:h.canton,activo:1,campos:"id,nombre"}},autorizadores:{controller:new ge,params:{permisos:["puede.autorizar.solicitudes_examenes"]}},cantones:[],examenes:l.length?l:new Ce}),s.cantones=JSON.parse(V.getItem("cantones").toString()),V.set("examenes",JSON.stringify(s.examenes)),U.value=s.cantones});const{cantones:U,filtrarCantones:T}=fe(s),j=async l=>{_.activar();try{R();const{result:p}=await y.listar({canton_id:l,activo:1,campos:"id,nombre"});s.laboratoriosClinicos=p}catch(p){console.log(p)}finally{_.desactivar()}},J=(l,p)=>{p===0&&(t.examenes_solicitados=t.examenes_solicitados.map(v=>(v.laboratorio_clinico=l,v)))},G=(l,p)=>{p===0&&z.value===w.nuevo&&(t.examenes_solicitados=t.examenes_solicitados.map(v=>(v.fecha_asistencia=l,v)))},M=(l,p)=>{p===0&&z.value===w.nuevo&&(t.examenes_solicitados=t.examenes_solicitados.map(v=>(v.hora_asistencia=l,v)))},R=()=>{t.examenes_solicitados=t.examenes_solicitados.map(l=>(l.laboratorio_clinico=null,l))};return P(()=>{console.log("on before guardar..."),t.examenes_solicitados=t.examenes_solicitados.map(l=>(l.fecha_hora_asistencia=`${l.fecha_asistencia} ${l.hora_asistencia}`,l)),t.canton=h.canton}),H(()=>{console.log("on before modificar..."),t.examenes_solicitados=t.examenes_solicitados.map(l=>(l.fecha_hora_asistencia=`${l.fecha_asistencia} ${l.hora_asistencia}`,l)),t.canton=h.canton}),{mixin:e.mixin,solicitudExamen:t,empleado:h,examenes:E,listadosAuxiliares:s,maskFecha:ee,esAutorizador:oe(()=>t.autorizador===b.user.id),selectAprobarEstadosSolicitudesExamenes:he,mostrarCambiarCanton:a,acciones:w,estadosSolicitudesExamenes:qe,cantones:U,filtrarCantones:T,accion:z,disabled:N,consultarLaboratoriosClinicos:j,guardar:I,asignarLaboratorio:J,asignarFecha:G,asignarHora:M}}});const ke={class:"q-mb-md"},_e={key:0,class:"bg-desenfoque rounded q-pt-md q-mb-md"},ye={class:"col-12 text-primary text-bold q-px-md q-mb-md"},Ee={class:"row q-mb-md q-px-md"},ze={class:"row justify-between items-center q-mb-sm"},we={key:0,class:"q-mb-sm block"},Ae={key:1,class:"q-mb-sm block text-bold"},Le={class:"col-12 col-md-3"},Ue={class:"col-12 col-md-3"},xe={class:"q-mb-md block"},$e={class:"col-12 col-md-3"},Fe={class:"q-mb-md block"},Qe={class:"row items-center justify-end"},Se={class:"col-12 col-md-3"},Be={class:"q-mb-md block"},Ne={class:"row q-px-md"},Oe={class:"col-12 q-mb-md"},De={key:1,class:"bg-desenfoque rounded q-pt-md"},Ie={class:"col-12 text-primary text-bold q-px-md q-mb-md"},Pe={class:"row q-col-gutter-sm q-px-md"},He={class:"col-12 col-md-3 q-mb-md"},Te={key:0,class:"col-12 col-md-3 q-mb-md"},je={key:1,class:"col-12 col-md-3"},Je={key:2,class:"col-12 q-mb-md"};function Ge(e,o,b,h,_,y){const E=se("detalle-paciente");return r(),u("div",null,[i("div",ke,[n($,{name:"scale",mode:"out-in"},{default:m(()=>[e.empleado.id?(r(),q(E,{key:0,empleado:e.empleado},null,8,["empleado"])):c("",!0)]),_:1})]),e.empleado.id?(r(),u("div",_e,[i("div",ye,[n(g,{name:"bi-list"}),o[8]||(o[8]=f(" Listado de ex\xE1menes solicitados "))]),i("div",Ee,[o[9]||(o[9]=i("div",{class:"col-12 col-md-3"},null,-1)),n($,{name:"scale",mode:"out-in"},{default:m(()=>[F(i("div",{class:ie(["rounded q-mb-md",{"col-12":e.solicitudExamen.id,"col-6 custom-shadow q-pa-md border-white":!e.solicitudExamen.id}])},[i("div",ze,[e.solicitudExamen.id?(r(),u("label",we,"Cant\xF3n")):(r(),u("label",Ae,"Seleccione un cant\xF3n para filtrar los laboratorios cl\xEDnicos")),e.solicitudExamen.id?c("",!0):(r(),q(A,{key:2,icon:"bi-x",class:"rounded",unelevated:"",color:"negative",dense:"",onClick:o[0]||(o[0]=()=>e.mostrarCambiarCanton=!e.mostrarCambiarCanton)}))]),n(k,{modelValue:e.empleado.canton,"onUpdate:modelValue":[o[1]||(o[1]=a=>e.empleado.canton=a),o[2]||(o[2]=a=>e.consultarLaboratoriosClinicos(e.empleado.canton))],options:e.cantones,onFilter:e.filtrarCantones,disable:e.disabled||e.esAutorizador,"transition-show":"scale","transition-hide":"scale","options-dense":"",dense:"",outlined:"","option-label":a=>a.canton,"option-value":a=>a.id,"use-input":"","input-debounce":"0","emit-value":"","map-options":""},null,8,["modelValue","options","onFilter","disable","option-label","option-value"])],2),[[te,e.mostrarCambiarCanton||e.solicitudExamen.id]])]),_:1})]),(r(!0),u(le,null,ne(e.solicitudExamen.examenes_solicitados,(a,t)=>(r(),u("div",{key:a.examen_id,class:"row q-col-gutter-sm q-mb-md q-px-md"},[i("div",Le,[o[10]||(o[10]=i("label",{class:"q-mb-md block"},"Ex\xE1men a solicitar ",-1)),n(k,{modelValue:a.examen,"onUpdate:modelValue":s=>a.examen=s,options:e.listadosAuxiliares.examenes,disable:"","transition-show":"scale","transition-hide":"scale","options-dense":"",dense:"",outlined:"","option-label":s=>s.examen,"option-value":s=>s.id,"use-input":"","input-debounce":"0","emit-value":"","map-options":""},null,8,["modelValue","onUpdate:modelValue","options","option-label","option-value"])]),i("div",Ue,[i("label",xe,[o[12]||(o[12]=f("Laboratorio cl\xEDnico ")),t===0&&e.accion===e.acciones.nuevo?(r(),q(A,{key:0,class:"bg-white q-px-sm",outline:"",color:"grey-7",dense:"",flat:"",size:"sm","no-caps":"",rounded:"",unelevated:"",onClick:o[3]||(o[3]=()=>e.mostrarCambiarCanton=!e.mostrarCambiarCanton)},{default:m(()=>[n(g,{size:"12px",name:"bi-arrow-left-right",class:"q-mr-sm"}),o[11]||(o[11]=i("div",null,"Seleccionar otro cant\xF3n",-1))]),_:1})):c("",!0)]),n(k,{modelValue:a.laboratorio_clinico,"onUpdate:modelValue":[s=>a.laboratorio_clinico=s,s=>e.asignarLaboratorio(a.laboratorio_clinico,t)],options:e.listadosAuxiliares.laboratoriosClinicos,disable:e.disabled||e.esAutorizador,hint:t===0&&e.accion===e.acciones.nuevo?"Se autocompletar\xE1n los dem\xE1s laboratorios con el seleccionado aqu\xED":null,"transition-show":"scale","transition-hide":"scale","options-dense":"",dense:"",outlined:"","option-label":s=>s.nombre,"option-value":s=>s.id,"use-input":"","input-debounce":"0","emit-value":"","map-options":""},null,8,["modelValue","onUpdate:modelValue","options","disable","hint","option-label","option-value"])]),i("div",$e,[i("label",Fe,[o[14]||(o[14]=f("Fecha de asistencia ")),t===0?(r(),q(g,{key:0,name:"info",color:"grey"},{default:m(()=>[n(Q,{class:"bg-dark"},{default:m(()=>o[13]||(o[13]=[f(L("Se autocompletar\xE1n las dem\xE1s fechas con la seleccionada aqu\xED"))])),_:1})]),_:1})):c("",!0)]),n(C,{modelValue:a.fecha_asistencia,"onUpdate:modelValue":s=>a.fecha_asistencia=s,outlined:"",type:"datetime",disable:e.disabled,dense:""},{append:m(()=>[n(g,{name:"event",class:"cursor-pointer"},{default:m(()=>[n(de,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:m(()=>[n(re,{modelValue:a.fecha_asistencia,"onUpdate:modelValue":[s=>a.fecha_asistencia=s,s=>e.asignarFecha(a.fecha_asistencia,t)],mask:e.maskFecha,"today-btn":""},{default:m(()=>[i("div",Qe,[F(n(A,{label:"Cerrar",color:"primary",flat:""},null,512),[[me]])])]),_:2},1032,["modelValue","onUpdate:modelValue","mask"])]),_:2},1024)]),_:2},1024)]),_:2},1032,["modelValue","onUpdate:modelValue","disable"])]),i("div",Se,[i("label",Be,[o[16]||(o[16]=f("Hora de asistencia ")),t===0?(r(),q(g,{key:0,name:"info",color:"grey"},{default:m(()=>[n(Q,{class:"bg-dark"},{default:m(()=>o[15]||(o[15]=[f(L("Se autocompletar\xE1n las dem\xE1s horas con la seleccionada aqu\xED"))])),_:1})]),_:1})):c("",!0)]),n(C,{modelValue:a.hora_asistencia,"onUpdate:modelValue":[s=>a.hora_asistencia=s,s=>e.asignarHora(a.hora_asistencia,t)],disable:e.disabled,type:"time",step:"1","stack-label":"",outlined:"",dense:""},null,8,["modelValue","onUpdate:modelValue","disable"])])]))),128)),i("div",Ne,[i("div",Oe,[o[17]||(o[17]=i("label",{class:"q-mb-sm block"},"Observaci\xF3n del solicitante",-1)),n(C,{modelValue:e.solicitudExamen.observacion,"onUpdate:modelValue":o[4]||(o[4]=a=>e.solicitudExamen.observacion=a),disable:e.disabled||e.esAutorizador,outlined:"",dense:"",autogrow:""},null,8,["modelValue","disable"])])])])):c("",!0),e.empleado.id?(r(),u("div",De,[i("div",Ie,[n(g,{name:"bi-key"}),o[18]||(o[18]=f(" Autorizaci\xF3n "))]),i("div",Pe,[i("div",He,[o[19]||(o[19]=i("label",{class:"q-mb-sm block"},"Autorizador",-1)),n(k,{modelValue:e.solicitudExamen.autorizador,"onUpdate:modelValue":o[5]||(o[5]=a=>e.solicitudExamen.autorizador=a),options:e.listadosAuxiliares.autorizadores,disable:e.disabled||e.esAutorizador,"transition-show":"scale","transition-hide":"scale","options-dense":"",dense:"",outlined:"","option-label":a=>`${a.apellidos} ${a.nombres}`,"option-value":a=>a.id,"use-input":"","input-debounce":"0","emit-value":"","map-options":""},null,8,["modelValue","options","disable","option-label","option-value"])]),e.solicitudExamen.created_at?(r(),u("div",Te,[o[20]||(o[20]=i("label",{class:"q-mb-sm block"},"Fecha de solicitud",-1)),n(C,{modelValue:e.solicitudExamen.created_at,"onUpdate:modelValue":o[6]||(o[6]=a=>e.solicitudExamen.created_at=a),dense:"",outlined:"",disable:""},null,8,["modelValue"])])):c("",!0),e.esAutorizador||e.accion===e.acciones.consultar?(r(),u("div",je,[o[21]||(o[21]=i("label",{class:"q-mb-sm block text-positive text-bold"},"Autorizaci\xF3n",-1)),n(ue,{color:"grey-4"},{default:m(()=>[f(L(e.solicitudExamen.estado_solicitud_examen),1)]),_:1})])):c("",!0),e.solicitudExamen.created_at?(r(),u("div",Je,[o[22]||(o[22]=i("label",{class:"q-mb-sm block"},"Observaci\xF3n del autorizador",-1)),n(C,{modelValue:e.solicitudExamen.observacion_autorizador,"onUpdate:modelValue":o[7]||(o[7]=a=>e.solicitudExamen.observacion_autorizador=a),disable:"",outlined:"",dense:"",autogrow:""},null,8,["modelValue"])])):c("",!0)])])):c("",!0)])}var mo=ae(Ve,[["render",Ge]]);export{Ce as E,mo as F,no as S,ro as a};
