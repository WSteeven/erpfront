var de=Object.defineProperty;var ue=(e,o,r)=>o in e?de(e,o,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[o]=r;var c=(e,o,r)=>(ue(e,typeof o!="symbol"?o+"":o,r),r);import{e as m,bz as ce,t as I,m as pe,f as me,bA as w,A as D,bH as be,c as fe,U as ve,u as ge,a3 as W,dD as ye,v as Ce,x as F,y as p,S as Pe,H as n,D as s,a7 as Se,B as l,z as f,K as q,L,I as B,J as A,M as h,N as Ve,O as we,P as Ee,G as T,a5 as Le,R as he}from"./index.976e8f3c.js";import{Q as $,a as X}from"./QSelect.a8f2bfb2.js";import{Q as N,a as U}from"./QItemSection.c6f2640c.js";import{Q as Te}from"./QForm.ed6f6690.js";import{c as $e}from"./configuracionColumnasInventarios.ec051713.js";import{c as qe}from"./configuracionColumnasItemsSeleccionados.5da3f45e.js";import{r as Q}from"./index.95f5a0db.js";import{u as Ie}from"./index.ed676411.js";import{u as ke}from"./selector.b9804ebb.js";import{T as De}from"./TabLayoutFilterTabs.a267f3c1.js";import{E as Fe}from"./EssentialTable.d8e6954a.js";import{E as Be}from"./EssentialSelectableTable.001f5242.js";import{M as Ae}from"./ModalEntidad.84100166.js";import{C as Ne}from"./ContenedorSimpleMixin.5a0b06ab.js";import{E as Ue}from"./entidadAuditable.75a46700.js";import{T as Qe}from"./TareaController.c7f2748b.js";import{C as Oe}from"./ClienteController.f53ff018.js";import{S as Re,A as je,s as ze}from"./utils.30e08aa2.js";import{u as He}from"./filtrosListadosGenerales.31e9eb2c.js";import"./QChip.334d746c.js";import"./QMenu.410ae527.js";import"./position-engine.2f1d750c.js";import"./format.8ac60962.js";import"./SelectorController.62baf71e.js";import"./QTabs.3c726b04.js";import"./QResizeObserver.6ec10d95.js";import"./QTabPanels.1c8c4baa.js";import"./touch.9135741d.js";import"./QPopupProxy.d8ef7a42.js";import"./QPage.ed5d79ca.js";import"./EssentialTableTabs.c7e98bba.js";import"./QBadge.1ddeabfd.js";import"./EssentialTablePagination.f449a738.js";import"./QTable.048b8be8.js";import"./use-fullscreen.0ccd26e6.js";import"./QToolbar.cff7174f.js";import"./QBtnGroup.7d0835e4.js";import"./buttonSubmits.2eb37d38.js";import"./QFile.e27868da.js";import"./_commonjsHelpers.8402d862.js";import"./QImg.e0fb285c.js";import"./VisorImagen.e7965569.js";import"./seleccionContratacionPersonal.utils.e3e1ed3d.js";import"./ErrorComponent.b482e77d.js";import"./i18n-validators.06eef631.js";import"./configuracion_general.ef04b031.js";import"./ConfiguracionController.65de3fc5.js";const Me=[{name:"solicitante",field:"solicitante",label:"Creado por",align:"left",sortable:!0},{name:"justificacion",field:"justificacion",label:"Justificaci\xF3n",align:"left",sortable:!0},{name:"desde_cliente",field:"desde_cliente",label:"Desde",align:"left",sortable:!0},{name:"hasta_cliente",field:"hasta_cliente",label:"Hasta",align:"left",sortable:!0},{name:"tarea",field:"tarea",label:"Tarea",align:"left",sortable:!0},{name:"sucursal",field:"sucursal",label:"Sucursal",align:"left",sortable:!0},{name:"estado",field:"estado",label:"Estado de devoluci\xF3n",align:"left",sortable:!0}],Je=[{name:"producto",field:"producto",label:"Producto",align:"left",sortable:!0},{name:"detalle_id",field:"detalle_id",label:"Descripci\xF3n",align:"left",sortable:!0},{name:"cliente_id",field:"cliente_id",label:"Propietario",align:"left",sortable:!0},{name:"condicion",field:"condicion",label:"Condici\xF3n",align:"left",sortable:!0},{name:"cantidades",field:"cantidades",label:"Cantidad",align:"left",sortable:!1},{name:"devuelto",field:"devuelto",label:"Devuelto",align:"left",sortable:!1},{name:"devolucion",field:"devolucion",label:"Devolucion",align:"left",sortable:!1},{name:"acciones",field:"acciones",label:"Acciones",align:"right",sortable:!1}],Ge=[{name:"producto",field:"producto",label:"Producto",align:"left",sortable:!0},{name:"detalle_id",field:"detalle_id",label:"Descripci\xF3n",align:"left",sortable:!0},{name:"cliente_id",field:"cliente_id",label:"Propietario",align:"left",sortable:!0},{name:"condicion",field:"condicion",label:"Condici\xF3n",align:"left",sortable:!0},{name:"cantidades",field:"cantidades",label:"Cantidad",align:"left",sortable:!1},{name:"devuelto",field:"devuelto",label:"Devuelto",align:"left",sortable:!1},{name:"acciones",field:"acciones",label:"Acciones",align:"right",sortable:!1}];function Ke(e,o){const r=m(),b=m([]),u=m(),y={refListadoSeleccionable:r,listadoSeleccionable:b,endpoint:o,limpiar:()=>{e.id=null,u.value=null},seleccionar:i=>{console.log(i),e.listadoProductos=[...e.listadoProductos,...i]}},C=ke(y);return{refListadoSeleccionable:r,listado:b,listar:i=>C.listar(u.value,i),limpiar:()=>y.limpiar(),seleccionar:i=>{console.log(i);let d=[];d=e.listadoProductos.map(V=>V.id);const v=i.filter(V=>!d.includes(V.id));y.seleccionar(v)},criterioBusqueda:u}}class We extends ce{constructor(){super(I.traspasos)}}class O extends Ue{constructor(){super();c(this,"justificacion");c(this,"devuelta");c(this,"solicitante");c(this,"desde_cliente");c(this,"hasta_cliente");c(this,"tarea");c(this,"sucursal");c(this,"estado");c(this,"listadoProductos");c(this,"es_tarea");this.justificacion=null,this.devuelta=null,this.solicitante=null,this.desde_cliente=null,this.hasta_cliente=null,this.tarea=null,this.sucursal=null,this.estado=null,this.listadoProductos=[],this.es_tarea=!1}}class Xe{constructor(o){c(this,"traspaso");this.traspaso=o}async validar(){if(this.traspaso.listadoProductos.length===0)throw new Error("Debe agregar al menos un producto al listado.");return!0}}const Ye=pe("traspaso",()=>{const e=me(new O),o=new O,r=m(),b=w.nuevo,u=new Re;async function y(i){const d=D.getInstance(),v=d.getEndpoint(I.traspasos)+"/show-preview/"+i;return(await d.get(v)).data.modelo}async function C(i){try{u.activar();const d=await y(i);e.hydrate(d)}catch{e.hydrate(o)}finally{u.desactivar()}}async function P(){const i=D.getInstance(),d=i.getEndpoint(I.traspasos)+"/show-preview/"+r.value,v=await i.get(d);e.hydrate(v.data.modelo)}async function S(){const i=D.getInstance(),d=be.URL_BASE+"/"+i.getEndpoint(I.traspasos)+"/imprimir/"+r.value,v="traspaso_"+r.value+"_"+Date.now();je(d,"GET","blob","pdf",v),console.log("traspaso impreso con exito")}function a(){e.hydrate(o)}return{traspaso:e,accionTraspaso:b,cargarTraspaso:C,resetearTraspaso:a,idTraspaso:r,showPreview:P,imprmirPdf:S}});var Ze=fe({components:{TabLayoutFilterTabs:De,EssentialTable:Fe,EssentialSelectableTable:Be,ModalesEntidad:Ae},setup(){const e=new Ne(O,new We),{entidad:o,disabled:r,accion:b,listadosAuxiliares:u}=e.useReferencias(),{setValidador:y,obtenerListados:C,cargarVista:P}=e.useComportamiento(),{onReestablecer:S,onBeforeGuardar:a,onConsultado:i}=e.useHooks(),{confirmar:d,prompt:v,notificarError:V}=ve();ge();const R=Ye(),{refListadoSeleccionable:Y,criterioBusqueda:Z,listado:_,listar:x,limpiar:ee,seleccionar:oe}=Ke(o,"inventarios");let j=m(),k=m(!1);m(!1);let z=m(!1);m(),i(()=>{b.value===w.editar&&(k.value=!0)}),S(()=>{k.value=!1}),a(()=>{console.log("se ejecuta el ONBEFOREGUARDAR"),o.desde_cliente===o.hasta_cliente&&V("\xA1No se puede hacer traspasos en un mismo cliente!")});const H=m([]),M=m([]),J=m([]),{clientes:G,filtrarClientes:ae}=He(u);P(async()=>{await C({clientes:{controller:new Oe,params:{campos:"id,razon_social",requiere_bodega:1,estado:1}},tareas:{controller:new Qe,params:{campos:"id,codigo_tarea,titulo,cliente_id"}}})});const K=Ie({sucursal:{required:Q},desde_cliente:{required:Q},hasta_cliente:{required:Q}},o);y(K.value);const se=new Xe(o);e.agregarValidaciones(se);function le({entidad:t,posicion:g}){d("\xBFEst\xE1 seguro de continuar?",()=>o.listadoProductos.splice(g,1))}const te={titulo:"Quitar",color:"negative",icono:"bi-x",accion:({entidad:t,posicion:g})=>{le({entidad:t,posicion:g})},visible:()=>b.value==w.nuevo},ie={titulo:"Cantidad",icono:"bi-pencil",accion:({posicion:t})=>{const g={titulo:"Confirmaci\xF3n",mensaje:"Ingresa la cantidad",defecto:o.listadoProductos[t].cantidades,tipo:"number",accion:E=>o.listadoProductos[t].cantidades=E};v(g)},visible:()=>b.value==w.nuevo},ne={titulo:"Devolucion",icono:"bi-pencil",accion:({posicion:t})=>{const g={titulo:"Confirmaci\xF3n",mensaje:"Ingresa la cantidad",defecto:o.listadoProductos[t].devolucion,tipo:"number",accion:E=>o.listadoProductos[t].devolucion=E};v(g)},visible:({entidad:t,posicion:g})=>b.value==w.editar&&t.cantidades!=t.devuelto},re={titulo:"Imprimir",color:"secondary",icono:"bi-printer",accion:async({entidad:t})=>{R.idTraspaso=t.id,await R.imprmirPdf()}};return G.value=u.clientes,J.value=JSON.parse(W.getItem("estados_transacciones").toString()),H.value=JSON.parse(W.getItem("sucursales").toString()),M.value=u.tareas,{mixin:e,traspaso:o,disabled:r,accion:b,v$:K,configuracionColumnas:Me,acciones:w,clientes:G,opciones_estados:J,opciones_sucursales:H,opciones_tareas:M,refListado:Y,criterioBusquedaProducto:Z,listadoProductos:_,listarProductos:x,limpiarProducto:ee,seleccionarProducto:oe,configuracionColumnasItems:$e,configuracionColumnasItemsSeleccionadosDevolver:Je,configuracionColumnasItemsSeleccionadosDevuelto:Ge,configuracionColumnasItemsSeleccionados:qe,botonEditarCantidad:ie,botonEliminar:te,botonImprimir:re,botonDevolver:ne,soloLectura:k,puedeEditar:z,tabOptionsTraspasos:ye,tabSeleccionado:j,tabEs(t){console.log(t),j.value=t,z.value=t==0},filtrarClientes:ae,ordenarLista:ze,tareaSeleccionada(t){const g=u.tareas.filter(E=>E.id===t);o.hasta_cliente=g[0].cliente_id}}}});const _e={class:"row q-col-gutter-sm q-py-md"},xe={key:0,class:"col-12 col-md-3"},eo={key:1,class:"col-12 col-md-3"},oo={class:"col-12 col-md-6"},ao={class:"col-12 col-md-3 q-mb-md"},so={class:"error-msg"},lo={key:2,class:"col-12 col-md-3"},to={key:3,class:"col-12 col-md-3"},io={class:"col-12 col-md-3"},no={class:"error-msg"},ro={class:"col-12 col-md-3"},uo={class:"error-msg"},co={key:4,class:"col-12 col-md-3"},po={class:"col-12 col-md-12"},mo={class:"row q-col-gutter-x-xs"},bo={class:"col-12 col-md-10 q-mb-md"},fo={class:"col-12 col-md-2"},vo={class:"col-12"};function go(e,o,r,b,u,y){const C=F("essential-table"),P=F("essential-selectable-table"),S=F("tab-layout-filter-tabs");return p(),Pe(S,{mixin:e.mixin,configuracionColumnas:e.configuracionColumnas,"titulo-pagina":"Traspasos","tab-options":e.tabOptionsTraspasos,onTabSeleccionado:e.tabEs,permitirEditar:e.puedeEditar,accion1:e.botonImprimir},{formulario:n(()=>[s(Te,{onSubmit:o[15]||(o[15]=Se(()=>{},["prevent"]))},{default:n(()=>[l("div",_e,[e.traspaso.id?(p(),f("div",xe,[o[16]||(o[16]=l("label",{class:"q-mb-sm block"},"Traspaso N\xB0",-1)),s(q,{modelValue:e.traspaso.id,"onUpdate:modelValue":o[0]||(o[0]=a=>e.traspaso.id=a),placeholder:"Obligatorio",disable:e.disabled||e.soloLectura,readonly:e.disabled||e.soloLectura,outlined:"",dense:""},null,8,["modelValue","disable","readonly"])])):L("",!0),e.traspaso.created_at?(p(),f("div",eo,[o[17]||(o[17]=l("label",{class:"q-mb-sm block"},"Fecha",-1)),s(q,{modelValue:e.traspaso.created_at,"onUpdate:modelValue":o[1]||(o[1]=a=>e.traspaso.created_at=a),disable:"",outlined:"",dense:""},null,8,["modelValue"])])):L("",!0),l("div",oo,[o[18]||(o[18]=l("label",{class:"q-mb-sm block"},"Justificaci\xF3n",-1)),s(q,{type:"textarea",autogrow:"",modelValue:e.traspaso.justificacion,"onUpdate:modelValue":o[2]||(o[2]=a=>e.traspaso.justificacion=a),placeholder:"Obligatorio",disable:e.disabled||e.soloLectura,readonly:e.disabled||e.soloLectura,outlined:"",dense:""},null,8,["modelValue","disable","readonly"])]),l("div",ao,[o[19]||(o[19]=l("label",{class:"q-mb-sm block"},"Sucursal",-1)),s($,{modelValue:e.traspaso.sucursal,"onUpdate:modelValue":o[3]||(o[3]=a=>e.traspaso.sucursal=a),options:e.opciones_sucursales,"transition-show":"scale","transition-hide":"scale","options-dense":"",dense:"",outlined:"",disable:e.disabled||e.soloLectura,readonly:e.disabled||e.soloLectura,error:!!e.v$.sucursal.$errors.length,"error-message":"Debes seleccionar una sucursal","option-label":a=>a.lugar,"option-value":a=>a.id,"emit-value":"","map-options":""},{error:n(()=>[(p(!0),f(B,null,A(e.v$.sucursal.$errors,a=>(p(),f("div",{key:a.$uid},[l("div",so,h(a.$message),1)]))),128))]),_:1},8,["modelValue","options","disable","readonly","error","option-label","option-value"])]),e.traspaso.es_tarea||e.accion===e.acciones.nuevo?(p(),f("div",lo,[s(Ve,{class:"q-mt-lg q-pt-md",modelValue:e.traspaso.es_tarea,"onUpdate:modelValue":o[4]||(o[4]=a=>e.traspaso.es_tarea=a),label:"\xBFEs material para tarea?",disable:e.disabled||e.soloLectura,outlined:"",dense:""},null,8,["modelValue","disable"])])):L("",!0),e.traspaso.es_tarea?(p(),f("div",to,[o[20]||(o[20]=l("label",{class:"q-mb-sm block"},"Tarea",-1)),s($,{modelValue:e.traspaso.tarea,"onUpdate:modelValue":[o[5]||(o[5]=a=>e.traspaso.tarea=a),e.filtroTareas],options:e.opciones_tareas,"transition-show":"scale","transition-hide":"scale","options-dense":"",clearable:"",hint:"Opcional",dense:"",outlined:"",disable:e.disabled||e.soloLectura,readonly:e.disabled||e.soloLectura,"option-label":a=>a.titulo,"option-value":a=>a.id,"emit-value":"","map-options":""},{option:n(a=>[s(N,we(Ee(a.itemProps)),{default:n(()=>[s(U,null,{default:n(()=>[s(X,null,{default:n(()=>[T(h(a.opt.codigo_tarea),1)]),_:2},1024),s(X,{caption:""},{default:n(()=>[T(h(a.opt.titulo),1)]),_:2},1024)]),_:2},1024)]),_:2},1040)]),_:1},8,["modelValue","options","disable","readonly","onUpdate:modelValue","option-label","option-value"])])):L("",!0),l("div",io,[o[22]||(o[22]=l("label",{class:"q-mb-sm block"},"Desde",-1)),s($,{modelValue:e.traspaso.desde_cliente,"onUpdate:modelValue":o[6]||(o[6]=a=>e.traspaso.desde_cliente=a),options:e.clientes,"transition-show":"scale","transition-hide":"scale","options-dense":"",dense:"",outlined:"",error:!!e.v$.desde_cliente.$errors.length,"use-input":"","input-debounce":"0",onFilter:e.filtrarClientes,onPopupShow:o[7]||(o[7]=a=>e.ordenarLista(e.clientes,"razon_social")),disable:e.disabled||e.soloLectura,readonly:e.disabled||e.soloLectura,"option-label":a=>a.razon_social,"option-value":a=>a.id,"emit-value":"","map-options":""},{"no-option":n(()=>[s(N,null,{default:n(()=>[s(U,{class:"text-grey"},{default:n(()=>o[21]||(o[21]=[T(" No hay resultados ")])),_:1})]),_:1})]),error:n(()=>[(p(!0),f(B,null,A(e.v$.desde_cliente.$errors,a=>(p(),f("div",{key:a.$uid},[l("div",no,h(a.$message),1)]))),128))]),_:1},8,["modelValue","options","error","onFilter","disable","readonly","option-label","option-value"])]),l("div",ro,[o[24]||(o[24]=l("label",{class:"q-mb-sm block"},"Hasta",-1)),s($,{modelValue:e.traspaso.hasta_cliente,"onUpdate:modelValue":o[8]||(o[8]=a=>e.traspaso.hasta_cliente=a),options:e.clientes,"transition-show":"scale","transition-hide":"scale","options-dense":"",dense:"",outlined:"",error:!!e.v$.hasta_cliente.$errors.length,"use-input":"","input-debounce":"0",onFilter:e.filtrarClientes,onPopupShow:o[9]||(o[9]=a=>e.ordenarLista(e.clientes,"razon_social")),disable:e.traspaso.es_tarea,readonly:e.disabled||e.soloLectura,"option-label":a=>a.razon_social,"option-value":a=>a.id,"emit-value":"","map-options":""},{"no-option":n(()=>[s(N,null,{default:n(()=>[s(U,{class:"text-grey"},{default:n(()=>o[23]||(o[23]=[T(" No hay resultados ")])),_:1})]),_:1})]),error:n(()=>[(p(!0),f(B,null,A(e.v$.hasta_cliente.$errors,a=>(p(),f("div",{key:a.$uid},[l("div",uo,h(a.$message),1)]))),128))]),_:1},8,["modelValue","options","error","onFilter","disable","readonly","option-label","option-value"])]),e.traspaso.estado?(p(),f("div",co,[o[25]||(o[25]=l("label",{class:"q-mb-sm block"},"Estado",-1)),s($,{modelValue:e.traspaso.estado,"onUpdate:modelValue":o[10]||(o[10]=a=>e.traspaso.estado=a),options:e.opciones_estados,"transition-show":"scale","transition-hide":"scale","options-dense":"",dense:"",outlined:"",disable:e.disabled||e.soloLectura,readonly:e.disabled||e.soloLectura,"option-label":a=>a.nombre,"option-value":a=>a.id,"emit-value":"","map-options":""},null,8,["modelValue","options","disable","readonly","option-label","option-value"])])):L("",!0),l("div",po,[o[27]||(o[27]=l("label",{class:"q-mb-sm block"},"Agregar productos",-1)),l("div",mo,[l("div",bo,[s(q,{modelValue:e.criterioBusquedaProducto,"onUpdate:modelValue":o[11]||(o[11]=a=>e.criterioBusquedaProducto=a),disable:e.disabled||e.soloLectura,placeholder:"Nombre de producto",hint:"Presiona Enter para seleccionar un producto",onKeydown:o[12]||(o[12]=Le(a=>e.listarProductos({sucursal_id:e.traspaso.sucursal,cliente_id:e.traspaso.desde_cliente}),["enter"])),onBlur:o[13]||(o[13]=a=>e.criterioBusquedaProducto===""?e.limpiarProducto():null),outlined:"",dense:""},null,8,["modelValue","disable"])]),l("div",fo,[s(he,{onClick:o[14]||(o[14]=a=>e.listarProductos({sucursal_id:e.traspaso.sucursal,cliente_id:e.traspaso.desde_cliente})),disable:e.disabled||e.soloLectura,icon:"search",unelevated:"",color:"positive",class:"full-width",style:{height:"40px"},"no-caps":"",glossy:""},{default:n(()=>o[26]||(o[26]=[T("Buscar")])),_:1},8,["disable"])])])]),l("div",vo,[s(C,{titulo:"Productos Seleccionados",configuracionColumnas:e.accion===e.acciones.nuevo?e.configuracionColumnasItemsSeleccionados:e.accion===e.acciones.consultar?e.configuracionColumnasItemsSeleccionadosDevuelto:e.configuracionColumnasItemsSeleccionadosDevolver,datos:e.traspaso.listadoProductos,permitirConsultar:!1,permitirEditar:!1,permitirEliminar:!1,mostrarBotones:!1,accion1:e.botonEditarCantidad,accion2:e.botonEliminar,accion3:e.botonDevolver,mostrarFooter:!0},null,8,["configuracionColumnas","datos","accion1","accion2","accion3"])])])]),_:1}),s(P,{ref:"refListado","configuracion-columnas":e.configuracionColumnasItems,datos:e.listadoProductos,"tipo-seleccion":"multiple",onSelected:e.seleccionarProducto},null,8,["configuracion-columnas","datos","onSelected"])]),_:1},8,["mixin","configuracionColumnas","tab-options","onTabSeleccionado","permitirEditar","accion1"])}var ma=Ce(Ze,[["render",go]]);export{ma as default};
