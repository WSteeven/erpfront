var Z=Object.defineProperty;var x=(e,o,u)=>o in e?Z(e,o,{enumerable:!0,configurable:!0,writable:!0,value:u}):e[o]=u;var i=(e,o,u)=>(x(e,typeof o!="symbol"?o+"":o,u),u);import{Q as j}from"./QSelect.a8f2bfb2.js";import{bz as ee,t as q,c as oe,U as ae,e as E,E as se,bA as g,q as te,s as ne,A as O,v as le,x as C,y as w,S as ie,H as l,D as s,a7 as re,B as t,K as y,F as P,k as T,R as L,z as F,I as de,J as ue,M as ce,aa as me,L as pe}from"./index.976e8f3c.js";import{Q as N,a as I,C as R}from"./QPopupProxy.d8ef7a42.js";import{Q as be}from"./QForm.ed6f6690.js";import{T as fe}from"./TabLayoutFilterTabs2.f1a01a4e.js";import{E as ve}from"./EssentialTable.d8e6954a.js";import{C as ge}from"./ContenedorSimpleMixin.5a0b06ab.js";import{E as Ce}from"./entidadAuditable.75a46700.js";import{u as Ve}from"./filtrosListadosGenerales.31e9eb2c.js";import{f as $e}from"./recursosHumanos.utils.706e72b6.js";import{u as he}from"./index.ed676411.js";import{r as b}from"./i18n-validators.06eef631.js";import{S as Ee,s as we,i as H,n as G}from"./utils.30e08aa2.js";import{E as ye}from"./EssentialEditor.265a8636.js";import{D as ke}from"./DescuentosGenralesController.4472c36f.js";import{M as De}from"./MultaController.b478141b.js";import{E as je}from"./ErrorComponent.b482e77d.js";import{N as Fe}from"./NoOptionComponent.ffe820c8.js";import"./QChip.334d746c.js";import"./QItemSection.c6f2640c.js";import"./QMenu.410ae527.js";import"./position-engine.2f1d750c.js";import"./format.8ac60962.js";import"./QTabs.3c726b04.js";import"./QResizeObserver.6ec10d95.js";import"./QTabPanels.1c8c4baa.js";import"./touch.9135741d.js";import"./QPage.ed5d79ca.js";import"./EssentialTableTabs.c7e98bba.js";import"./QBadge.1ddeabfd.js";import"./EssentialTablePagination.f449a738.js";import"./QTable.048b8be8.js";import"./use-fullscreen.0ccd26e6.js";import"./QToolbar.cff7174f.js";import"./QBtnGroup.7d0835e4.js";import"./buttonSubmits.2eb37d38.js";import"./QFile.e27868da.js";import"./_commonjsHelpers.8402d862.js";import"./QImg.e0fb285c.js";import"./VisorImagen.e7965569.js";import"./seleccionContratacionPersonal.utils.e3e1ed3d.js";import"./index.95f5a0db.js";import"./extend.4a22771d.js";class qe extends Ce{constructor(){super();i(this,"fecha_descuento");i(this,"empleado");i(this,"tipo_descuento");i(this,"multa");i(this,"descripcion");i(this,"descripcion_corta");i(this,"valor");i(this,"cantidad_cuotas");i(this,"mes_inicia_cobro");i(this,"pendiente_pagar");i(this,"pagado");i(this,"cuotas");this.fecha_descuento=null,this.empleado=null,this.multa=null,this.tipo_descuento=null,this.descripcion="",this.descripcion_corta="",this.valor=null,this.cantidad_cuotas=null,this.mes_inicia_cobro=null,this.pendiente_pagar=null,this.pagado=!1,this.cuotas=[]}}class Be extends ee{constructor(){super(q.descuentos)}}const Ue=[{name:"empleado",field:"empleado",label:"Empleado",align:"left",sortable:!0},{name:"descripcion_corta",field:"descripcion_corta",label:"Descripci\xF3n",align:"left",sortable:!0},{name:"valor",field:"valor",label:"Monto",align:"left",sortable:!0},{name:"cantidad_cuotas",field:"cantidad_cuotas",label:"Cant. Cuotas",align:"left",sortable:!0},{name:"pendiente_pagar",field:"pendiente_pagar",label:"Pendiente Pagar",align:"left",sortable:!0}],Ae=[{name:"num_cuota",field:"num_cuota",label:"N\xFAmero de Cuota",align:"left",sortable:!0},{name:"mes_vencimiento",field:"mes_vencimiento",label:"Mes de Vencimiento",align:"left",sortable:!0},{name:"valor_cuota",field:"valor_cuota",label:"Valor de Cuota",align:"left",sortable:!0},{name:"pagada",field:"pagada",label:"pagada",align:"center",sortable:!0},{name:"comentario",field:"comentario",label:"Comentario",align:"left",sortable:!0}];var Me=oe({components:{NoOptionComponent:Fe,ErrorComponent:je,EssentialEditor:ye,TabLayoutFilterTabs2:fe,EssentialTable:ve},setup(){const e=new ge(qe,new Be),{entidad:o,disabled:u,accion:V,listadosAuxiliares:f}=e.useReferencias(),{setValidador:B,obtenerListados:c,cargarVista:v,listar:k}=e.useComportamiento(),{prompt:$,confirmar:D,notificarCorrecto:a}=ae(),U=E("0"),A=E(!1),h=new Ee,M=E([]),S=E([]),{empleados:Q,filtrarEmpleados:J}=Ve(f);v(async()=>{await c({empleados:{controller:new se,params:{estado:1}},descuentos_generales:{controller:new ke,params:{}},multas:{controller:new De,params:{}}}),M.value=f.descuentos_generales,Q.value=f.empleados,S.value=f.multas});const _=he({empleado:{required:b},fecha_descuento:{required:b},descripcion:{required:b},valor:{required:b},cantidad_cuotas:{required:b},mes_inicia_cobro:{required:b}},o);B(_.value);async function K(n){U.value=n,await k({pagado:n})}function Y(n,r){A.value=r!=="month"}async function W(){try{h.activar();const n=O.getInstance(),r=n.getEndpoint(q.calcular_cuotas_descuento),d=await n.post(r,o);console.log(d),d.status==200&&a("Cuotas calculadas"),o.cuotas=d.data.cuotas}catch(n){if(H(n)){const d=error.erroresValidacion;await G(d,this.notificaciones)}}finally{h.desactivar()}}async function X(n,r,d){try{h.activar();const m=O.getInstance(),z=m.getEndpoint(q.aplazar_cuota_descuento)+n.id,p=await m.post(z,{comentario:d});console.log(p),p.status==200&&(a(p.data.mensaje),o.cuotas[r]=p.data.cuota)}catch(m){if(H(m)){const p=error.erroresValidacion;await G(p,this.notificaciones)}}finally{h.desactivar()}}return{v$:_,mixin:e,descuento:o,accion:V,acciones:g,accionesTabla:te,disabled:u,configuracionColumnas:Ue,configuracionColumnasCuotasDescuento:Ae,maskFecha:ne,tabDefecto:U,tabOptions:$e,is_month:A,multas:S,descuentos_generales:M,empleados:Q,filtrarEmpleados:J,filtrar:K,checkMes:Y,calcularCantidadCuotas:W,ordenarLista:we,btnComentarioCuota:{titulo:"Comentario",icono:"bi-chat-square-text-fill",color:"primary",accion:({entidad:n})=>{const r={titulo:"Comentario",mensaje:"Escribe el comentario",defecto:n.comentario,accion:d=>{n.comentario=d}};$(r)},visible:()=>[g.nuevo,g.editar].includes(V.value)},btnAplazarCuota:{titulo:"Aplazar",icono:"bi-caret-down-fill",color:"warning",accion:({entidad:n,posicion:r})=>{console.log(n,r),D("Se modificar\xE1 el mes de vencimiento hasta el mes siguiente de la ultima cuota. \xA1Esta acci\xF3n es irreversible! \xBFEst\xE1 seguro de continuar?",async()=>{$({titulo:"Comentario",mensaje:"Escribe el motivo por el vas a aplazar la cuota",accion:async m=>{await X(n,r,m)}})})},visible:({entidad:n})=>[g.nuevo,g.editar].includes(V.value)&&!n.pagada},barraDefault:[["bold","italic","strike","underline","subscript","superscript"],["quote","unordered","ordered","outdent","indent"]]}}});const Se={class:"row q-col-gutter-sm q-py-md"},Qe={class:"col-12 col-md-3"},_e={class:"col-12 col-md-3 col-sm-4"},ze={class:"col-12 col-md-3 col-sm-4"},Oe={class:"col-12 col-md-3"},Pe={class:"row items-center justify-end"},Te={class:"col-12"},Le={class:"col-12 col-md-3"},Ne={class:"col-12 col-md-3"},Ie={class:"row items-center justify-end"},Re={class:"col-12 col-md-3"},He={class:"col-12 col-md-3 col-sm-3"},Ge={key:0,class:"col-12"};function Je(e,o,u,V,f,B){const c=C("error-component"),v=C("no-option-component"),k=C("essential-editor"),$=C("essential-table"),D=C("tab-layout-filter-tabs2");return w(),ie(D,{mixin:e.mixin,"configuracion-columnas":e.configuracionColumnas,"titulo-pagina":"Descuentos a Empleados","tab-options":e.tabOptions,"ajustar-celdas":"","tab-defecto":e.tabDefecto,filtrar:e.filtrar},{formulario:l(()=>[s(be,{onSubmit:o[15]||(o[15]=re(()=>{},["prevent"]))},{default:l(()=>[t("div",Se,[t("div",Qe,[o[16]||(o[16]=t("label",{class:"q-mb-sm block"},"Empleado",-1)),s(j,{modelValue:e.descuento.empleado,"onUpdate:modelValue":o[0]||(o[0]=a=>e.descuento.empleado=a),options:e.empleados,"transition-show":"jump-up","transition-hide":"jump-down","options-dense":"",dense:"",outlined:"",disable:e.disabled,error:!!e.v$.empleado.$errors.length,"error-message":"Debes seleccionar un empleado","use-input":"","input-debounce":"0",onFilter:e.filtrarEmpleados,onPopupShow:o[1]||(o[1]=a=>e.ordenarLista(e.empleados,"apellidos")),"option-value":a=>a.id,"option-label":a=>a.nombres+" "+a.apellidos,"emit-value":"","map-options":""},{error:l(()=>[s(c,{clave:"empleado",v$:e.v$},null,8,["v$"])]),"no-option":l(()=>[s(v)]),_:1},8,["modelValue","options","disable","error","onFilter","option-value","option-label"])]),t("div",_e,[o[17]||(o[17]=t("label",{class:"q-mb-sm block"},"Tipo Descuento",-1)),s(j,{modelValue:e.descuento.tipo_descuento,"onUpdate:modelValue":[o[2]||(o[2]=a=>e.descuento.tipo_descuento=a),o[3]||(o[3]=()=>e.descuento.multa=null)],options:e.descuentos_generales,"transition-show":"jump-up","transition-hide":"jump-down","options-dense":"",dense:"",disable:e.disabled,outlined:"","use-input":"","input-debounce":"0","option-value":a=>a.id,"option-label":a=>a.nombre,"emit-value":"","map-options":""},{"no-option":l(()=>[s(v)]),_:1},8,["modelValue","options","disable","option-value","option-label"])]),t("div",ze,[o[18]||(o[18]=t("label",{class:"q-mb-sm block"},"Multa",-1)),s(j,{modelValue:e.descuento.multa,"onUpdate:modelValue":[o[4]||(o[4]=a=>e.descuento.multa=a),o[5]||(o[5]=()=>e.descuento.tipo_descuento=null)],options:e.multas,"transition-show":"jump-up","transition-hide":"jump-down","options-dense":"",dense:"",disable:e.disabled,outlined:"","use-input":"","input-debounce":"0","option-value":a=>a.id,"option-label":a=>a.nombre,"emit-value":"","map-options":""},{"no-option":l(()=>[s(v)]),_:1},8,["modelValue","options","disable","option-value","option-label"])]),t("div",Oe,[o[19]||(o[19]=t("label",{class:"q-mb-sm block"},"Fecha del descuento",-1)),s(y,{modelValue:e.descuento.fecha_descuento,"onUpdate:modelValue":o[7]||(o[7]=a=>e.descuento.fecha_descuento=a),placeholder:"Obligatorio",error:!!e.v$.fecha_descuento.$errors.length,disable:e.disabled,onBlur:e.v$.fecha_descuento.$touch,outlined:"",dense:""},{append:l(()=>[s(P,{name:"event",class:"cursor-pointer"},{default:l(()=>[s(N,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:l(()=>[s(I,{modelValue:e.descuento.fecha_descuento,"onUpdate:modelValue":o[6]||(o[6]=a=>e.descuento.fecha_descuento=a),mask:e.maskFecha,"today-btn":""},{default:l(()=>[t("div",Pe,[T(s(L,{label:"Cerrar",color:"primary",flat:""},null,512),[[R]])])]),_:1},8,["modelValue","mask"])]),_:1})]),_:1})]),error:l(()=>[s(c,{clave:"fecha_descuento",v$:e.v$},null,8,["v$"])]),_:1},8,["modelValue","error","disable","onBlur"])]),t("div",Te,[o[20]||(o[20]=t("div",{class:"row justify-between"},[t("label",{class:"q-mb-sm block"},"Descripci\xF3n")],-1)),s(k,{modelValue:e.descuento.descripcion,"onUpdate:modelValue":o[8]||(o[8]=a=>e.descuento.descripcion=a),disable:e.disabled,"barra-herramientas":e.barraDefault},null,8,["modelValue","disable","barra-herramientas"]),(w(!0),F(de,null,ue(e.v$.descripcion.$errors,a=>(w(),F("div",{key:a.$uid,class:"text-negative text-uppercase"},[t("small",null,ce(a.$message),1)]))),128))]),t("div",Le,[o[21]||(o[21]=t("label",{class:"q-mb-sm block"},"Valor ",-1)),s(y,{modelValue:e.descuento.valor,"onUpdate:modelValue":o[9]||(o[9]=a=>e.descuento.valor=a),placeholder:"Obligatorio",type:"number",disable:e.disabled,error:!!e.v$.valor.$errors.length,onBlur:e.v$.valor.$touch,outlined:"",dense:""},{error:l(()=>[s(c,{clave:"valor",v$:e.v$},null,8,["v$"])]),_:1},8,["modelValue","disable","error","onBlur"])]),t("div",Ne,[o[22]||(o[22]=t("label",{class:"q-mb-sm block"},"Mes inicia cobro",-1)),s(y,{modelValue:e.descuento.mes_inicia_cobro,"onUpdate:modelValue":o[12]||(o[12]=a=>e.descuento.mes_inicia_cobro=a),mask:"####-##",placeholder:"Obligatorio",error:!!e.v$.mes_inicia_cobro.$errors.length,disable:e.disabled,onBlur:e.v$.mes_inicia_cobro.$touch,outlined:"",dense:""},{append:l(()=>[s(P,{name:"event",class:"cursor-pointer"},{default:l(()=>[s(N,{cover:"","transition-show":"scale","transition-hide":"scale",modelValue:e.is_month,"onUpdate:modelValue":o[11]||(o[11]=a=>e.is_month=a)},{default:l(()=>[s(I,{modelValue:e.descuento.mes_inicia_cobro,"onUpdate:modelValue":[o[10]||(o[10]=a=>e.descuento.mes_inicia_cobro=a),e.checkMes],minimal:"",mask:e.maskFecha,"emit-immediately":"","default-view":"Years"},{default:l(()=>[t("div",Ie,[T(s(L,{label:"Cerrar",color:"primary",flat:""},null,512),[[R]])])]),_:1},8,["modelValue","mask","onUpdate:modelValue"])]),_:1},8,["modelValue"])]),_:1})]),error:l(()=>[s(c,{clave:"mes_inicia_cobro",v$:e.v$},null,8,["v$"])]),_:1},8,["modelValue","error","disable","onBlur"])]),t("div",Re,[o[23]||(o[23]=t("label",{class:"q-mb-sm block"},"Cantidad Cuotas ",-1)),s(y,{modelValue:e.descuento.cantidad_cuotas,"onUpdate:modelValue":[o[13]||(o[13]=a=>e.descuento.cantidad_cuotas=a),e.calcularCantidadCuotas],placeholder:"Obligatorio",type:"number",disable:e.accion!==e.acciones.nuevo,error:!!e.v$.cantidad_cuotas.$errors.length,onBlur:e.v$.valor.$touch,outlined:"",dense:""},{error:l(()=>[s(c,{clave:"cantidad_cuotas",v$:e.v$},null,8,["v$"])]),_:1},8,["modelValue","disable","error","onBlur","onUpdate:modelValue"])]),t("div",He,[o[24]||(o[24]=t("label",{class:"q-mb-sm block"},"Pagado",-1)),s(me,{label:e.descuento.pagado?"SI":"NO",modelValue:e.descuento.pagado,"onUpdate:modelValue":o[14]||(o[14]=a=>e.descuento.pagado=a),color:"primary","keep-color":"",icon:"bi-check2-circle","unchecked-icon":"clear",disable:""},null,8,["label","modelValue"])]),e.descuento.cuotas.length>0?(w(),F("div",Ge,[s($,{titulo:"Cuotas a Pagar",datos:e.descuento.cuotas,"configuracion-columnas":e.accion==e.acciones.editar?[...e.configuracionColumnasCuotasDescuento,e.accionesTabla]:e.configuracionColumnasCuotasDescuento,"ajustar-celdas":"","desplegar-desde":3,accion1:e.btnComentarioCuota,accion2:e.btnAplazarCuota,altoFijo:!1,permitirConsultar:!1,permitirEditar:!1,permitirEliminar:!1},null,8,["datos","configuracion-columnas","accion1","accion2"])])):pe("",!0)])]),_:1})]),_:1},8,["mixin","configuracion-columnas","tab-options","tab-defecto","filtrar"])}var No=le(Me,[["render",Je]]);export{No as default};
