var me=Object.defineProperty;var ue=(e,i,r)=>i in e?me(e,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[i]=r;var t=(e,i,r)=>(ue(e,typeof i!="symbol"?i+"":i,r),r);import{Q as q,a as B}from"./QItemSection.c6f2640c.js";import{Q as N}from"./QSelect.a8f2bfb2.js";import{bz as J,t as E,c as pe,u as fe,U as be,e as f,g as Q,ct as ve,a4 as P,s as I,d6 as _e,v as he,x as T,y as d,S as ge,H as s,D as n,a7 as Ve,B as a,z as m,I as _,J as h,M as g,G as U,K as V,F as S,k as z,R as M,L as $e}from"./index.976e8f3c.js";import{Q as O,a as Y,C as R}from"./QPopupProxy.d8ef7a42.js";import{Q as ye}from"./QForm.ed6f6690.js";import{r as $}from"./i18n-validators.06eef631.js";import{u as je}from"./index.ed676411.js";import{T as Ee}from"./TabLayoutFilterTabs2.f1a01a4e.js";import{G as ke}from"./GestorDocumentos.5aa78d49.js";import{S as Ce}from"./EssentialTable.d8e6954a.js";import{C as G}from"./ContenedorSimpleMixin.5a0b06ab.js";import{E as De}from"./entidadAuditable.75a46700.js";import{Q as H,L as we,y as Ae,v as Le}from"./utils.30e08aa2.js";import{A as Fe}from"./Archivo.c26f5472.js";import{T as qe}from"./TipoLicenciaController.e1024ae0.js";import"./QChip.334d746c.js";import"./QMenu.410ae527.js";import"./position-engine.2f1d750c.js";import"./format.8ac60962.js";import"./index.95f5a0db.js";import"./QTabs.3c726b04.js";import"./QResizeObserver.6ec10d95.js";import"./QTabPanels.1c8c4baa.js";import"./touch.9135741d.js";import"./QPage.ed5d79ca.js";import"./EssentialTableTabs.c7e98bba.js";import"./QBadge.1ddeabfd.js";import"./EssentialTablePagination.f449a738.js";import"./QTable.048b8be8.js";import"./use-fullscreen.0ccd26e6.js";import"./QToolbar.cff7174f.js";import"./QBtnGroup.7d0835e4.js";import"./buttonSubmits.2eb37d38.js";import"./QUploader.43bbdad9.js";import"./QCircularProgress.4d1a2735.js";import"./QFile.e27868da.js";import"./_commonjsHelpers.8402d862.js";import"./QImg.e0fb285c.js";import"./VisorImagen.e7965569.js";import"./seleccionContratacionPersonal.utils.e3e1ed3d.js";import"./ErrorComponent.b482e77d.js";const Be=[{name:"justificacion",field:"justificacion",label:"Justificaci\xF3n",align:"left",sortable:!0},{name:"estado_licencia_info",field:"estado_licencia_info",label:"Estado",align:"left",sortable:!0},{name:"fecha_inicio",field:"fecha_inicio",label:"Inicio",align:"left",sortable:!0},{name:"fecha_fin",field:"fecha_fin",label:"Fin",align:"left",sortable:!0},{name:"empleado_info",field:"empleado_info",label:"Empleado",align:"left",sortable:!0}];class Ne extends J{constructor(){super(E.licencia_empleado)}}class Qe extends De{constructor(){super();t(this,"id");t(this,"empleado");t(this,"empleado_info");t(this,"tipo_licencia");t(this,"tipo_licencia_info");t(this,"estado");t(this,"estado_licencia_info");t(this,"fecha_inicio");t(this,"fecha_fin");t(this,"justificacion");t(this,"id_jefe_inmediato");t(this,"jefe_inmediato");t(this,"documento");t(this,"tieneDocumento");t(this,"dias_licencia");this.id=null,this.empleado=null,this.empleado_info=null,this.fecha_inicio=null,this.fecha_fin=null,this.tipo_licencia=null,this.tipo_licencia_info=null,this.estado=null,this.estado_licencia_info=null,this.justificacion=null,this.id_jefe_inmediato=null,this.jefe_inmediato=null,this.documento=null,this.tieneDocumento=null,this.dias_licencia=null}}class Pe extends J{constructor(){super(E.archivo_licencia_empleado)}}var Ie=pe({components:{TabLayoutFilterTabs2:Ee,SelectorImagen:Ce,GestorDocumentos:ke},emits:["cerrar-modal"],setup(e,{emit:i}){const r=new G(Qe,new Ne),k=new G(Fe,new Pe),{entidad:l,disabled:C,accion:b,listadosAuxiliares:p}=r.useReferencias(),{setValidador:o,cargarVista:K,obtenerListados:W,listar:X}=r.useComportamiento(),{onBeforeGuardar:Z,onConsultado:x,onGuardado:ee,onBeforeModificar:ie,onReestablecer:oe}=r.useHooks(),v=fe(),{notificarAdvertencia:ae}=be(),D=f([]),u=f(),w=f(),se=v.esRecursosHumanos;let A="1";const L=f(!1),y=f(!1),ne=Q(()=>v.can("puede.ver.campo.empleado")),le=Q(()=>b.value==="NUEVO");function te(){const c=p.tipos_licencias.filter(j=>j.id==l.tipo_licencia);c[0].num_dias>0?(l.dias_licencia=c[0].num_dias,y.value=!0):(l.dias_licencia=null,l.fecha_fin=null,y.value=!1)}Z(()=>{l.tieneDocumento=u.value.tamanioListado>0,l.tieneDocumento||ae("Debe seleccionar al menos un archivo.")}),ie(()=>{l.tieneDocumento=!0}),ee(c=>{re(c),i("cerrar-modal")}),x(()=>{L.value=v.user.id==l.id_jefe_inmediato,setTimeout(()=>{u.value.listarArchivos({licencia_id:l.id}),u.value.esConsultado=!0},2e3)}),oe(()=>{setTimeout(()=>{u.value.limpiarListado(),u.value.esConsultado=!1},1e3)}),K(async()=>{await W({tipos_licencias:new qe,autorizaciones:{controller:new ve,params:{campos:"id,nombre",es_modulo_rhh:!0,es_jefe_inmediato:v.user.id==l.id_jefe_inmediato}}}),D.value=p.tipos_licencias,w.value=p.autorizaciones});const F=je({tipo_licencia:{required:$},fecha_inicio:{required:$},fecha_fin:{required:$},justificacion:{required:$}},l);o(F.value);async function re(c){await u.value.subir({licencia_id:c})}function ce(c){X({estado:c}),A=c}P(()=>{l.fecha_inicio&&l.dias_licencia&&(l.fecha_fin=H(we(l.fecha_inicio,"DD-MM-YYYY"),0,0,Number(l.dias_licencia),I))});function de(c){const j=H(Le(),0,0,-15,"YYYY/MM/DD");return c>=j}return{removeAccents:Ae,mixin:r,licencia:l,optionsFechaInicio:de,filtrarPermisoEmpleado:ce,watchEffect:P,es_jefe_inmediato:L,esRecursosHumanos:se,esNuevo:le,verEmpleado:ne,refArchivoPrestamoEmpresarial:u,mixinArchivoPrestamoEmpleado:k,endpoint:E.archivo_licencia_empleado,tipos_licencias:D,tiene_dias_licencia:y,obtenerDiasLicencia:te,tabPermisoEmpleado:A,autorizaciones:w,accion:b,maskFecha:I,v$:F,disabled:C,tabOptionsLicencias:_e,configuracionColumnas:Be}}});const Te={class:"row q-col-gutter-sm q-mb-md q-mt-md q-mx-md q-py-sm"},Ue={class:"col-12 col-md-3 q-mb-md"},Se={class:"error-msg"},ze={class:"col-12 col-md-3"},Me={class:"row items-center justify-end"},Oe={class:"error-msg"},Ye={class:"col-12 col-md-3"},Re={class:"row items-center justify-end"},Ge={class:"error-msg"},He={class:"col-12 col-md-3"},Je={class:"error-msg"},Ke={class:"col-12 col-md-3"},We={class:"col-12 col-md-3"},Xe={key:0,class:"col-12 col-md-3"};function Ze(e,i,r,k,l,C){const b=T("gestor-documentos"),p=T("tab-layout-filter-tabs2");return d(),ge(p,{mixin:e.mixin,configuracionColumnas:e.configuracionColumnas,tabOptions:e.tabOptionsLicencias,full:!0,permitirEditar:!e.esRecursosHumanos,permitirEliminar:!1,mostrarButtonSubmits:!0,filtrar:e.filtrarPermisoEmpleado,tabDefecto:e.tabPermisoEmpleado,forzarListar:!0},{formulario:s(()=>[n(ye,{onSubmit:i[9]||(i[9]=Ve(()=>{},["prevent"]))},{default:s(()=>[a("div",Te,[a("div",Ue,[i[11]||(i[11]=a("label",{class:"q-mb-sm block"},"Tipo",-1)),n(N,{modelValue:e.licencia.tipo_licencia,"onUpdate:modelValue":[i[0]||(i[0]=o=>e.licencia.tipo_licencia=o),e.obtenerDiasLicencia],options:e.tipos_licencias,"transition-show":"jump-up","transition-hide":"jump-down",disable:!e.esNuevo,"options-dense":"",dense:"",outlined:"","input-debounce":0,"use-input":"","option-value":o=>o.id,"option-label":o=>o.nombre,"emit-value":"","map-options":""},{error:s(()=>[(d(!0),m(_,null,h(e.v$.tipo_licencia.$errors,o=>(d(),m("div",{key:o.$uid},[a("div",Se,g(o.$message),1)]))),128))]),"no-option":s(()=>[n(q,null,{default:s(()=>[n(B,{class:"text-grey"},{default:s(()=>i[10]||(i[10]=[U(" No hay resultados ")])),_:1})]),_:1})]),_:1},8,["modelValue","options","disable","onUpdate:modelValue","option-value","option-label"])]),a("div",ze,[i[12]||(i[12]=a("label",{class:"q-mb-sm block"},"Fecha Inicio",-1)),n(V,{modelValue:e.licencia.fecha_inicio,"onUpdate:modelValue":i[2]||(i[2]=o=>e.licencia.fecha_inicio=o),placeholder:"Obligatorio",error:!!e.v$.fecha_inicio.$errors.length,disable:!e.esNuevo,onBlur:e.v$.fecha_inicio.$touch,readonly:"",outlined:"",dense:""},{append:s(()=>[n(S,{name:"event",class:"cursor-pointer"},{default:s(()=>[n(O,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:s(()=>[n(Y,{modelValue:e.licencia.fecha_inicio,"onUpdate:modelValue":i[1]||(i[1]=o=>e.licencia.fecha_inicio=o),mask:e.maskFecha,options:e.optionsFechaInicio,"today-btn":""},{default:s(()=>[a("div",Me,[z(n(M,{label:"Cerrar",color:"primary",flat:""},null,512),[[R]])])]),_:1},8,["modelValue","mask","options"])]),_:1})]),_:1})]),error:s(()=>[(d(!0),m(_,null,h(e.v$.fecha_inicio.$errors,o=>(d(),m("div",{key:o.$uid},[a("div",Oe,g(o.$message),1)]))),128))]),_:1},8,["modelValue","error","disable","onBlur"])]),a("div",Ye,[i[13]||(i[13]=a("label",{class:"q-mb-sm block"},"Fecha Fin",-1)),n(V,{modelValue:e.licencia.fecha_fin,"onUpdate:modelValue":i[4]||(i[4]=o=>e.licencia.fecha_fin=o),placeholder:"Obligatorio",error:!!e.v$.fecha_fin.$errors.length,disable:!1,onBlur:e.v$.fecha_fin.$touch,outlined:"",dense:""},{append:s(()=>[n(S,{name:"event",class:"cursor-pointer"},{default:s(()=>[n(O,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:s(()=>[n(Y,{modelValue:e.licencia.fecha_fin,"onUpdate:modelValue":i[3]||(i[3]=o=>e.licencia.fecha_fin=o),mask:e.maskFecha,"today-btn":""},{default:s(()=>[a("div",Re,[z(n(M,{label:"Cerrar",color:"primary",flat:""},null,512),[[R]])])]),_:1},8,["modelValue","mask"])]),_:1})]),_:1})]),error:s(()=>[(d(!0),m(_,null,h(e.v$.fecha_fin.$errors,o=>(d(),m("div",{key:o.$uid},[a("div",Ge,g(o.$message),1)]))),128))]),_:1},8,["modelValue","error","onBlur"]),i[14]||(i[14]=a("div",{class:"q-gutter-md row items-start"},null,-1))]),a("div",He,[i[15]||(i[15]=a("label",{class:"q-mb-sm block"},"Justificativo",-1)),n(V,{modelValue:e.licencia.justificacion,"onUpdate:modelValue":[i[5]||(i[5]=o=>e.licencia.justificacion=o),i[6]||(i[6]=o=>e.licencia.justificacion=e.removeAccents(o))],placeholder:"Obligatorio",disable:!e.esNuevo,error:!!e.v$.justificacion.$errors.length,outlined:"",dense:""},{error:s(()=>[(d(!0),m(_,null,h(e.v$.justificacion.$errors,o=>(d(),m("div",{key:o.$uid},[a("div",Je,g(o.$message),1)]))),128))]),_:1},8,["modelValue","disable","error"])]),a("div",Ke,[i[16]||(i[16]=a("label",{class:"q-mb-sm block"},"Documento",-1)),n(b,{ref:"refArchivoPrestamoEmpresarial",mixin:e.mixinArchivoPrestamoEmpleado,endpoint:e.endpoint,disable:!e.esNuevo,"permitir-eliminar":!1,"listar-al-guardar":!1,esMultiple:!1},null,8,["mixin","endpoint","disable"])]),a("div",We,[i[17]||(i[17]=a("label",{class:"q-mb-sm block"},"Dias de licencia",-1)),n(V,{modelValue:e.licencia.dias_licencia,"onUpdate:modelValue":i[7]||(i[7]=o=>e.licencia.dias_licencia=o),placeholder:"Obligatorio",disable:e.tiene_dias_licencia,onBlur:e.v$.fecha_fin.$touch,outlined:"",dense:""},null,8,["modelValue","disable","onBlur"])]),e.accion=="EDITAR"&&e.es_jefe_inmediato?(d(),m("div",Xe,[i[19]||(i[19]=a("label",{class:"q-mb-sm block"},"Autorizacion",-1)),n(N,{modelValue:e.licencia.estado,"onUpdate:modelValue":i[8]||(i[8]=o=>e.licencia.estado=o),options:e.autorizaciones,"transition-show":"jump-up","transition-hide":"jump-down","options-dense":"",dense:"",outlined:"",disable:e.disabled,readonly:e.disabled,"use-input":"","input-debounce":"0","option-value":o=>o.id,"option-label":o=>o.nombre,"emit-value":"","map-options":""},{"no-option":s(()=>[n(q,null,{default:s(()=>[n(B,{class:"text-grey"},{default:s(()=>i[18]||(i[18]=[U(" No hay resultados ")])),_:1})]),_:1})]),_:1},8,["modelValue","options","disable","readonly","option-value","option-label"])])):$e("",!0)])]),_:1})]),_:1},8,["mixin","configuracionColumnas","tabOptions","permitirEditar","filtrar","tabDefecto"])}var Mi=he(Ie,[["render",Ze]]);export{Mi as default};
