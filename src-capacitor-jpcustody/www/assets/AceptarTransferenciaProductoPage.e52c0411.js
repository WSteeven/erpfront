var ae=Object.defineProperty;var oe=(e,a,s)=>a in e?ae(e,a,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[a]=s;var O=(e,a,s)=>(oe(e,typeof a!="symbol"?a+"":a,s),s);import{Q as ie}from"./QPage.e6f8825d.js";import{T as re,a as te,c as se}from"./TransferenciaProductoEmpleado.0042f841.js";import{j as w,k as ne}from"./tareas.utils.309e0dff.js";import{u as I}from"./transaccionEgreso.e83517ca.js";import{d as N,bd as Q,m as q,u as R,R as le,c as y,a1 as de,bz as ce,c_ as me,_ as U,t as T,v as c,P as _,F as V,z as r,a6 as ue,y as t,x as p,I as u,J as f,O as F,B as j,D as $,K as fe,bh as pe,h as be,p as ge}from"./index.b8e09611.js";import{u as Ce}from"./utils.9344cd7e.js";import{E as ve}from"./EssentialTableTabs.03c27e34.js";import{M as Ve}from"./ModalEntidad.54c9ab3a.js";import{C as Te}from"./ContenedorSimpleMixin.4e22246b.js";import{C as Ee,a as Pe}from"./ComponenteModal.domain.92aacded.js";import{Q as ye}from"./QForm.eab79b48.js";import{u as ke}from"./transferencia.8feb8af3.js";import{u as Se}from"./transaccion.cd27f880.js";import{u as we}from"./pedido.272275e4.js";import{i as S}from"./iconos.5bc406be.js";import{E as qe}from"./EssentialSelectableTable.ac03bc90.js";import{S as _e}from"./SimpleLayout.97ee66fd.js";import{E as Ae}from"./EssentialTable.23af6cc8.js";import{C as De}from"./CalloutComponent.faccc689.js";import"./entidadAuditable.75a46700.js";import"./Transaccion.ef293505.js";import"./format.8ac60962.js";import"./QBadge.89898cd2.js";import"./QTabs.1ee2fae1.js";import"./QResizeObserver.1422c274.js";import"./QSelect.b920278b.js";import"./QChip.f8f308fa.js";import"./QItemSection.ec4cc512.js";import"./QMenu.b3fb639b.js";import"./position-engine.799c9136.js";import"./EssentialTablePagination.ce808cac.js";import"./QTable.c4bfb038.js";import"./use-fullscreen.37810a50.js";import"./QToolbar.afeb6de9.js";import"./QBtnGroup.7d38eecd.js";import"./configuracion_general.1d29d94f.js";import"./ConfiguracionController.a136b041.js";import"./Transferencia.f2b64659.js";import"./buttonSubmits.f2d72caa.js";import"./QFile.c79664c6.js";import"./QPopupProxy.685eacb5.js";import"./_commonjsHelpers.8402d862.js";import"./QImg.95754b62.js";import"./VisorImagen.29457a6f.js";import"./seleccionContratacionPersonal.utils.e3e1ed3d.js";import"./ErrorComponent.3c1fc91c.js";import"./i18n-validators.06abe774.js";import"./index.ea415f98.js";const Be=[{name:"producto",field:"producto",label:"Producto",style:"max-width:300px; overflow: auto;",align:"left",sortable:!0,editable:!1,visible:!0},{name:"descripcion",field:"descripcion",label:"Descripci\xF3n",style:"max-width:300px; overflow: auto;",align:"left",sortable:!0,editable:!1,visible:!0},{name:"categoria",field:"categoria",label:"Categoria",align:"left",sortable:!0,editable:!1,visible:!0},{name:"serial",field:"serial",label:"Serial",align:"left",sortable:!0,editable:!1,visible:!0},{name:"cantidad",field:"cantidad",label:"Cantidad enviada",align:"left",sortable:!1},{name:"recibido",field:"recibido",label:"Cantidad recibida",align:"left",sortable:!1,editable:!1}],ze=[{name:"producto",field:"producto",label:"Producto",style:"max-width:300px; overflow: auto;",align:"left",sortable:!0,editable:!1,visible:!0},{name:"descripcion",field:"descripcion",label:"Descripci\xF3n",style:"max-width:300px; overflow: auto;",align:"left",sortable:!0,editable:!1,visible:!0},{name:"categoria",field:"categoria",label:"Categoria",align:"left",sortable:!0,editable:!1,visible:!0},{name:"serial",field:"serial",label:"Serial",align:"left",sortable:!0,editable:!1,visible:!0},{name:"cantidad",field:"cantidad",label:"Cantidad enviada",align:"left",sortable:!1,editable:!1},{name:"recibido",field:"recibido",label:"Cantidad recibida",align:"left",sortable:!1,editable:!1},{name:"acciones",field:"acciones",label:"Acciones",align:"center"}];var Me=N({components:{SimpleLayout:_e,EssentialTable:Ae,EssentialSelectableTable:qe,CalloutComponent:De},props:{datos:Object},setup(e,{emit:a}){var D,B,z,M;Q().setQuasar(q());const s=R();Se(),I();const C=we(),v=ke(),{entidad:n}=(D=e.datos)==null?void 0:D.mixin.useReferencias(),{consultar:l,editarParcial:m}=(B=e.datos)==null?void 0:B.mixin.useComportamiento(),{onConsultado:b,onBeforeModificar:o}=(z=e.datos)==null?void 0:z.mixin.useHooks(),{notificarError:k,notificarCorrecto:d,confirmar:L,prompt:A}=le(),G=s.esBodeguero,J=s.esCoordinador,H=s.user.roles.filter(i=>i.indexOf("BODEGA")>-1||i.indexOf("COORDINADOR")>-1).length>0;let K=y(!1),W=y(!1),X=y(!1);const Y=de();function Z(){A({titulo:"Aprobar y firmar",mensaje:"Novedades al recibir los productos.",accion:async E=>{try{L("Esta acci\xF3n completar\xE1 la transferencia. \xBFDesea continuar?",async()=>{const P={autorizacion_id:2,novedades_transferencia_recibida:E,listado_productos:n.listado_productos.filter(g=>g.recibido)};await m(n.id,P),d("Transferencia aprobada y firmada correctamente."),a("cerrar-modal",!1),a("guardado","aceptado")})}catch{k("No se pudo aprobar ni firmar la transferencia.")}}})}function x(){n.modificar_recepcion=!n.modificar_recepcion,n.listado_productos.forEach(i=>i.recibido=i.cantidad)}const h={titulo:"Cantidad",icono:S.editar,accion:({entidad:i,posicion:E})=>{const P={titulo:"Confirmaci\xF3n",mensaje:"Ingresa la cantidad",defecto:n.listado_productos[E].recibido,tipo:"number",validacion:g=>!!g&&g>=0&&g<=i.cantidad,accion:g=>n.listado_productos[E].recibido=g};A(P)}},ee={titulo:({entidad:i})=>i.recibido===0?"S\xED se recibi\xF3":"No se recibi\xF3",icono:({entidad:i})=>i.recibido===0?"bi-check":S.cancelar,color:({entidad:i})=>i.recibido===0?"positive":"negative",accion:({entidad:i})=>i.recibido=i.recibido===0?i.cantidad:0};return b(()=>{n.autorizacion==w.VALIDADO&&n.listado_productos.forEach(i=>i.recibido=i.cantidad)}),l(n),{mixin:(M=e.datos)==null?void 0:M.mixin,transferencia:n,acciones:ce,pedidoStore:C,transferenciaStore:v,esVisibleAutorizacion:K,esVisibleTarea:W,requiereFecha:X,configuracionColumnasProductosRecibidos:Be,configuracionColumnasProductosRecibidosParcial:ze,rolSeleccionado:H,esBodeguero:G,esCoordinador:J,permitirModificarCantidades:x,aprobarTransferencia:Z,tabGestionarEgresos:me,route:Y,btnEditarCantidad:h,btnLlego:ee,iconos:S}}});const Oe={class:"row q-col-gutter-sm q-py-lg"},Fe={key:0,class:"col-12 col-md-3"},je={key:1,class:"col-12 col-md-3"},$e={key:2,class:"col-12 col-md-3"},Ie={class:"col-12 col-md-3"},Ne={key:3,class:"col-12 col-md-3"},Qe={key:4,class:"col-12 col-md-3"},Re={class:"col-12 col-md-3"},Ue={class:"col-12 col-md-3"},Le={class:"col-12 col-md-6 q-mb-md"},Ge={class:"col-12"},Je={class:"col-12"},He={key:5,class:"col-12"},Ke={key:6,class:"col-12"},We={key:0,class:"q-pa-md q-gutter-sm flex flex-center"};function Xe(e,a,s,C,v,n){const l=T("callout-component"),m=T("essential-table"),b=T("simple-layout");return c(),_(b,{mixin:e.mixin,mostrarButtonSubmits:!1},{formulario:V(()=>[r(ye,{onSubmit:a[9]||(a[9]=ue(()=>{},["prevent"]))},{default:V(()=>[t("div",Oe,[e.transferencia.id?(c(),p("div",Fe,[a[12]||(a[12]=t("label",{class:"q-mb-sm block"},"Transferencia N\xB0",-1)),r(u,{modelValue:e.transferencia.id,"onUpdate:modelValue":a[0]||(a[0]=o=>e.transferencia.id=o),placeholder:"Obligatorio",disable:"",outlined:"",dense:""},null,8,["modelValue"])])):f("",!0),e.transferencia.created_at?(c(),p("div",je,[a[13]||(a[13]=t("label",{class:"q-mb-sm block"},"Fecha de solicitud",-1)),r(u,{modelValue:e.transferencia.created_at,"onUpdate:modelValue":a[1]||(a[1]=o=>e.transferencia.created_at=o),disable:"",outlined:"",dense:""},null,8,["modelValue"])])):f("",!0),e.transferencia.solicitante?(c(),p("div",$e,[a[14]||(a[14]=t("label",{class:"q-mb-sm block"},"Solicitante",-1)),r(u,{modelValue:e.transferencia.nombre_solicitante,"onUpdate:modelValue":a[2]||(a[2]=o=>e.transferencia.nombre_solicitante=o),dense:"",outlined:"",disable:""},null,8,["modelValue"])])):f("",!0),t("div",Ie,[a[15]||(a[15]=t("label",{class:"q-mb-sm block"},"Cliente",-1)),r(u,{modelValue:e.transferencia.nombre_cliente,"onUpdate:modelValue":a[3]||(a[3]=o=>e.transferencia.nombre_cliente=o),disable:"",outlined:"",dense:""},null,8,["modelValue"])]),e.transferencia.nombre_tarea_origen?(c(),p("div",Ne,[a[16]||(a[16]=t("label",{class:"q-mb-sm block"},"Tarea origen",-1)),r(u,{modelValue:e.transferencia.nombre_tarea_origen,"onUpdate:modelValue":a[4]||(a[4]=o=>e.transferencia.nombre_tarea_origen=o),dense:"",outlined:"",disable:""},null,8,["modelValue"])])):f("",!0),e.transferencia.nombre_tarea_destino?(c(),p("div",Qe,[a[17]||(a[17]=t("label",{class:"q-mb-sm block"},"Tarea destino",-1)),r(u,{modelValue:e.transferencia.nombre_tarea_destino,"onUpdate:modelValue":a[5]||(a[5]=o=>e.transferencia.nombre_tarea_destino=o),dense:"",outlined:"",disable:""},null,8,["modelValue"])])):f("",!0),t("div",Re,[a[18]||(a[18]=t("label",{class:"q-mb-sm block"},"Empleado que env\xEDa",-1)),r(u,{modelValue:e.transferencia.nombre_empleado_origen,"onUpdate:modelValue":a[6]||(a[6]=o=>e.transferencia.nombre_empleado_origen=o),autogrow:"",disable:"",outlined:"",dense:""},null,8,["modelValue"])]),t("div",Ue,[a[19]||(a[19]=t("label",{class:"q-mb-sm block"},"Empleado que recibe",-1)),r(u,{modelValue:e.transferencia.nombre_empleado_destino,"onUpdate:modelValue":a[7]||(a[7]=o=>e.transferencia.nombre_empleado_destino=o),autogrow:"",disable:"",outlined:"",dense:""},null,8,["modelValue"])]),t("div",Le,[a[20]||(a[20]=t("label",{class:"q-mb-sm block"},"Justificaci\xF3n",-1)),r(u,{autogrow:"",modelValue:e.transferencia.justificacion,"onUpdate:modelValue":a[8]||(a[8]=o=>e.transferencia.justificacion=o),placeholder:"Obligatorio",disable:"",outlined:"",dense:""},null,8,["modelValue"])]),t("div",Ge,[e.transferencia.tarea_destino?f("",!0):(c(),_(l,{key:0,mensaje:"Al aceptar la transferencia el material se asignar\xE1 a su stock personal."}))]),t("div",Je,[r(l,{mensaje:"Si un producto no le permite aceptar la transferencia, m\xE1rquelo como <b>no recibido</b>. Para lograrlo primero presione el bot\xF3n <b>Modificar las cantidades recibidas</b>.",tipo:"info"})]),e.transferencia.modificar_recepcion?f("",!0):(c(),p("div",He,[r(m,{titulo:"Productos Seleccionados",configuracionColumnas:e.configuracionColumnasProductosRecibidos,datos:e.transferencia.listado_productos,permitirConsultar:!1,permitirEditar:!1,permitirEliminar:!1,mostrarBotones:!1,permitirBuscar:!1,ajustarCeldas:!0,altoFijo:!1},null,8,["configuracionColumnas","datos"])])),e.transferencia.modificar_recepcion?(c(),p("div",Ke,[r(m,{titulo:"Productos Seleccionados",configuracionColumnas:e.configuracionColumnasProductosRecibidosParcial,datos:e.transferencia.listado_productos,permitirConsultar:!1,permitirEditar:!1,permitirEliminar:!1,mostrarBotones:!1,permitirBuscar:!1,ajustarCeldas:!0,altoFijo:!1,accion1:e.btnEditarCantidad,accion2:e.btnLlego},null,8,["configuracionColumnas","datos","accion1","accion2"])])):f("",!0)])]),_:1}),e.transferencia.autorizacion===4?(c(),p("div",We,[r(F,{color:"positive",onClick:a[10]||(a[10]=o=>e.aprobarTransferencia()),"no-caps":"",glossy:"",push:""},{default:V(()=>[r(j,{name:"bi-check-circle",size:"xs",class:"q-mr-sm"}),a[21]||(a[21]=$(" Aprobar"))]),_:1}),r(F,{color:e.transferencia.modificar_recepcion?"negative":"amber-8",onClick:a[11]||(a[11]=o=>e.permitirModificarCantidades()),"no-caps":"",glossy:"",push:""},{default:V(()=>[r(j,{name:e.iconos.editar,size:"xs",class:"q-mr-sm"},null,8,["name"]),$(" "+fe(e.transferencia.modificar_recepcion?"Cancelar modificaci\xF3n de las cantidades recibidas":"Modificar las cantidades recibidas"),1)]),_:1},8,["color"])])):f("",!0)]),_:1},8,["mixin"])}var Ye=U(Me,[["render",Xe]]);class Ze{constructor(){O(this,"VisualizarTransferenciaProductoPage");this.VisualizarTransferenciaProductoPage=pe(new Ee("Aceptar transferencia de productos",Ye))}}class xe extends Pe{constructor(){super(new Ze)}}var he=N({name:"aceptar_transferencia_producto",components:{EssentialTableTabs:ve,ModalEntidad:Ve},setup(){const e=R();Q().setQuasar(q()),Ce().setQuasar(q()),I();const a=new xe,s=new Te(re,new te),{entidad:C,listado:v}=s.useReferencias(),{listar:n}=s.useComportamiento(),l=y(w.VALIDADO);function m(d){l.value=d,n({autorizacion_id:d,empleado_destino_id:e.user.id,filtrar:!0})}const b={titulo:"Visualizar para aceptar",icono:"bi-eye",color:"primary",accion:async({entidad:d})=>{C.id=d.id,a.abrirModalEntidad("VisualizarTransferenciaProductoPage",{mixin:s})}},o={titulo:"Imprimir",color:"positive",icono:"bi-printer",accion:async({entidad:d})=>n({export:"pdf",id:d.id,titulo:"Tranferencia #"+d.id})};function k(d){d=="aceptado"&&(l.value=w.VALIDADO,m(l.value))}return be(()=>m(l.value)),{mixin:s,listado:v,configuracionColumnas:se,guardado:k,tabOptionsAceptarTransferenciasProductos:ne,tabDefecto:l,filtrarTabs:m,botonVerTransaccion:b,accionesTabla:ge,modales:a,botonImprimir:o}}});function ea(e,a,s,C,v,n){const l=T("essential-table-tabs"),m=T("modal-entidad");return c(),_(ie,{padding:""},{default:V(()=>[a[1]||(a[1]=t("div",{class:"text-h5 text-bold q-mb-md"}," Aceptar transferencia de productos ",-1)),r(l,{titulo:"Transferencias realizadas",configuracionColumnas:[...e.configuracionColumnas,e.accionesTabla],datos:e.listado,permitirConsultar:!1,permitirEditar:!1,permitirEliminar:!1,"tab-options":e.tabOptionsAceptarTransferenciasProductos,mostrarFooter:!1,onTabSeleccionado:e.filtrarTabs,accion1:e.botonVerTransaccion,accion2:e.botonImprimir,ajustarCeldas:!0,tabDefecto:e.tabDefecto,class:"borde custom-shadow rounded"},null,8,["configuracionColumnas","datos","tab-options","onTabSeleccionado","accion1","accion2","tabDefecto"]),r(m,{comportamiento:e.modales,persistente:!1,mostrarListado:!1,onGuardado:a[0]||(a[0]=b=>e.guardado(b))},null,8,["comportamiento"])]),_:1})}var Ya=U(he,[["render",ea]]);export{Ya as default};
