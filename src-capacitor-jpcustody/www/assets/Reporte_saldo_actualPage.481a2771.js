var eo=Object.defineProperty;var so=(o,e,n)=>e in o?eo(o,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):o[e]=n;var $=(o,e,n)=>(so(o,typeof e!="symbol"?e+"":e,n),n);import{bx as D,s as w,d as ao,bc as ro,m as L,u as lo,R as to,c as y,$ as io,E as I,dp as no,A as uo,bG as U,_ as po,v as i,P as R,F as r,z as a,bd as mo,be as q,y as c,x as u,G as B,H as N,K as k,D as v,J as b,a7 as co,L as T,Q as fo,c9 as vo,O as S,B as V}from"./index.2ef7a81a.js";import{Q as z,a as F}from"./QItemSection.3a5d4c83.js";import{Q as O}from"./QSelect.69d1b992.js";import{Q as bo}from"./QChip.c5c0b225.js";import{Q as go}from"./QPage.2bc1c297.js";import{T as yo}from"./TabLayout.5bc8ab45.js";import{u as Co}from"./index.e8d8fb1e.js";import{C as _o}from"./ContenedorSimpleMixin.617817a8.js";import{u as wo,V as $o,A as j,i as ko,n as So}from"./utils.a862dc08.js";import{E as Vo}from"./entidadAuditable.75a46700.js";import"./QMenu.f50512a6.js";import"./position-engine.093dda28.js";import"./format.8ac60962.js";import"./QTabs.5cdabeb1.js";import"./QResizeObserver.8bc492d6.js";import"./QTabPanels.7f1e5320.js";import"./touch.9135741d.js";import"./QPopupProxy.567210a4.js";import"./buttonSubmits.35676009.js";import"./EssentialTable.f528a579.js";import"./QFile.f5c4066f.js";import"./QToolbar.ff7ff7d8.js";import"./use-fullscreen.a336d1b1.js";import"./QBadge.ebf9f349.js";import"./_commonjsHelpers.8402d862.js";import"./QImg.9c11306d.js";import"./VisorImagen.12af3936.js";import"./seleccionContratacionPersonal.utils.e3e1ed3d.js";import"./ErrorComponent.94e1365a.js";import"./i18n-validators.46fc4c83.js";import"./index.e1f41ef1.js";import"./EssentialTablePagination.73d42aee.js";class Qo extends Vo{constructor(){super();$(this,"usuario");$(this,"saldo_anterior");this.usuario=null,this.saldo_anterior=0}}class Ao extends D{constructor(){super(w.reporte_saldo_actual_pdf)}}class Eo extends D{constructor(){super(w.cortar_saldo)}}var Lo=ao({components:{TabLayout:yo},setup(){ro().setQuasar(L()),wo().setQuasar(L());const o=lo(),e=to(),n=new _o(Qo,new Ao),C=y(!1),{entidad:d,disabled:Q,accion:s,listadosAuxiliares:f}=n.useReferencias(),{setValidador:P,obtenerListados:G,cargarVista:H}=n.useComportamiento(),M=io(),A=Co({usuario:{required:!0,minLength:3,maxLength:50}},d);P(A.value);const g=y(),_=y(),J=y("false"),K=y("false");H(async()=>{await G({usuarios:{controller:new I,params:{estado:1}},usuariosInactivos:{controller:new I,params:{estado:0}}}),g.value=$o(f.usuarios),f.usuarios=g.value,_.value=f.usuariosInactivos});function W(l,t){if(l===""){t(()=>{g.value=f.usuarios});return}t(()=>{const p=l.toLowerCase();g.value=f.usuarios.filter(m=>m.nombres.toLowerCase().indexOf(p)>-1||m.apellidos.toLowerCase().indexOf(p)>-1)})}function X(l,t){if(l===""){t(()=>{_.value=f.usuariosInactivos});return}t(()=>{const p=l.toLowerCase();_.value=f.usuariosInactivos.filter(m=>m.nombres.toLowerCase().indexOf(p)>-1||m.apellidos.toLowerCase().indexOf(p)>-1)})}function Y(){d.usuario=null}async function Z(l,t){const p=uo.getInstance(),m="reporte_saldo_actual"+new Date().getTime();switch(t){case"excel":const h=U.URL_BASE+"/"+p.getEndpoint(w.reporte_saldo_actual_excel);j(h,"POST","blob","xlsx",m,l);break;case"pdf":const oo=U.URL_BASE+"/"+p.getEndpoint(w.reporte_saldo_actual_pdf);j(oo,"POST","blob","pdf",m,l);break}}o.can("puede.buscar.saldo.usuarios")==!1&&(d.usuario=o.user.id,C.value=!0,E());async function E(){const l=new no;if(d.usuario){const{response:t}=await l.consultar(d.usuario);C.value=!0,d.saldo_anterior=t.data.saldo_actual}}async function x(){try{await new Eo().listar(),M.push("acreditacion-semana")}catch(l){if(ko(l)){const t=l.erroresValidacion;await So(t,e)}}}return{mixin:n,store:o,reporte_saldo_actual:d,cortar_saldo:x,saldoAnterior:E,disabled:Q,accion:s,v$:A,usuarios:g,usuariosInactivos:_,is_all_users:J,is_inactivo:K,mostrarUsuarios:Y,generar_reporte:Z,filtrarUsuarios:W,filtrarUsuariosInactivos:X,visualizar_saldo_usuario:C}}});const Io={key:0,class:"col-12 col-md-3"},Uo={class:"error-msg"},Ro={key:1,class:"col-12 col-md-3"},qo={class:"error-msg"},Bo={key:2,class:"col-12 col-md-3"},No={key:3,class:"col-12 col-md-3"},To={key:4,class:"col-12 col-md-3"};function zo(o,e,n,C,d,Q){return i(),R(go,{class:"flex flex-center"},{default:r(()=>[a(mo,{flat:"",bordered:"",class:"my-card bg-grey-1"},{default:r(()=>[a(q,null,{default:r(()=>e[10]||(e[10]=[c("div",{class:"row items-center no-wrap"},[c("div",{class:"col"},[c("div",{class:"text-h6"},"Generar Reporte Saldo Actual")])],-1)])),_:1}),a(q,null,{default:r(()=>[o.is_all_users=="false"&&o.store.can("puede.buscar.saldo.usuarios")&&o.is_inactivo=="false"?(i(),u("div",Io,[e[12]||(e[12]=c("label",{class:"q-mb-sm block"},"Empleado",-1)),a(O,{modelValue:o.reporte_saldo_actual.usuario,"onUpdate:modelValue":[e[0]||(e[0]=s=>o.reporte_saldo_actual.usuario=s),e[1]||(e[1]=s=>o.saldoAnterior())],options:o.usuarios,"transition-show":"jump-up","transition-hide":"jump-down","options-dense":"",dense:"",outlined:"",disable:o.disabled,readonly:o.disabled,error:!!o.v$.usuario.$errors.length,"error-message":"Debes seleccionar un empleado","use-input":"","input-debounce":"0",onFilter:o.filtrarUsuarios,"option-value":s=>s.id,"option-label":s=>s.nombres+" "+s.apellidos,"emit-value":"","map-options":""},{error:r(()=>[(i(!0),u(B,null,N(o.v$.usuario.$errors,s=>(i(),u("div",{key:s.$uid},[c("div",Uo,k(s.$message),1)]))),128))]),"no-option":r(()=>[a(z,null,{default:r(()=>[a(F,{class:"text-grey"},{default:r(()=>e[11]||(e[11]=[v(" No hay resultados ")])),_:1})]),_:1})]),_:1},8,["modelValue","options","disable","readonly","error","onFilter","option-value","option-label"])])):b("",!0),o.is_all_users=="false"&&o.store.can("puede.buscar.saldo.usuarios")&&o.is_inactivo=="true"?(i(),u("div",Ro,[e[14]||(e[14]=c("label",{class:"q-mb-sm block"},"Empleado",-1)),a(O,{modelValue:o.reporte_saldo_actual.usuario,"onUpdate:modelValue":[e[2]||(e[2]=s=>o.reporte_saldo_actual.usuario=s),e[3]||(e[3]=s=>o.saldoAnterior())],options:o.usuariosInactivos,"transition-show":"jump-up","transition-hide":"jump-down","options-dense":"",dense:"",outlined:"",disable:o.disabled,readonly:o.disabled,error:!!o.v$.usuario.$errors.length,"error-message":"Debes seleccionar un empleado","use-input":"","input-debounce":"0",onFilter:o.filtrarUsuariosInactivos,"option-value":s=>s.id,"option-label":s=>s.nombres+" "+s.apellidos,"emit-value":"","map-options":""},{error:r(()=>[(i(!0),u(B,null,N(o.v$.usuario.$errors,s=>(i(),u("div",{key:s.$uid},[c("div",qo,k(s.$message),1)]))),128))]),"no-option":r(()=>[a(z,null,{default:r(()=>[a(F,{class:"text-grey"},{default:r(()=>e[13]||(e[13]=[v(" No hay resultados ")])),_:1})]),_:1})]),_:1},8,["modelValue","options","disable","readonly","error","onFilter","option-value","option-label"])])):b("",!0),o.visualizar_saldo_usuario==!0&&o.is_all_users=="false"?(i(),u("div",Bo,[e[15]||(e[15]=c("label",{class:"q-mb-sm block"},"Saldo:",-1)),a(bo,{square:""},{default:r(()=>[a(co,{icon:"bi-currency-dollar",color:"green","text-color":"white"}),v(" "+k(o.reporte_saldo_actual.saldo_anterior),1)]),_:1})])):b("",!0),o.store.can("puede.buscar.saldo.usuarios")?(i(),u("div",No,[a(T,{modelValue:o.is_all_users,"onUpdate:modelValue":[e[4]||(e[4]=s=>o.is_all_users=s),e[5]||(e[5]=s=>o.mostrarUsuarios())],color:"secondary",label:"Todos los empleados","true-value":"true","false-value":"false"},null,8,["modelValue"])])):b("",!0),o.store.can("puede.buscar.saldo.usuarios")?(i(),u("div",To,[a(T,{modelValue:o.is_inactivo,"onUpdate:modelValue":e[6]||(e[6]=s=>o.is_inactivo=s),color:"secondary",label:"Inactivo","true-value":"true","false-value":"false"},null,8,["modelValue"])])):b("",!0)]),_:1}),a(fo),a(vo,{align:"around"},{default:r(()=>[a(S,{color:"positive",onClick:e[7]||(e[7]=s=>o.generar_reporte(o.reporte_saldo_actual,"excel"))},{default:r(()=>[a(V,{name:"bi-file-earmark-excel-fill",size:"xs",class:"q-mr-sm"}),e[16]||(e[16]=v("Excel"))]),_:1}),a(S,{color:"negative",onClick:e[8]||(e[8]=s=>o.generar_reporte(o.reporte_saldo_actual,"pdf"))},{default:r(()=>[a(V,{name:"bi-file-earmark-pdf-fill",size:"xs",class:"q-mr-sm"}),e[17]||(e[17]=v("PDF"))]),_:1}),o.store.can("puede.ver.acreditacion_semana")?(i(),R(S,{key:0,color:"warning",onClick:e[9]||(e[9]=s=>o.cortar_saldo())},{default:r(()=>[a(V,{name:"bi-scissors",size:"xs",class:"q-mr-sm"}),e[18]||(e[18]=v("Cortar Saldo "))]),_:1})):b("",!0)]),_:1})]),_:1})]),_:1})}var ye=po(Lo,[["render",zo]]);export{ye as default};
