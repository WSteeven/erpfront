var O=Object.defineProperty;var R=(a,o,r)=>o in a?O(a,o,{enumerable:!0,configurable:!0,writable:!0,value:r}):a[o]=r;var E=(a,o,r)=>(R(a,typeof o!="symbol"?o+"":o,r),r);import{Q as $}from"./QPage.2bc1c297.js";import{bx as k,s as Q,bg as L,d as x,c as n,bc as U,m as w,u as j,df as i,dg as J,p as K,E as H,by as G,_ as W,t as h,v as z,P as X,F as Z,y as u,D as y,K as A,x as aa,J as ea,a4 as oa,z as M}from"./index.2ef7a81a.js";import{M as ta}from"./ModalEntidad.be40edc8.js";import{C as ra}from"./ConfirmarDialog.681cf174.js";import{E as sa}from"./EssentialTableTabs.3fb37590.js";import{C as ia}from"./ContenedorSimpleMixin.617817a8.js";import{G as na}from"./Gasto.2c5038cc.js";import{S as la,u as ca,P as ua}from"./utils.a862dc08.js";import{C as ma,a as da}from"./ComponenteModal.domain.57cc3867.js";import{V as pa}from"./VisualizarGastoPage.7f3a96b1.js";import{u as fa}from"./fondo_rotativo.380fa482.js";import{V as ba}from"./VehiculoController.cda17fd9.js";import{P as ga}from"./ProyectoController.03d7427c.js";import{T as _a}from"./TareaController.f1ef1787.js";import"./QToolbar.ff7ff7d8.js";import"./position-engine.093dda28.js";import"./configuracion_general.ca1e935d.js";import"./ConfiguracionController.337fc7d3.js";import"./EssentialTable.f528a579.js";import"./QSelect.69d1b992.js";import"./QChip.c5c0b225.js";import"./QItemSection.3a5d4c83.js";import"./QMenu.f50512a6.js";import"./format.8ac60962.js";import"./QFile.f5c4066f.js";import"./use-fullscreen.a336d1b1.js";import"./QBadge.ebf9f349.js";import"./QPopupProxy.567210a4.js";import"./_commonjsHelpers.8402d862.js";import"./QImg.9c11306d.js";import"./VisorImagen.12af3936.js";import"./seleccionContratacionPersonal.utils.e3e1ed3d.js";import"./ErrorComponent.94e1365a.js";import"./i18n-validators.46fc4c83.js";import"./index.e1f41ef1.js";import"./QTabs.5cdabeb1.js";import"./QResizeObserver.8bc492d6.js";import"./EssentialTablePagination.73d42aee.js";import"./entidadAuditable.75a46700.js";import"./QForm.e1af9500.js";import"./TabLayout.5bc8ab45.js";import"./QTabPanels.7f1e5320.js";import"./touch.9135741d.js";import"./buttonSubmits.35676009.js";import"./index.e8d8fb1e.js";import"./configuracionColumnasGasto.bbc5ae20.js";import"./GastoPusherEvent.368e989e.js";import"./notificationRealtime.d61aeff8.js";import"./AprobarGastoController.ce444993.js";import"./GastoController.ef00e52d.js";const va=[{name:"id",field:"id",label:"Id",align:"left",sortable:!0},{name:"fecha_viat",field:"fecha_viat",label:"Fecha",align:"left",sortable:!0},{name:"tarea_info",field:"tarea_info",label:"Tarea",align:"left",sortable:!0},{name:"tarea_cliente",field:"tarea_cliente",label:"Tarea cliente",align:"left",sortable:!0},{name:"factura",field:"factura",label:"#Factura",align:"left",sortable:!0},{name:"num_comprobante",field:"num_comprobante",label:"#Comprobante",align:"left",sortable:!0},{name:"ruc",field:"ruc",label:"RUC.",align:"left",sortable:!0},{name:"aut_especial_user",field:"aut_especial_user",label:"Autorizaci\xF3n Especial",align:"left",sortable:!0},{name:"empleado_info",field:"empleado_info",label:"Empleado",align:"left",sortable:!0},{name:"detalle_info",field:"detalle_info",label:"Detalle",align:"left",sortable:!0},{name:"sub_detalle_info",field:"sub_detalle_info",label:"SubDetalle",align:"left",sortable:!0},{name:"centro_costo",field:"centro_costo",label:"Centro de Costo",align:"left",sortable:!0},{name:"subcentro_costo",field:"subcentro_costo",label:"Sub Centro de Costo",align:"left",sortable:!0},{name:"estado_info",field:"estado_info",label:"Estado	",align:"left",sortable:!0},{name:"detalle_estado",field:"detalle_estado",label:"Descripcion",align:"left",sortable:!0},{name:"created_at",field:"created_at",label:"Fecha de Creaci\xF3n",align:"left",sortable:!0}];class P extends k{constructor(){super(Q.autorizaciones_gastos)}}class Ca{constructor(){E(this,"VisualizarGastoPage");this.VisualizarGastoPage=L(new ma("Gastos",pa))}}class Da extends da{constructor(){super(new Ca)}}var Ea=x({name:"AutorizarGastoPage",components:{EssentialTableTabs:sa,ConfirmarDialog:ra,ModalEntidad:ta},setup(){const a=new P,o=n(),r=new ia(na,a),{listado:p}=r.useReferencias(),s=new la;U().setQuasar(w()),ca().setQuasar(w());const l=j(),t=fa(),m=n([]),c=n([]),g=n([]),_=n([]),S=new P;async function f(e){s.activar();const{result:d}=await S.listar({estado:e});p.value=d,o.value=e,s.desactivar()}async function T(){m.value=(await new ba().listar({campos:"id,placa"})).result,c.value=(await new H().listar({estado:1})).result}async function N(e){s.activar(),g.value=(await new ga().listar({campos:"id,nombre,codigo_proyecto",finalizado:0,empleado_id:e})).result,_.value=(await new _a().listar({campos:"id,codigo_tarea,titulo,cliente_id,proyecto_id",empleado_id:e,activas_empleado:1,formulario:!0})).result,s.desactivar()}f(i.PENDIENTE),T();const v=new Da,V=n(),F={titulo:"Consultar",icono:"bi-eye",color:"indigo",accion:async({entidad:e})=>{s.activar(),t.gasto=e,t.vehiculos=m.value,t.empleados=c.value,t.habilitar_observacion_autorizador=l.user.id===e.aut_especial&&[i.PENDIENTE,i.APROBADO].includes(e.estado)&&q(e.fecha_viat),t.accion_form=l.user.id===e.aut_especial&&e.estado===i.PENDIENTE?G.editar:G.consultar,e.estado===i.PENDIENTE&&await N(e.id_usuario),t.proyectos=g.value,t.tareas=_.value,v.abrirModalEntidad("VisualizarGastoPage"),s.desactivar()}};function q(e){const d=new Date,C=new Date(d.getFullYear(),d.getMonth(),1),b=new Date(C);b.setDate(C.getDate()-1);const Y=new Date(b.getFullYear(),b.getMonth(),1),I=new Date(new Date().getFullYear(),new Date().getMonth()+1,0),D=ua(e,"YYYY-MM-DD","America/Guayaquil");return D>=Y&&D<=I||l.esAdministrador}async function B(){f(i.PENDIENTE)}return{configuracionColumnasAutorizarGasto:va,listado:p,estadosGastos:i,tabAutorizarGasto:J,botonVerModalGasto:F,accionesTabla:K,estaSemanAC:V,guardado:B,filtrarAutorizacionesGasto:f,authenticationStore:l,modales:v}}});const wa={class:"text-center q-pb-md"},Ga={class:"q-my-md"},ha={key:0,class:"q-mb-md"};function za(a,o,r,p,s,l){const t=h("essential-table-tabs"),m=h("modal-entidad");return z(),X($,{padding:!a.$q.screen.xs},{default:Z(()=>{var c;return[u("div",wa,[u("div",Ga,[o[0]||(o[0]=y(" Bienvenido, ")),u("strong",null,A(a.authenticationStore.nombreUsuario),1)]),(c=a.authenticationStore.user)!=null&&c.grupo?(z(),aa("div",ha,[o[1]||(o[1]=y(" Grupo, ")),u("strong",null,A(a.authenticationStore.user.grupo),1)])):ea("",!0)]),u("div",{class:oa([{"bg-desenfoque rounded q-pa-sm":a.$q.screen.xs},"borde custom-shadow rounded"])},[M(t,{configuracionColumnas:[...a.configuracionColumnasAutorizarGasto,a.accionesTabla],datos:a.listado,accion1:a.botonVerModalGasto,permitirConsultar:!1,permitirEditar:!1,permitirEliminar:!1,permitirBuscar:!0,"mostrar-botones":!1,"tab-options":a.tabAutorizarGasto,onTabSeleccionado:a.filtrarAutorizacionesGasto,tabDefecto:"3",ajustarCeldas:""},null,8,["configuracionColumnas","datos","accion1","tab-options","onTabSeleccionado"])],2),M(m,{comportamiento:a.modales,onGuardado:a.guardado,mostrarListado:!1},null,8,["comportamiento","onGuardado"])]}),_:1},8,["padding"])}var Ge=W(Ea,[["render",za]]);export{Ge as default};
