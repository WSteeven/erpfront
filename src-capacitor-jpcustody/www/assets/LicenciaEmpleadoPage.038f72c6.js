var me=Object.defineProperty;var ue=(e,i,r)=>i in e?me(e,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[i]=r;var t=(e,i,r)=>(ue(e,typeof i!="symbol"?i+"":i,r),r);import{Q as L,a as B}from"./QItemSection.3a5d4c83.js";import{Q as N}from"./QSelect.69d1b992.js";import{bx as J,s as E,d as pe,u as fe,R as be,c as f,f as P,cs as ve,a2 as Q,q as I,d5 as _e,_ as he,t as T,v as d,P as ge,F as s,z as n,a5 as Ve,y as a,x as m,G as _,H as h,K as g,D as O,I as V,B as U,j as S,O as z,J as $e}from"./index.2ef7a81a.js";import{Q as M,a as Y,C as R}from"./QPopupProxy.567210a4.js";import{Q as ye}from"./QForm.e1af9500.js";import{r as $}from"./i18n-validators.46fc4c83.js";import{u as je}from"./index.e8d8fb1e.js";import{T as Ee}from"./TabLayoutFilterTabs2.2c3270e4.js";import{G as Ce}from"./GestorDocumentos.59b3d278.js";import{S as ke}from"./EssentialTable.f528a579.js";import{C as G}from"./ContenedorSimpleMixin.617817a8.js";import{E as De}from"./entidadAuditable.75a46700.js";import{Q as H,L as we,y as Ae,v as qe}from"./utils.a862dc08.js";import{A as Fe}from"./Archivo.c26f5472.js";import{T as Le}from"./TipoLicenciaController.a819b0a1.js";import"./QChip.c5c0b225.js";import"./QMenu.f50512a6.js";import"./position-engine.093dda28.js";import"./format.8ac60962.js";import"./index.e1f41ef1.js";import"./QTabs.5cdabeb1.js";import"./QResizeObserver.8bc492d6.js";import"./QTabPanels.7f1e5320.js";import"./touch.9135741d.js";import"./QPage.2bc1c297.js";import"./EssentialTableTabs.3fb37590.js";import"./QBadge.ebf9f349.js";import"./EssentialTablePagination.73d42aee.js";import"./QToolbar.ff7ff7d8.js";import"./use-fullscreen.a336d1b1.js";import"./buttonSubmits.35676009.js";import"./QUploader.6e8b7051.js";import"./QCircularProgress.f92822f9.js";import"./QFile.f5c4066f.js";import"./_commonjsHelpers.8402d862.js";import"./QImg.9c11306d.js";import"./VisorImagen.12af3936.js";import"./seleccionContratacionPersonal.utils.e3e1ed3d.js";import"./ErrorComponent.94e1365a.js";const Be=[{name:"justificacion",field:"justificacion",label:"Justificaci\xF3n",align:"left",sortable:!0},{name:"estado_licencia_info",field:"estado_licencia_info",label:"Estado",align:"left",sortable:!0},{name:"fecha_inicio",field:"fecha_inicio",label:"Inicio",align:"left",sortable:!0},{name:"fecha_fin",field:"fecha_fin",label:"Fin",align:"left",sortable:!0},{name:"empleado_info",field:"empleado_info",label:"Empleado",align:"left",sortable:!0}];class Ne extends J{constructor(){super(E.licencia_empleado)}}class Pe extends De{constructor(){super();t(this,"id");t(this,"empleado");t(this,"empleado_info");t(this,"tipo_licencia");t(this,"tipo_licencia_info");t(this,"estado");t(this,"estado_licencia_info");t(this,"fecha_inicio");t(this,"fecha_fin");t(this,"justificacion");t(this,"id_jefe_inmediato");t(this,"jefe_inmediato");t(this,"documento");t(this,"tieneDocumento");t(this,"dias_licencia");this.id=null,this.empleado=null,this.empleado_info=null,this.fecha_inicio=null,this.fecha_fin=null,this.tipo_licencia=null,this.tipo_licencia_info=null,this.estado=null,this.estado_licencia_info=null,this.justificacion=null,this.id_jefe_inmediato=null,this.jefe_inmediato=null,this.documento=null,this.tieneDocumento=null,this.dias_licencia=null}}class Qe extends J{constructor(){super(E.archivo_licencia_empleado)}}var Ie=pe({components:{TabLayoutFilterTabs2:Ee,SelectorImagen:ke,GestorDocumentos:Ce},emits:["cerrar-modal"],setup(e,{emit:i}){const r=new G(Pe,new Ne),C=new G(Fe,new Qe),{entidad:l,disabled:k,accion:b,listadosAuxiliares:p}=r.useReferencias(),{setValidador:o,cargarVista:K,obtenerListados:W,listar:X}=r.useComportamiento(),{onBeforeGuardar:Z,onConsultado:x,onGuardado:ee,onBeforeModificar:ie,onReestablecer:oe}=r.useHooks(),v=fe(),{notificarAdvertencia:ae}=be(),D=f([]),u=f(),w=f(),se=v.esRecursosHumanos;let A="1";const q=f(!1),y=f(!1),ne=P(()=>v.can("puede.ver.campo.empleado")),le=P(()=>b.value==="NUEVO");function te(){const c=p.tipos_licencias.filter(j=>j.id==l.tipo_licencia);c[0].num_dias>0?(l.dias_licencia=c[0].num_dias,y.value=!0):(l.dias_licencia=null,l.fecha_fin=null,y.value=!1)}Z(()=>{l.tieneDocumento=u.value.tamanioListado>0,l.tieneDocumento||ae("Debe seleccionar al menos un archivo.")}),ie(()=>{l.tieneDocumento=!0}),ee(c=>{re(c),i("cerrar-modal")}),x(()=>{q.value=v.user.id==l.id_jefe_inmediato,setTimeout(()=>{u.value.listarArchivos({licencia_id:l.id}),u.value.esConsultado=!0},2e3)}),oe(()=>{setTimeout(()=>{u.value.limpiarListado(),u.value.esConsultado=!1},1e3)}),K(async()=>{await W({tipos_licencias:new Le,autorizaciones:{controller:new ve,params:{campos:"id,nombre",es_modulo_rhh:!0,es_jefe_inmediato:v.user.id==l.id_jefe_inmediato}}}),D.value=p.tipos_licencias,w.value=p.autorizaciones});const F=je({tipo_licencia:{required:$},fecha_inicio:{required:$},fecha_fin:{required:$},justificacion:{required:$}},l);o(F.value);async function re(c){await u.value.subir({licencia_id:c})}function ce(c){X({estado:c}),A=c}Q(()=>{l.fecha_inicio&&l.dias_licencia&&(l.fecha_fin=H(we(l.fecha_inicio,"DD-MM-YYYY"),0,0,Number(l.dias_licencia),I))});function de(c){const j=H(qe(),0,0,-15,"YYYY/MM/DD");return c>=j}return{removeAccents:Ae,mixin:r,licencia:l,optionsFechaInicio:de,filtrarPermisoEmpleado:ce,watchEffect:Q,es_jefe_inmediato:q,esRecursosHumanos:se,esNuevo:le,verEmpleado:ne,refArchivoPrestamoEmpresarial:u,mixinArchivoPrestamoEmpleado:C,endpoint:E.archivo_licencia_empleado,tipos_licencias:D,tiene_dias_licencia:y,obtenerDiasLicencia:te,tabPermisoEmpleado:A,autorizaciones:w,accion:b,maskFecha:I,v$:F,disabled:k,tabOptionsLicencias:_e,configuracionColumnas:Be}}});const Te={class:"row q-col-gutter-sm q-mb-md q-mt-md q-mx-md q-py-sm"},Oe={class:"col-12 col-md-3 q-mb-md"},Ue={class:"error-msg"},Se={class:"col-12 col-md-3"},ze={class:"row items-center justify-end"},Me={class:"error-msg"},Ye={class:"col-12 col-md-3"},Re={class:"row items-center justify-end"},Ge={class:"error-msg"},He={class:"col-12 col-md-3"},Je={class:"error-msg"},Ke={class:"col-12 col-md-3"},We={class:"col-12 col-md-3"},Xe={key:0,class:"col-12 col-md-3"};function Ze(e,i,r,C,l,k){const b=T("gestor-documentos"),p=T("tab-layout-filter-tabs2");return d(),ge(p,{mixin:e.mixin,configuracionColumnas:e.configuracionColumnas,tabOptions:e.tabOptionsLicencias,full:!0,permitirEditar:!e.esRecursosHumanos,permitirEliminar:!1,mostrarButtonSubmits:!0,filtrar:e.filtrarPermisoEmpleado,tabDefecto:e.tabPermisoEmpleado,forzarListar:!0},{formulario:s(()=>[n(ye,{onSubmit:i[9]||(i[9]=Ve(()=>{},["prevent"]))},{default:s(()=>[a("div",Te,[a("div",Oe,[i[11]||(i[11]=a("label",{class:"q-mb-sm block"},"Tipo",-1)),n(N,{modelValue:e.licencia.tipo_licencia,"onUpdate:modelValue":[i[0]||(i[0]=o=>e.licencia.tipo_licencia=o),e.obtenerDiasLicencia],options:e.tipos_licencias,"transition-show":"jump-up","transition-hide":"jump-down",disable:!e.esNuevo,"options-dense":"",dense:"",outlined:"","input-debounce":0,"use-input":"","option-value":o=>o.id,"option-label":o=>o.nombre,"emit-value":"","map-options":""},{error:s(()=>[(d(!0),m(_,null,h(e.v$.tipo_licencia.$errors,o=>(d(),m("div",{key:o.$uid},[a("div",Ue,g(o.$message),1)]))),128))]),"no-option":s(()=>[n(L,null,{default:s(()=>[n(B,{class:"text-grey"},{default:s(()=>i[10]||(i[10]=[O(" No hay resultados ")])),_:1})]),_:1})]),_:1},8,["modelValue","options","disable","onUpdate:modelValue","option-value","option-label"])]),a("div",Se,[i[12]||(i[12]=a("label",{class:"q-mb-sm block"},"Fecha Inicio",-1)),n(V,{modelValue:e.licencia.fecha_inicio,"onUpdate:modelValue":i[2]||(i[2]=o=>e.licencia.fecha_inicio=o),placeholder:"Obligatorio",error:!!e.v$.fecha_inicio.$errors.length,disable:!e.esNuevo,onBlur:e.v$.fecha_inicio.$touch,readonly:"",outlined:"",dense:""},{append:s(()=>[n(U,{name:"event",class:"cursor-pointer"},{default:s(()=>[n(M,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:s(()=>[n(Y,{modelValue:e.licencia.fecha_inicio,"onUpdate:modelValue":i[1]||(i[1]=o=>e.licencia.fecha_inicio=o),mask:e.maskFecha,options:e.optionsFechaInicio,"today-btn":""},{default:s(()=>[a("div",ze,[S(n(z,{label:"Cerrar",color:"primary",flat:""},null,512),[[R]])])]),_:1},8,["modelValue","mask","options"])]),_:1})]),_:1})]),error:s(()=>[(d(!0),m(_,null,h(e.v$.fecha_inicio.$errors,o=>(d(),m("div",{key:o.$uid},[a("div",Me,g(o.$message),1)]))),128))]),_:1},8,["modelValue","error","disable","onBlur"])]),a("div",Ye,[i[13]||(i[13]=a("label",{class:"q-mb-sm block"},"Fecha Fin",-1)),n(V,{modelValue:e.licencia.fecha_fin,"onUpdate:modelValue":i[4]||(i[4]=o=>e.licencia.fecha_fin=o),placeholder:"Obligatorio",error:!!e.v$.fecha_fin.$errors.length,disable:!1,onBlur:e.v$.fecha_fin.$touch,outlined:"",dense:""},{append:s(()=>[n(U,{name:"event",class:"cursor-pointer"},{default:s(()=>[n(M,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:s(()=>[n(Y,{modelValue:e.licencia.fecha_fin,"onUpdate:modelValue":i[3]||(i[3]=o=>e.licencia.fecha_fin=o),mask:e.maskFecha,"today-btn":""},{default:s(()=>[a("div",Re,[S(n(z,{label:"Cerrar",color:"primary",flat:""},null,512),[[R]])])]),_:1},8,["modelValue","mask"])]),_:1})]),_:1})]),error:s(()=>[(d(!0),m(_,null,h(e.v$.fecha_fin.$errors,o=>(d(),m("div",{key:o.$uid},[a("div",Ge,g(o.$message),1)]))),128))]),_:1},8,["modelValue","error","onBlur"]),i[14]||(i[14]=a("div",{class:"q-gutter-md row items-start"},null,-1))]),a("div",He,[i[15]||(i[15]=a("label",{class:"q-mb-sm block"},"Justificativo",-1)),n(V,{modelValue:e.licencia.justificacion,"onUpdate:modelValue":[i[5]||(i[5]=o=>e.licencia.justificacion=o),i[6]||(i[6]=o=>e.licencia.justificacion=e.removeAccents(o))],placeholder:"Obligatorio",disable:!e.esNuevo,error:!!e.v$.justificacion.$errors.length,outlined:"",dense:""},{error:s(()=>[(d(!0),m(_,null,h(e.v$.justificacion.$errors,o=>(d(),m("div",{key:o.$uid},[a("div",Je,g(o.$message),1)]))),128))]),_:1},8,["modelValue","disable","error"])]),a("div",Ke,[i[16]||(i[16]=a("label",{class:"q-mb-sm block"},"Documento",-1)),n(b,{ref:"refArchivoPrestamoEmpresarial",mixin:e.mixinArchivoPrestamoEmpleado,endpoint:e.endpoint,disable:!e.esNuevo,"permitir-eliminar":!1,"listar-al-guardar":!1,esMultiple:!1},null,8,["mixin","endpoint","disable"])]),a("div",We,[i[17]||(i[17]=a("label",{class:"q-mb-sm block"},"Dias de licencia",-1)),n(V,{modelValue:e.licencia.dias_licencia,"onUpdate:modelValue":i[7]||(i[7]=o=>e.licencia.dias_licencia=o),placeholder:"Obligatorio",disable:e.tiene_dias_licencia,onBlur:e.v$.fecha_fin.$touch,outlined:"",dense:""},null,8,["modelValue","disable","onBlur"])]),e.accion=="EDITAR"&&e.es_jefe_inmediato?(d(),m("div",Xe,[i[19]||(i[19]=a("label",{class:"q-mb-sm block"},"Autorizacion",-1)),n(N,{modelValue:e.licencia.estado,"onUpdate:modelValue":i[8]||(i[8]=o=>e.licencia.estado=o),options:e.autorizaciones,"transition-show":"jump-up","transition-hide":"jump-down","options-dense":"",dense:"",outlined:"",disable:e.disabled,readonly:e.disabled,"use-input":"","input-debounce":"0","option-value":o=>o.id,"option-label":o=>o.nombre,"emit-value":"","map-options":""},{"no-option":s(()=>[n(L,null,{default:s(()=>[n(B,{class:"text-grey"},{default:s(()=>i[18]||(i[18]=[O(" No hay resultados ")])),_:1})]),_:1})]),_:1},8,["modelValue","options","disable","readonly","option-value","option-label"])])):$e("",!0)])]),_:1})]),_:1},8,["mixin","configuracionColumnas","tabOptions","permitirEditar","filtrar","tabDefecto"])}var Ui=he(Ie,[["render",Ze]]);export{Ui as default};
