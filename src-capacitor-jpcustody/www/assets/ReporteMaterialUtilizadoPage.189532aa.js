var M=Object.defineProperty;var Q=(e,o,s)=>o in e?M(e,o,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[o]=s;var u=(e,o,s)=>(Q(e,typeof o!="symbol"?o+"":o,s),s);import{Q as y,a as m}from"./QSelect.69d1b992.js";import{Q as c,a as f}from"./QItemSection.3a5d4c83.js";import{bx as S,s as D,d as F,bG as L,A as N,_ as h,v as l,P as O,F as r,y as i,z as a,x as d,G as R,H as V,K as p,bf as w,D as n,J as C,O as j}from"./index.2ef7a81a.js";import{Q as I}from"./QPage.2bc1c297.js";import{g as G,o as H}from"./tareas.utils.309e0dff.js";import{u as J}from"./filtrosListadosGenerales.79b6e840.js";import{r as b}from"./i18n-validators.46fc4c83.js";import{u as K}from"./index.e8d8fb1e.js";import{C as Y}from"./ContenedorSimpleMixin.617817a8.js";import{P as x}from"./ProyectoController.03d7427c.js";import{T as W}from"./TareaController.f1ef1787.js";import{E as X}from"./entidadAuditable.75a46700.js";import{A as Z}from"./utils.a862dc08.js";import"./QChip.c5c0b225.js";import"./QMenu.f50512a6.js";import"./position-engine.093dda28.js";import"./format.8ac60962.js";import"./index.e1f41ef1.js";class oo extends S{constructor(){super(D.reporte_materiales_utilizados)}}class eo extends X{constructor(){super();u(this,"tipo_reporte");u(this,"proyecto_id");u(this,"tarea_id");this.tipo_reporte=null,this.proyecto_id=null,this.tarea_id=null}}var to=F({setup(){const e=new Y(eo,new oo),{entidad:o,listadosAuxiliares:s}=e.useReferencias(),{obtenerListados:g,cargarVista:_,setValidador:v,listar:t}=e.useComportamiento();_(async()=>{await g({proyectos:{controller:new x,params:{campos:"id,nombre,codigo_proyecto"}},tareas:{controller:new W,params:{campos:"id,codigo_tarea,titulo,cliente_id,proyecto_id"}}})});const{tareas:P,filtrarTareas:T,proyectos:k,filtrarProyectos:z}=J(s);async function U(){const q=new Date,A="reporte_material_utilizado_"+q.toLocaleString(),B=e.getController().getEndpoint(),E=L.URL_BASE+"/"+N.getInstance().getEndpoint(B,o);Z(E,"GET","blob","xlsx",A)}const $=K({tipo_reporte:{required:b},tarea_id:{required:b},proyecto_id:{required:b}},o);return v($.value),{v$:$,filtro:o,tiposReportesMaterialUtilizado:G,opcionesTipoReporteMaterialUtilizado:H,tareas:P,filtrarTareas:T,proyectos:k,filtrarProyectos:z,consultarDescargar:U}}});const ro={class:"row q-col-gutter-sm q-pa-sm bg-desenfoque rounded border-white"},ao={class:"col-12 col-md-3"},io={key:0,class:"col-12 col-md-6"},so={class:"error-msg"},lo={key:1,class:"col-12 col-md-6"},no={class:"error-msg"},po={class:"col-12 col-md-3"};function uo(e,o,s,g,_,v){return l(),O(I,{padding:""},{default:r(()=>[i("div",ro,[o[11]||(o[11]=i("div",{class:"col-12 text-primary q-mb-sm"}," Reporte de materiales utilizados ",-1)),i("div",ao,[o[4]||(o[4]=i("label",{class:"q-mb-sm block"},"Tipo de reporte",-1)),a(y,{modelValue:e.filtro.tipo_reporte,"onUpdate:modelValue":o[0]||(o[0]=t=>e.filtro.tipo_reporte=t),options:e.opcionesTipoReporteMaterialUtilizado,"transition-show":"scale","transition-hide":"scale","options-dense":"",dense:"",outlined:""},null,8,["modelValue","options"])]),e.filtro.tipo_reporte===e.tiposReportesMaterialUtilizado.POR_TAREA?(l(),d("div",io,[o[6]||(o[6]=i("label",{class:"q-mb-sm block"},"Tareas",-1)),a(y,{modelValue:e.filtro.tarea_id,"onUpdate:modelValue":o[1]||(o[1]=t=>e.filtro.tarea_id=t),options:e.tareas,onFilter:e.filtrarTareas,"transition-show":"jump-up","transition-hide":"jump-down","options-dense":"",dense:"",outlined:"",error:!!e.v$.tarea_id.$errors.length,onBlur:e.v$.tarea_id.$touch,"error-message":"Debes seleccionar una Tarea","use-input":"","input-debounce":"0","option-value":t=>t.id,"option-label":t=>t.codigo_tarea+" - "+t.titulo,"emit-value":"","map-options":""},{error:r(()=>[(l(!0),d(R,null,V(e.v$.tarea_id.$errors,t=>(l(),d("div",{key:t.$uid},[i("div",so,p(t.$message),1)]))),128))]),option:r(t=>[a(c,w(t.itemProps,{class:"q-my-sm"}),{default:r(()=>[a(f,null,{default:r(()=>[a(m,{class:"text-bold text-primary"},{default:r(()=>[n(p(t.opt.codigo_tarea),1)]),_:2},1024),a(m,{caption:""},{default:r(()=>[n(p(t.opt.titulo),1)]),_:2},1024)]),_:2},1024)]),_:2},1040)]),"no-option":r(()=>[a(c,null,{default:r(()=>[a(f,{class:"text-grey"},{default:r(()=>o[5]||(o[5]=[n(" No hay resultados ")])),_:1})]),_:1})]),_:1},8,["modelValue","options","onFilter","error","onBlur","option-value","option-label"])])):C("",!0),e.filtro.tipo_reporte===e.tiposReportesMaterialUtilizado.POR_PROYECTO?(l(),d("div",lo,[o[8]||(o[8]=i("label",{class:"q-mb-sm block"},"Proyectos",-1)),a(y,{modelValue:e.filtro.proyecto_id,"onUpdate:modelValue":o[2]||(o[2]=t=>e.filtro.proyecto_id=t),options:e.proyectos,onFilter:e.filtrarProyectos,"transition-show":"jump-up","transition-hide":"jump-down","options-dense":"",dense:"",outlined:"",error:!!e.v$.proyecto_id.$errors.length,onBlur:e.v$.proyecto_id.$touch,"error-message":"Debes seleccionar un proyecto","use-input":"","input-debounce":"0","option-value":t=>t.id,"option-label":t=>t.nombre,"emit-value":"","map-options":""},{error:r(()=>[(l(!0),d(R,null,V(e.v$.proyecto_id.$errors,t=>(l(),d("div",{key:t.$uid},[i("div",no,p(t.$message),1)]))),128))]),option:r(t=>[a(c,w(t.itemProps,{class:"q-my-sm"}),{default:r(()=>[a(f,null,{default:r(()=>[a(m,{class:"text-bold text-primary"},{default:r(()=>[n(p(t.opt.codigo_proyecto),1)]),_:2},1024),a(m,{caption:""},{default:r(()=>[n(p(t.opt.nombre),1)]),_:2},1024)]),_:2},1024)]),_:2},1040)]),"no-option":r(()=>[a(c,null,{default:r(()=>[a(f,{class:"text-grey"},{default:r(()=>o[7]||(o[7]=[n(" No hay resultados ")])),_:1})]),_:1})]),_:1},8,["modelValue","options","onFilter","error","onBlur","option-value","option-label"])])):C("",!0),i("div",po,[o[10]||(o[10]=i("label",{class:"block q-mb-sm"},"\xA0",-1)),a(j,{color:"primary",class:"full-width",icon:"bi-search","no-caps":"",unelevated:"",onClick:o[3]||(o[3]=t=>e.consultarDescargar())},{default:r(()=>o[9]||(o[9]=[n("Consultar y descargar")])),_:1})])])]),_:1})}var Eo=h(to,[["render",uo]]);export{Eo as default};
