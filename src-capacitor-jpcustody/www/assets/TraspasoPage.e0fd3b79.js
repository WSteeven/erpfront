var de=Object.defineProperty;var ue=(e,o,r)=>o in e?de(e,o,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[o]=r;var c=(e,o,r)=>(ue(e,typeof o!="symbol"?o+"":o,r),r);import{c as m,bx as ce,s as I,l as pe,e as me,by as w,A as F,bG as be,d as fe,R as ve,u as ge,a1 as W,dC as ye,_ as Ce,t as D,v as p,P as Pe,F as n,z as s,a5 as Se,y as l,x as f,I as q,J as L,G as B,H as A,K as h,L as Ve,M as we,N as Ee,D as T,a3 as Le,O as he}from"./index.2ef7a81a.js";import{Q as $,a as X}from"./QSelect.69d1b992.js";import{Q as N,a as U}from"./QItemSection.3a5d4c83.js";import{Q as Te}from"./QForm.e1af9500.js";import{c as $e}from"./configuracionColumnasInventarios.ec051713.js";import{c as qe}from"./configuracionColumnasItemsSeleccionados.5da3f45e.js";import{r as Q}from"./index.e1f41ef1.js";import{u as Ie}from"./index.e8d8fb1e.js";import{u as ke}from"./selector.4bfc5776.js";import{T as Fe}from"./TabLayoutFilterTabs.46a7f079.js";import{E as De}from"./EssentialTable.f528a579.js";import{E as Be}from"./EssentialSelectableTable.97da6dd3.js";import{M as Ae}from"./ModalEntidad.be40edc8.js";import{C as Ne}from"./ContenedorSimpleMixin.617817a8.js";import{E as Ue}from"./entidadAuditable.75a46700.js";import{T as Qe}from"./TareaController.f1ef1787.js";import{C as Oe}from"./ClienteController.34c1759e.js";import{S as Re,A as je,s as ze}from"./utils.a862dc08.js";import{u as Me}from"./filtrosListadosGenerales.79b6e840.js";import"./QChip.c5c0b225.js";import"./QMenu.f50512a6.js";import"./position-engine.093dda28.js";import"./format.8ac60962.js";import"./SelectorController.438cc9af.js";import"./QTabs.5cdabeb1.js";import"./QResizeObserver.8bc492d6.js";import"./QTabPanels.7f1e5320.js";import"./touch.9135741d.js";import"./QPopupProxy.567210a4.js";import"./QPage.2bc1c297.js";import"./EssentialTableTabs.3fb37590.js";import"./QBadge.ebf9f349.js";import"./EssentialTablePagination.73d42aee.js";import"./QToolbar.ff7ff7d8.js";import"./use-fullscreen.a336d1b1.js";import"./buttonSubmits.35676009.js";import"./QFile.f5c4066f.js";import"./_commonjsHelpers.8402d862.js";import"./QImg.9c11306d.js";import"./VisorImagen.12af3936.js";import"./seleccionContratacionPersonal.utils.e3e1ed3d.js";import"./ErrorComponent.94e1365a.js";import"./i18n-validators.46fc4c83.js";import"./configuracion_general.ca1e935d.js";import"./ConfiguracionController.337fc7d3.js";const Ge=[{name:"solicitante",field:"solicitante",label:"Creado por",align:"left",sortable:!0},{name:"justificacion",field:"justificacion",label:"Justificaci\xF3n",align:"left",sortable:!0},{name:"desde_cliente",field:"desde_cliente",label:"Desde",align:"left",sortable:!0},{name:"hasta_cliente",field:"hasta_cliente",label:"Hasta",align:"left",sortable:!0},{name:"tarea",field:"tarea",label:"Tarea",align:"left",sortable:!0},{name:"sucursal",field:"sucursal",label:"Sucursal",align:"left",sortable:!0},{name:"estado",field:"estado",label:"Estado de devoluci\xF3n",align:"left",sortable:!0}],He=[{name:"producto",field:"producto",label:"Producto",align:"left",sortable:!0},{name:"detalle_id",field:"detalle_id",label:"Descripci\xF3n",align:"left",sortable:!0},{name:"cliente_id",field:"cliente_id",label:"Propietario",align:"left",sortable:!0},{name:"condicion",field:"condicion",label:"Condici\xF3n",align:"left",sortable:!0},{name:"cantidades",field:"cantidades",label:"Cantidad",align:"left",sortable:!1},{name:"devuelto",field:"devuelto",label:"Devuelto",align:"left",sortable:!1},{name:"devolucion",field:"devolucion",label:"Devolucion",align:"left",sortable:!1},{name:"acciones",field:"acciones",label:"Acciones",align:"right",sortable:!1}],Je=[{name:"producto",field:"producto",label:"Producto",align:"left",sortable:!0},{name:"detalle_id",field:"detalle_id",label:"Descripci\xF3n",align:"left",sortable:!0},{name:"cliente_id",field:"cliente_id",label:"Propietario",align:"left",sortable:!0},{name:"condicion",field:"condicion",label:"Condici\xF3n",align:"left",sortable:!0},{name:"cantidades",field:"cantidades",label:"Cantidad",align:"left",sortable:!1},{name:"devuelto",field:"devuelto",label:"Devuelto",align:"left",sortable:!1},{name:"acciones",field:"acciones",label:"Acciones",align:"right",sortable:!1}];function Ke(e,o){const r=m(),b=m([]),u=m(),y={refListadoSeleccionable:r,listadoSeleccionable:b,endpoint:o,limpiar:()=>{e.id=null,u.value=null},seleccionar:i=>{console.log(i),e.listadoProductos=[...e.listadoProductos,...i]}},C=ke(y);return{refListadoSeleccionable:r,listado:b,listar:i=>C.listar(u.value,i),limpiar:()=>y.limpiar(),seleccionar:i=>{console.log(i);let d=[];d=e.listadoProductos.map(V=>V.id);const v=i.filter(V=>!d.includes(V.id));y.seleccionar(v)},criterioBusqueda:u}}class We extends ce{constructor(){super(I.traspasos)}}class O extends Ue{constructor(){super();c(this,"justificacion");c(this,"devuelta");c(this,"solicitante");c(this,"desde_cliente");c(this,"hasta_cliente");c(this,"tarea");c(this,"sucursal");c(this,"estado");c(this,"listadoProductos");c(this,"es_tarea");this.justificacion=null,this.devuelta=null,this.solicitante=null,this.desde_cliente=null,this.hasta_cliente=null,this.tarea=null,this.sucursal=null,this.estado=null,this.listadoProductos=[],this.es_tarea=!1}}class Xe{constructor(o){c(this,"traspaso");this.traspaso=o}async validar(){if(this.traspaso.listadoProductos.length===0)throw new Error("Debe agregar al menos un producto al listado.");return!0}}const Ye=pe("traspaso",()=>{const e=me(new O),o=new O,r=m(),b=w.nuevo,u=new Re;async function y(i){const d=F.getInstance(),v=d.getEndpoint(I.traspasos)+"/show-preview/"+i;return(await d.get(v)).data.modelo}async function C(i){try{u.activar();const d=await y(i);e.hydrate(d)}catch{e.hydrate(o)}finally{u.desactivar()}}async function P(){const i=F.getInstance(),d=i.getEndpoint(I.traspasos)+"/show-preview/"+r.value,v=await i.get(d);e.hydrate(v.data.modelo)}async function S(){const i=F.getInstance(),d=be.URL_BASE+"/"+i.getEndpoint(I.traspasos)+"/imprimir/"+r.value,v="traspaso_"+r.value+"_"+Date.now();je(d,"GET","blob","pdf",v),console.log("traspaso impreso con exito")}function a(){e.hydrate(o)}return{traspaso:e,accionTraspaso:b,cargarTraspaso:C,resetearTraspaso:a,idTraspaso:r,showPreview:P,imprmirPdf:S}});var Ze=fe({components:{TabLayoutFilterTabs:Fe,EssentialTable:De,EssentialSelectableTable:Be,ModalesEntidad:Ae},setup(){const e=new Ne(O,new We),{entidad:o,disabled:r,accion:b,listadosAuxiliares:u}=e.useReferencias(),{setValidador:y,obtenerListados:C,cargarVista:P}=e.useComportamiento(),{onReestablecer:S,onBeforeGuardar:a,onConsultado:i}=e.useHooks(),{confirmar:d,prompt:v,notificarError:V}=ve();ge();const R=Ye(),{refListadoSeleccionable:Y,criterioBusqueda:Z,listado:_,listar:x,limpiar:ee,seleccionar:oe}=Ke(o,"inventarios");let j=m(),k=m(!1);m(!1);let z=m(!1);m(),i(()=>{b.value===w.editar&&(k.value=!0)}),S(()=>{k.value=!1}),a(()=>{console.log("se ejecuta el ONBEFOREGUARDAR"),o.desde_cliente===o.hasta_cliente&&V("\xA1No se puede hacer traspasos en un mismo cliente!")});const M=m([]),G=m([]),H=m([]),{clientes:J,filtrarClientes:ae}=Me(u);P(async()=>{await C({clientes:{controller:new Oe,params:{campos:"id,razon_social",requiere_bodega:1,estado:1}},tareas:{controller:new Qe,params:{campos:"id,codigo_tarea,titulo,cliente_id"}}})});const K=Ie({sucursal:{required:Q},desde_cliente:{required:Q},hasta_cliente:{required:Q}},o);y(K.value);const se=new Xe(o);e.agregarValidaciones(se);function le({entidad:t,posicion:g}){d("\xBFEst\xE1 seguro de continuar?",()=>o.listadoProductos.splice(g,1))}const te={titulo:"Quitar",color:"negative",icono:"bi-x",accion:({entidad:t,posicion:g})=>{le({entidad:t,posicion:g})},visible:()=>b.value==w.nuevo},ie={titulo:"Cantidad",icono:"bi-pencil",accion:({posicion:t})=>{const g={titulo:"Confirmaci\xF3n",mensaje:"Ingresa la cantidad",defecto:o.listadoProductos[t].cantidades,tipo:"number",accion:E=>o.listadoProductos[t].cantidades=E};v(g)},visible:()=>b.value==w.nuevo},ne={titulo:"Devolucion",icono:"bi-pencil",accion:({posicion:t})=>{const g={titulo:"Confirmaci\xF3n",mensaje:"Ingresa la cantidad",defecto:o.listadoProductos[t].devolucion,tipo:"number",accion:E=>o.listadoProductos[t].devolucion=E};v(g)},visible:({entidad:t,posicion:g})=>b.value==w.editar&&t.cantidades!=t.devuelto},re={titulo:"Imprimir",color:"secondary",icono:"bi-printer",accion:async({entidad:t})=>{R.idTraspaso=t.id,await R.imprmirPdf()}};return J.value=u.clientes,H.value=JSON.parse(W.getItem("estados_transacciones").toString()),M.value=JSON.parse(W.getItem("sucursales").toString()),G.value=u.tareas,{mixin:e,traspaso:o,disabled:r,accion:b,v$:K,configuracionColumnas:Ge,acciones:w,clientes:J,opciones_estados:H,opciones_sucursales:M,opciones_tareas:G,refListado:Y,criterioBusquedaProducto:Z,listadoProductos:_,listarProductos:x,limpiarProducto:ee,seleccionarProducto:oe,configuracionColumnasItems:$e,configuracionColumnasItemsSeleccionadosDevolver:He,configuracionColumnasItemsSeleccionadosDevuelto:Je,configuracionColumnasItemsSeleccionados:qe,botonEditarCantidad:ie,botonEliminar:te,botonImprimir:re,botonDevolver:ne,soloLectura:k,puedeEditar:z,tabOptionsTraspasos:ye,tabSeleccionado:j,tabEs(t){console.log(t),j.value=t,z.value=t==0},filtrarClientes:ae,ordenarLista:ze,tareaSeleccionada(t){const g=u.tareas.filter(E=>E.id===t);o.hasta_cliente=g[0].cliente_id}}}});const _e={class:"row q-col-gutter-sm q-py-md"},xe={key:0,class:"col-12 col-md-3"},eo={key:1,class:"col-12 col-md-3"},oo={class:"col-12 col-md-6"},ao={class:"col-12 col-md-3 q-mb-md"},so={class:"error-msg"},lo={key:2,class:"col-12 col-md-3"},to={key:3,class:"col-12 col-md-3"},io={class:"col-12 col-md-3"},no={class:"error-msg"},ro={class:"col-12 col-md-3"},uo={class:"error-msg"},co={key:4,class:"col-12 col-md-3"},po={class:"col-12 col-md-12"},mo={class:"row q-col-gutter-x-xs"},bo={class:"col-12 col-md-10 q-mb-md"},fo={class:"col-12 col-md-2"},vo={class:"col-12"};function go(e,o,r,b,u,y){const C=D("essential-table"),P=D("essential-selectable-table"),S=D("tab-layout-filter-tabs");return p(),Pe(S,{mixin:e.mixin,configuracionColumnas:e.configuracionColumnas,"titulo-pagina":"Traspasos","tab-options":e.tabOptionsTraspasos,onTabSeleccionado:e.tabEs,permitirEditar:e.puedeEditar,accion1:e.botonImprimir},{formulario:n(()=>[s(Te,{onSubmit:o[15]||(o[15]=Se(()=>{},["prevent"]))},{default:n(()=>[l("div",_e,[e.traspaso.id?(p(),f("div",xe,[o[16]||(o[16]=l("label",{class:"q-mb-sm block"},"Traspaso N\xB0",-1)),s(q,{modelValue:e.traspaso.id,"onUpdate:modelValue":o[0]||(o[0]=a=>e.traspaso.id=a),placeholder:"Obligatorio",disable:e.disabled||e.soloLectura,readonly:e.disabled||e.soloLectura,outlined:"",dense:""},null,8,["modelValue","disable","readonly"])])):L("",!0),e.traspaso.created_at?(p(),f("div",eo,[o[17]||(o[17]=l("label",{class:"q-mb-sm block"},"Fecha",-1)),s(q,{modelValue:e.traspaso.created_at,"onUpdate:modelValue":o[1]||(o[1]=a=>e.traspaso.created_at=a),disable:"",outlined:"",dense:""},null,8,["modelValue"])])):L("",!0),l("div",oo,[o[18]||(o[18]=l("label",{class:"q-mb-sm block"},"Justificaci\xF3n",-1)),s(q,{type:"textarea",autogrow:"",modelValue:e.traspaso.justificacion,"onUpdate:modelValue":o[2]||(o[2]=a=>e.traspaso.justificacion=a),placeholder:"Obligatorio",disable:e.disabled||e.soloLectura,readonly:e.disabled||e.soloLectura,outlined:"",dense:""},null,8,["modelValue","disable","readonly"])]),l("div",ao,[o[19]||(o[19]=l("label",{class:"q-mb-sm block"},"Sucursal",-1)),s($,{modelValue:e.traspaso.sucursal,"onUpdate:modelValue":o[3]||(o[3]=a=>e.traspaso.sucursal=a),options:e.opciones_sucursales,"transition-show":"scale","transition-hide":"scale","options-dense":"",dense:"",outlined:"",disable:e.disabled||e.soloLectura,readonly:e.disabled||e.soloLectura,error:!!e.v$.sucursal.$errors.length,"error-message":"Debes seleccionar una sucursal","option-label":a=>a.lugar,"option-value":a=>a.id,"emit-value":"","map-options":""},{error:n(()=>[(p(!0),f(B,null,A(e.v$.sucursal.$errors,a=>(p(),f("div",{key:a.$uid},[l("div",so,h(a.$message),1)]))),128))]),_:1},8,["modelValue","options","disable","readonly","error","option-label","option-value"])]),e.traspaso.es_tarea||e.accion===e.acciones.nuevo?(p(),f("div",lo,[s(Ve,{class:"q-mt-lg q-pt-md",modelValue:e.traspaso.es_tarea,"onUpdate:modelValue":o[4]||(o[4]=a=>e.traspaso.es_tarea=a),label:"\xBFEs material para tarea?",disable:e.disabled||e.soloLectura,outlined:"",dense:""},null,8,["modelValue","disable"])])):L("",!0),e.traspaso.es_tarea?(p(),f("div",to,[o[20]||(o[20]=l("label",{class:"q-mb-sm block"},"Tarea",-1)),s($,{modelValue:e.traspaso.tarea,"onUpdate:modelValue":[o[5]||(o[5]=a=>e.traspaso.tarea=a),e.filtroTareas],options:e.opciones_tareas,"transition-show":"scale","transition-hide":"scale","options-dense":"",clearable:"",hint:"Opcional",dense:"",outlined:"",disable:e.disabled||e.soloLectura,readonly:e.disabled||e.soloLectura,"option-label":a=>a.titulo,"option-value":a=>a.id,"emit-value":"","map-options":""},{option:n(a=>[s(N,we(Ee(a.itemProps)),{default:n(()=>[s(U,null,{default:n(()=>[s(X,null,{default:n(()=>[T(h(a.opt.codigo_tarea),1)]),_:2},1024),s(X,{caption:""},{default:n(()=>[T(h(a.opt.titulo),1)]),_:2},1024)]),_:2},1024)]),_:2},1040)]),_:1},8,["modelValue","options","disable","readonly","onUpdate:modelValue","option-label","option-value"])])):L("",!0),l("div",io,[o[22]||(o[22]=l("label",{class:"q-mb-sm block"},"Desde",-1)),s($,{modelValue:e.traspaso.desde_cliente,"onUpdate:modelValue":o[6]||(o[6]=a=>e.traspaso.desde_cliente=a),options:e.clientes,"transition-show":"scale","transition-hide":"scale","options-dense":"",dense:"",outlined:"",error:!!e.v$.desde_cliente.$errors.length,"use-input":"","input-debounce":"0",onFilter:e.filtrarClientes,onPopupShow:o[7]||(o[7]=a=>e.ordenarLista(e.clientes,"razon_social")),disable:e.disabled||e.soloLectura,readonly:e.disabled||e.soloLectura,"option-label":a=>a.razon_social,"option-value":a=>a.id,"emit-value":"","map-options":""},{"no-option":n(()=>[s(N,null,{default:n(()=>[s(U,{class:"text-grey"},{default:n(()=>o[21]||(o[21]=[T(" No hay resultados ")])),_:1})]),_:1})]),error:n(()=>[(p(!0),f(B,null,A(e.v$.desde_cliente.$errors,a=>(p(),f("div",{key:a.$uid},[l("div",no,h(a.$message),1)]))),128))]),_:1},8,["modelValue","options","error","onFilter","disable","readonly","option-label","option-value"])]),l("div",ro,[o[24]||(o[24]=l("label",{class:"q-mb-sm block"},"Hasta",-1)),s($,{modelValue:e.traspaso.hasta_cliente,"onUpdate:modelValue":o[8]||(o[8]=a=>e.traspaso.hasta_cliente=a),options:e.clientes,"transition-show":"scale","transition-hide":"scale","options-dense":"",dense:"",outlined:"",error:!!e.v$.hasta_cliente.$errors.length,"use-input":"","input-debounce":"0",onFilter:e.filtrarClientes,onPopupShow:o[9]||(o[9]=a=>e.ordenarLista(e.clientes,"razon_social")),disable:e.traspaso.es_tarea,readonly:e.disabled||e.soloLectura,"option-label":a=>a.razon_social,"option-value":a=>a.id,"emit-value":"","map-options":""},{"no-option":n(()=>[s(N,null,{default:n(()=>[s(U,{class:"text-grey"},{default:n(()=>o[23]||(o[23]=[T(" No hay resultados ")])),_:1})]),_:1})]),error:n(()=>[(p(!0),f(B,null,A(e.v$.hasta_cliente.$errors,a=>(p(),f("div",{key:a.$uid},[l("div",uo,h(a.$message),1)]))),128))]),_:1},8,["modelValue","options","error","onFilter","disable","readonly","option-label","option-value"])]),e.traspaso.estado?(p(),f("div",co,[o[25]||(o[25]=l("label",{class:"q-mb-sm block"},"Estado",-1)),s($,{modelValue:e.traspaso.estado,"onUpdate:modelValue":o[10]||(o[10]=a=>e.traspaso.estado=a),options:e.opciones_estados,"transition-show":"scale","transition-hide":"scale","options-dense":"",dense:"",outlined:"",disable:e.disabled||e.soloLectura,readonly:e.disabled||e.soloLectura,"option-label":a=>a.nombre,"option-value":a=>a.id,"emit-value":"","map-options":""},null,8,["modelValue","options","disable","readonly","option-label","option-value"])])):L("",!0),l("div",po,[o[27]||(o[27]=l("label",{class:"q-mb-sm block"},"Agregar productos",-1)),l("div",mo,[l("div",bo,[s(q,{modelValue:e.criterioBusquedaProducto,"onUpdate:modelValue":o[11]||(o[11]=a=>e.criterioBusquedaProducto=a),disable:e.disabled||e.soloLectura,placeholder:"Nombre de producto",hint:"Presiona Enter para seleccionar un producto",onKeydown:o[12]||(o[12]=Le(a=>e.listarProductos({sucursal_id:e.traspaso.sucursal,cliente_id:e.traspaso.desde_cliente}),["enter"])),onBlur:o[13]||(o[13]=a=>e.criterioBusquedaProducto===""?e.limpiarProducto():null),outlined:"",dense:""},null,8,["modelValue","disable"])]),l("div",fo,[s(he,{onClick:o[14]||(o[14]=a=>e.listarProductos({sucursal_id:e.traspaso.sucursal,cliente_id:e.traspaso.desde_cliente})),disable:e.disabled||e.soloLectura,icon:"search",unelevated:"",color:"positive",class:"full-width",style:{height:"40px"},"no-caps":"",glossy:""},{default:n(()=>o[26]||(o[26]=[T("Buscar")])),_:1},8,["disable"])])])]),l("div",vo,[s(C,{titulo:"Productos Seleccionados",configuracionColumnas:e.accion===e.acciones.nuevo?e.configuracionColumnasItemsSeleccionados:e.accion===e.acciones.consultar?e.configuracionColumnasItemsSeleccionadosDevuelto:e.configuracionColumnasItemsSeleccionadosDevolver,datos:e.traspaso.listadoProductos,permitirConsultar:!1,permitirEditar:!1,permitirEliminar:!1,mostrarBotones:!1,accion1:e.botonEditarCantidad,accion2:e.botonEliminar,accion3:e.botonDevolver,mostrarFooter:!0},null,8,["configuracionColumnas","datos","accion1","accion2","accion3"])])])]),_:1}),s(P,{ref:"refListado","configuracion-columnas":e.configuracionColumnasItems,datos:e.listadoProductos,"tipo-seleccion":"multiple",onSelected:e.seleccionarProducto},null,8,["configuracion-columnas","datos","onSelected"])]),_:1},8,["mixin","configuracionColumnas","tab-options","onTabSeleccionado","permitirEditar","accion1"])}var ca=Ce(Ze,[["render",go]]);export{ca as default};
