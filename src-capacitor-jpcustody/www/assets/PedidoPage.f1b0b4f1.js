var no=Object.defineProperty;var uo=(e,o,u)=>o in e?no(e,o,{enumerable:!0,configurable:!0,writable:!0,value:u}):e[o]=u;var re=(e,o,u)=>(uo(e,typeof o!="symbol"?o+"":o,u),u);import{ab as po,f as Le,k as mo,aj as co,c as C,u as Be,A as bo,s as vo,d as fo,R as go,bc as yo,m as Ce,$ as Co,a0 as Vo,by as B,E as Po,a1 as Ve,dc as ko,d8 as wo,db as $o,b$ as D,cx as qo,b_ as Pe,_ as Eo,t as Q,v as n,x as d,z as s,F as l,a5 as So,y as t,I as q,J as m,D as f,G as E,H as T,K as g,O as te,B as ke,j as Lo,L as X,bf as we,M as Bo,N as To,cL as Ao,a3 as jo,P as Do}from"./index.2ef7a81a.js";import{Q as k,a as w}from"./QItemSection.3a5d4c83.js";import{Q as V,a as U}from"./QSelect.69d1b992.js";import{Q as Fo,a as Uo,C as ho}from"./QPopupProxy.567210a4.js";import{E as Io,S as Ro,j as zo}from"./EssentialTable.f528a579.js";import{Q as Oo}from"./QForm.e1af9500.js";import{c as No,a as Qo}from"./VisualizarPedidoPage.ef54c636.js";import{r as $e,a as h,h as Mo}from"./i18n-validators.46fc4c83.js";import{u as Ho}from"./index.e8d8fb1e.js";import{u as Go}from"./selector.4bfc5776.js";import{T as Jo}from"./TabLayoutFilterTabs2.2c3270e4.js";import{E as Yo}from"./EssentialSelectableTable.97da6dd3.js";import{M as Ko}from"./ModalEntidad.be40edc8.js";import{C as Wo}from"./ContenedorSimpleMixin.617817a8.js";import{P as Xo}from"./PedidoController.34234b5c.js";import{P as Zo,u as _o}from"./pedido.0f2fc614.js";import{c as xo,a as ea}from"./configuracionColumnasDetallesModal.0b76e70c.js";import{f as oa}from"./index.e1f41ef1.js";import{C as aa}from"./ClienteController.34c1759e.js";import{u as sa,S as ia,s as la}from"./utils.a862dc08.js";import{C as ra}from"./ComportamientoModalesPedido.40352906.js";import{u as ta}from"./filtrosListadosGenerales.79b6e840.js";import{P as qe}from"./ProyectoController.03d7427c.js";import{T as Ee}from"./TareaController.f1ef1787.js";import{E as na}from"./EtapaController.fd57e676.js";import"./QChip.c5c0b225.js";import"./QMenu.f50512a6.js";import"./position-engine.093dda28.js";import"./format.8ac60962.js";import"./QFile.f5c4066f.js";import"./QToolbar.ff7ff7d8.js";import"./use-fullscreen.a336d1b1.js";import"./QBadge.ebf9f349.js";import"./_commonjsHelpers.8402d862.js";import"./QImg.9c11306d.js";import"./VisorImagen.12af3936.js";import"./seleccionContratacionPersonal.utils.e3e1ed3d.js";import"./ErrorComponent.94e1365a.js";import"./TabLayout.5bc8ab45.js";import"./QTabs.5cdabeb1.js";import"./QResizeObserver.8bc492d6.js";import"./QTabPanels.7f1e5320.js";import"./touch.9135741d.js";import"./QPage.2bc1c297.js";import"./buttonSubmits.35676009.js";import"./EssentialTablePagination.73d42aee.js";import"./SelectorController.438cc9af.js";import"./EssentialTableTabs.3fb37590.js";import"./configuracion_general.ca1e935d.js";import"./ConfiguracionController.337fc7d3.js";import"./entidadAuditable.75a46700.js";import"./ComponenteModal.domain.57cc3867.js";var da=po({name:"QTr",props:{props:Object,noHover:Boolean},setup(e,{slots:o}){const u=Le(()=>"q-tr"+(e.props===void 0||e.props.header===!0?"":" "+e.props.__trClass)+(e.noHover===!0?" q-tr--no-hover":""));return()=>mo("tr",{class:u.value},co(o.default))}});function ua(e,o){const u=C(),r=C([]),S=C(),A=Be(),v={refListadoSeleccionable:u,listadoSeleccionable:r,endpoint:o,limpiar:()=>{e.id=null,S.value=null},seleccionar:P=>{e.listadoProductos=[...e.listadoProductos,...P]}},b=Go(v);return{refListadoSeleccionable:u,listado:r,listar:P=>b.listar(S.value,P),limpiar:()=>v.limpiar(),seleccionar:P=>{let a=[];a=e.listadoProductos.map(j=>j.id);const R=P.filter(j=>!a.includes(j.id));R.forEach(j=>{j.solicitante=A.user.id}),v.seleccionar(R)},criterioBusqueda:S}}function pa(e){if(e===null)return!0;{const o=e.split("-"),u=new Date,r=new Date(+o[2],+o[1]-1,+o[0]);return!oa.req(e)||u<=r}}class ma{constructor(o){re(this,"pedido");this.pedido=o}async validar(){if(this.pedido.listadoProductos.length===0)throw new Error("Debe agregar al menos un producto al listado");if(this.pedido.listadoProductos.some(o=>o.cantidad==0||o.cantidad==null))throw new Error("Debe ingresar una cantidad mayor a cero en todos los elementos del listado");return!0}}class Se{constructor(){re(this,"axios");this.axios=bo.getInstance()}async marcarCompletado(o,u){return this.solicitud("/marcar-completado/",o,{motivo:u})}async anular(o,u){return this.solicitud("/anular/",o,{motivo:u})}async solicitud(o,u,r){const S=this.axios.getEndpoint(vo.pedidos)+o+u,A=await this.axios.post(S,r);return{response:A,result:A.data.modelo}}}var ca=fo({components:{TabLayoutFilterTabs2:Jo,EssentialTable:Io,EssentialSelectableTable:Yo,ModalesEntidad:Ko,SelectorImagen:Ro},emits:["guardado"],setup(e,{emit:o}){const u=new Wo(Zo,new Xo),{entidad:r,disabled:S,filtros:A,accion:v,listadosAuxiliares:b,listado:I}=u.useReferencias(),{setValidador:M,obtenerListados:H,cargarVista:P,listar:a,consultar:R,reestablecer:j}=u.useComportamiento(),{onReestablecer:Te,onBeforeConsultar:Ae,onConsultado:je,onGuardado:De}=u.useHooks(),{confirmar:Z,prompt:_,notificarCorrecto:ne,notificarError:de,notificarAdvertencia:Fe}=go(),ue=new ra;yo().setQuasar(Ce()),sa().setQuasar(Ce());const L=new ia,G=_o(),p=Be(),Ue=Co(),{refListadoSeleccionable:he,criterioBusqueda:Ie,listado:Re,listar:ze,limpiar:Oe,seleccionar:Ne}=ua(r,"detalles"),y=C("PENDIENTE"),x=C(!1),pe=C(!1),ee=C(!0),J=p.esCoordinador,oe=p.esBodeguero,me=p.esTecnico,ae=p.esActivosFijos,ce=p.esRecursosHumanos,Qe=p.esGerente,Me=Le(()=>{var i,c;return["inspecciones","incidentes"].includes((c=(i=Vo().name)==null?void 0:i.toString())!=null?c:"")});De(i=>o("guardado",i)),Te(()=>{x.value=!1,ge()}),Ae(()=>ee.value=!1),je(()=>{ee.value=!0,ie.value=b.empleados,v.value===B.editar&&(J||ae||p.user.id===r.per_autoriza_id)&&(x.value=!0),ye(),W(r.proyecto,!1)});const He=C(!0),Ge=C(!1),Je=C(!1),se=C([]),Ye=C("only_sucursal"),Ke=[{label:"Solo bodega seleccionada",value:"only_sucursal"},{label:"Solo perteneciente al cliente de la tarea",value:"only_cliente_tarea"},{label:"Todos los elementos",value:"todos"}],{empleados:ie,filtrarEmpleados:We,clientes:be,filtrarClientes:Xe,proyectos:le,filtrarProyectos:Ze,etapas:z,filtrarEtapas:_e,tareas:Y,filtrarTareas:xe,sucursales:ve,filtrarSucursales:eo,incidentes:as,filtrarIncidentes:ss}=ta(b);P(async()=>{ge(),await H({empleados:{controller:new Po,params:{campos:"id,nombres,apellidos,cargo_id",estado:1}},clientes:{controller:new aa,params:{campos:"id,razon_social",requiere_bodega:1,estado:1}},sucursales:JSON.parse(Ve.getItem("sucursales").toString())}),ie.value=b.empleados,Y.value=b.tareas,be.value=b.clientes,ve.value=b.sucursales});const oo={justificacion:{required:$e},observacion_aut:{requiredIfCoordinador:h(()=>r.tiene_observacion_aut)},sucursal:{required:$e},per_retira:{requiredIfCheck:h(()=>r.retira_tercero)},responsable:{requiredIfCoordinador:h(()=>(J||!me||ce)&&!r.para_cliente)},etapa:{requiredIf:h(()=>{if(z.value)return z.value.length&&r.proyecto})},tarea:{requiredIfTarea:h(()=>r.es_tarea)},fecha_limite:{required:h(()=>v.value===B.nuevo),fechaMenor:Mo.withMessage("La fecha l\xEDmite debe ser mayor a la fecha actual",pa)&&v.value===B.nuevo}},fe=Ho(oo,r);M(fe.value);const ao=new ma(r);u.agregarValidaciones(ao);async function so(i){y.value=i,await a({estado:i,paginate:!0}),A.fields={estado:i},pe.value=(J||ae||p.esJefeTecnico||Qe||p.esCompras||p.esRecursosHumanos||p.can("puede.autorizar.pedidos"))&&y.value===D.pendiente}function ge(){r.solicitante=p.user.id,r.responsable=p.user.id}async function ye(){L.activar();const i=await new qe().listar({empleado_id:r.responsable,campos:"id,nombre,codigo_proyecto",finalizado:0});b.proyectos=i.result,le.value=i.result,v.value==B.nuevo?await O(null):await O(r.etapa,!1),L.desactivar()}function K(i=!1,c=!1){v.value==B.nuevo&&(i&&(r.etapa=null),c&&(r.tarea=null))}async function W(i,c){if(L.activar(),r.proyecto){K(i,c);const $=await new na().listar({etapas_empleado:1,empleado_id:r.responsable,proyecto_id:r.proyecto});if(se.value=$.result,$.result.length<1)await O(null,!1);else{const F=await new Ee().listar({activas_empleado:1,empleado_id:r.responsable,proyecto_id:r.proyecto});b.tareas=F.result,Y.value=F.result}b.etapas=se.value,z.value=se.value}else z.value=[],K(!0,!0),await O(null,!1);L.desactivar()}async function O(i,c=!0){L.activar(),K(!1,c);const $=await new Ee().listar({activas_empleado:1,proyecto_id:r.proyecto,etapa_id:i,empleado_id:r.responsable,campos:"id,codigo_tarea,titulo",finalizado:0});b.tareas=$.result,Y.value=$.result,L.desactivar()}async function io(){const i=b.tareas.filter(c=>c.id==r.tarea)[0];i&&(r.cliente_id=i.cliente_id,r.proyecto==null&&(r.proyecto=i.proyecto_id,await W(!0,!0)),r.etapa=i.etapa_id,r.tarea=i.id)}async function lo(i=!0){if(i&&(r.proyecto=null),K(!0,!0),L.activar(),r.responsable){const c=await new qe().listar({empleado_id:r.responsable,finalizado:0});b.proyectos=c.result,le.value=c.result,await W(!1,!1)}else r.es_tarea=!1;L.desactivar()}async function ro(){const i=(await new qo().listar({campos:"id,lugar"})).result;Ve.set("sucursales",JSON.stringify(i))}function to({posicion:i}){Z("\xBFEst\xE1 seguro de continuar?",()=>r.listadoProductos.splice(i,1))}return{mixin:u,pedido:r,disabled:S,accion:v,v$:fe,acciones:B,configuracionColumnas:No,tablaRefrescada:ee,clientes:be,filtrarClientes:Xe,proyectos:le,filtrarProyectos:Ze,etapas:z,filtrarEtapas:_e,tareas:Y,filtrarTareas:xe,sucursales:ve,filtrarSucursales:eo,empleados:ie,filtrarEmpleados:We,estados:ko,autorizaciones:wo,refListado:he,criterioBusquedaProducto:Ie,listadoProductos:Re,listarProductos:ze,limpiarProducto:Oe,seleccionarProducto:Ne,configuracionColumnasDetallesModal:xo,configuracionColumnasProductosSeleccionados:ea,configuracionColumnasProductosSeleccionadosDespachado:Qo,botonEditarCantidad:{titulo:"Cantidad",icono:"bi-pencil",accion:({posicion:i})=>{const c={titulo:"Modifica",mensaje:"Ingresa la cantidad",tipo:"number",defecto:r.listadoProductos[i].cantidad,accion:$=>r.listadoProductos[i].cantidad=$};_(c)},visible:()=>v.value!=B.consultar},botonCorregir:{titulo:"Corregir pedido",color:"amber-3",icono:"bi-gear",accion:({entidad:i})=>{G.pedido=i,ue.abrirModalEntidad("CorregirPedidoPage")},visible:({entidad:i})=>(y.value=="APROBADO"||y.value=="PARCIAL")&&(oe||i.per_autoriza_id==p.user.id)&&i.estado!=D.completa},botonEliminar:{titulo:"Quitar",color:"negative",icono:"bi-x",accion:({posicion:i})=>to({posicion:i}),visible:()=>v.value!=B.consultar},botonImprimir:{titulo:"Imprimir",color:"secondary",icono:"bi-printer",accion:async({entidad:i})=>{G.idPedido=i.id,await G.imprimirPdf()},visible:()=>y.value=="APROBADO"||y.value=="PARCIAL"||y.value=="COMPLETA"},botonDespachar:{titulo:"Despachar",color:"primary",icono:"bi-pencil-square",accion:({entidad:i})=>{G.pedido=i,Ue.push("transacciones-egresos")},visible:({entidad:i})=>(y.value=="APROBADO"||y.value=="PARCIAL")&&(oe||p.esBodegueroTelconet)&&i.estado!=D.completa},botonAnularAutorizacion:{titulo:"Anular",color:"negative",icono:"bi-x",accion:({entidad:i,posicion:c})=>{Z("\xBFEst\xE1 seguro de anular el pedido?",()=>{_({titulo:"Causa de anulaci\xF3n",mensaje:"Ingresa el motivo de la anulaci\xF3n",accion:async F=>{try{const{result:N}=await new Se().anular(i.id,F);N.autorizacion===Pe.cancelado&&(ne("Pedido anulado con \xE9xito"),I.value.splice(c,1))}catch{de("No se pudo anular, debes ingresar un motivo para la anulaci\xF3n")}}})})},visible:({entidad:i})=>(y.value===Pe.aprobado||y.value===D.parcial)&&((i.per_autoriza_id===p.user.id||i.solicitante_id===p.user.id)&&i.estado===D.pendiente||p.esActivosFijos)||p.esAdministrador},botonMarcarComoCompletado:{titulo:"Marcar Completado",color:"green-6",icono:"bi-check-circle-fill",tooltip:"Marcar pedido como completado",accion:({entidad:i,posicion:c})=>{Z("\xBFEst\xE1 seguro de marcar el pedido como completado?",()=>{_({titulo:"Observaci\xF3n",mensaje:"Ingresa el motivo de marcar como completo el pedido",accion:async F=>{try{const{result:N}=await new Se().marcarCompletado(i.id,F);N.estado===D.completa&&(ne("Pedido marcado completado con \xE9xito"),I.value.splice(c,1))}catch{de("No se pudo completar el pedido, debes ingresar un motivo para la anulaci\xF3n")}}})})},visible:()=>y.value===D.parcial&&p.esBodeguero&&p.esCoordinadorBodega},store:p,modales:ue,soloLectura:x,all:He,only_sucursal:Ge,only_cliente_tarea:Je,group:Ye,options_groups:Ke,tabOptionsPedidos:$o,tabSeleccionado:y,puedeEditar:pe,esCoordinador:J,esCoordinadorBackup:p.esCoordinadorBackup,esBodeguero:oe,esTecnico:me,esActivosFijos:ae,esRRHH:ce,obtenerProyectosTareasTecnico:lo,obtenerEtapasProyecto:W,obtenerTareasEtapa:O,checkEvidencia(i){i||(r.evidencia1="",r.evidencia2="")},checkCliente(i){i?(r.per_retira=null,r.responsable=null):r.cliente=null},checkRetiraTercero(i){i||(r.per_retira=null)},checkEsTarea(i){i?r.responsable?ye():(Fe("Debes seleccionar primero un empleado (t\xE9cnico) responsable"),r.es_tarea=!1):r.tarea=null},ordenarLista:la,onRowClick:i=>alert(`${i.name} clicked`),obtenerDatosTareaSeleccionada:io,filtrarPedidos:so,recargarSucursales:ro,enRutaInspeccionIncidente:Me,consultar:R,reestablecer:j}}});const ba={class:"row q-col-gutter-sm q-py-md"},va={key:0,class:"col-12 col-md-3"},fa={key:1,class:"col-12 col-md-3"},ga={key:2,class:"col-12 col-md-3"},ya={class:"col-12 col-md-3"},Ca={class:"error-msg"},Va={class:"col-12 col-md-6"},Pa={class:"error-msg"},ka={class:"col-12 col-md-3"},wa={class:"row items-center justify-end"},$a={class:"error-msg"},qa={class:"col-12 col-md-3 q-mb-xl"},Ea={key:3,class:"col-12 col-md-3"},Sa={key:4,class:"col-12 col-md-3"},La={class:"error-msg"},Ba={class:"col-12 col-md-3 q-mb-xl"},Ta={key:5,class:"col-12 col-md-3"},Aa={class:"error-msg"},ja={key:6,class:"col-12 col-md-3 q-mb-xl"},Da={key:7,class:"col-12 col-md-3"},Fa={key:8,class:"col-12 col-md-3"},Ua={class:"error-msg"},ha={key:9,class:"col-12 col-md-3"},Ia={class:"error-msg"},Ra={key:10,class:"col-12 col-md-3"},za={key:11,class:"col-12 col-md-3 q-mb-md"},Oa={key:12,class:"col-12 col-md-3"},Na={class:"error-msg"},Qa={key:13,class:"col-12 col-md-3 q-mb-md"},Ma={class:"col-12 col-md-3 q-mb-xl"},Ha={key:14,class:"col-12 col-md-3"},Ga={key:15,class:"col-12 col-md-3"},Ja={key:16,class:"col-12 col-md-3"},Ya={key:17,class:"col-12 col-md-3"},Ka={key:18,class:"col-12 col-md-3"},Wa={key:19,class:"col-12 col-md-12"},Xa={class:"col-12 col-md-12"},Za={class:"row q-col-gutter-x-xs"},_a={class:"col-12 col-md-10 q-mb-md"},xa={class:"col-12 col-md-2"},es={class:"col-12"};function os(e,o,u,r,S,A){const v=Q("selector-imagen"),b=Q("essential-table"),I=Q("essential-selectable-table"),M=Q("tab-layout-filter-tabs2"),H=Q("modales-entidad");return n(),d(E,null,[s(M,{mixin:e.mixin,configuracionColumnas:e.configuracionColumnas,"titulo-pagina":"Pedido","tab-options":e.tabOptionsPedidos,tabDefecto:e.tabSeleccionado,filtrar:e.filtrarPedidos,permitirEditar:e.puedeEditar,"permitir-cancelar":!e.enRutaInspeccionIncidente,ajustarCeldas:"",paginate:"","mostrar-listado":!e.enRutaInspeccionIncidente,accion1:e.botonDespachar,accion2:e.botonAnularAutorizacion,accion3:e.botonCorregir,accion4:e.botonMarcarComoCompletado,accion5:e.botonImprimir},{formulario:l(()=>[s(Oo,{onSubmit:o[37]||(o[37]=So(()=>{},["prevent"]))},{default:l(()=>{var P;return[t("div",ba,[e.pedido.id?(n(),d("div",va,[o[38]||(o[38]=t("label",{class:"q-mb-sm block"},"Pedido N\xB0",-1)),s(q,{modelValue:e.pedido.id,"onUpdate:modelValue":o[0]||(o[0]=a=>e.pedido.id=a),placeholder:"Obligatorio",disable:e.disabled||e.soloLectura,outlined:"",dense:""},null,8,["modelValue","disable"])])):m("",!0),e.pedido.created_at?(n(),d("div",fa,[o[39]||(o[39]=t("label",{class:"q-mb-sm block"},"Fecha",-1)),s(q,{modelValue:e.pedido.created_at,"onUpdate:modelValue":o[1]||(o[1]=a=>e.pedido.created_at=a),disable:"",outlined:"",dense:""},null,8,["modelValue"])])):m("",!0),e.pedido.solicitante?(n(),d("div",ga,[o[41]||(o[41]=t("label",{class:"q-mb-sm block"},"Solicitante",-1)),s(V,{modelValue:e.pedido.solicitante,"onUpdate:modelValue":o[2]||(o[2]=a=>e.pedido.solicitante=a),options:e.empleados,"transition-show":"scale","transition-hide":"scale","options-dense":"",dense:"",outlined:"",disable:"","option-label":a=>a.nombres+" "+a.apellidos,"option-value":a=>a.id,"emit-value":"","map-options":""},{"no-option":l(()=>[s(k,null,{default:l(()=>[s(w,{class:"text-grey"},{default:l(()=>o[40]||(o[40]=[f(" No hay resultados ")])),_:1})]),_:1})]),_:1},8,["modelValue","options","option-label","option-value"])])):m("",!0),t("div",ya,[o[42]||(o[42]=t("label",{class:"q-mb-sm block"},"Sucursal",-1)),s(V,{modelValue:e.pedido.sucursal,"onUpdate:modelValue":o[3]||(o[3]=a=>e.pedido.sucursal=a),options:e.sucursales,"transition-show":"scale","transition-hide":"scale","options-dense":"",dense:"",outlined:"",disable:e.disabled||e.soloLectura,error:!!e.v$.sucursal.$errors.length,"error-message":"Debes seleccionar una sucursal","use-input":"","input-debounce":"0",onFilter:e.filtrarSucursales,onPopupShow:o[4]||(o[4]=a=>e.ordenarLista(e.sucursales,"lugar")),"option-label":a=>a.lugar,"option-value":a=>a.id,"emit-value":"","map-options":""},{error:l(()=>[(n(!0),d(E,null,T(e.v$.sucursal.$errors,a=>(n(),d("div",{key:a.$uid},[t("div",Ca,g(a.$message),1)]))),128))]),after:l(()=>[s(te,{color:"positive",onClick:e.recargarSucursales},{default:l(()=>[s(ke,{size:"xs",class:"q-mr-sm",name:"bi-arrow-clockwise"})]),_:1},8,["onClick"])]),_:1},8,["modelValue","options","disable","error","onFilter","option-label","option-value"])]),t("div",Va,[o[43]||(o[43]=t("label",{class:"q-mb-sm block"},"Justificaci\xF3n",-1)),s(q,{type:"textarea",autogrow:"",modelValue:e.pedido.justificacion,"onUpdate:modelValue":o[5]||(o[5]=a=>e.pedido.justificacion=a),placeholder:"Obligatorio",disable:e.disabled&&!e.store.esAdministrador||e.soloLectura&&!e.store.esAdministrador,error:!!e.v$.justificacion.$errors.length,outlined:"",dense:"",onBlur:e.v$.justificacion.$touch},{error:l(()=>[(n(!0),d(E,null,T(e.v$.justificacion.$errors,a=>(n(),d("div",{key:a.$uid},[t("div",Pa,g(a.$message),1)]))),128))]),_:1},8,["modelValue","disable","error","onBlur"])]),t("div",ka,[o[44]||(o[44]=t("label",{class:"q-mb-sm block"},"Fecha limite",-1)),s(q,{modelValue:e.pedido.fecha_limite,"onUpdate:modelValue":o[7]||(o[7]=a=>e.pedido.fecha_limite=a),placeholder:"Obligatorio",error:!!e.v$.fecha_limite.$errors.length,onBlur:e.v$.fecha_limite.$touch,disable:e.disabled||e.soloLectura,outlined:"",dense:""},{append:l(()=>[s(ke,{name:"event",class:"cursor-pointer"},{default:l(()=>[s(Fo,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:l(()=>[s(Uo,{modelValue:e.pedido.fecha_limite,"onUpdate:modelValue":o[6]||(o[6]=a=>e.pedido.fecha_limite=a),mask:"DD-MM-YYYY","today-btn":""},{default:l(()=>[t("div",wa,[Lo(s(te,{label:"Cerrar",color:"primary",flat:""},null,512),[[ho]])])]),_:1},8,["modelValue"])]),_:1})]),_:1})]),error:l(()=>[(n(!0),d(E,null,T(e.v$.fecha_limite.$errors,a=>(n(),d("div",{style:{clear:"inherit"},key:a.$uid},[t("div",$a,g(a.$message),1)]))),128))]),_:1},8,["modelValue","error","onBlur","disable"])]),t("div",qa,[s(X,{class:"q-mt-lg q-pt-md",modelValue:e.pedido.para_cliente,"onUpdate:modelValue":[o[8]||(o[8]=a=>e.pedido.para_cliente=a),e.checkCliente],label:"\xBFEs material para el cliente?",disable:e.disabled||e.soloLectura,outlined:"",dense:""},null,8,["modelValue","disable","onUpdate:modelValue"])]),e.pedido.para_cliente?(n(),d("div",Ea,[o[45]||(o[45]=t("label",{class:"q-mb-sm block"},"Cliente",-1)),s(V,{modelValue:e.pedido.cliente,"onUpdate:modelValue":o[9]||(o[9]=a=>e.pedido.cliente=a),options:e.clientes,"transition-show":"jump-up","transition-hide":"jump-up","options-dense":"",dense:"",outlined:"","use-input":"","input-debounce":"0",onFilter:e.filtrarClientes,onPopupShow:o[10]||(o[10]=a=>e.ordenarLista(e.clientes,"razon_social")),"option-label":a=>a.razon_social,"option-value":a=>a.id,"emit-value":"","map-options":""},null,8,["modelValue","options","onFilter","option-label","option-value"])])):m("",!0),(e.esCoordinador||e.esCoordinadorBackup)&&!e.pedido.para_cliente||e.esRRHH&&!e.pedido.para_cliente||!e.esTecnico&&!e.pedido.para_cliente?(n(),d("div",Sa,[o[47]||(o[47]=t("label",{class:"q-mb-sm block"},"Responsable",-1)),s(V,{modelValue:e.pedido.responsable,"onUpdate:modelValue":[o[11]||(o[11]=a=>e.pedido.responsable=a),e.obtenerProyectosTareasTecnico],options:e.empleados,"transition-show":"jump-up","transition-hide":"jump-up","options-dense":"",dense:"",outlined:"","use-input":"","input-debounce":"0",onFilter:e.filtrarEmpleados,onPopupShow:o[12]||(o[12]=a=>e.ordenarLista(e.empleados,"apellidos")),"error-message":"Debes seleccionar el responsable de los materiales",error:!!e.v$.responsable.$errors.length,disable:e.disabled||e.soloLectura,"option-label":a=>a.apellidos+" "+a.nombres,"option-value":a=>a.id,"emit-value":"","map-options":""},{"no-option":l(()=>[s(k,null,{default:l(()=>[s(w,{class:"text-grey"},{default:l(()=>o[46]||(o[46]=[f(" No hay resultados ")])),_:1})]),_:1})]),error:l(()=>[(n(!0),d(E,null,T(e.v$.responsable.$errors,a=>(n(),d("div",{key:a.$uid},[t("div",La,g(a.$message),1)]))),128))]),_:1},8,["modelValue","options","onFilter","onUpdate:modelValue","error","disable","option-label","option-value"])])):m("",!0),t("div",Ba,[s(X,{class:"q-mt-lg q-pt-md",modelValue:e.pedido.retira_tercero,"onUpdate:modelValue":[o[13]||(o[13]=a=>e.pedido.retira_tercero=a),e.checkRetiraTercero],label:"\xBFRetira otra persona?",disable:e.disabled||e.soloLectura,outlined:"",dense:""},null,8,["modelValue","disable","onUpdate:modelValue"])]),e.pedido.retira_tercero?(n(),d("div",Ta,[o[49]||(o[49]=t("label",{class:"q-mb-sm block"},"Persona que retira",-1)),s(V,{modelValue:e.pedido.per_retira,"onUpdate:modelValue":o[14]||(o[14]=a=>e.pedido.per_retira=a),options:e.empleados,"transition-show":"jump-up","transition-hide":"jump-up","options-dense":"",dense:"",outlined:"","use-input":"","input-debounce":"0",onFilter:e.filtrarEmpleados,onPopupShow:o[15]||(o[15]=a=>e.ordenarLista(e.empleados,"apellidos")),"error-message":"Debes seleccionar la persona que retira los materiales",error:!!e.v$.per_retira.$errors.length,disable:e.disabled||e.soloLectura,"option-label":a=>a.apellidos+" "+a.nombres,"option-value":a=>a.id,"emit-value":"","map-options":""},{"no-option":l(()=>[s(k,null,{default:l(()=>[s(w,{class:"text-grey"},{default:l(()=>o[48]||(o[48]=[f(" No hay resultados ")])),_:1})]),_:1})]),error:l(()=>[(n(!0),d(E,null,T(e.v$.per_retira.$errors,a=>(n(),d("div",{key:a.$uid},[t("div",Aa,g(a.$message),1)]))),128))]),_:1},8,["modelValue","options","onFilter","error","disable","option-label","option-value"])])):m("",!0),e.pedido.es_tarea||e.accion==="NUEVO"?(n(),d("div",ja,[s(X,{class:"q-mt-lg q-pt-md",modelValue:e.pedido.es_tarea,"onUpdate:modelValue":[o[16]||(o[16]=a=>e.pedido.es_tarea=a),e.checkEsTarea],label:"\xBFEs material de proyecto/tarea?",disable:e.disabled||e.soloLectura,outlined:"",dense:""},null,8,["modelValue","disable","onUpdate:modelValue"])])):m("",!0),e.pedido.es_tarea||e.pedido.proyecto?(n(),d("div",Da,[o[51]||(o[51]=t("label",{class:"q-mb-sm block"},"Proyecto",-1)),s(V,{modelValue:e.pedido.proyecto,"onUpdate:modelValue":[o[17]||(o[17]=a=>e.pedido.proyecto=a),o[18]||(o[18]=a=>e.obtenerEtapasProyecto(!0,!0))],options:e.proyectos,onFilter:e.filtrarProyectos,"transition-show":"scale","transition-hide":"scale",hint:"Opcional","options-dense":"",dense:"",outlined:"",clearable:"","option-label":a=>a.nombre,"option-value":a=>a.id,"use-input":"","input-debounce":"0","emit-value":"","map-options":"",disable:e.disabled||e.soloLectura},{option:l(a=>[s(k,we(a.itemProps,{class:"q-my-sm"}),{default:l(()=>[s(w,null,{default:l(()=>[s(U,{class:"text-bold text-primary"},{default:l(()=>[f(g(a.opt.codigo_proyecto),1)]),_:2},1024),s(U,{caption:""},{default:l(()=>[f(g(a.opt.nombre),1)]),_:2},1024)]),_:2},1024)]),_:2},1040)]),"no-option":l(()=>[s(k,null,{default:l(()=>[s(w,{class:"text-grey"},{default:l(()=>o[50]||(o[50]=[f(" No hay resultados ")])),_:1})]),_:1})]),_:1},8,["modelValue","options","onFilter","option-label","option-value","disable"])])):m("",!0),((P=e.etapas)==null?void 0:P.length)||e.pedido.etapa?(n(),d("div",Fa,[o[53]||(o[53]=t("label",{class:"q-mb-sm block"},"Etapa",-1)),s(V,{modelValue:e.pedido.etapa,"onUpdate:modelValue":[o[19]||(o[19]=a=>e.pedido.etapa=a),o[20]||(o[20]=a=>e.obtenerTareasEtapa(e.pedido.etapa))],options:e.etapas,onFilter:e.filtrarEtapas,"transition-show":"scale","transition-hide":"scale",hint:"Obligatorio","options-dense":"",dense:"",clearable:"",outlined:"","option-label":a=>a.nombre,"option-value":a=>a.id,"use-input":"","input-debounce":"0","emit-value":"","map-options":"",disable:e.disabled||e.soloLectura,onBlur:e.v$.etapa.$touch,error:!!e.v$.etapa.$errors.length},{option:l(a=>[s(k,we(a.itemProps,{class:"q-my-sm"}),{default:l(()=>[s(w,null,{default:l(()=>[s(U,{class:"text-bold text-primary"},{default:l(()=>[f(g(a.opt.nombre),1)]),_:2},1024),s(U,{caption:""},{default:l(()=>[f("Supervisor: "+g(a.opt.supervisor_responsable),1)]),_:2},1024)]),_:2},1024)]),_:2},1040)]),"no-option":l(()=>[s(k,null,{default:l(()=>[s(w,{class:"text-grey"},{default:l(()=>o[52]||(o[52]=[f(" No hay resultados ")])),_:1})]),_:1})]),error:l(()=>[(n(!0),d(E,null,T(e.v$.etapa.$errors,a=>(n(),d("div",{key:a.$uid},[t("div",Ua,g(a.$message),1)]))),128))]),_:1},8,["modelValue","options","onFilter","option-label","option-value","disable","onBlur","error"])])):m("",!0),e.pedido.es_tarea?(n(),d("div",ha,[o[55]||(o[55]=t("label",{class:"q-mb-sm block"},"Tarea",-1)),s(V,{modelValue:e.pedido.tarea,"onUpdate:modelValue":[o[21]||(o[21]=a=>e.pedido.tarea=a),e.obtenerDatosTareaSeleccionada],options:e.tareas,"transition-show":"scale","transition-hide":"scale","options-dense":"",clearable:"",hint:"Obligatorio",dense:"",outlined:"",disable:e.disabled||e.soloLectura,error:!!e.v$.tarea.$errors.length,"use-input":"","input-debounce":"0",onFilter:e.filtrarTareas,"error-message":"Debe seleccionar una tarea","option-label":a=>a.codigo_tarea+" - "+a.titulo,"option-value":a=>a.id,"emit-value":"","map-options":""},{option:l(a=>[s(k,Bo(To(a.itemProps)),{default:l(()=>[s(w,null,{default:l(()=>[s(U,null,{default:l(()=>[f(g(a.opt.codigo_tarea),1)]),_:2},1024),s(U,{caption:""},{default:l(()=>[f(g(a.opt.titulo),1)]),_:2},1024)]),_:2},1024)]),_:2},1040)]),error:l(()=>[(n(!0),d(E,null,T(e.v$.tarea.$errors,a=>(n(),d("div",{key:a.$uid},[t("div",Ia,g(a.$message),1)]))),128))]),"no-option":l(()=>[s(k,null,{default:l(()=>[s(w,{class:"text-grey"},{default:l(()=>o[54]||(o[54]=[f(" No hay resultados ")])),_:1})]),_:1})]),_:1},8,["modelValue","options","disable","error","onFilter","onUpdate:modelValue","option-label","option-value"])])):m("",!0),e.pedido.per_autoriza?(n(),d("div",Ra,[o[56]||(o[56]=t("label",{class:"q-mb-sm block"},"Persona que autoriza",-1)),s(V,{modelValue:e.pedido.per_autoriza,"onUpdate:modelValue":o[22]||(o[22]=a=>e.pedido.per_autoriza=a),options:e.empleados,"transition-show":"jump-up","transition-hide":"jump-up","options-dense":"",dense:"",outlined:"",disable:"","option-label":a=>a.nombres+" "+a.apellidos,"option-value":a=>a.id,"emit-value":"","map-options":""},null,8,["modelValue","options","option-label","option-value"])])):m("",!0),e.pedido.autorizacion?(n(),d("div",za,[o[58]||(o[58]=t("label",{class:"q-mb-sm block"},"Autorizacion",-1)),s(V,{modelValue:e.pedido.autorizacion,"onUpdate:modelValue":o[23]||(o[23]=a=>e.pedido.autorizacion=a),options:e.autorizaciones,"transition-show":"jum-up","transition-hide":"jump-down","options-dense":"",dense:"",outlined:"",disable:e.disabled||e.store.user.id!=e.pedido.per_autoriza_id&&!e.store.esCoordinadorBodega,"option-value":a=>a.id,"option-label":a=>a.nombre,"emit-value":"","map-options":""},{"no-option":l(()=>[s(k,null,{default:l(()=>[s(w,{class:"text-grey"},{default:l(()=>o[57]||(o[57]=[f(" No hay resultados ")])),_:1})]),_:1})]),_:1},8,["modelValue","options","disable","option-value","option-label"])])):m("",!0),e.store.user.id===e.pedido.per_autoriza_id?(n(),d("div",Oa,[o[59]||(o[59]=t("label",{class:"q-mb-sm block"},"Observacion",-1)),s(q,{autogrow:"",modelValue:e.pedido.observacion_aut,"onUpdate:modelValue":o[24]||(o[24]=a=>e.pedido.observacion_aut=a),placeholder:"Opcional",disable:e.disabled||e.soloLectura&&!(e.esCoordinador||e.esActivosFijos||e.store.user.id==e.pedido.per_autoriza_id),error:!!e.v$.observacion_aut.$errors.length,outlined:"",dense:""},{error:l(()=>[(n(!0),d(E,null,T(e.v$.observacion_aut.$errors,a=>(n(),d("div",{key:a.$uid},[t("div",Na,g(a.$message),1)]))),128))]),_:1},8,["modelValue","disable","error"])])):m("",!0),e.pedido.estado||e.accion===e.acciones.consultar?(n(),d("div",Qa,[o[60]||(o[60]=t("label",{class:"q-mb-sm block"},"Estado del despacho",-1)),s(V,{modelValue:e.pedido.estado,"onUpdate:modelValue":o[25]||(o[25]=a=>e.pedido.estado=a),options:e.estados,"transition-show":"jum-up","transition-hide":"jump-down","options-dense":"",dense:"",outlined:"",disable:"","option-value":a=>a.id,"option-label":a=>a.nombre,"emit-value":"","map-options":""},null,8,["modelValue","options","option-value","option-label"])])):m("",!0),t("div",Ma,[s(X,{class:"q-mt-lg q-pt-md",modelValue:e.pedido.tiene_evidencia,"onUpdate:modelValue":[o[26]||(o[26]=a=>e.pedido.tiene_evidencia=a),e.checkEvidencia],label:"\xBFTiene evidencia fotogr\xE1fica?",disable:e.disabled||e.soloLectura,outlined:"",dense:""},null,8,["modelValue","disable","onUpdate:modelValue"])]),e.pedido.tiene_evidencia||e.pedido.evidencia1?(n(),d("div",Ha,[o[61]||(o[61]=t("label",{class:"q-mb-sm block"},"Evidencia 1 ",-1)),s(v,{file_extensiones:".jpg, image/*",imagen:e.pedido.evidencia1,alto:"200px","onUpdate:modelValue":o[27]||(o[27]=a=>e.pedido.evidencia1=a)},null,8,["imagen"])])):m("",!0),e.pedido.tiene_evidencia||e.pedido.evidencia2?(n(),d("div",Ga,[o[62]||(o[62]=t("label",{class:"q-mb-sm block"},"Evidencia 2",-1)),s(v,{file_extensiones:".jpg, image/*",imagen:e.pedido.evidencia2,alto:"200px","onUpdate:modelValue":o[28]||(o[28]=a=>e.pedido.evidencia2=a)},null,8,["imagen"])])):m("",!0),e.pedido.observacion_est||e.accion===e.acciones.nuevo?(n(),d("div",Ja,[o[63]||(o[63]=t("label",{class:"q-mb-sm block"},"Observacion",-1)),s(q,{autogrow:"",modelValue:e.pedido.observacion_est,"onUpdate:modelValue":o[29]||(o[29]=a=>e.pedido.observacion_est=a),placeholder:"Opcional",disable:e.disabled||e.soloLectura&&!e.esCoordinador,outlined:"",dense:""},null,8,["modelValue","disable"])])):m("",!0),e.pedido.observacion_bodega?(n(),d("div",Ya,[o[64]||(o[64]=t("label",{class:"q-mb-sm block"},"Observacion del bodeguero",-1)),s(q,{autogrow:"",modelValue:e.pedido.observacion_bodega,"onUpdate:modelValue":o[30]||(o[30]=a=>e.pedido.observacion_bodega=a),disable:"",outlined:"",dense:""},null,8,["modelValue"])])):m("",!0),e.pedido.estado_orden_compra?(n(),d("div",Ka,[o[65]||(o[65]=t("label",{class:"q-mb-sm block"},"Estado Orden de Compra",-1)),s(q,{autogrow:"",modelValue:e.pedido.estado_orden_compra,"onUpdate:modelValue":o[31]||(o[31]=a=>e.pedido.estado_orden_compra=a),disable:"",outlined:"",dense:""},null,8,["modelValue"])])):m("",!0),e.accion==e.acciones.nuevo?(n(),d("div",Wa,[s(Ao,{modelValue:e.group,"onUpdate:modelValue":o[32]||(o[32]=a=>e.group=a),options:e.options_groups,color:"primary"},null,8,["modelValue","options"])])):m("",!0),t("div",Xa,[o[67]||(o[67]=t("label",{class:"q-mb-sm block"},"Agregar productos",-1)),t("div",Za,[t("div",_a,[s(q,{modelValue:e.criterioBusquedaProducto,"onUpdate:modelValue":o[33]||(o[33]=a=>e.criterioBusquedaProducto=a),disable:e.disabled,placeholder:"Nombre de producto",hint:"Presiona Enter para seleccionar un producto",onKeydown:o[34]||(o[34]=jo(a=>e.listarProductos({tipo_busqueda:e.group,search:e.criterioBusquedaProducto,sucursal_id:e.pedido.sucursal,cliente_id:e.pedido.cliente||e.pedido.cliente_id,stock:!0}),["enter"])),onBlur:o[35]||(o[35]=a=>e.criterioBusquedaProducto===""?e.limpiarProducto():null),outlined:"",dense:""},null,8,["modelValue","disable"])]),t("div",xa,[s(te,{onClick:o[36]||(o[36]=a=>e.listarProductos({tipo_busqueda:e.group,search:e.criterioBusquedaProducto,sucursal_id:e.pedido.sucursal,cliente_id:e.pedido.cliente||e.pedido.cliente_id,stock:!0})),icon:"search",unelevated:"",color:"positive",class:"full-width",style:{height:"40px"},disable:e.disabled,"no-caps":"",glossy:""},{default:l(()=>o[66]||(o[66]=[f("Buscar")])),_:1},8,["disable"])])])]),t("div",es,[e.tablaRefrescada?(n(),Do(b,{key:0,titulo:"Productos Seleccionados",configuracionColumnas:e.accion===e.acciones.nuevo||e.accion===e.acciones.editar?e.configuracionColumnasProductosSeleccionados:e.configuracionColumnasProductosSeleccionadosDespachado,datos:e.pedido.listadoProductos,permitirConsultar:!1,permitirEditar:!1,permitirEliminar:!1,mostrarBotones:!1,accion1:e.botonEditarCantidad,accion2:e.botonEliminar,ajustarCeldas:!0,altoFijo:!1},{body:l(a=>[s(da,{props:a,onClick:R=>e.onRowClick(a.row)},{default:l(()=>[s(zo,{key:"name",props:a},{default:l(()=>[f(g(a.row.name),1)]),_:2},1032,["props"])]),_:2},1032,["props","onClick"])]),_:1},8,["configuracionColumnas","datos","accion1","accion2"])):m("",!0)])])]}),_:1}),s(I,{ref:"refListado","configuracion-columnas":e.configuracionColumnasDetallesModal,datos:e.listadoProductos,"tipo-seleccion":"multiple",onSelected:e.seleccionarProducto},null,8,["configuracion-columnas","datos","onSelected"])]),_:1},8,["mixin","configuracionColumnas","tab-options","tabDefecto","filtrar","permitirEditar","permitir-cancelar","mostrar-listado","accion1","accion2","accion3","accion4","accion5"]),s(H,{comportamiento:e.modales},null,8,["comportamiento"])],64)}var ui=Eo(ca,[["render",os]]);export{ui as default};
