var ee=Object.defineProperty;var oe=(e,r,u)=>r in e?ee(e,r,{enumerable:!0,configurable:!0,writable:!0,value:u}):e[r]=u;var F=(e,r,u)=>(oe(e,typeof r!="symbol"?r+"":r,u),u);import{ab as ae,b2 as te,at as re,b3 as ne,bK as se,c as H,f as I,o as ie,k as P,aD as le,B as E,g as ue,bM as ce,ah as Q,bx as X,s as Y,d as de,bc as me,m as fe,R as ge,_ as be,t as R,v as i,P as m,F as f,z as y,bd as M,be as N,y as A,x as L,H as U,G,J as _,T as K,bH as ve,O as J,D as W,K as D,I as ye}from"./index.2ef7a81a.js";import{b as Ce}from"./format.8ac60962.js";import{Q as he}from"./QSelect.69d1b992.js";import{Q as Se}from"./QPage.2bc1c297.js";import{S as Ae,i as _e}from"./utils.a862dc08.js";import{r as pe}from"./EssentialTable.f528a579.js";import{r as xe}from"./i18n-validators.46fc4c83.js";import{u as Ie}from"./index.e8d8fb1e.js";import Le from"./CuestionarioDiagnosticoConsumoDrogasPage.a1a4bdb5.js";import Ve from"./CuestionarioPsicosocialPage.63b36cc5.js";import{T as qe}from"./TabLayout.5bc8ab45.js";import{B as we}from"./buttonSubmits.35676009.js";import{C as ke}from"./ContenedorSimpleMixin.617817a8.js";import{T as $e,R as He}from"./RespuestaCuestionarioEmpleado.c1c0dc89.js";var Ee=ae({name:"QRating",props:{...te,...re,modelValue:{type:Number,required:!0},max:{type:[String,Number],default:5},icon:[String,Array],iconHalf:[String,Array],iconSelected:[String,Array],iconAriaLabel:[String,Array],color:[String,Array],colorHalf:[String,Array],colorSelected:[String,Array],noReset:Boolean,noDimming:Boolean,readonly:Boolean,disable:Boolean},emits:["update:modelValue"],setup(e,{slots:r,emit:u}){const{proxy:{$q:p}}=ue(),V=ne(e),q=se(e),C=ce(q),l=H(0);let g={};const n=I(()=>e.readonly!==!0&&e.disable!==!0),v=I(()=>`q-rating row inline items-center q-rating--${n.value===!0?"":"non-"}editable`+(e.noDimming===!0?" q-rating--no-dimming":"")+(e.disable===!0?" disabled":"")+(e.color!==void 0&&Array.isArray(e.color)===!1?` text-${e.color}`:"")),h=I(()=>{const t=Array.isArray(e.icon)===!0?e.icon.length:0,a=Array.isArray(e.iconSelected)===!0?e.iconSelected.length:0,c=Array.isArray(e.iconHalf)===!0?e.iconHalf.length:0,d=Array.isArray(e.color)===!0?e.color.length:0,b=Array.isArray(e.colorSelected)===!0?e.colorSelected.length:0,o=Array.isArray(e.colorHalf)===!0?e.colorHalf.length:0;return{iconLen:t,icon:t>0?e.icon[t-1]:e.icon,selIconLen:a,selIcon:a>0?e.iconSelected[a-1]:e.iconSelected,halfIconLen:c,halfIcon:c>0?e.iconHalf[a-1]:e.iconHalf,colorLen:d,color:d>0?e.color[d-1]:e.color,selColorLen:b,selColor:b>0?e.colorSelected[b-1]:e.colorSelected,halfColorLen:o,halfColor:o>0?e.colorHalf[o-1]:e.colorHalf}}),B=I(()=>{if(typeof e.iconAriaLabel=="string"){const t=e.iconAriaLabel.length!==0?`${e.iconAriaLabel} `:"";return a=>`${t}${a}`}if(Array.isArray(e.iconAriaLabel)===!0){const t=e.iconAriaLabel.length;if(t>0)return a=>e.iconAriaLabel[Math.min(a,t)-1]}return(t,a)=>`${a} ${t}`}),x=I(()=>{const t=[],a=h.value,c=Math.ceil(e.modelValue),d=n.value===!0?0:null,b=e.iconHalf===void 0||c===e.modelValue?-1:c;for(let o=1;o<=e.max;o++){const s=l.value===0&&e.modelValue>=o||l.value>0&&l.value>=o,S=b===o&&l.value<o,T=l.value>0&&(S===!0?c:e.modelValue)>=o&&l.value<o,z=S===!0?o<=a.halfColorLen?e.colorHalf[o-1]:a.halfColor:a.selColor!==void 0&&s===!0?o<=a.selColorLen?e.colorSelected[o-1]:a.selColor:o<=a.colorLen?e.color[o-1]:a.color,Z=(S===!0?o<=a.halfIconLen?e.iconHalf[o-1]:a.halfIcon:a.selIcon!==void 0&&(s===!0||T===!0)?o<=a.selIconLen?e.iconSelected[o-1]:a.selIcon:o<=a.iconLen?e.icon[o-1]:a.icon)||p.iconSet.rating.icon;t.push({name:(S===!0?o<=a.halfIconLen?e.iconHalf[o-1]:a.halfIcon:a.selIcon!==void 0&&(s===!0||T===!0)?o<=a.selIconLen?e.iconSelected[o-1]:a.selIcon:o<=a.iconLen?e.icon[o-1]:a.icon)||p.iconSet.rating.icon,attrs:{tabindex:d,role:"radio","aria-checked":e.modelValue===o?"true":"false","aria-label":B.value(o,Z)},iconClass:"q-rating__icon"+(s===!0||S===!0?" q-rating__icon--active":"")+(T===!0?" q-rating__icon--exselected":"")+(l.value===o?" q-rating__icon--hovered":"")+(z!==void 0?` text-${z}`:"")})}return t}),j=I(()=>{const t={role:"radiogroup"};return e.disable===!0&&(t["aria-disabled"]="true"),e.readonly===!0&&(t["aria-readonly"]="true"),t});function w(t){if(n.value===!0){const a=Ce(parseInt(t,10),1,parseInt(e.max,10)),c=e.noReset!==!0&&e.modelValue===a?0:a;c!==e.modelValue&&u("update:modelValue",c),l.value=0}}function k(t){n.value===!0&&(l.value=t)}function O(t,a){switch(t.keyCode){case 13:case 32:return w(a),Q(t);case 37:case 40:return g[`rt${a-1}`]&&g[`rt${a-1}`].focus(),Q(t);case 39:case 38:return g[`rt${a+1}`]&&g[`rt${a+1}`].focus(),Q(t)}}function $(){l.value=0}return ie(()=>{g={}}),()=>{const t=[];return x.value.forEach(({iconClass:a,name:c,attrs:d},b)=>{const o=b+1;t.push(P("div",{key:o,ref:s=>{g[`rt${o}`]=s},class:"q-rating__icon-container flex flex-center",...d,onClick(){w(o)},onMouseover(){k(o)},onMouseout:$,onFocus(){k(o)},onBlur:$,onKeyup(s){O(s,o)}},le(r[`tip-${o}`],[P(E,{class:a,name:c})])))}),e.name!==void 0&&e.disable!==!0&&C(t,"push"),P("div",{class:v.value,style:V.value,...j.value},t)}}});class Be{constructor(r){F(this,"respuestaCuestionarioEmpleado");this.respuestaCuestionarioEmpleado=r}async validar(){const r=this.respuestaCuestionarioEmpleado.cuestionario.filter(u=>u.id_cuestionario);if(this.respuestaCuestionarioEmpleado.cuestionario.length!==r.length)throw new Error("No ha llenado todo el cuestionario!");return!0}}class Oe extends X{constructor(){super(Y.respuestas_cuestionarios_empleados)}}class Te extends X{constructor(){super(Y.preguntas)}}var Pe=de({components:{TabLayout:qe,ButtonSubmits:we,CuestionarioPsicosocialHeader:Ve,CuestionarioDiagnosticoConsumoDrogasHeader:Le},props:{mixin:{type:Object,required:!1}},setup(e){var b;me().setQuasar(fe());const r=H([]),u=new Ae,p=H(),{confirmar:V}=ge(),q=new $e,C=(b=e.mixin)!=null?b:new ke(He,new Oe),{obtenerListados:l,cargarVista:g,setValidador:n,guardar:v}=C.useComportamiento(),{entidad:h,accion:B,listadosAuxiliares:x}=C.useReferencias();g(async()=>{await l({preguntas:[]})}),q.listar().then(o=>{const{result:s}=o;r.value=s});const w=Ie({cuestionario:{required:xe}},h);n(w.value);const k=new Be(h);C.agregarValidaciones(k);function O(o){return o.map(s=>({label:s.respuesta,value:s.id}))}const $=()=>h.cuestionario=x.preguntas.map(o=>({respuesta_texto:typeof o.respuesta=="string"?o.respuesta:null,id_cuestionario:typeof o.respuesta=="string"?o.cuestionario[0].id:o.respuesta})),t=async()=>{V("Las respuestas ser\xE1n enviadas y no podr\xE1n ser modificadas. \xBFDesea continuar?",async()=>{try{$(),await v(h),x.preguntas=[],d.value="Gracias por completar el cuestionario."}catch(o){console.log(o)}})};async function a(o){p.value=o,u.activar();try{const{result:s}=await c.listar({tipo_cuestionario_id:o});x.preguntas=s}catch(s){if(_e(s)){const S=s.erroresValidacion;d.value=S[0]}}finally{u.desactivar()}}const c=new Te,d=H();return{consultarPreguntas:a,mapearCuestionario:O,listadosAuxiliares:x,tiposCuestionarios:r,mensaje:d,accion:B,guardarCuestionario:t,tipoCuestionarioSeleccionado:p,opcionesTiposCuestionarios:pe}}});const Qe={class:"text-center full-width"},Re={key:0},Me={key:2,class:"col-12 text-positive text-bold text-h5"},Ne={class:"q-mb-md"},De={class:"row q-col-gutter-x-sm"},je={class:"q-mb-sm block"},ze={class:"row full-width justify-center"};function Fe(e,r,u,p,V,q){const C=R("cuestionario-psicosocial-header"),l=R("cuestionario-diagnostico-consumo-drogas-header"),g=R("button-submits");return i(),m(Se,{padding:""},{default:f(()=>[y(K,{name:"scale",mode:"out-in"},{default:f(()=>[e.listadosAuxiliares.preguntas.length?_("",!0):(i(),m(M,{key:0,flat:"",class:"q-mb-sm bg-desenfoque border-white"},{default:f(()=>[y(N,{class:"row q-col-gutter-sm text-center"},{default:f(()=>[r[2]||(r[2]=A("div",{class:"full-width text-bold"},"Cuestionarios disponibles",-1)),r[3]||(r[3]=A("small",{class:"block text-center full-width q-mb-md"},"Los cuestionarios que no puede seleccionar ya han sido completados por usted",-1)),A("div",Qe,[(i(!0),L(G,null,U(e.tiposCuestionarios,(n,v)=>(i(),m(J,{key:v,class:"full-width text-primary bg-white q-mb-sm","no-caps":"",unelevated:"",disable:n.finalizado,onClick:h=>e.consultarPreguntas(n.id)},{default:f(()=>[n.finalizado?(i(),m(E,{key:0,name:"bi-check-circle-fill",class:"q-mr-sm",color:"positive"})):(i(),m(E,{key:1,name:"bi-check-circle",class:"q-mr-sm",color:"positive"})),W(" "+D(n.titulo),1)]),_:2},1032,["disable","onClick"]))),128))])]),_:1})]),_:1}))]),_:1}),y(K,{name:"scale",mode:"out-in"},{default:f(()=>[e.listadosAuxiliares.preguntas.length?(i(),L("div",Re,[y(M,{flat:"",class:"q-mb-sm bg-desenfoque border-white"},{default:f(()=>[ve(e.$slots,"persona"),y(N,null,{default:f(()=>[y(J,{color:"primary","no-caps":"",unelevated:"",square:"",onClick:r[0]||(r[0]=n=>e.listadosAuxiliares.preguntas=[])},{default:f(()=>[y(E,{name:"bi-arrow-left",class:"q-mr-sm"}),r[4]||(r[4]=W(" Volver a ver los cuestionarios disponibles"))]),_:1})]),_:1})]),_:3}),e.listadosAuxiliares.preguntas.length?(i(),m(M,{key:0,flat:"",class:"q-mb-sm border-white"},{default:f(()=>[y(N,{class:"row q-col-gutter-sm text-center"},{default:f(()=>[e.tipoCuestionarioSeleccionado===e.opcionesTiposCuestionarios.CUESTIONARIO_PSICOSOCIAL?(i(),m(C,{key:0})):_("",!0),e.tipoCuestionarioSeleccionado===e.opcionesTiposCuestionarios.CUESTIONARIO_DIAGNOSTICO_CONSUMO_DE_DROGAS?(i(),m(l,{key:1})):_("",!0),e.mensaje?(i(),L("div",Me,[A("div",Ne,D(e.mensaje),1),y(Ee,{"model-value":5,name:"bi-star-fill",maz:"5",color:"amber"})])):_("",!0),A("div",De,[(i(!0),L(G,null,U(e.listadosAuxiliares.preguntas,n=>(i(),L("div",{key:n.id,class:"col-12 col-md-6 text-bold text-justify q-mb-md"},[A("label",je,D(n.codigo+".- "+n.pregunta),1),n.cuestionario[0].respuesta?(i(),m(he,{key:0,modelValue:n.respuesta,"onUpdate:modelValue":v=>n.respuesta=v,options:e.mapearCuestionario(n.cuestionario),color:"primary",outlined:"",dense:"","options-dense":"","emit-value":"","map-options":""},null,8,["modelValue","onUpdate:modelValue","options"])):(i(),m(ye,{key:1,modelValue:n.respuesta,"onUpdate:modelValue":v=>n.respuesta=v,placeholder:"Escriba...",outlined:"",dense:""},null,8,["modelValue","onUpdate:modelValue"]))]))),128))]),A("div",ze,[e.listadosAuxiliares.preguntas.length?(i(),m(g,{key:0,accion:e.accion,"label-guardar":"Guardar y enviar respuestas",permitirCancelar:!1,onGuardar:r[1]||(r[1]=n=>e.guardarCuestionario())},null,8,["accion"])):_("",!0)])]),_:1})]),_:1})):_("",!0)])):_("",!0)]),_:3})]),_:3})}var Ue=be(Pe,[["render",Fe]]),lo=Object.freeze(Object.defineProperty({__proto__:null,default:Ue},Symbol.toStringTag,{value:"Module"}));export{Ue as C,Te as P,Ee as Q,lo as a};
