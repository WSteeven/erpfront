var So=Object.defineProperty;var ko=(a,o,f)=>o in a?So(a,o,{enumerable:!0,configurable:!0,writable:!0,value:f}):a[o]=f;var c=(a,o,f)=>(ko(a,typeof o!="symbol"?o+"":o,f),f);import{Q as L}from"./QSelect.69d1b992.js";import{bx as Io,s as Z,A as Bo,bF as Mo,d as Do,R as No,c as g,u as Ao,f as k,E as Oo,a2 as Q,by as To,q as qo,d4 as jo,p as Uo,_ as Lo,t as y,v as I,P as Y,F as i,z as n,a5 as Qo,y as m,I as C,B as R,j as H,O as J,x as Yo,J as G}from"./index.2ef7a81a.js";import{Q as K,a as W,C as X}from"./QPopupProxy.567210a4.js";import{Q as Ro}from"./QForm.e1af9500.js";import{r as E,a as Ho}from"./i18n-validators.46fc4c83.js";import{c as Jo,d as Go}from"./index.e1f41ef1.js";import{u as Ko}from"./index.e8d8fb1e.js";import{T as Wo}from"./TabLayoutFilterTabs2.2c3270e4.js";import{S as Xo,E as Zo}from"./EssentialTable.f528a579.js";import{E as xo}from"./ErrorComponent.94e1365a.js";import{N as oa}from"./NoOptionComponent.264184d7.js";import{C as aa}from"./ContenedorSimpleMixin.617817a8.js";import{E as ea}from"./entidadAuditable.75a46700.js";import{y as la,P as ta,L as ra}from"./utils.a862dc08.js";import{M as sa}from"./MotivoPermisoEmpleadoController.b0ad8a6e.js";import{u as na}from"./recursosHumanos.ef05fa51.js";import{P as ia}from"./PeriodoController.a2590ea4.js";import{u as ma}from"./filtrosListadosGenerales.79b6e840.js";import"./QChip.c5c0b225.js";import"./QItemSection.3a5d4c83.js";import"./QMenu.f50512a6.js";import"./position-engine.093dda28.js";import"./format.8ac60962.js";import"./QTabs.5cdabeb1.js";import"./QResizeObserver.8bc492d6.js";import"./QTabPanels.7f1e5320.js";import"./touch.9135741d.js";import"./QPage.2bc1c297.js";import"./EssentialTableTabs.3fb37590.js";import"./QBadge.ebf9f349.js";import"./EssentialTablePagination.73d42aee.js";import"./QToolbar.ff7ff7d8.js";import"./use-fullscreen.a336d1b1.js";import"./buttonSubmits.35676009.js";import"./QFile.f5c4066f.js";import"./_commonjsHelpers.8402d862.js";import"./QImg.9c11306d.js";import"./VisorImagen.12af3936.js";import"./seleccionContratacionPersonal.utils.e3e1ed3d.js";const ua=[{name:"fecha",field:"fecha",label:"Fecha",align:"left",sortable:!0},{name:"solicitante_info",field:"solicitante_info",label:"Solicitante",align:"left",sortable:!0},{name:"monto",field:"monto",label:"monto",align:"left",sortable:!0},{name:"plazo",field:"plazo",label:"Plazo",align:"left",sortable:!0}],pa=[{name:"num_cuota",field:"num_cuota",label:"N\xFAmero de Cuota",align:"left",sortable:!0},{name:"fecha_vencimiento",field:"fecha_vencimiento",label:"Fecha de Vencimiento",align:"left",sortable:!0},{name:"fecha_pago",field:"fecha_pago",label:"Fecha de Pago",align:"left",sortable:!0},{name:"valor_couta",field:"valor_couta",label:"Valor Couta",align:"left",sortable:!0},{name:"valor_pagado",field:"valor_pagado",label:"Valor a Pagado",align:"left",sortable:!0},{name:"valor_a_pagar",field:"valor_a_pagar",label:"Valor a Pagar",align:"left",sortable:!0},{name:"pago_couta",field:"pago_couta",label:"Pago",align:"left",sortable:!0}];class ca extends Io{constructor(){super(Z.prestamo_empresarial)}}class da extends ea{constructor(){super();c(this,"id");c(this,"solicitante");c(this,"solicitante_info");c(this,"fecha");c(this,"vencimiento");c(this,"periodo");c(this,"valor_utilidad");c(this,"monto");c(this,"plazo");c(this,"plazos");this.id=null,this.solicitante=null,this.solicitante_info=null,this.fecha=null,this.vencimiento=null,this.periodo=null,this.valor_utilidad=null,this.monto=null,this.plazo=null,this.plazos=null}}class fa{constructor(){c(this,"axios");this.axios=Bo.getInstance()}async anularPrestamoEmpresarial(o){try{await this.axios.post(this.axios.getEndpoint(Z.anular_prestamo_empresarial),o)}catch(f){const d=f;throw new Mo(d)}}}var va=Do({components:{NoOptionComponent:oa,ErrorComponent:xo,TabLayoutFilterTabs2:Wo,SelectorImagen:Xo,EssentialTable:Zo},setup(){const a=new aa(da,new ca),{entidad:o,disabled:f,accion:d,listadosAuxiliares:h,listado:B}=a.useReferencias(),{setValidador:v,obtenerListados:V,cargarVista:w,listar:F}=a.useComportamiento(),{onBeforeModificar:r}=a.useHooks(),{confirmar:S,prompt:P,notificarCorrecto:x,notificarAdvertencia:oo,notificarError:z}=No(),M=g(0),D=g([]),ao=g([{id:1,nombre:"Prestamo Descuento"},{id:2,nombre:"Anticipo"}]),N=g(!1);r(()=>N.value=!0);const eo=g(),A=g(!1),{empleados:O,filtrarEmpleados:lo}=ma(h),_=g(),T=na(),to=Ao(),$=k(()=>(T.obtenerSueldoBasico(),T.sueldo_basico)),ro=new fa,so=k(()=>d.value==="NUEVO");w(async()=>{await V({motivos:new sa,empleados:{controller:new Oo,params:{campos:"id,nombres,apellidos",estado:1}},periodos:{controller:new ia,params:{campos:"id,nombre",activo:1}}}),O.value=h.empleados,_.value=h.periodos,D.value=h.motivos}),eo.value=parseInt($.value)*2;const no=k(()=>({solicitante:{required:E},fecha:{required:E},vencimiento:{required:E},monto:{required:E},valor_utilidad:{requiredIf:Ho(o.periodo!=null)},plazo:{required:E,minValue:Jo(1),maxValue:Go(12)},plazos:{required:E}}));o.plazos=[];const io=g({id:0,vencimiento:"",plazo:0});function mo(){M.value++,M.value>=1&&(o.plazos=[]);const e=o.monto!==null?o.monto:0,s=o.plazo!=null?o.plazo:0;if(e/s<=200)for(let l=1;l<=o.plazo;l++){const u={id:l-1,num_cuota:l,fecha_vencimiento:uo(l,"meses"),valor_couta:(e/s).toFixed(2),pago_couta:!1};o.plazos.push(u)}}function uo(e,s){const p=ta(o.fecha!==null?o.fecha:new Date().toString(),"YYYY-MM-DD");switch(s){case"dias":p.setDate(p.getDate()+e);break;case"semanas":p.setDate(p.getTime()+6048e5*e);break;case"meses":p.setDate(30),p.setMonth(p.getMonth()+e-1);break;case"anios":p.setDate(p.getTime()+290304e5*e);break}return ra(p,"YYYY-MM-DD")}const q=Ko(no,o);v(q.value),Q(()=>{try{if(d.value==To.nuevo){if(o.plazo!=null){const e=o.monto!==null?o.monto:0,s=o.plazo!=null?o.plazo:0;e/s<=200&&o.plazo>0&&o.plazo<=12?(mo(),o.vencimiento=o.plazos!=null?o.plazos[o.plazo-1].fecha_vencimiento:null,o.valor_utilidad!=null&&j()):o.plazo>0&&z("Las Coutas no deben exeder al 40% del sueldo del empleado")}}else o.vencimiento=o.plazos!=null?o.plazos[o.plazo-1].fecha_vencimiento:null}catch{}});function j(){const e=o.valor_utilidad==null?0:o.valor_utilidad,s=o.monto==null?0:o.monto;if(e>0){const t=o.plazos.findIndex(u=>u.num_cuota===o.plazo+1);if(t==-1){const u=_.value.find(p=>p.id===o.periodo),b={num_cuota:o.plazos.length+1,fecha_vencimiento:u.nombre.split("-")[0]+"-04-15",valor_couta:o.valor_utilidad,pago_couta:!1};o.plazos.push(b)}else o.plazos[t].valor_couta=o.valor_utilidad;const l=s/o.plazo;Eo(e,s,l)}}const po={titulo:"editar",icono:"bi-pencil-square",color:"secondary",accion:({posicion:e})=>{console.log(e),go(e)},visible:()=>d.value=="NUEVO"},co={titulo:"pagar",icono:"bi-cash",color:"primary",accion:({posicion:e})=>{_o(e)},visible:()=>d.value=="EDITAR"},fo={titulo:"Aplazar",icono:"bi-cash-stack",color:"warning",accion:({posicion:e})=>{bo(e)},visible:()=>d.value=="EDITAR"},vo={titulo:"Editar Valor a Pagar",icono:"bi-pencil-square",color:"warning",accion:({posicion:e})=>{ho(e)},visible:()=>d.value=="EDITAR"};function bo(e){const s=o.plazos[o.plazo-1].fecha_vencimiento,[t,l,u]=s.split("-"),b=new Date(t,l-1,u);b.setMonth(b.getMonth()+1);const p=b.getDate(),wo=b.getMonth()+1,Fo=`${b.getFullYear()}-${wo.toString().padStart(2,"0")}-${p.toString().padStart(2,"0")}`;o.plazos[e].fecha_vencimiento=Fo}function go(e){S("\xBFEst\xE1 seguro de modificar la couta N"+(e+1)+"?",()=>{P({titulo:"Modificar couta",mensaje:"Ingrese nuevo valor de la couta",accion:async t=>{var l;try{const u=(l=o.monto)!=null?l:0;t>u&&(A.value=!0,oo("La suma de todas las coutas no debe superar al valor del prestamo")),o.plazos[e].valor_couta=t,zo(e,u)}catch{z("No se pudo modificar, debes ingresar monto")}}})})}function ho(e){S("\xBFEst\xE1 seguro de modificar la couta?",()=>{P({titulo:"Modificar couta",mensaje:"Ingrese nuevo valor total de la couta",accion:async t=>{try{o.plazos[e].valor_a_pagar=t}catch{z("No se pudo modificar, debes ingresar monto")}}})})}function zo(e,s){const t=o.plazos[e].num_cuota;o.plazos.map(l=>(l.num_cuota!==t&&(l.valor_couta=((parseFloat(s.toString())-o.plazos[e].valor_couta)/(o.plazo-1)).toFixed(2)),l))}function Eo(e,s,t){if(e>0){let l;e!==0?l=parseFloat(e.toString())/parseFloat(s.toString()):l=0,o.plazos.slice(0,-1).map(u=>(u.valor_couta=(t-t*l).toFixed(2),u))}}function _o(e){S("\xBFEst\xE1 seguro de pagar la couta?",()=>{P({titulo:"Pagar couta",mensaje:"Ingrese valor de la couta a pagar",accion:async t=>{try{if(t>parseFloat(o.plazos[e].valor_couta)){z("No se pudo pagar, debes ingresar monto menor o igual a "+o.plazos[e].valor_couta);return}const l=new Date;t==parseFloat(o.plazos[e].valor_couta)&&(o.plazos[e].pago_couta=!0,o.plazos[e].fecha_pago=l.toISOString().slice(0,10),Co(e+1)),o.plazos[e].fecha_pago=l.toISOString().slice(0,10),o.plazos[e].valor_pagado=parseFloat(t),o.plazos[e].valor_a_pagar=(o.plazos[e].valor_couta-t).toFixed(2)}catch(l){z("No se pudo pagar, a ocurido un error: "+l)}}})})}function Co(e){o.plazos.slice(e).forEach(s=>{const t=new Date(s.fecha_vencimiento);t.setMonth(t.getMonth()-1),s.fecha_vencimiento=t.toISOString().slice(0,10)})}function Vo(e,s){if(e===""){s(()=>{_.value=h.periodos});return}s(()=>{const t=e.toLowerCase();_.value=h.periodos.filter(l=>l.nombre.toLowerCase().indexOf(t)>-1)})}const Po={titulo:"",icono:"bi-trash",color:"negative",visible:()=>to.can("puede.eliminar.prestamo_empresarial")&&U=="ACTIVO",accion:({entidad:e,posicion:s})=>{d.value="ELIMINAR",$o({entidad:e,posicion:s})}};async function $o({entidad:e,posicion:s}){try{P({titulo:"Eliminar PrestamoEmpresarial",mensaje:"Ingrese motivo de eliminacion",accion:async l=>{e.estado=!1,e.motivo=l,e.descripcion_prestamoempresarial=l,await ro.anularPrestamoEmpresarial(e),x("Se ha eliminado PrestamoEmpresarial"),B.value.splice(s,1)}})}catch{z("No se pudo anular, debes ingresar un motivo para la anulacion")}}let U="ACTIVO";function yo(e){F({estado:e},!1),U=e}return{removeAccents:la,mixin:a,prestamo:o,empleados:O,sueldo_basico:$,periodos:_,watchEffect:Q,filtrarEmpleados:lo,filtrarPeriodo:Vo,filtrarPrestamoEmpresarial:yo,recargar_tabla:j,esMayorPrestamo:A,maximoValorPrestamo:[e=>e&&e<=parseInt($.value)*2||"Solo se permite prestamo menor o igual a 2 SBU ("+parseInt($.value)*2+")"],btnModificarCouta:po,btnPagarCouta:co,btnEditarTotalCouta:vo,btnAplazarCouta:fo,btnEliminarPrestamoEmpresarial:Po,esNuevo:so,configuracionColumnasPlazoPrestamo:pa,esConsultado:N,plazo_pago:io,motivos:D,tipos:ao,maskFecha:qo,v$:q,disabled:f,tabPrestamoEmpresarial:jo,configuracionColumnas:ua,accion:d,accionesTabla:Uo}}});const ba={class:"row q-col-gutter-sm q-py-md"},ga={class:"col-12 col-md-3"},ha={class:"col-12 col-md-3"},za={class:"row items-center justify-end"},Ea={class:"col-12 col-md-3"},_a={class:"col-12 col-md-3"},Ca={class:"col-12 col-md-3"},Va={class:"row items-center justify-end"},Pa={class:"col-12 col-md-3"},$a={key:0,class:"col-12 col-md-3"};function ya(a,o,f,d,h,B){const v=y("error-component"),V=y("no-option-component"),w=y("essential-table"),F=y("tab-layout-filter-tabs2");return I(),Y(F,{mixin:a.mixin,"titulo-pagina":"Pr\xE9stamo Empresarial",configuracionColumnas:a.configuracionColumnas,permitirEliminar:!1,accion1:a.btnEliminarPrestamoEmpresarial,tabOptions:a.tabPrestamoEmpresarial,filtrar:a.filtrarPrestamoEmpresarial,tabDefecto:"ACTIVO",forzarListar:!0},{formulario:i(()=>[n(Ro,{onSubmit:o[9]||(o[9]=Qo(()=>{},["prevent"]))},{default:i(()=>[m("div",ba,[m("div",ga,[o[10]||(o[10]=m("label",{class:"q-mb-sm block"},"Empleado",-1)),n(L,{modelValue:a.prestamo.solicitante,"onUpdate:modelValue":o[0]||(o[0]=r=>a.prestamo.solicitante=r),options:a.empleados,"transition-show":"jump-up","transition-hide":"jump-down","options-dense":"",dense:"",outlined:"",disable:!a.esNuevo,readonly:a.disabled,error:!!a.v$.solicitante.$errors.length,"error-message":"Debes seleccionar un empleado","use-input":"","input-debounce":"0",onFilter:a.filtrarEmpleados,"option-value":r=>r.id,"option-label":r=>r.nombres+" "+r.apellidos,"emit-value":"","map-options":""},{error:i(()=>[n(v,{clave:"solicitante",v$:a.v$},null,8,["v$"])]),"no-option":i(()=>[n(V)]),_:1},8,["modelValue","options","disable","readonly","error","onFilter","option-value","option-label"])]),m("div",ha,[o[11]||(o[11]=m("label",{class:"q-mb-sm block"},"Fecha",-1)),n(C,{modelValue:a.prestamo.fecha,"onUpdate:modelValue":o[2]||(o[2]=r=>a.prestamo.fecha=r),placeholder:"Obligatorio",error:!!a.v$.fecha.$errors.length,disable:!a.esNuevo,onBlur:a.v$.fecha.$touch,outlined:"",dense:""},{append:i(()=>[n(R,{name:"event",class:"cursor-pointer"},{default:i(()=>[n(K,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:i(()=>[n(W,{modelValue:a.prestamo.fecha,"onUpdate:modelValue":o[1]||(o[1]=r=>a.prestamo.fecha=r),mask:a.maskFecha,"today-btn":""},{default:i(()=>[m("div",za,[H(n(J,{label:"Cerrar",color:"primary",flat:""},null,512),[[X]])])]),_:1},8,["modelValue","mask"])]),_:1})]),_:1})]),error:i(()=>[n(v,{clave:"fecha",v$:a.v$},null,8,["v$"])]),_:1},8,["modelValue","error","disable","onBlur"])]),m("div",Ea,[o[12]||(o[12]=m("label",{class:"q-mb-sm block"},"Valor ",-1)),n(C,{modelValue:a.prestamo.monto,"onUpdate:modelValue":o[3]||(o[3]=r=>a.prestamo.monto=r),placeholder:"Obligatorio",type:"number",disable:!a.esNuevo,error:!!a.v$.monto.$errors.length,onBlur:a.v$.monto.$touch,hint:"Solo se permite prestamo menor o igual a 2 SBU ("+parseInt(a.sueldo_basico)*2+")",outlined:"",dense:""},{error:i(()=>[n(v,{clave:"monto",v$:a.v$},null,8,["v$"])]),_:1},8,["modelValue","disable","error","onBlur","hint"])]),m("div",_a,[o[13]||(o[13]=m("label",{class:"q-mb-sm block"},"Plazo ",-1)),n(C,{modelValue:a.prestamo.plazo,"onUpdate:modelValue":o[4]||(o[4]=r=>a.prestamo.plazo=r),type:"number",disable:!a.esNuevo,error:!!a.v$.plazo.$errors.length,onBlur:a.v$.plazo.$touch,outlined:"",dense:""},{error:i(()=>[n(v,{clave:"plazo",v$:a.v$},null,8,["v$"])]),_:1},8,["modelValue","disable","error","onBlur"])]),m("div",Ca,[o[14]||(o[14]=m("label",{class:"q-mb-sm block"},"Vence",-1)),n(C,{modelValue:a.prestamo.vencimiento,"onUpdate:modelValue":o[6]||(o[6]=r=>a.prestamo.vencimiento=r),error:!!a.v$.vencimiento.$errors.length,disable:"",onBlur:a.v$.vencimiento.$touch,outlined:"",dense:""},{append:i(()=>[n(R,{name:"event",class:"cursor-pointer"},{default:i(()=>[n(K,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:i(()=>[n(W,{modelValue:a.prestamo.vencimiento,"onUpdate:modelValue":o[5]||(o[5]=r=>a.prestamo.vencimiento=r),mask:a.maskFecha,"today-btn":""},{default:i(()=>[m("div",Va,[H(n(J,{label:"Cerrar",color:"primary",flat:""},null,512),[[X]])])]),_:1},8,["modelValue","mask"])]),_:1})]),_:1})]),error:i(()=>[n(v,{clave:"vencimiento",v$:a.v$},null,8,["v$"])]),_:1},8,["modelValue","error","onBlur"])]),m("div",Pa,[o[15]||(o[15]=m("label",{class:"q-mb-sm block"},"Periodo",-1)),n(L,{modelValue:a.prestamo.periodo,"onUpdate:modelValue":o[7]||(o[7]=r=>a.prestamo.periodo=r),options:a.periodos,"transition-show":"jump-up","transition-hide":"jump-down","options-dense":"",dense:"",outlined:"",disable:a.disabled,readonly:a.disabled,"use-input":"","input-debounce":"0",onFilter:a.filtrarPeriodo,"option-value":r=>r.id,"option-label":r=>r.nombre,"emit-value":"","map-options":""},{"no-option":i(()=>[n(V)]),_:1},8,["modelValue","options","disable","readonly","onFilter","option-value","option-label"])]),a.prestamo.periodo!=null?(I(),Yo("div",$a,[o[16]||(o[16]=m("label",{class:"q-mb-sm block"},"Valor Utilidades ",-1)),n(C,{modelValue:a.prestamo.valor_utilidad,"onUpdate:modelValue":o[8]||(o[8]=r=>a.prestamo.valor_utilidad=r),placeholder:"Obligatorio",type:"number",disable:!a.esNuevo,error:!!a.v$.valor_utilidad.$errors.length,onBlur:a.v$.valor_utilidad.$touch,outlined:"",dense:""},{error:i(()=>[n(v,{clave:"valor_utilidad",v$:a.v$},null,8,["v$"])]),_:1},8,["modelValue","disable","error","onBlur"])])):G("",!0)])]),_:1}),a.prestamo.plazo>0&&a.prestamo.plazo<=12?(I(),Y(w,{key:0,titulo:"Plazo de Prestamo",configuracionColumnas:[...a.configuracionColumnasPlazoPrestamo,a.accionesTabla],datos:a.prestamo.plazos,permitirConsultar:!1,permitirEditar:!1,permitirEliminar:!1,accion1:a.btnModificarCouta,accion2:a.btnPagarCouta,accion3:a.btnAplazarCouta,accion4:a.btnEditarTotalCouta,altoFijo:!1},null,8,["configuracionColumnas","datos","accion1","accion2","accion3","accion4"])):G("",!0)]),_:1},8,["mixin","configuracionColumnas","accion1","tabOptions","filtrar"])}var fe=Lo(va,[["render",ya]]);export{fe as default};
