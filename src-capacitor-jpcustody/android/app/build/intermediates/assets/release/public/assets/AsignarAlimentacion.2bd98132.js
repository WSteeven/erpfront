var Se=Object.defineProperty;var we=(e,a,c)=>a in e?Se(e,a,{enumerable:!0,configurable:!0,writable:!0,value:c}):e[a]=c;var A=(e,a,c)=>(we(e,typeof a!="symbol"?a+"":a,c),c);import{Q as re,a as ce}from"./QItemSection.ec4cc512.js";import{Q as me}from"./QSelect.b920278b.js";import{by as de,s as B,l as De,c as $,R as ue,A as L,bG as P,d as W,_ as X,t as V,v as _,x as C,z as n,F as t,O as Y,a5 as O,B as J,y as r,c7 as Ve,G as I,u as pe,E as fe,f as qe,p as Me,q as be,bz as R,P as ae,a6 as ve,D as ge,J as oe,I as K,H as j,K as z,j as ke,bh as ie,bd as Fe,m as Be,e as ne}from"./index.b8e09611.js";import{Q as Ee}from"./QForm.eab79b48.js";import{E as Ae}from"./entidadAuditable.75a46700.js";import{T as Ie}from"./TabLayout.45a66130.js";import{u as _e}from"./index.70965bc7.js";import{C as ye}from"./ContenedorSimpleMixin.4e22246b.js";import{C as le,a as ze}from"./ComponenteModal.domain.92aacded.js";import{E as $e}from"./EssentialSelectableTable.ac03bc90.js";import{E as Ce}from"./EssentialTable.23af6cc8.js";import{S as Ne}from"./utils.9344cd7e.js";import{A as Qe}from"./Alimentacion.2916aefc.js";import{Q as Le,a as Pe,C as Re}from"./QPopupProxy.685eacb5.js";import{Q as je}from"./QPage.e6f8825d.js";import{r as te}from"./i18n-validators.06abe774.js";import{B as He}from"./buttonSubmits.f2d72caa.js";import{u as he}from"./filtrosListadosGenerales.87fcb144.js";import{M as Ue}from"./ModalEntidad.54c9ab3a.js";import{S as Te}from"./SolicitarFecha.13418260.js";import"./QChip.f8f308fa.js";import"./QMenu.b3fb639b.js";import"./position-engine.799c9136.js";import"./format.8ac60962.js";import"./QTabs.1ee2fae1.js";import"./QResizeObserver.1422c274.js";import"./QTabPanels.1776fc83.js";import"./touch.9135741d.js";import"./EssentialTablePagination.ce808cac.js";import"./QTable.c4bfb038.js";import"./use-fullscreen.37810a50.js";import"./QToolbar.afeb6de9.js";import"./QBtnGroup.7d38eecd.js";import"./QBadge.89898cd2.js";import"./QFile.c79664c6.js";import"./_commonjsHelpers.8402d862.js";import"./QImg.95754b62.js";import"./VisorImagen.29457a6f.js";import"./seleccionContratacionPersonal.utils.e3e1ed3d.js";import"./ErrorComponent.3c1fc91c.js";import"./index.ea415f98.js";import"./configuracion_general.1d29d94f.js";import"./ConfiguracionController.a136b041.js";class Ge extends Ae{constructor(){super();A(this,"empleado");A(this,"empleado_info");A(this,"valor_minimo");this.empleado=null,this.empleado_info=null,this.valor_minimo=null}}class Oe extends de{constructor(){super(B.asignar_alimentacion)}}const Ye=[{name:"empleado_info",field:"empleado_info",label:"Empleados",align:"left",sortable:!0},{name:"valor_minimo",field:"valor_minimo",label:"Valor Minimo",align:"left",sortable:!0}],Je=[{name:"nombres",field:"nombres",label:"Nombres",align:"left",sortable:!0},{name:"apellidos",field:"apellidos",label:"Apellidos",align:"left",sortable:!0},{name:"canton",field:"canton",label:"Sede",align:"left",sortable:!0},{name:"grupo",field:"grupo",label:"Grupo",align:"left",sortable:!0},{name:"cargo",field:"cargo",label:"Cargo",align:"left",sortable:!0},{name:"departamento",field:"departamento",label:"Departamento",align:"left",sortable:!0}],Z=De("preorden",()=>{const e=$([]),a=$([]),c=$(0),y=$(),s=new Qe,d=new Ne,{notificarError:b}=ue();async function v(){try{d.activar();const i=L.getInstance(),f=P.URL_BASE+"/"+i.getEndpoint(B.empleados),u=await i.get(f,{params:{estado:1}});e.value=u.data.results}catch(i){b(i)}finally{d.desactivar()}}async function o(){try{d.activar();const i=L.getInstance(),f=P.URL_BASE+"/"+i.getEndpoint(B.alimentacion),u=await i.get(f,{params:{mes:s.mes,es_quincena:s.es_quincena?1:0,finalizado:0}});a.value=u.data.results,s.hydrate(a.value[0])}catch(i){b(i)}finally{d.desactivar()}}async function l(i,f){try{d.activar();const u=L.getInstance(),M=P.URL_BASE+"/"+u.getEndpoint(B.asignar_alimentacion);i={empleados:i,valor_minimo:f};const k=await u.post(M,i);console.log(k)}catch(u){b(u)}finally{d.desactivar()}}async function q(){try{d.activar(),m();const i=L.getInstance(),f=P.URL_BASE+"/"+i.getEndpoint(B.alimentacion),u=await i.post(f,s);s.id=u.data.modelo.id}catch(i){b(i)}finally{d.desactivar()}}function m(){const i=["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"],[f,u]=s.mes.split("-");s.nombre=`ASIGNACION DE ALIMENTACION ${s.es_quincena?"QUINCENA DEL MES DE ":""}  ${i[parseInt(u,10)-1]} de ${f}`}return{asignarAlimentacion:l,listarempleados:v,realizarCorte:q,obtenerAlimentacion:o,alimentaciones:a,listadoItems:e,valor_asignar:c,mes:y,alimentacion:s}});var Ke=W({components:{EssentialSelectableTable:$e,EssentialTable:Ce},emits:["cerrar-modal","guardado"],setup(e,{emit:a}){const c=Z(),y=$([]),s=$(),d=$([]);d.value=c.listadoItems;function b(){y.value=s.value.selected,c.asignarAlimentacion(y.value,c.valor_asignar),v(!1),a("guardado",y.value)}function v(o=!0){a("cerrar-modal",o)}return{listado:d,configuracionColumnasSeleccionEmpleados:Je,seleccionar:b,cerrarModal:v,refListado:s}}});function We(e,a,c,y,s,d){const b=V("essential-selectable-table"),v=V("essential-table");return _(),C(I,null,[n(b,{"configuracion-columnas":e.configuracionColumnasItemsPreorden,datos:e.listado},null,8,["configuracion-columnas","datos"]),n(v,{ref:"refListado",titulo:"Listado de empleados",configuracionColumnas:e.configuracionColumnasSeleccionEmpleados,datos:e.listado,"tipo-seleccion":"multiple",permitirConsultar:!0,permitirEditar:!1,permitirEliminar:!1,permitirFiltrar:!1,ajustarCeldas:!0},null,8,["configuracionColumnas","datos"]),n(Ve,{class:O(["q-gutter-xs",{"justify-end":!e.$q.screen.xs}])},{default:t(()=>[n(Y,{color:"primary",class:O({"full-width":e.$q.screen.xs}),"no-caps":"",push:"",onClick:e.seleccionar},{default:t(()=>[n(J,{name:"bi-save",size:"xs",class:"q-pr-sm"}),a[0]||(a[0]=r("span",null,"Seleccionar",-1))]),_:1},8,["class","onClick"]),n(Y,{color:"negative",class:O({"full-width":e.$q.screen.xs}),"no-caps":"",push:"",onClick:e.cerrarModal},{default:t(()=>[n(J,{name:"bi-x-lg",size:"xs",class:"q-pr-sm"}),a[1]||(a[1]=r("span",null,"Cancelar",-1))]),_:1},8,["class","onClick"])]),_:1},8,["class"])],64)}var Xe=X(Ke,[["render",We]]);class Ze extends de{constructor(){super(B.detalle_alimentacion)}}const xe=[{name:"empleado_info",field:"empleado_info",label:"Empleado",align:"left",sortable:!0},{name:"valor_asignado",field:"valor_asignado",label:"Valor asignado",align:"left",sortable:!0},{name:"fecha_corte",field:"fecha_corte",label:"Fecha de corte",align:"left",sortable:!0}];class se extends Ae{constructor(){super();A(this,"empleado");A(this,"empleado_info");A(this,"valor_asignado");A(this,"fecha_corte");A(this,"alimentacion_id");A(this,"masivo");A(this,"nuevo");this.empleado=null,this.empleado_info=null,this.valor_asignado=null,this.fecha_corte=null,this.masivo=!1,this.alimentacion_id=null,this.nuevo=!1}}var ea=W({components:{EssentialSelectableTable:$e,EssentialTable:Ce,ButtonSubmits:He},emits:["cerrar-modal","guardado"],setup(e,{emit:a}){const c=new ye(se,new Ze),{setValidador:y,guardar:s,editar:d,eliminar:b,reestablecer:v,cargarVista:o,obtenerListados:l,listar:q}=c.useComportamiento(),{entidad:m,accion:i,listado:f,listadosAuxiliares:u}=c.useReferencias(),{empleados:M,filtrarEmpleados:k}=he(u),h=Z(),S=pe();o(async()=>{await l({empleados:{controller:new fe,params:{campos:"id,nombres,apellidos",estado:1}}}),M.value=u.empleados,await q({alimentacion_id:h.alimentacion.id})});const x={valor_asignado:{required:te},fecha_corte:{required:te}},F=$(!0),g=$(!1),N=_e(x,m);y(N.value);const Q=$();function H(p=!0){a("cerrar-modal",p)}const U={titulo:"Editar",icono:"bi-pencil",color:"warning",visible:()=>S.can("puede.editar.detalle_alimentaciones"),accion:({entidad:p})=>{F.value=!0,i.value=R.editar,m.id=p.id,m.empleado=p.empleado,m.valor_asignado=p.valor_asignado,m.fecha_corte=p.fecha_corte,g.value=!0}},T={titulo:"Consultar",icono:"bi-eye",color:"primary",visible:()=>S.can("puede.ver.detalle_alimentaciones"),accion:({entidad:p})=>{i.value=R.consultar,m.id=p.id,m.empleado=p.empleado,m.valor_asignado=p.valor_asignado,m.fecha_corte=p.fecha_corte,g.value=!0}},G={titulo:"Agregar",icono:"bi-plus",color:"positive",visible:()=>S.can("puede.crear.detalle_alimentaciones"),accion:()=>{i.value=R.nuevo,m.nuevo=!0,m.alimentacion_id=h.alimentacion.id,g.value=!0,F.value=!1}};async function D(p){try{let w=new se;i.value==R.nuevo?(w=await s(p),m.hydrate(w),await q({alimentacion_id:h.alimentacion.id})):await d(p,!0),g.value=!1}catch(w){console.log(w)}}function E(){v(),g.value=!1}const ee=qe(()=>f.value.reduce((p,w)=>p+parseFloat(w.valor_asignado?w.valor_asignado.replace(/,/g,""):0),0));return{listado:f,deshabilitar_empleado:F,accionesTabla:Me,accion:i,filtrarEmpleados:k,mostrar_formulario:g,alimentacion:m,guardarDatos:D,reestablecerDatos:E,empleados:M,maskFecha:be,totalDetalleAlimentacion:ee,v$:N,cerrarModal:H,refListado:Q,btnNuevoDetalleAlimentacion:G,btnVerDetalleAlimentacion:T,btnEditarDetalleAlimentacion:U,btnEliminarDetalleAlimentacion:{titulo:"Eliminar",icono:"bi-trash",color:"secondary",visible:()=>S.can("puede.eliminar.detalle_alimentaciones"),accion:({entidad:p,posicion:w})=>{i.value="ELIMINAR",b(p),f.value.splice(w,1)}},btnAsignarMasivo:{titulo:"Asignacion Masiva",icono:"bi-arrow-clockwise",color:"warning",visible:()=>S.can("puede.ver.btn.asignar_masivo_alimentaciones"),accion:()=>{m.alimentacion_id=h.alimentacion.id,m.masivo=!0}},configuracionColumnasDetalleAlimentacion:xe}}});const aa={class:"row q-col-gutter-sm q-mb-md"},oa={key:0,class:"col-12 col-md-3"},ia={class:"col-12 col-md-3"},na={class:"error-msg"},la={class:"col-12 col-md-3"},ta={class:"row items-center justify-end"},sa={class:"error-msg"},ra={class:"row justify-end q-col-gutter-x-xs"},ca={class:"text-h5 q-py-sm"};function ma(e,a,c,y,s,d){const b=V("button-submits"),v=V("essential-table");return _(),ae(je,{padding:""},{default:t(()=>[e.mostrar_formulario||e.alimentacion.masivo?(_(),ae(Ee,{key:0,onSubmit:a[7]||(a[7]=ve(()=>{},["prevent"]))},{default:t(()=>[r("div",aa,[e.alimentacion.masivo?oe("",!0):(_(),C("div",oa,[a[9]||(a[9]=r("label",{class:"q-mb-sm block"},"Empleado",-1)),n(me,{modelValue:e.alimentacion.empleado,"onUpdate:modelValue":a[0]||(a[0]=o=>e.alimentacion.empleado=o),options:e.empleados,"transition-show":"jump-up","transition-hide":"jump-down","options-dense":"",dense:"",outlined:"",disable:e.deshabilitar_empleado,readonly:e.disabled,"error-message":"Debes seleccionar un empleado","use-input":"","input-debounce":"0",onFilter:e.filtrarEmpleados,"option-value":o=>o.id,"option-label":o=>o.nombres+" "+o.apellidos,"emit-value":"","map-options":""},{"no-option":t(()=>[n(re,null,{default:t(()=>[n(ce,{class:"text-grey"},{default:t(()=>a[8]||(a[8]=[ge(" No hay resultados ")])),_:1})]),_:1})]),_:1},8,["modelValue","options","disable","readonly","onFilter","option-value","option-label"])])),r("div",ia,[a[10]||(a[10]=r("label",{class:"q-mb-sm block"},"Valor Asignado",-1)),n(K,{modelValue:e.alimentacion.valor_asignado,"onUpdate:modelValue":a[1]||(a[1]=o=>e.alimentacion.valor_asignado=o),placeholder:"Obligatorio",disable:e.disabled,error:!!e.v$.valor_asignado.$errors.length,onBlur:e.v$.valor_asignado.$touch,outlined:"",dense:""},{error:t(()=>[(_(!0),C(I,null,j(e.v$.valor_asignado.$errors,o=>(_(),C("div",{key:o.$uid},[r("div",na,z(o.$message),1)]))),128))]),_:1},8,["modelValue","disable","error","onBlur"])]),r("div",la,[a[11]||(a[11]=r("label",{class:"q-mb-sm block"},"Fecha de corte",-1)),n(K,{modelValue:e.alimentacion.fecha_corte,"onUpdate:modelValue":a[3]||(a[3]=o=>e.alimentacion.fecha_corte=o),placeholder:"Obligatorio",error:!!e.v$.fecha_corte.$errors.length,disable:e.disabled,readonly:"",onBlur:e.v$.fecha_corte.$touch,outlined:"",dense:""},{append:t(()=>[n(J,{name:"event",class:"cursor-pointer"},{default:t(()=>[n(Le,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:t(()=>[n(Pe,{modelValue:e.alimentacion.fecha_corte,"onUpdate:modelValue":a[2]||(a[2]=o=>e.alimentacion.fecha_corte=o),mask:e.maskFecha,"today-btn":""},{default:t(()=>[r("div",ta,[ke(n(Y,{label:"Cerrar",color:"primary",flat:""},null,512),[[Re]])])]),_:1},8,["modelValue","mask"])]),_:1})]),_:1})]),error:t(()=>[(_(!0),C(I,null,j(e.v$.fecha_corte.$errors,o=>(_(),C("div",{key:o.$uid},[r("div",sa,z(o.$message),1)]))),128))]),_:1},8,["modelValue","error","disable","onBlur"])])]),r("div",ra,[n(b,{accion:e.accion,"label-guardar":"Guardar",permitirCancelar:!0,onCancelar:a[4]||(a[4]=o=>e.reestablecerDatos()),onEditar:a[5]||(a[5]=o=>e.guardarDatos(e.alimentacion)),onGuardar:a[6]||(a[6]=o=>e.guardarDatos(e.alimentacion))},null,8,["accion"])])]),_:1})):oe("",!0),r("div",ca,"Total: "+z(e.totalDetalleAlimentacion.toFixed(2)),1),n(v,{titulo:"Valores de Corte de Alimentacion",datos:e.listado,configuracionColumnas:[...e.configuracionColumnasDetalleAlimentacion,e.accionesTabla],permitirConsultar:!1,permitirEditar:!1,permitirEliminar:!1,accion1Header:e.btnNuevoDetalleAlimentacion,accion2Header:e.btnAsignarMasivo,accion1:e.btnVerDetalleAlimentacion,accion2:e.btnEditarDetalleAlimentacion,accion3:e.btnEliminarDetalleAlimentacion},null,8,["datos","configuracionColumnas","accion1Header","accion2Header","accion1","accion2","accion3"])]),_:1})}var da=X(ea,[["render",ma]]);class ua{constructor(){A(this,"SeleccionEmpleadoPage");A(this,"DetalleAlimentacionPage");this.SeleccionEmpleadoPage=ie(new le("Seleccionar Empleados",Xe)),this.DetalleAlimentacionPage=ie(new le("Detalle Alimentacion",da))}}class pa extends ze{constructor(){super(new ua)}}var fa=W({components:{TabLayout:Ie,ModalesEntidad:Ue,SolicitarFecha:Te},setup(){Fe().setQuasar(Be());const e=new ye(Ge,new Oe),{entidad:a,disabled:c,accion:y,listadosAuxiliares:s}=e.useReferencias(),{setValidador:d,obtenerListados:b,cargarVista:v,listar:o}=e.useComportamiento(),{confirmar:l,prompt:q,notificarError:m,promptItems:i}=ue(),f=pe(),{empleados:u,filtrarEmpleados:M}=he(s),k=$(!1),h=new pa;v(async()=>{await b({empleados:{controller:new fe,params:{campos:"id,nombres,apellidos",estado:1}}}),u.value=s.empleados});const S=$(!1),F=_e({empleado:{required:!0},valor_minimo:{required:!0}},a);d(F.value);const g=Z(),N={titulo:"Seleccionar",tooltip:"Seleccionar Empleado",icono:"bi-box-arrow-in-down",accion:async()=>{l("\xBFEst\xE1 seguro de realizar la asignacion de alimentacion?",async()=>{l("Esto asignara alimentacion a los empleado. \xBFDesea continuar?",async()=>{q({titulo:"Valor de Alimentacion",mensaje:"Ingrese  valor a acreditar de alimentacion",accion:async E=>{try{g.valor_asignar=E,await g.listarempleados(),h.abrirModalEntidad("SeleccionEmpleadoPage")}catch{m("No se pudo asignar alimentacion")}}})})})},visible:()=>f.can("puede.ver.bnt.seleccionar_empleados")},Q=[{id:!0,name:"Quincena"},{id:!1,name:"Fin de Mes"}],H={titulo:"Realizar Corte",tooltip:"Seleccionar Periodo de Corte",icono:"fa-solid fa-utensils",color:"warning",accion:async()=>{const D=ne({mensaje:"De que periodo desea  realizar el corte",accion:E=>{g.alimentacion.es_quincena=E,S.value=!0},requerido:!1,defecto:"false",tipo:"radio",items:Q.map(E=>({label:E.name,value:E.id}))});i(D)},visible:()=>f.can("puede.ver.bnt.corte_asignacion_alimentaciones")},U={titulo:"Visualizar Corte",tooltip:"Visualizar Corte de alimentacion",icono:"bi-eye-fill",color:"primary",accion:async()=>{const D=ne({mensaje:"De que periodo desea visualizar el corte",accion:E=>{g.alimentacion.es_quincena=E,k.value=!0,S.value=!0},requerido:!1,defecto:"false",tipo:"radio",items:Q.map(E=>({label:E.name,value:E.id}))});i(D)},visible:()=>f.can("puede.ver.detalle_alimentaciones")};async function T(){await o()}function G(D){g.alimentacion.mes=D,k.value?(g.obtenerAlimentacion(),h.abrirModalEntidad("DetalleAlimentacionPage")):l("Esto realizara los cortes de valores de alimentacion de los empleados. \xBFDesea continuar?",async()=>{await g.realizarCorte(),h.abrirModalEntidad("DetalleAlimentacionPage")})}return{mixin:e,asignar_alimentacion:a,guardado:T,mostrarSolicitarFecha:S,filtrarEmpleados:M,btnSeleccionarEmpleado:N,btnRealizarCorte:H,btnVisualizarCorte:U,maskFecha:be,empleados:u,modales:h,disabled:c,accion:y,v$:F,configuracionColumnas:Ye,fechaSubida:G}}});const ba={class:"row q-col-gutter-sm q-mb-md"},va={class:"col-12 col-md-3"},ga={class:"error-msg"},Ea={class:"col-12 col-md-3"},Aa={class:"error-msg"};function _a(e,a,c,y,s,d){const b=V("tab-layout"),v=V("modales-entidad"),o=V("solicitar-fecha");return _(),C(I,null,[n(b,{mixin:e.mixin,configuracionColumnas:e.configuracionColumnas,accion1Header:e.btnSeleccionarEmpleado,accion2Header:e.btnRealizarCorte,accion3Header:e.btnVisualizarCorte},{formulario:t(()=>[n(Ee,{onSubmit:a[2]||(a[2]=ve(()=>{},["prevent"]))},{default:t(()=>[r("div",ba,[r("div",va,[a[6]||(a[6]=r("label",{class:"q-mb-sm block"},"Empleados",-1)),n(me,{modelValue:e.asignar_alimentacion.empleado,"onUpdate:modelValue":a[0]||(a[0]=l=>e.asignar_alimentacion.empleado=l),options:e.empleados,"transition-show":"jump-up","transition-hide":"jump-down","options-dense":"",dense:"",outlined:"",disable:e.disabled,readonly:e.disabled,"use-input":"","input-debounce":"0",onBlur:e.v$.empleado.$touch,onFilter:e.filtrarEmpleados,"option-value":l=>l.id,"option-label":l=>l.nombres+" "+l.apellidos,"emit-value":"","map-options":""},{error:t(()=>[(_(!0),C(I,null,j(e.v$.empleado.$errors,l=>(_(),C("div",{key:l.$uid},[r("div",ga,z(l.$message),1)]))),128))]),"no-option":t(()=>[n(re,null,{default:t(()=>[n(ce,{class:"text-grey"},{default:t(()=>a[5]||(a[5]=[ge(" No hay resultados ")])),_:1})]),_:1})]),_:1},8,["modelValue","options","disable","readonly","onBlur","onFilter","option-value","option-label"])]),r("div",Ea,[a[7]||(a[7]=r("label",{class:"q-mb-sm block"},"Valor minimo",-1)),n(K,{modelValue:e.asignar_alimentacion.valor_minimo,"onUpdate:modelValue":a[1]||(a[1]=l=>e.asignar_alimentacion.valor_minimo=l),placeholder:"Obligatorio",type:"number",disable:e.disabled,error:!!e.v$.valor_minimo.$errors.length,onBlur:e.v$.valor_minimo.$touch,outlined:"",dense:""},{error:t(()=>[(_(!0),C(I,null,j(e.v$.valor_minimo.$errors,l=>(_(),C("div",{key:l.$uid},[r("div",Aa,z(l.$message),1)]))),128))]),_:1},8,["modelValue","disable","error","onBlur"])])])]),_:1})]),_:1},8,["mixin","configuracionColumnas","accion1Header","accion2Header","accion3Header"]),n(v,{comportamiento:e.modales,persistente:!1,onGuardado:a[3]||(a[3]=l=>e.guardado(l))},null,8,["comportamiento"]),n(o,{mostrar:e.mostrarSolicitarFecha,confirmar:e.fechaSubida,mask:"YYYY-MM",onCerrar:a[4]||(a[4]=l=>e.mostrarSolicitarFecha=!1)},null,8,["mostrar","confirmar"])],64)}var fo=X(fa,[["render",_a]]);export{fo as default};
