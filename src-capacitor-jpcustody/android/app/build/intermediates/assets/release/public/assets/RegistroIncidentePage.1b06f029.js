var z=Object.defineProperty;var H=(e,o,t)=>o in e?z(e,o,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[o]=t;var l=(e,o,t)=>(H(e,typeof o!="symbol"?o+"":o,t),t);import{Q as c,a as A}from"./QSelect.b920278b.js";import{Q as h,a as V}from"./QItemSection.ec4cc512.js";import{by as J,s as K,d as W,R as X,u as Y,c as k,E as Z,q as _,bz as x,_ as ee,t as D,v as n,P as oe,F as a,z as i,a6 as se,y as r,x as d,J as ie,M as ae,N as re,D as b,K as p,I as L,B as le,j as te,O as ne,G as q,H as Q,L as de}from"./index.b8e09611.js";import{Q as pe,a as ue,C as me}from"./QPopupProxy.685eacb5.js";import{Q as ce}from"./QForm.eab79b48.js";import{s as U,n as be}from"./vehiculos.utils.c31e027d.js";import{r as u}from"./i18n-validators.06abe774.js";import{S as ge,s as ve}from"./utils.9344cd7e.js";import{u as fe}from"./index.70965bc7.js";import{G as he}from"./GestorArchivos.801d8a9f.js";import{T as Ve}from"./TabLayout.45a66130.js";import{C as $e}from"./ContenedorSimpleMixin.4e22246b.js";import{E as we}from"./entidadAuditable.75a46700.js";import{V as ye}from"./VehiculoController.30a3b5a2.js";import{u as Ce}from"./filtrosListadosGenerales.87fcb144.js";import"./QChip.f8f308fa.js";import"./QMenu.b3fb639b.js";import"./position-engine.799c9136.js";import"./format.8ac60962.js";import"./index.ea415f98.js";import"./QUploader.16c4ab83.js";import"./QCircularProgress.c6e924d2.js";import"./QFile.c79664c6.js";import"./configuracionColumnasArchivoSubtarea.215f4ffd.js";import"./EssentialTable.23af6cc8.js";import"./QTable.c4bfb038.js";import"./use-fullscreen.37810a50.js";import"./QToolbar.afeb6de9.js";import"./QBtnGroup.7d38eecd.js";import"./QBadge.89898cd2.js";import"./_commonjsHelpers.8402d862.js";import"./QImg.95754b62.js";import"./VisorImagen.29457a6f.js";import"./seleccionContratacionPersonal.utils.e3e1ed3d.js";import"./ErrorComponent.3c1fc91c.js";import"./QTabs.1ee2fae1.js";import"./QResizeObserver.1422c274.js";import"./QTabPanels.1776fc83.js";import"./touch.9135741d.js";import"./QPage.e6f8825d.js";import"./buttonSubmits.f2d72caa.js";import"./EssentialTablePagination.ce808cac.js";const ke=[{name:"vehiculo",field:"vehiculo",label:"Veh\xEDculo",align:"left",sortable:!0},{name:"fecha",field:"fecha",label:"Fecha",align:"left",sortable:!0},{name:"tipo",field:"tipo",label:"Tipo",align:"left",sortable:!0},{name:"gravedad",field:"gravedad",label:"Gravedad",align:"left",sortable:!0},{name:"persona_reporta",field:"persona_reporta",label:"Persona Reporta",align:"left",sortable:!0}];class qe extends we{constructor(){super();l(this,"vehiculo");l(this,"fecha");l(this,"descripcion");l(this,"tipo");l(this,"gravedad");l(this,"persona_reporta");l(this,"persona_registra");l(this,"aplica_seguro");this.vehiculo=null,this.fecha=null,this.descripcion=null,this.tipo=null,this.gravedad=null,this.persona_reporta=null,this.persona_registra=null,this.aplica_seguro=!1}}class Qe extends J{constructor(){super(K.registros_incidentes)}}var Ie=W({components:{TabLayout:Ve,GestorArchivos:he},setup(){const e=new $e(qe,new Qe),{entidad:o,disabled:t,listadosAuxiliares:g,accion:I}=e.useReferencias(),{setValidador:P,cargarVista:$,obtenerListados:w}=e.useComportamiento(),{onReestablecer:s,onConsultado:E,onModificado:T,onGuardado:B}=e.useHooks();X();const v=Y();new ge;const y=k(),f=k(),C=k(),{vehiculos:j,filtrarVehiculos:N,empleados:S,filtrarEmpleados:G}=Ce(g);$(async()=>{await w({vehiculos:new ye,empleados:{controller:new Z,params:{estado:1}}}),j.value=g.vehiculos,S.value=g.empleados,o.persona_registra=v.user.id,o.persona_reporta=v.user.id});const F=fe({vehiculo:{required:u},fecha:{required:u},tipo:{required:u},gravedad:{required:u},descripcion:{required:u},persona_reporta:{required:u}},o);P(F.value),s(()=>{o.persona_registra=v.user.id,o.persona_reporta=v.user.id,f.value.limpiarListado()}),E(()=>{setTimeout(()=>{f.value.listarArchivosAlmacenados(o.id)},1),y.value=U}),B(m=>{C.value=m,setTimeout(async()=>{await R()},1)}),T(m=>{C.value=m,setTimeout(async()=>{await R()},1)});async function R(){await f.value.subir()}function M(m){y.value=U.filter(O=>O.tipo.indexOf(m)>-1)}return{mixin:e,registro:o,v$:F,accion:I,disabled:t,configuracionColumnas:ke,maskFecha:_,acciones:x,refArchivo:f,idRegistro:C,vehiculos:j,filtrarVehiculos:N,empleados:S,filtrarEmpleados:G,tiposIncidentes:be,subtipos:y,filtrarSubtipos:M,ordenarLista:ve}}});const Pe={class:"row q-col-gutter-sm q-py-md"},je={key:0,class:"col-12 col-md-3"},Se={class:"col-12 col-md-3"},Fe={class:"col-12 col-md-3"},Re={class:"row items-center justify-end"},Ae={class:"error-msg"},De={class:"col-12 col-md-3"},Le={class:"col-12 col-md-3"},Ue={class:"col-12 col-md-3 q-mb-xl"},Ee={class:"col-12 col-md-3"},Te={class:"error-msg"},Be={class:"col-12 col-md-12"},Ne={class:"error-msg"},Ge={class:"col-12 q-mb-md"};function Me(e,o,t,g,I,P){const $=D("gestor-archivos"),w=D("tab-layout");return n(),oe(w,{mixin:e.mixin,configuracionColumnas:e.configuracionColumnas,"titulo-pagina":"Registro de incidentes"},{formulario:a(()=>[i(ce,{onSubmit:o[10]||(o[10]=se(()=>{},["prevent"]))},{default:a(()=>[r("div",Pe,[e.registro.persona_registra?(n(),d("div",je,[o[11]||(o[11]=r("label",{class:"q-mb-sm block"},"Persona que registra",-1)),i(c,{modelValue:e.registro.persona_registra,"onUpdate:modelValue":o[0]||(o[0]=s=>e.registro.persona_registra=s),options:e.empleados,"transition-show":"jump-up","transition-hide":"jump-up","options-dense":"",dense:"",outlined:"",disable:"","option-label":s=>s.apellidos+" "+s.nombres,"option-value":s=>s.id,"emit-value":"","map-options":""},null,8,["modelValue","options","option-label","option-value"])])):ie("",!0),r("div",Se,[o[13]||(o[13]=r("label",{class:"q-mb-sm block"},"Placa",-1)),i(c,{modelValue:e.registro.vehiculo,"onUpdate:modelValue":o[1]||(o[1]=s=>e.registro.vehiculo=s),options:e.vehiculos,"transition-show":"jump-up","transition-hide":"jump-down",disable:e.disabled,"options-dense":"",dense:"",outlined:"",onFilter:e.filtrarVehiculos,"error-message":"Debes seleccionar un n\xFAmero de placa","use-input":"","input-debounce":"0","option-value":s=>s.id,"option-label":s=>s.placa,"emit-value":"","map-options":""},{option:a(s=>[i(h,ae(re(s.itemProps)),{default:a(()=>[i(V,null,{default:a(()=>[i(A,null,{default:a(()=>[b(p(s.opt.placa),1)]),_:2},1024),i(A,{caption:""},{default:a(()=>[b(p(s.opt.marca)+": "+p(s.opt.modelo),1)]),_:2},1024)]),_:2},1024)]),_:2},1040)]),"no-option":a(()=>[i(h,null,{default:a(()=>[i(V,{class:"text-grey"},{default:a(()=>o[12]||(o[12]=[b(" No hay resultados ")])),_:1})]),_:1})]),_:1},8,["modelValue","options","disable","onFilter","option-value","option-label"])]),r("div",Fe,[o[14]||(o[14]=r("label",{class:"q-mb-sm block"},"Fecha del incidente",-1)),i(L,{modelValue:e.registro.fecha,"onUpdate:modelValue":o[3]||(o[3]=s=>e.registro.fecha=s),placeholder:"Obligatorio",value:e.registro.fecha,error:!!e.v$.fecha.$errors.length,disable:e.disabled,onBlur:e.v$.fecha.$touch,outlined:"",dense:""},{append:a(()=>[i(le,{name:"event",class:"cursor-pointer"},{default:a(()=>[i(pe,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:a(()=>[i(ue,{modelValue:e.registro.fecha,"onUpdate:modelValue":o[2]||(o[2]=s=>e.registro.fecha=s),mask:e.maskFecha,"today-btn":""},{default:a(()=>[r("div",Re,[te(i(ne,{label:"Cerrar",color:"primary",flat:""},null,512),[[me]])])]),_:1},8,["modelValue","mask"])]),_:1})]),_:1})]),error:a(()=>[(n(!0),d(q,null,Q(e.v$.fecha.$errors,s=>(n(),d("div",{key:s.$uid},[r("div",Ae,p(s.$message),1)]))),128))]),_:1},8,["modelValue","value","error","disable","onBlur"])]),r("div",De,[o[15]||(o[15]=r("label",{class:"q-mb-sm block"},"Tipo de incidente",-1)),i(c,{modelValue:e.registro.tipo,"onUpdate:modelValue":[o[4]||(o[4]=s=>e.registro.tipo=s),e.filtrarSubtipos],options:e.tiposIncidentes,"transition-show":"jump-up","transition-hide":"jump-down",disable:e.disabled,"options-dense":"",dense:"",outlined:"",clearable:"","error-message":"Debes seleccionar un tipo de incidente","option-value":s=>s.value,"option-label":s=>s.label,"emit-value":"","map-options":""},null,8,["modelValue","options","disable","onUpdate:modelValue","option-value","option-label"])]),r("div",Le,[o[17]||(o[17]=r("label",{class:"q-mb-sm block"},"Gravedad",-1)),i(c,{modelValue:e.registro.gravedad,"onUpdate:modelValue":o[5]||(o[5]=s=>e.registro.gravedad=s),options:e.subtipos,"transition-show":"jump-up","transition-hide":"jump-down",disable:e.disabled,"options-dense":"",dense:"",outlined:"","error-message":"Debes seleccionar un elemento","option-value":s=>s.value,"option-label":s=>s.label,"emit-value":"","map-options":""},{"no-option":a(()=>[i(h,null,{default:a(()=>[i(V,{class:"text-grey"},{default:a(()=>o[16]||(o[16]=[b(" Primero selecciona un tipo de incidente ")])),_:1})]),_:1})]),_:1},8,["modelValue","options","disable","option-value","option-label"])]),r("div",Ue,[i(de,{class:"q-mt-lg q-pt-md",modelValue:e.registro.aplica_seguro,"onUpdate:modelValue":o[6]||(o[6]=s=>e.registro.aplica_seguro=s),label:"\xBFAplic\xF3 el seguro?",disable:e.disabled,outlined:"",dense:""},null,8,["modelValue","disable"])]),r("div",Ee,[o[19]||(o[19]=r("label",{class:"q-mb-sm block"},"Persona que reporta",-1)),i(c,{modelValue:e.registro.persona_reporta,"onUpdate:modelValue":o[7]||(o[7]=s=>e.registro.persona_reporta=s),options:e.empleados,"transition-show":"jump-up","transition-hide":"jump-up","options-dense":"",dense:"",outlined:"","use-input":"","input-debounce":"0",onFilter:e.filtrarEmpleados,onPopupShow:o[8]||(o[8]=s=>e.ordenarLista(e.empleados,"apellidos")),"error-message":"Debes seleccionar un empleado",error:!!e.v$.persona_reporta.$errors.length,disable:e.disabled,"option-label":s=>s.apellidos+" "+s.nombres,"option-value":s=>s.id,"emit-value":"","map-options":""},{"no-option":a(()=>[i(h,null,{default:a(()=>[i(V,{class:"text-grey"},{default:a(()=>o[18]||(o[18]=[b(" No hay resultados ")])),_:1})]),_:1})]),error:a(()=>[(n(!0),d(q,null,Q(e.v$.persona_reporta.$errors,s=>(n(),d("div",{key:s.$uid},[r("div",Te,p(s.$message),1)]))),128))]),_:1},8,["modelValue","options","onFilter","error","disable","option-label","option-value"])]),r("div",Be,[o[20]||(o[20]=r("label",{class:"q-mb-sm block"},"Descripci\xF3n del incidente",-1)),i(L,{type:"textarea",autogrow:"",modelValue:e.registro.descripcion,"onUpdate:modelValue":o[9]||(o[9]=s=>e.registro.descripcion=s),placeholder:"Obligatorio",disable:e.disabled,error:!!e.v$.descripcion.$errors.length,outlined:"",dense:""},{error:a(()=>[(n(!0),d(q,null,Q(e.v$.descripcion.$errors,s=>(n(),d("div",{key:s.$uid},[r("div",Ne,p(s.$message),1)]))),128))]),_:1},8,["modelValue","disable","error"])]),r("div",Ge,[i($,{ref:"refArchivo",label:"Im\xE1genes o archivos adjuntos",mixin:e.mixin,disable:e.disabled,listarAlGuardar:!1,"permitir-eliminar":e.accion==e.acciones.nuevo||e.accion==e.acciones.editar,idModelo:e.idRegistro},null,8,["mixin","disable","permitir-eliminar","idModelo"])])])]),_:1})]),_:1},8,["mixin","configuracionColumnas"])}var Do=ee(Ie,[["render",Me]]);export{Do as default};
