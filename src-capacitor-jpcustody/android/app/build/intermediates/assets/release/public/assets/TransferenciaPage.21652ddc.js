var z=Object.defineProperty;var G=(e,o,u)=>o in e?z(e,o,{enumerable:!0,configurable:!0,writable:!0,value:u}):e[o]=u;var i=(e,o,u)=>(G(e,typeof o!="symbol"?o+"":o,u),u);import{Q as B,a as F}from"./QSelect.b920278b.js";import{by as H,s as J,d as K,bd as W,m as X,u as Y,c as v,E as Z,q as x,_ as ee,t as y,v as p,P as oe,F as s,z as r,a6 as ae,y as n,x as $,J as E,I as w,B as re,j as se,O as ne,bg as ie,D as N,K as T,G as le,H as te,L as ue}from"./index.b8e09611.js";import{Q as de,a as me,C as pe}from"./QPopupProxy.685eacb5.js";import{Q as ce,a as fe}from"./QItemSection.ec4cc512.js";import{Q as be}from"./QForm.eab79b48.js";import{E as ve}from"./entidadAuditable.75a46700.js";import{T as $e}from"./TabLayout.45a66130.js";import{S as ge}from"./EssentialTable.23af6cc8.js";import{u as he}from"./index.70965bc7.js";import{a as k,r as g,d as Ve,m as L}from"./i18n-validators.06abe774.js";import{C as Ce}from"./ContenedorSimpleMixin.4e22246b.js";import{u as ye,c as we}from"./transferenciaSaldo.e09f9167.js";import{T as Se}from"./TareaController.490ce98d.js";import{E as qe}from"./EmpleadoPermisosController.1af79390.js";import{I as Be,s as Ee}from"./utils.9344cd7e.js";import{N as Te}from"./NoOptionComponent.9c331961.js";import{E as ke}from"./ErrorComponent.3c1fc91c.js";import"./QChip.f8f308fa.js";import"./QMenu.b3fb639b.js";import"./position-engine.799c9136.js";import"./format.8ac60962.js";import"./QTabs.1ee2fae1.js";import"./QResizeObserver.1422c274.js";import"./QTabPanels.1776fc83.js";import"./touch.9135741d.js";import"./QPage.e6f8825d.js";import"./buttonSubmits.f2d72caa.js";import"./EssentialTablePagination.ce808cac.js";import"./QTable.c4bfb038.js";import"./use-fullscreen.37810a50.js";import"./QToolbar.afeb6de9.js";import"./QBtnGroup.7d38eecd.js";import"./QBadge.89898cd2.js";import"./QFile.c79664c6.js";import"./_commonjsHelpers.8402d862.js";import"./QImg.95754b62.js";import"./VisorImagen.29457a6f.js";import"./seleccionContratacionPersonal.utils.e3e1ed3d.js";import"./index.ea415f98.js";class Le extends ve{constructor(){super();i(this,"fecha");i(this,"usuario_envia_info");i(this,"usuario_recibe_info");i(this,"usuario_envia");i(this,"usuario_recibe");i(this,"monto");i(this,"motivo");i(this,"observacion");i(this,"cuenta");i(this,"tarea");i(this,"tarea_info");i(this,"comprobante");i(this,"estado_info");i(this,"es_devolucion");this.fecha=null,this.usuario_envia_info=null,this.usuario_recibe_info=null,this.usuario_envia=null,this.usuario_recibe=null,this.monto=null,this.motivo="TRANSFERENCIA ENTRE USUARIOS",this.observacion=null,this.cuenta=null,this.tarea=null,this.tarea_info=null,this.comprobante=null,this.estado_info=null,this.es_devolucion=!1}}class Qe extends H{constructor(){super(J.transferencia)}}var Ue=K({components:{ErrorComponent:ke,NoOptionComponent:Te,TabLayout:$e,SelectorImagen:ge},emits:["guardado","cerrar-modal"],setup(){W().setQuasar(X());const e=Y(),o=e.user,u=ye(),h=new Ce(Le,new Qe),{entidad:l,disabled:Q,accion:d,listadosAuxiliares:t}=h.useReferencias(),{setValidador:S,obtenerListados:q,cargarVista:a,consultar:D}=h.useComportamiento(),V=v([]),C=v([]),U=v(!0),A=v(!1),I=v([]),j={usuario_envia:{required:k(()=>e.can("puede.registrar.fondos_terceros"))},usuario_recibe:{requiredIf:k(()=>!l.es_devolucion)},monto:{required:g,maxValue:Ve(9999),maxLength:L(50)},cuenta:{required:g,maxLength:L(50)},tarea:{requiredIf:k(()=>!l.es_devolucion)},fecha:{required:g},comprobante:{required:g},observacion:{required:g,maxLength:L(150)}},O=he(j,l);S(O.value),u.id_transferencia&&(D({id:u.id_transferencia}),U.value=!1,A.value=!0),a(async()=>{await q({usuarios:{controller:new Z,params:{campos:"id,nombres,apellidos",estado:1}},tareas:{controller:new Se,params:{campos:"id,codigo_tarea,titulo,cliente_id,proyecto_id","f_params[orderBy][field]":"id","f_params[orderBy][type]":"DESC","f_params[limit]":100}}}),t.tareas.unshift({id:0,titulo:"Sin Tarea",codigo_tarea:" "}),C.value=t.tareas,V.value=t.usuarios,e.can("puede.registrar.fondos_terceros")&&await P()});async function P(){const m=await new qe().listar({permisos:["puede.delegar.registro_fondos"]});I.value=m.result}function R(m,c){if(m===""){c(()=>{V.value=t.usuarios});return}c(()=>{const f=m.toLowerCase();V.value=t.usuarios.filter(b=>b.nombres.toLowerCase().indexOf(f)>-1||b.apellidos.toLowerCase().indexOf(f)>-1)})}function _(m,c){if(m===""){c(()=>{C.value=t.tareas});return}c(()=>{const f=m.toLowerCase();C.value=t.tareas.filter(b=>b.codigo_tarea.toLowerCase().indexOf(f)>-1||b.titulo.toLowerCase().indexOf(f)>-1)})}function M(){l.es_devolucion?(l.usuario_recibe=null,l.tarea=0,l.motivo="DEVOLUCION"):(l.motivo="TRANSFERENCIA ENTRE USUARIOS",l.tarea=null)}return{mixin:h,transferencia:l,disabled:Q,accion:d,maskFecha:x,v$:O,store:e,empleados_delegadores:I,optionsFecha:Be,usuarios:V,usuario:o,tareas:C,ordenarLista:Ee,filtrarUsuarios:R,filtrarTareas:_,existeDevolucion:M,mostrarListado:U,configuracionColumnas:we}}});const Ie={class:"row q-col-gutter-sm q-mb-md"},Oe={key:0,class:"col-12 col-md-3 q-mb-md col-sm-3"},Fe={key:1,class:"col-12 col-md-3 q-mb-md"},Ne={class:"col-12 col-md-3 col-sm-3"},De={class:"row items-center justify-end"},Ae={class:"col-12 col-md-3"},je={class:"col-12 col-md-3"},Pe={key:2,class:"col-12 col-md-3"},Re={class:"col-12 col-md-3"},_e={class:"error-msg"},Me={class:"col-12 col-md-3 q-mb-xl"},ze={class:"col-12 col-md-3"};function Ge(e,o,u,h,l,Q){const d=y("error-component"),t=y("no-option-component"),S=y("selector-imagen"),q=y("tab-layout");return p(),oe(q,{mixin:e.mixin,configuracionColumnas:e.configuracionColumnas,ajustarCeldas:""},{formulario:s(()=>[r(be,{onSubmit:o[12]||(o[12]=ae(()=>{},["prevent"]))},{default:s(()=>[n("div",Ie,[e.store.can("puede.registrar.fondos_terceros")?(p(),$("div",Oe,[o[13]||(o[13]=n("label",{class:"q-mb-sm block"},"Empleado Solicitante",-1)),r(B,{modelValue:e.transferencia.usuario_envia,"onUpdate:modelValue":o[0]||(o[0]=a=>e.transferencia.usuario_envia=a),options:e.empleados_delegadores,"transition-show":"jump-up","transition-hide":"jump-down",disable:e.disabled,"options-dense":"",dense:"",outlined:"",error:!!e.v$.usuario_envia.$errors.length,onBlur:e.v$.usuario_envia.$touch,"error-message":"Debes seleccionar un empleado al que se carga el gasto","use-input":"","input-debounce":"0",onPopupShow:o[1]||(o[1]=a=>e.ordenarLista(e.empleados_delegadores,"nombres")),"option-value":a=>a.id,"option-label":a=>a.nombres+" "+a.apellidos,"emit-value":"","map-options":""},{error:s(()=>[r(d,{clave:"usuario_envia",v$:e.v$},null,8,["v$"])]),"no-option":s(()=>[r(t)]),_:1},8,["modelValue","options","disable","error","onBlur","option-value","option-label"])])):E("",!0),e.transferencia.es_devolucion?E("",!0):(p(),$("div",Fe,[o[14]||(o[14]=n("label",{class:"q-mb-sm block"},"Destinatario:",-1)),r(B,{modelValue:e.transferencia.usuario_recibe,"onUpdate:modelValue":o[2]||(o[2]=a=>e.transferencia.usuario_recibe=a),options:e.usuarios,"transition-show":"jump-up","transition-hide":"jump-down","options-dense":"",dense:"",outlined:"",disable:e.disabled,readonly:e.disabled,error:!!e.v$.usuario_recibe.$errors.length,"error-message":"Debes seleccionar un usuario","use-input":"",onBlur:e.v$.usuario_recibe.$touch,"input-debounce":"0",onFilter:e.filtrarUsuarios,"option-value":a=>a.id,"option-label":a=>a.nombres+" "+a.apellidos,"emit-value":"","map-options":""},{error:s(()=>[r(d,{clave:"usuario_recibe",v$:e.v$},null,8,["v$"])]),"no-option":s(()=>[r(t)]),_:1},8,["modelValue","options","disable","readonly","error","onBlur","onFilter","option-value","option-label"])])),n("div",Ne,[o[15]||(o[15]=n("label",{class:"q-mb-sm block"},"Fecha de Transferencia",-1)),r(w,{modelValue:e.transferencia.fecha,"onUpdate:modelValue":o[4]||(o[4]=a=>e.transferencia.fecha=a),placeholder:"Obligatorio",error:!!e.v$.fecha.$errors.length,onBlur:e.v$.fecha.$touch,disable:e.disabled,readonly:"",outlined:"",dense:""},{append:s(()=>[r(re,{name:"event",class:"cursor-pointer"},{default:s(()=>[r(de,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:s(()=>[r(me,{modelValue:e.transferencia.fecha,"onUpdate:modelValue":o[3]||(o[3]=a=>e.transferencia.fecha=a),options:e.optionsFecha,mask:e.maskFecha,"today-btn":""},{default:s(()=>[n("div",De,[se(r(ne,{label:"Cerrar",color:"primary",flat:""},null,512),[[pe]])])]),_:1},8,["modelValue","options","mask"])]),_:1})]),_:1})]),error:s(()=>[r(d,{clave:"fecha",v$:e.v$},null,8,["v$"])]),_:1},8,["modelValue","error","onBlur","disable"])]),n("div",Ae,[o[16]||(o[16]=n("label",{class:"q-mb-sm block"},"Monto:",-1)),r(w,{modelValue:e.transferencia.monto,"onUpdate:modelValue":o[5]||(o[5]=a=>e.transferencia.monto=a),placeholder:"Obligatorio",disable:e.disabled,type:"number",error:!!e.v$.monto.$errors.length,onBlur:e.v$.monto.$touch,outlined:"",dense:""},{error:s(()=>[r(d,{clave:"monto",v$:e.v$},null,8,["v$"])]),_:1},8,["modelValue","disable","error","onBlur"])]),n("div",je,[o[17]||(o[17]=n("label",{class:"q-mb-sm block"},"Cuenta:",-1)),r(w,{modelValue:e.transferencia.cuenta,"onUpdate:modelValue":o[6]||(o[6]=a=>e.transferencia.cuenta=a),placeholder:"Obligatorio",disable:e.disabled,error:!!e.v$.cuenta.$errors.length,onBlur:e.v$.cuenta.$touch,outlined:"",dense:""},{error:s(()=>[r(d,{clave:"cuenta",v$:e.v$},null,8,["v$"])]),_:1},8,["modelValue","disable","error","onBlur"])]),e.transferencia.es_devolucion?E("",!0):(p(),$("div",Pe,[o[18]||(o[18]=n("label",{class:"q-mb-sm block"},"Tareas",-1)),r(B,{modelValue:e.transferencia.tarea,"onUpdate:modelValue":o[7]||(o[7]=a=>e.transferencia.tarea=a),options:e.tareas,"transition-show":"jump-up","transition-hide":"jump-down","options-dense":"",dense:"",outlined:"",disable:e.disabled,readonly:e.disabled,error:!!e.v$.tarea.$errors.length,onFilter:e.filtrarTareas,onBlur:e.v$.tarea.$touch,"error-message":"Debes seleccionar una Tarea","use-input":"","input-debounce":"0","option-value":a=>a.id,"option-label":a=>a.titulo,"emit-value":"","map-options":""},{error:s(()=>[r(d,{clave:"tarea",v$:e.v$},null,8,["v$"])]),option:s(a=>[r(ce,ie(a.itemProps,{class:"q-my-sm"}),{default:s(()=>[r(fe,null,{default:s(()=>[r(F,{class:"text-bold text-primary"},{default:s(()=>[N(T(a.opt.codigo_tarea),1)]),_:2},1024),r(F,{caption:""},{default:s(()=>[N(T(a.opt.titulo),1)]),_:2},1024)]),_:2},1024)]),_:2},1040)]),"no-option":s(()=>[r(t)]),_:1},8,["modelValue","options","disable","readonly","error","onFilter","onBlur","option-value","option-label"])])),n("div",Re,[o[19]||(o[19]=n("label",{class:"q-mb-sm block"},"Comprobante ",-1)),r(S,{placeholder:"Obligatorio",imagen:e.transferencia.comprobante,error:!!e.v$.comprobante.$errors.length,"onUpdate:modelValue":o[8]||(o[8]=a=>e.transferencia.comprobante=a)},{error:s(()=>[(p(!0),$(le,null,te(e.v$.comprobante.$errors,a=>(p(),$("div",{key:a.$uid},[n("div",_e,T(a.$message),1)]))),128))]),_:1},8,["imagen","error"])]),n("div",Me,[r(ue,{class:"q-mt-lg q-pt-md",modelValue:e.transferencia.es_devolucion,"onUpdate:modelValue":[o[9]||(o[9]=a=>e.transferencia.es_devolucion=a),o[10]||(o[10]=a=>e.existeDevolucion())],label:"\xBFEs devolucion a la cuenta de la empresa?",disable:e.disabled,outlined:"",dense:""},null,8,["modelValue","disable"])]),n("div",ze,[o[20]||(o[20]=n("label",{class:"q-mb-sm block"},"Observaci\xF3n",-1)),r(w,{modelValue:e.transferencia.observacion,"onUpdate:modelValue":o[11]||(o[11]=a=>e.transferencia.observacion=a),placeholder:"obligatorio",type:"textarea",disable:e.disabled,error:!!e.v$.observacion.$errors.length,autogrow:"",onBlur:e.v$.observacion.$touch,outlined:"",dense:""},{error:s(()=>[r(d,{clave:"observacion",v$:e.v$},null,8,["v$"])]),_:1},8,["modelValue","disable","error","onBlur"])])])]),_:1})]),_:1},8,["mixin","configuracionColumnas"])}var Io=ee(Ue,[["render",Ge]]);export{Io as default};
