var X=Object.defineProperty;var Y=(e,i,n)=>i in e?X(e,i,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[i]=n;var d=(e,i,n)=>(Y(e,typeof i!="symbol"?i+"":i,n),n);import{d as Z,u as x,E as ee,c as v,q as ie,bz as oe,n as ne,_ as se,t as c,v as r,P as U,F as l,z as a,a6 as ae,y as s,I as g,x as t,G as $,H as h,K as b,D as L,J as u,B,j as le,O as M,L as re,a9 as te}from"./index.b8e09611.js";import{Q as de,a as ce}from"./QItemSection.ec4cc512.js";import{Q as me}from"./QSelect.b920278b.js";import{Q as pe,a as ue,C as be}from"./QPopupProxy.685eacb5.js";import{Q as fe}from"./QForm.eab79b48.js";import{a as G,g as ve,e as ge}from"./utils.7dcda2a3.js";import{r as _,a as z}from"./i18n-validators.06abe774.js";import{u as $e}from"./index.70965bc7.js";import{u as he}from"./filtrosListadosGenerales.87fcb144.js";import{T as Ve}from"./TabLayoutFilterTabs2.6bbaa932.js";import{M as ye}from"./MultiplePageLayout.ab045a99.js";import{S as Ie}from"./SolicitudDescuentoPage.8a5b6f19.js";import{G as ke}from"./GestorArchivos.801d8a9f.js";import{C as qe}from"./CoordenadasInput.d6f16af3.js";import{E as Ce}from"./EssentialEditor.aa04b076.js";import{I as Ee,a as Ae}from"./IncidentePage.7e70f440.js";import{a as Be}from"./EssentialTable.23af6cc8.js";import{C as _e}from"./ContenedorSimpleMixin.4e22246b.js";import{E as Qe}from"./entidadAuditable.75a46700.js";import"./QChip.f8f308fa.js";import"./QMenu.b3fb639b.js";import"./position-engine.799c9136.js";import"./format.8ac60962.js";import"./utils.9344cd7e.js";import"./index.ea415f98.js";import"./QTabs.1ee2fae1.js";import"./QResizeObserver.1422c274.js";import"./QTabPanels.1776fc83.js";import"./touch.9135741d.js";import"./QPage.e6f8825d.js";import"./EssentialTableTabs.03c27e34.js";import"./QBadge.89898cd2.js";import"./EssentialTablePagination.ce808cac.js";import"./QTable.c4bfb038.js";import"./use-fullscreen.37810a50.js";import"./QToolbar.afeb6de9.js";import"./QBtnGroup.7d38eecd.js";import"./buttonSubmits.f2d72caa.js";import"./selector.e0ee4903.js";import"./SelectorController.efbca5b9.js";import"./EssentialSelectableTable.ac03bc90.js";import"./configuracionColumnasDetallesModal.ec8d68f5.js";import"./ClienteMaterialEmpleadoController.99667624.js";import"./CategoriaController.374c6f26.js";import"./QUploader.16c4ab83.js";import"./QCircularProgress.c6e924d2.js";import"./QFile.c79664c6.js";import"./configuracionColumnasArchivoSubtarea.215f4ffd.js";import"./extend.4a22771d.js";import"./QBtnToggle.9f2e36fa.js";import"./SimpleLayout.97ee66fd.js";import"./DevolucionPage.37ecf206.js";import"./DevolucionController.eba785bd.js";import"./ModalEntidad.54c9ab3a.js";import"./configuracion_general.1d29d94f.js";import"./ConfiguracionController.a136b041.js";import"./devolucion.ba2120b6.js";import"./TareaController.490ce98d.js";import"./configuracionColumnasProductosSeleccionados.8e4ddf6e.js";import"./listadoMaterialesDevolucion.14686f4f.js";import"./ComponenteModal.domain.92aacded.js";import"./PedidoPage.61155df0.js";import"./VisualizarPedidoPage.e3ac2fb6.js";import"./TabLayout.45a66130.js";import"./pedido.272275e4.js";import"./PedidoController.a6731e75.js";import"./configuracionColumnasDetallesModal.0b76e70c.js";import"./ClienteController.6128473d.js";import"./ComportamientoModalesPedido.44e6fefe.js";import"./ProyectoController.cb4f7c6c.js";import"./EtapaController.7c12ac90.js";import"./ErrorComponent.3c1fc91c.js";import"./NoOptionComponent.9c331961.js";import"./_commonjsHelpers.8402d862.js";import"./QImg.95754b62.js";import"./VisorImagen.29457a6f.js";import"./seleccionContratacionPersonal.utils.e3e1ed3d.js";import"./ArchivoController.b6daf863.js";const Te=[{name:"id",field:"id",label:"Id",align:"left",sortable:!0},{name:"titulo",field:"titulo",label:"Titulo",align:"left",sortable:!0},{name:"descripcion",field:"descripcion",label:"Descripci\xF3n",align:"left",sortable:!0},{name:"responsable",field:"responsable",label:"Responsable",align:"left",sortable:!0},{name:"fecha_inicio",field:"fecha_inicio",label:"Fecha de inicio",align:"left",sortable:!0},{name:"estado",field:"estado",label:"Estado",align:"left",sortable:!0},{name:"cantidad_incidentes",field:"cantidad_incidentes",label:"Cantidad de incidentes",align:"left",sortable:!0}];class we extends Qe{constructor(){super();d(this,"titulo");d(this,"descripcion");d(this,"estado");d(this,"fecha_inicio");d(this,"responsable");d(this,"empleado_involucrado");d(this,"finalizado");d(this,"tiene_incidencias");d(this,"coordenadas");d(this,"seguimiento");d(this,"cantidad_incidentes");this.titulo=null,this.descripcion=null,this.estado=G.CREADO,this.fecha_inicio=null,this.responsable=null,this.finalizado=!1,this.tiene_incidencias=!1,this.empleado_involucrado=null,this.coordenadas=null,this.seguimiento="",this.cantidad_incidentes=0}}var Fe=Z({name:"inspecciones",components:{CoordenadasInput:qe,TabLayoutFilterTabs2:Ve,Estado:Be,IncidentePage:Ee,GestorArchivos:ke,EssentialEditor:Ce,MultiplePageLayout:ye,SolicitudDescuentoPage:Ie},setup(){const e=x(),i=new _e(we,new Ae),{entidad:n,disabled:Q,listadosAuxiliares:T,accion:w,tabsPage:V}=i.useReferencias(),{setValidador:y,listar:I,cargarVista:k,obtenerListados:q}=i.useComportamiento(),{onConsultado:C,onReestablecer:E,onBeforeGuardar:o,onGuardado:R,onModificado:N,onBeforeModificar:j}=i.useHooks();k(async()=>{await q({empleados:{controller:new ee,params:{campos:"id,nombres,apellidos",estado:1}}})});const F=v(),f=v(),m=v(),A=v();n.responsable=e.user.apellidos+" "+e.user.nombres;const{empleados:H,filtrarEmpleados:J}=he(T);function D(p){I({estado:p}),F.value=p}const P=async()=>await f.value.subir(),S=()=>{m.value.incidente.es_parte_inspeccion=!0,m.value.incidente.inspeccion=n.id},K=()=>{V.value="2",ne(()=>{m.value.tabs="listado",m.value.refrescarListados("inspecciones"),m.value.filtrarIncidentes(ge.CREADO,{inspeccion_id:n.id}),S()})},W={titulo:{required:_},descripcion:{required:_},fecha_inicio:{required:_},empleado_involucrado:{requiredIf:z(()=>!n.tiene_incidencias)},coordenadas:{requiredIf:z(()=>!n.tiene_incidencias)}};console.log(!n.tiene_incidencias);const O=$e(W,n);return y(O.value),C(()=>{n.tiene_incidencias=n.tiene_incidencias||!!n.cantidad_incidentes,setTimeout(()=>f.value.listarArchivosAlmacenados(n.id),1)}),R(p=>{A.value=p,setTimeout(()=>P(),1)}),o(()=>{n.tiene_incidencias&&(n.empleado_involucrado=null,n.coordenadas=null)}),j(()=>{n.tiene_incidencias&&(n.empleado_involucrado=null,n.coordenadas=null)}),N(p=>{A.value=p,setTimeout(()=>P(),1)}),E(()=>{n.responsable=e.user.nombres+" "+e.user.apellidos,f.value.limpiarListado()}),D(G.CREADO),{validador$:O,refIncidentePage:m,idEntidad:A,refArchivo:f,mixin:i,inspeccion:n,accion:w,disabled:Q,maskFecha:ie,configuracionColumnasInspecciones:Te,tabActual:F,filtrarInspecciones:D,tabOptionsEstadosInspecciones:ve,acciones:oe,empleados:H,filtrarEmpleados:J,marcarTieneIncidencias:S,irIncidencias:K}}});const De={class:"row q-col-gutter-sm q-py-md"},Pe={class:"col-12 col-md-3"},Se={class:"error-msg"},Oe={class:"col-12 col-md-9"},Ue={class:"error-msg"},Le={key:0,class:"col-12 col-md-3"},Me={class:"error-msg"},ze={class:"col-12 col-md-3"},Ge={key:1,class:"col-12 col-md-3"},Re={class:"col-12 col-md-3"},Ne={class:"row items-center justify-end"},je={class:"error-msg"},He={key:2,class:"col-12 col-md-3"},Je={class:"col-12 q-mb-md"},Ke={class:"col-12 col-md-3"},We={key:3,class:"col-12 col-md-3"},Xe={class:"col-12"},Ye={key:4,class:"col-12 border-callout-warning bg-solid q-pb-sm"},Ze={class:"bg-desenfoque rounded q-pa-md"},xe={class:"q-px-md q-py-xs rounded text-bold q-mb-md inline-block bg-grey-3"};function ei(e,i,n,Q,T,w){const V=c("coordenadas-input"),y=c("essential-editor"),I=c("gestor-archivos"),k=c("tab-layout-filter-tabs2"),q=c("incidente-page"),C=c("solicitud-descuento-page"),E=c("multiple-page-layout");return r(),U(E,{mixin:e.mixin},{tab1:l(()=>[a(k,{mixin:e.mixin,"configuracion-columnas":e.configuracionColumnasInspecciones,tabOptions:e.tabOptionsEstadosInspecciones,filtrar:e.filtrarInspecciones,tabDefecto:e.tabActual,"ajustar-celdas":"","forzar-listar":"","multiple-pages":""},{formulario:l(()=>[a(fe,{onSubmit:i[10]||(i[10]=ae(()=>{},["prevent"]))},{default:l(()=>[s("div",De,[s("div",Pe,[i[13]||(i[13]=s("label",{class:"q-mb-sm block"},"T\xEDtulo",-1)),a(g,{modelValue:e.inspeccion.titulo,"onUpdate:modelValue":i[0]||(i[0]=o=>e.inspeccion.titulo=o),placeholder:"Obligatorio",disable:e.disabled,autofocus:"",outlined:"",dense:"",error:!!e.validador$.titulo.$errors.length,onBlur:e.validador$.titulo.$touch},{error:l(()=>[(r(!0),t($,null,h(e.validador$.titulo.$errors,o=>(r(),t("div",{key:o.$uid},[s("div",Se,b(o.$message),1)]))),128))]),_:1},8,["modelValue","disable","error","onBlur"])]),s("div",Oe,[i[14]||(i[14]=s("label",{class:"q-mb-sm block"},"Descripci\xF3n",-1)),a(g,{modelValue:e.inspeccion.descripcion,"onUpdate:modelValue":i[1]||(i[1]=o=>e.inspeccion.descripcion=o),placeholder:"Obligatorio",disable:e.disabled,outlined:"",dense:"",error:!!e.validador$.descripcion.$errors.length,onBlur:e.validador$.descripcion.$touch},{error:l(()=>[(r(!0),t($,null,h(e.validador$.descripcion.$errors,o=>(r(),t("div",{key:o.$uid},[s("div",Ue,b(o.$message),1)]))),128))]),_:1},8,["modelValue","disable","error","onBlur"])]),e.inspeccion.tiene_incidencias?u("",!0):(r(),t("div",Le,[i[16]||(i[16]=s("label",{class:"q-mb-sm block"},"Empleado involucrado",-1)),a(me,{modelValue:e.inspeccion.empleado_involucrado,"onUpdate:modelValue":i[2]||(i[2]=o=>e.inspeccion.empleado_involucrado=o),options:e.empleados,"transition-show":"scale","transition-hide":"scale","options-dense":"",dense:"",outlined:"","use-input":"","input-debounce":"0",disable:e.disabled,error:!!e.validador$.empleado_involucrado.$errors.length,onBlur:e.validador$.empleado_involucrado.$touch,onFilter:e.filtrarEmpleados,"option-label":o=>o.apellidos+" "+o.nombres,"option-value":o=>o.id,"emit-value":"","map-options":""},{"no-option":l(()=>[a(de,null,{default:l(()=>[a(ce,{class:"text-grey"},{default:l(()=>i[15]||(i[15]=[L(" No hay resultados ")])),_:1})]),_:1})]),error:l(()=>[(r(!0),t($,null,h(e.validador$.empleado_involucrado.$errors,o=>(r(),t("div",{key:o.$uid},[s("div",Me,b(o.$message),1)]))),128))]),_:1},8,["modelValue","options","disable","error","onBlur","onFilter","option-label","option-value"])])),s("div",ze,[i[17]||(i[17]=s("label",{class:"q-mb-sm block"},"Responsable de la inspecci\xF3n",-1)),a(g,{modelValue:e.inspeccion.responsable,"onUpdate:modelValue":i[3]||(i[3]=o=>e.inspeccion.responsable=o),disable:"",outlined:"",dense:""},null,8,["modelValue"])]),e.inspeccion.tiene_incidencias?u("",!0):(r(),t("div",Ge,[a(V,{modelValue:e.inspeccion.coordenadas,"onUpdate:modelValue":i[4]||(i[4]=o=>e.inspeccion.coordenadas=o),disable:e.disabled,validador:e.validador$},null,8,["modelValue","disable","validador"])])),s("div",Re,[i[18]||(i[18]=s("label",{class:"q-mb-sm block"},"Fecha de inicio",-1)),a(g,{modelValue:e.inspeccion.fecha_inicio,"onUpdate:modelValue":i[6]||(i[6]=o=>e.inspeccion.fecha_inicio=o),placeholder:"Obligatorio",outlined:"",disable:e.disabled,type:"datetime",error:!!e.validador$.fecha_inicio.$errors.length,onBlur:e.validador$.fecha_inicio.$touch,dense:""},{append:l(()=>[a(B,{name:"event",class:"cursor-pointer"},{default:l(()=>[a(pe,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:l(()=>[a(ue,{modelValue:e.inspeccion.fecha_inicio,"onUpdate:modelValue":i[5]||(i[5]=o=>e.inspeccion.fecha_inicio=o),mask:e.maskFecha,"today-btn":""},{default:l(()=>[s("div",Ne,[le(a(M,{label:"Cerrar",color:"primary",flat:""},null,512),[[be]])])]),_:1},8,["modelValue","mask"])]),_:1})]),_:1})]),error:l(()=>[(r(!0),t($,null,h(e.validador$.fecha_inicio.$errors,o=>(r(),t("div",{key:o.$uid},[s("div",je,b(o.$message),1)]))),128))]),_:1},8,["modelValue","disable","error","onBlur"])]),e.inspeccion.created_at?(r(),t("div",He,[i[19]||(i[19]=s("label",{class:"q-mb-sm block"},"Fecha hora de solicitud",-1)),s("b",null,b(e.inspeccion.created_at),1)])):u("",!0),s("div",Je,[i[20]||(i[20]=s("label",{class:"q-mb-sm block"},"Seguimiento",-1)),a(y,{modelValue:e.inspeccion.seguimiento,"onUpdate:modelValue":i[7]||(i[7]=o=>e.inspeccion.seguimiento=o),disable:e.disabled},null,8,["modelValue","disable"])]),s("div",Ke,[a(re,{modelValue:e.inspeccion.tiene_incidencias,"onUpdate:modelValue":i[8]||(i[8]=o=>e.inspeccion.tiene_incidencias=o),label:"\xBFTiene incidencias?",disable:e.disabled||e.inspeccion.cantidad_incidentes>0,outlined:"",dense:""},null,8,["modelValue","disable"])]),e.accion!==e.acciones.nuevo?(r(),t("div",We,[a(te,{modelValue:e.inspeccion.finalizado,"onUpdate:modelValue":i[9]||(i[9]=o=>e.inspeccion.finalizado=o),label:"\xBFFinalizado?",disable:e.disabled,color:"positive",outlined:"",dense:""},null,8,["modelValue","disable"])])):u("",!0),s("div",Xe,[a(I,{ref:"refArchivo",label:"Adjuntar archivos",mixin:e.mixin,disable:e.disabled,listarAlGuardar:!1,"permitir-eliminar":e.accion==e.acciones.nuevo||e.accion==e.acciones.editar,idModelo:e.idEntidad},null,8,["mixin","disable","permitir-eliminar","idModelo"])]),e.inspeccion.tiene_incidencias&&e.accion===e.acciones.nuevo?(r(),t("div",Ye,[a(B,{name:"bi-exclamation-octagon",color:"warning",class:"q-mr-sm"}),i[21]||(i[21]=s("span",{innerHTML:"Usted est\xE1 a punto de registrar una inspecci\xF3n con incidencias. Para poder agregar incidencias primero guarde la inspecci\xF3n, luego vaya a Listado y presione el bot\xF3n <b>Editar</b> de la inspecci\xF3n agregada recientemente."},null,-1))])):u("",!0)])]),_:1})]),"custom-buttons":l(()=>[e.accion!==e.acciones.nuevo&&e.inspeccion.tiene_incidencias?(r(),U(M,{key:0,onClick:i[11]||(i[11]=o=>e.irIncidencias()),color:"positive",label:"Gestionar incidentes",icon:"bi-person-hearts","no-caps":"",push:""})):u("",!0)]),_:1},8,["mixin","configuracion-columnas","tabOptions","filtrar","tabDefecto"])]),tab2:l(()=>[s("div",Ze,[s("span",xe,[a(B,{name:"bi-person-hearts",class:"q-mr-sm"}),i[22]||(i[22]=L(" Incidentes de la inspecci\xF3n seleccionada "))]),a(q,{ref:"refIncidentePage",onGuardado:i[12]||(i[12]=o=>e.marcarTieneIncidencias())},null,512)])]),tab3:l(()=>[a(C)]),_:1},8,["mixin"])}var Ao=se(Fe,[["render",ei]]);export{Ao as default};
