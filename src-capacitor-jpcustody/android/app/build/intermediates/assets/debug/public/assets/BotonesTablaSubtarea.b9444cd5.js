var Fe=Object.defineProperty;var De=(a,e,s)=>e in a?Fe(a,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):a[e]=s;var $=(a,e,s)=>(De(a,typeof e!="symbol"?e+"":e,s),s);import{A as wa,s as M,bF as Ue,by as Qa,R as ra,c as b,bG as Ja,d as qe,u as Za,bU as f,p as Ve,f as ua,e as sa,h as Oe,w as Va,bP as Re,bQ as Pe,_ as Ie,t as ia,v as A,P as V,F as w,y as d,a5 as ma,K as ya,z as p,O as Oa,B as Ra,be as Ea,a9 as oa,x as Y,J as U,G as Pa,H as Ia,cO as Na,D as Ne}from"./index.b8e09611.js";import{a as Ha,Q as W}from"./QTabs.1ee2fae1.js";import{Q as Ba}from"./QSelect.b920278b.js";import{a as La,Q as X}from"./QTabPanels.1776fc83.js";import{Q as He}from"./QPage.e6f8825d.js";import{S as Be,v as Le,A as $e,i as Ca,n as Ta,a as Ge}from"./utils.9344cd7e.js";import{u as Ka}from"./trabajoAsignado.85b43458.js";import{A as Qe,u as Je}from"./ArchivoSeguimiento.408b3360.js";import{T as za,_ as Ze,u as Ke}from"./BotonesTablaTicket.151fa3b2.js";import{_ as Ye}from"./TablaFilasDinamicas.d44b2e0f.js";import{E as We,S as Xe}from"./EssentialTable.23af6cc8.js";import{B as xe}from"./buttonSubmits.f2d72caa.js";import{M as at}from"./ModalEntidad.54c9ab3a.js";import{V as et}from"./VisorImagen.29457a6f.js";import{M as tt}from"./MotivoCanceladoTicketController.4f5fc288.js";import{T as Ya}from"./TicketController.c52b9d83.js";import{C as it}from"./ComportamientoModalesTicketAsignado.c3014348.js";import{C as Aa}from"./ContenedorSimpleMixin.4e22246b.js";import{F as ot,u as st}from"./FiltroMiBodegaEmpleado.0c8b713d.js";import{F as rt,u as lt}from"./FiltroMiBodegaProyecto.31341d8b.js";import{A as nt}from"./Archivo.c26f5472.js";import{E as dt}from"./entidadAuditable.75a46700.js";import{u as ct}from"./movilizacionSubtarea.b7993c98.js";import{S as ut}from"./SubtareaController.0658809c.js";class x{constructor(){$(this,"axios");$(this,"cargando",new Be);this.axios=wa.getInstance()}async asignar(e){return await this.solicitud("/asignar",e)}async agendar(e){return await this.solicitud("/agendar",e)}async ejecutar(e,s){return this.solicitud("/ejecutar",e,s)}async realizar(e,s){return this.solicitud("/realizar",e,s)}async finalizar(e,s){return this.solicitud("/finalizar",e,s)}async pausar(e,s){return this.solicitud("/pausar",e,s)}async reanudar(e,s){return this.solicitud("/reanudar",e,s)}async corregir(e){return this.solicitud("/corregir",e)}async suspender(e,s){return this.solicitud("/suspender",e,s)}async pendiente(e,s){return this.solicitud("/pendiente",e,{motivo_pendiente_id:s})}async cancelar(e,s){return this.solicitud("/cancelar",e,{motivo_suspendido_id:s})}async reagendar(e,s){return await this.solicitud("/reagendar",e,{nueva_fecha:s})}async solicitud(e,s,T){this.cargando.activar();try{const y=this.axios.getEndpoint(M.subtareas)+e+"/"+s,l=await this.axios.post(y,T);return{response:l,result:l.data.modelo}}catch(y){const l=y;throw new Ue(l)}finally{this.cargando.desactivar()}}}const Ma=[{name:"detalle_producto",field:"detalle_producto",label:"Producto",align:"left",sortable:!0,type:"text"},{name:"serial",field:"serial",label:"Serial",align:"left"},{name:"medida",field:"medida",label:"Medida",align:"left"},{name:"cliente",field:"cliente",label:"Cliente",align:"left"},{name:"despachado",field:"despachado",label:"Despachado",align:"left"},{name:"cantidad_utilizada",field:"cantidad_utilizada",label:"Cantidad utilizada en el dia",align:"left"},{name:"total_cantidad_utilizada",field:"total_cantidad_utilizada",label:"Total cantidad utilizada",align:"left"},{name:"stock_actual",field:"stock_actual",label:"Stock actual",align:"left"},{name:"devuelto",field:"devuelto",label:"Devuelto",align:"left"}],mt=[{name:"fecha_hora",field:"fecha_hora",label:"Fecha hora",align:"center",type:"text",sortable:!0,editable:!0,disableModal:!0},{name:"trabajo_realizado",field:"trabajo_realizado",label:"Trabajo realizado",align:"left",type:"text",hint:"Obligatorio",requerido:!0},{name:"fotografia",field:"fotografia",label:"Fotografia",align:"left",type:"imagen",visible:!1,hint:"Obligatorio",requerido:!0}];class pt extends Qa{constructor(){super(M.actividades_realizadas_seguimientos_subtareas)}}class bt extends Qa{constructor(){super(M.archivos_seguimientos)}}class $a extends dt{constructor(){super();$(this,"fecha_hora");$(this,"trabajo_realizado");$(this,"fotografia");$(this,"subtarea");this.fecha_hora=null,this.trabajo_realizado=null,this.fotografia=null,this.subtarea=null}}const ft=[{name:"producto",field:"producto",label:"Producto",align:"left"},{name:"suma_total",field:"suma_total",label:"Suma total",align:"center"}],_t=[{name:"codigo",field:"codigo",label:"C\xF3digo del ticket",align:"left",sortable:!0,visible:!1,editable:!1},{name:"asunto",field:"asunto",label:"Asunto",align:"left"},{name:"descripcion",field:"descripcion",label:"Descripci\xF3n",align:"left"},{name:"fotografia",field:"fotografia",label:"Fotograf\xEDa",visible:!1,type:"imagen"},{name:"responsable",field:"responsable",label:"Responsable",align:"left",sortable:!0,editable:!1},{name:"estado",field:"estado",label:"Estado",align:"left",editable:!1}];function gt(a){const e=new Ya,{notificarCorrecto:s}=ra(),T=b([]);async function y(h){a(async()=>{const{result:k}=await e.listar({filter:`solicitud_ats[subtarea_id]=${h}`});return T.value=k})}async function l(h,k){const m=new za;m.asunto=h.asunto,m.descripcion=h.descripcion,m.es_solicitud_ats=!0,m.prioridad="ALTA",m.subtarea_id=k,m.para_sso=!0;const o=h.fotografia;try{a(async()=>{const{result:C}=await e.guardar(m);if(T.value.unshift(C),o){const D=E(o);await q(D,C.id)}})}catch(C){console.log(C)}}function E(h){const k=atob(h.split(",")[1]),m=new Array(k.length);for(let D=0;D<k.length;D++)m[D]=k.charCodeAt(D);const o=new Uint8Array(m),C=new Blob([o],{type:"image/png"});return new File([C],"nombre_de_archivo.png",{type:"image/png"})}async function q(h,k){const m=new FormData;m.append("file",h),m.append("ticket_id",k);const o=M.archivos_tickets,C=wa.getInstance(),D=`${Ja.URL_BASE}/${C.getEndpoint(o)}`,P=await C.post(D,m);s(P.data.mensaje)}return{mostrarSolicitudesAts:b(!1),consultarTicketsATS:y,ticketsAts:T,guardarFilaSolicitudAts:l}}const vt=[{name:"detalle_producto",field:"detalle_producto",label:"Producto",align:"left",sortable:!0,type:"text"},{name:"serial",field:"serial",label:"Serial",align:"left"},{name:"medida",field:"medida",label:"Medida",align:"left"},{name:"cliente",field:"cliente",label:"Cliente",align:"left"},{name:"despachado",field:"despachado",label:"Despachado",align:"left"},{name:"total_cantidad_utilizada",field:"total_cantidad_utilizada",label:"Total cantidad utilizada",align:"left"},{name:"stock_actual",field:"stock_actual",label:"Stock actual",align:"left"},{name:"devuelto",field:"devuelto",label:"Devuelto",align:"left"}];var St=qe({components:{EssentialTable:We,SelectorImagen:Xe,ButtonSubmits:xe,TablaObservaciones:Ze,ArchivoSeguimiento:Qe,TablaFilasDinamicas:Ye,VisorImagen:et,ModalesEntidad:at},props:{mixinModal:{type:Object,required:!0}},emits:["cerrar-modal"],setup(a,{emit:e}){const s=Ka(),T=Za(),y=new Aa(nt,new bt),l=new Aa($a,new pt),{entidad:E,listado:q}=l.useReferencias(),{guardar:h,listar:k,cargarVista:m}=l.useComportamiento(),o=b(),C=b(),D=b(),P=b(!1),la=b(!1),O=b(!1),pa=b(!1),ba=b(!1),H=![f.FINALIZADO,f.PAUSADO,f.CANCELADO,f.SUSPENDIDO].includes(s.subtarea.estado),fa=H?[...Ma,Ve]:Ma,{prompt:B}=ra(),_a=s.codigoSubtarea,ga=ua(()=>{var i;return"Rango disponible desde "+s.subtarea.fecha_hora_ejecucion.substring(0,10)+" hasta "+((i=s.subtarea.fecha_hora_finalizacion)!=null?i:Le())}),na=b(!0),G=b([]),Q=ua(()=>na.value?G.value.filter(i=>i.stock_actual):G.value),J=b(!0),aa=b([]),Z=ua(()=>J.value?aa.value.filter(i=>i.stock_actual):aa.value),va=b([]),R=b([]),L=b([]),I=b([]),ea=b([]),t=T.esTecnicoLider,u=T.esCoordinador||T.esJefeTecnico||T.esCoordinadorBackup,S=b(),r=s.subtarea,c=b(),j=b(),K=b(),da=b(),ja=b([]),Fa=b([]),Wa=b([]),Xa=b([]),v=wa.getInstance(),F={tarea_id:s.idTareaSeleccionada,subtarea_id:s.subtarea.id,proyecto_id:s.proyecto_id,etapa_id:s.etapa_id,empleado_id:N()},Da=new it,Sa=new Aa(za,new Ya),{obtenerListados:xa}=Sa.useComportamiento(),{listadosAuxiliares:ha}=Sa.useReferencias();xa({motivosCancelados:{controller:new tt,params:{activo:1}},clientesMaterialesTarea:[],clientesMaterialesEmpleado:[]});const{mostrarSolicitudesAts:ae,consultarTicketsATS:ee,ticketsAts:te,guardarFilaSolicitudAts:ie}=gt(m),{btnSeguimiento:oe,btnCancelar:se}=Ke(Sa,Da),ca=sa(new rt);ca.empleado_id=F.empleado_id,ca.proyecto_id=F.proyecto_id,ca.etapa_id=F.etapa_id;const Ua=new ot;Ua.empleado_id=F.empleado_id;const{consultarClientesMaterialesTarea:ka}=lt(ca,ha),{consultarClientesMaterialesEmpleado:re}=st(Ua,ha);k({subtarea_id:s.subtarea.id}),Se(),he(),ye(),ke(),ee(r.id),Oe(()=>S.value.listarArchivos({subtarea_id:s.subtarea.id}));const le={titulo:"Cantidad utilizada",icono:"bi-pencil-square",color:"primary",visible:()=>H,accion:({entidad:i,posicion:n})=>{const g={titulo:"Confirmaci\xF3n",mensaje:"Ingresa la cantidad",defecto:Q.value[n].cantidad_utilizada,tipo:"number",validacion:_=>{var z;return!!_&&_>=0&&_<=i.stock_actual+((z=i.cantidad_utilizada)!=null?z:0)},accion:async _=>{var ta;i.cantidad_anterior=(ta=i.cantidad_utilizada)!=null?ta:0,i.cantidad_utilizada=_;const z=await be(i);Q.value[n].total_cantidad_utilizada=z.total_cantidad_utilizada,Q.value[n].stock_actual=z.stock_actual}};B(g)}},ne={titulo:"Cantidad utilizada",icono:"bi-pencil-square",color:"primary",visible:()=>H,accion:({entidad:i,posicion:n})=>{const g={titulo:"Confirmaci\xF3n",mensaje:"Ingresa la cantidad",defecto:Z.value[n].cantidad_utilizada,tipo:"number",validacion:_=>{var z;return!!_&&_>=0&&_<=i.stock_actual+((z=i.cantidad_utilizada)!=null?z:0)},accion:async _=>{var ta;i.cantidad_anterior=(ta=i.cantidad_utilizada)!=null?ta:0,i.cantidad_utilizada=_;const z=await fe(i);Z.value[n].total_cantidad_utilizada=z.total_cantidad_utilizada,Z.value[n].stock_actual=z.stock_actual}};B(g)}},de={titulo:"Ver fotograf\xEDa",icono:"bi-image-fill",color:"secondary",visible:({entidad:i})=>i.fotografia,accion:async({entidad:i})=>{C.value.abrir(i.fotografia)}},ce={titulo:"Cantidad utilizada",icono:"bi-pencil-square",color:"primary",visible:()=>H,accion:({entidad:i,posicion:n})=>{const g={titulo:"Confirmaci\xF3n",mensaje:"Ingresa la cantidad",defecto:R.value[n].cantidad_utilizada,tipo:"number",validacion:_=>!!_&&_>=0&&_<=i.stock_actual+i.cantidad_utilizada,accion:async _=>{i.cantidad_anterior=i.cantidad_utilizada,i.cantidad_utilizada=_;const z=await me(i);z.id=i.id,R.value[n]=z}};B(g)}},ue={titulo:"Cantidad utilizada",icono:"bi-pencil-square",color:"primary",visible:()=>H,accion:({entidad:i,posicion:n})=>{const g={titulo:"Confirmaci\xF3n",mensaje:"Ingresa la cantidad",defecto:L.value[n].cantidad_utilizada,tipo:"number",validacion:_=>!!_&&_>=0&&_<=i.stock_actual+i.cantidad_utilizada,accion:async _=>{i.cantidad_anterior=i.cantidad_utilizada,i.cantidad_utilizada=_;const z=await pe(i);z.id=i.id,L.value[n]=z}};B(g)}};async function me(i){const n={...F,detalle_producto_id:i.detalle_producto_id,cantidad_utilizada:i.cantidad_utilizada,cantidad_anterior:i.cantidad_anterior,fecha:c.value,cliente_id:i.cliente_id},g=v.getEndpoint(M.actualizar_cantidad_utilizada_historial,n);return(await v.post(g)).data.modelo}async function pe(i){const n={...F,detalle_producto_id:i.detalle_producto_id,cantidad_utilizada:i.cantidad_utilizada,cantidad_anterior:i.cantidad_anterior,fecha:j.value,cliente_id:i.cliente_id},g=v.getEndpoint(M.actualizar_cantidad_utilizada_historial_stock,n);return(await v.post(g)).data.modelo}async function be(i){const n={...F,detalle_producto_id:i.detalle_producto_id,cantidad_utilizada:i.cantidad_utilizada,cantidad_anterior:i.cantidad_anterior,fecha:c.value,cliente_id:i.cliente_id},g=v.getEndpoint(M.actualizar_cantidad_utilizada_tarea,n);return(await v.post(g)).data.modelo}async function fe(i){const n={subtarea_id:s.subtarea.id,empleado_id:N(),detalle_producto_id:i.detalle_producto_id,cantidad_utilizada:i.cantidad_utilizada,cantidad_anterior:i.cantidad_anterior,fecha:c.value,cliente_id:i.cliente_id},g=v.getEndpoint(M.actualizar_cantidad_utilizada_stock,n);return(await v.post(g)).data.modelo}function N(){return t?T.user.id:s.subtarea.empleado_responsable_id}async function _e(i){m(async()=>{const n={tarea_id:s.subtarea.tarea_id,subtarea_id:s.subtarea.id,empleado_id:N(),cliente_id:i,proyecto_id:r.proyecto_id,etapa_id:r.etapa_id};r.proyecto_id||delete n.proyecto_id,r.etapa_id||delete n.etapa_id,r.etapa_id&&delete n.tarea_id;const g=v.getEndpoint(M.materiales_empleado_tarea,n),_=await v.get(g);G.value=_.data.results})}function ge(i){m(async()=>{const n=v.getEndpoint(M.materiales_empleado,{empleado_id:N(),subtarea_id:s.subtarea.id,cliente_id:i}),g=await v.get(n);aa.value=g.data.results})}function qa(i){m(async()=>{const n=v.getEndpoint(M.obtener_historial_material_tarea_usado_por_fecha,{fecha:i,subtarea_id:s.subtarea.id,empleado_id:N()}),g=await v.get(n);R.value=g.data.results})}function ve(i){m(async()=>{const n=v.getEndpoint(M.obtener_historial_material_stock_usado_por_fecha,{fecha:i,subtarea_id:s.subtarea.id,empleado_id:N()}),g=await v.get(n);L.value=g.data.results})}function Se(){m(async()=>{const i=v.getEndpoint(M.fechas_historial_materiales_usados)+"/"+s.subtarea.id,n=await v.get(i);ja.value=n.data.results})}function he(){m(async()=>{const i=v.getEndpoint(M.fechas_historial_materiales_stock_usados)+"/"+s.subtarea.id,n=await v.get(i);Fa.value=n.data.results})}function ke(){re({empleado_id:N()})}async function ye(){F.proyecto_id&&F.etapa_id?ka({proyecto_id:F.proyecto_id,etapa_id:F.etapa_id,filtrar_por_etapa:!0}):F.proyecto_id?ka({proyecto_id:F.proyecto_id,etapa_id:F.etapa_id,filtrar_por_proyecto:!0}):ka({tarea_id:r.tarea_id,filtrar_por_tarea:!0})}async function Ee(){const i=Ja.URL_BASE+"/"+v.getEndpoint(M.exportExcelSeguimiento)+"/"+r.id;$e(i,"GET","blob","xlsx","reporte_hoy_")}function Ce(){S.value.subir({subtarea_id:s.subtarea.id})}function Te(){c.value=null,R.value=[]}function Ae(){j.value=null,L.value=[]}function Me(i){E.hydrate(i),E.subtarea=s.subtarea.id,h(E)}function ze(){da.value=void 0,G.value=[]}const we=()=>{m(async()=>{const i=v.getEndpoint(M.obtener_resumen_material_subtarea_usado,{subtarea_id:s.subtarea.id,empleado_id:N()}),n=await v.get(i);I.value=n.data.results.filter(g=>g.total_cantidad_utilizada>0)})},je=()=>{m(async()=>{const i=v.getEndpoint(M.obtener_resumen_material_stock_usado,{subtarea_id:s.subtarea.id,empleado_id:N()}),n=await v.get(i);ea.value=n.data.results.filter(g=>g.total_cantidad_utilizada>0)})};return Va(c,()=>{c.value&&qa(c.value)}),Va(j,()=>{j.value&&ve(j.value)}),{refVisorImagen:C,refTrabajos:o,refObservaciones:D,refArchivoSeguimiento:S,mixinArchivoSeguimiento:y,utilizarMateriales:P,existeMaterialesDevolucion:la,existeObservaciones:O,usarMaterialStock:ba,usarMaterialTarea:pa,columnasMaterial:fa,configuracionColumnasResumenMaterialOcupado:vt,configuracionColumnasMaterialOcupadoFormulario:Ma,configuracionColumnasSumaMaterial:ft,materialesTarea:Q,materialesStock:Z,sumaMaterialesTareaUsado:va,historialMaterialTareaUsadoPorFecha:R,historialMaterialStockUsadoPorFecha:L,resumenMaterialSubtareaUsado:I,resumenMaterialStockUsado:ea,obtenerHistorialMaterialTareaUsadoPorFecha:qa,botonEditarCantidadTarea:le,botonEditarCantidadStock:ne,botonEditarCantidadTareaHistorial:ce,botonEditarCantidadStockHistorial:ue,regiones:Re,atenciones:Pe,emit:e,codigoSubtarea:_a,esLider:t,esCoordinador:u,descargarExcel:Ee,endpoint:M.archivos_seguimientos,ActividadRealizadaSeguimientoSubtarea:$a,configuracionColumnasTrabajoRealizado:mt,verFotografia:de,clientes:Wa,subtarea:r,permitirSubir:H,tab:b("usar_material_tarea"),tabMaterialStock:b("usar_material_stock"),tabsMateriales:b("historial"),fecha_historial:c,fecha_historial_stock:j,rangoFechasHistorial:ga,actividadesRealizadas:q,guardarFilaActividad:Me,mostrarMaterialStock:r.proyecto_id===null,mostrarBotonSubir:ua(()=>{var i;return(i=S.value)==null?void 0:i.quiero_subir_archivos}),subirArchivos:Ce,fechasHistorialMaterialesUsados:ja,fechasHistorialMaterialesStockUsados:Fa,resetearFiltroHistorialTarea:Te,resetearFiltroHistorialStock:Ae,clienteMaterialStock:K,clienteMaterialTarea:da,obtenerMaterialesStock:ge,obtenerMaterialesTarea:_e,clientesMaterialesTarea:Xa,listadosAuxiliares:ha,ticketsAts:te,configuracionColumnasSolicitudAts:_t,Ticket:za,guardarFilaSolicitudAts:ie,btnSeguimiento:oe,btnCancelar:se,modales:Da,mostrarMaterialConStock:na,mostrarMaterialStockConStock:J,mostrarSolicitudesAts:ae,actualizarTablaMaterialesTarea:ze,actualizarTablaResumenMaterialesTarea:we,actualizarTablaResumenMaterialesStock:je}}});const ht={class:"column items-center justify-between q-gutter-sm q-mb-md"},kt={class:"row"},yt={class:"col-12 q-mb-md"},Et={class:"col-12 q-mb-md"},Ct={key:0,class:"col-12"},Tt={class:"col-12 q-mb-md"},At={key:1,class:"col-12 q-mb-md"},Mt={class:"row q-col-gutter-sm q-pa-sm q-mb-md"},zt={class:"col-12 col-md-6"},wt={class:"col-12 col-md-6"},jt={class:"row q-col-gutter-sm q-pa-sm q-mb-md"},Ft={class:"col-12"},Dt={class:"row text-center justify-center bg-drawer rounded-card q-py-md q-mb-md custom-shadow"},Ut={class:"col-12 col-md-3 q-mb-md"},qt={class:"text-positive"},Vt={class:"col-12"},Ot={class:"q-gutter-sm"},Rt={class:"col-12"},Pt={key:2,class:"col-12 q-mb-md"},It={key:3,class:"col-12 q-mb-md"},Nt={class:"row q-col-gutter-sm q-pa-sm q-mb-md"},Ht={class:"col-12 col-md-6"},Bt={class:"col-12 col-md-6"},Lt={class:"col-12"},$t={class:"row q-col-gutter-sm q-pa-sm q-mb-md"},Gt={class:"col"},Qt={class:"row text-center justify-center bg-drawer rounded-card q-py-md q-mb-md custom-shadow"},Jt={class:"col-12 col-md-3 q-mb-md"},Zt={class:"text-positive"},Kt={class:"col-12"},Yt={class:"q-gutter-sm"},Wt={class:"col-12 q-mb-md"};function Xt(a,e,s,T,y,l){const E=ia("tabla-filas-dinamicas"),q=ia("essential-table"),h=ia("archivo-seguimiento"),k=ia("visor-imagen"),m=ia("modales-entidad");return A(),V(He,null,{default:w(()=>[d("div",ht,[d("div",{class:ma([{"text-center full-width":a.$q.screen.xs},"text-primary"])},ya("Subtarea "+a.subtarea.codigo_subtarea),3),p(Oa,{color:"primary","no-caps":"",push:"",class:ma(["q-mr-sm",{"full-width":a.$q.screen.xs}]),onClick:e[0]||(e[0]=o=>a.descargarExcel())},{default:w(()=>[p(Ra,{name:"bi-file-spreadsheet",size:"xs",class:"q-pr-sm"}),e[25]||(e[25]=d("span",null,"Descargar informe",-1))]),_:1},8,["class"])]),p(Ea,{class:"rounded-card custom-shadow q-pa-md"},{default:w(()=>[d("div",kt,[d("div",yt,[p(E,{listado:a.actividadesRealizadas,"configuracion-columnas":a.configuracionColumnasTrabajoRealizado,onGuardarFila:e[1]||(e[1]=o=>a.guardarFilaActividad(o)),mostrarAccion1Header:a.permitirSubir,entidad:a.ActividadRealizadaSeguimientoSubtarea,accion1:a.verFotografia,titulo:"Cronolog\xEDa de actividades realizadas"},null,8,["listado","configuracion-columnas","mostrarAccion1Header","entidad","accion1"])]),d("div",Et,[e[26]||(e[26]=d("br",null,null,-1)),p(oa,{modelValue:a.mostrarSolicitudesAts,"onUpdate:modelValue":e[2]||(e[2]=o=>a.mostrarSolicitudesAts=o),label:"Solicitudes de ATS","checked-icon":"bi-eye",color:"positive",dense:""},null,8,["modelValue"])]),a.mostrarSolicitudesAts?(A(),Y("div",Ct,[p(E,{titulo:"Solicitudes  de ATS a trav\xE9s de tickets",configuracionColumnas:a.configuracionColumnasSolicitudAts,listado:a.ticketsAts,permitirConsultar:!1,permitirEliminar:!1,permitirEditar:!1,mostrarBotones:!1,"alto-fijo":!1,entidad:a.Ticket,consultarTiempo:!1,accion1:a.btnSeguimiento,accion2:a.btnCancelar,mostrarAccion1Header:a.permitirSubir,onGuardarFila:e[3]||(e[3]=o=>a.guardarFilaSolicitudAts(o,a.subtarea.id))},null,8,["configuracionColumnas","listado","entidad","accion1","accion2","mostrarAccion1Header"])])):U("",!0),d("div",Tt,[e[27]||(e[27]=d("br",null,null,-1)),p(oa,{modelValue:a.usarMaterialTarea,"onUpdate:modelValue":e[4]||(e[4]=o=>a.usarMaterialTarea=o),label:"Usar material asignado para proyecto / etapa / tarea","checked-icon":"bi-eye",color:"positive",dense:""},null,8,["modelValue"])]),a.usarMaterialTarea?(A(),Y("div",At,[p(Ea,{class:"rounded-card"},{default:w(()=>[p(Ha,{modelValue:a.tab,"onUpdate:modelValue":e[8]||(e[8]=o=>a.tab=o),class:ma(["text-primary",{"bg-grey-1":!a.$q.dark.isActive}]),"active-color":"primary",align:"justify","no-caps":"","inline-label":""},{default:w(()=>[p(W,{name:"usar_material_tarea",label:"Usar material de tarea",onClick:e[5]||(e[5]=o=>a.actualizarTablaMaterialesTarea())}),p(W,{name:"resumen_material_tarea_utilizado",label:"Resumen de material utilizado",onClick:e[6]||(e[6]=o=>a.actualizarTablaResumenMaterialesTarea())}),a.esCoordinador?(A(),V(W,{key:0,name:"historial_material_tarea_usado",label:"Editar historial de material de tarea usado",onClick:e[7]||(e[7]=o=>a.resetearFiltroHistorialTarea())})):U("",!0)]),_:1},8,["modelValue","class"]),p(La,{modelValue:a.tab,"onUpdate:modelValue":e[13]||(e[13]=o=>a.tab=o),animated:"",class:"bg-body"},{default:w(()=>[p(X,{name:"usar_material_tarea"},{default:w(()=>[d("div",Mt,[d("div",zt,[e[28]||(e[28]=d("label",{class:"q-mb-sm block"},"Seleccione un cliente para filtrar el material",-1)),p(Ba,{modelValue:a.clienteMaterialTarea,"onUpdate:modelValue":[e[9]||(e[9]=o=>a.clienteMaterialTarea=o),e[10]||(e[10]=o=>a.obtenerMaterialesTarea(a.clienteMaterialTarea))],options:a.listadosAuxiliares.clientesMaterialesTarea,hint:a.subtarea.cliente,"transition-show":"scale","transition-hide":"scale","use-input":"","input-debounce":"0","options-dense":"",dense:"",outlined:"","option-label":o=>o.razon_social,"option-value":o=>o.cliente_id,"emit-value":"","map-options":""},null,8,["modelValue","options","hint","option-label","option-value"])]),d("div",wt,[e[29]||(e[29]=d("br",null,null,-1)),p(oa,{modelValue:a.mostrarMaterialConStock,"onUpdate:modelValue":e[11]||(e[11]=o=>a.mostrarMaterialConStock=o),label:"Mostrar s\xF3lo material con stock mayor a cero","checked-icon":"bi-bag-check",icon:"bi-bag",color:"positive",dense:""},null,8,["modelValue"])])]),a.materialesTarea.length?(A(),V(q,{key:0,titulo:"Materiales designados para la tarea",configuracionColumnas:a.columnasMaterial,datos:a.materialesTarea,"alto-fijo":!1,permitirConsultar:!1,permitirEliminar:!1,permitirEditar:!1,"permitir-buscar":!0,permitirEditarModal:!0,separador:"cell",accion1:a.botonEditarCantidadTarea,"ajustar-celdas":!0},null,8,["configuracionColumnas","datos","accion1"])):U("",!0)]),_:1}),p(X,{name:"resumen_material_tarea_utilizado"},{default:w(()=>[d("div",jt,[d("div",Ft,[a.resumenMaterialSubtareaUsado.length?(A(),V(q,{key:0,titulo:"Resumen material tarea usado",configuracionColumnas:a.columnasMaterial,datos:a.resumenMaterialSubtareaUsado,"alto-fijo":!1,permitirConsultar:!1,permitirEliminar:!1,permitirEditar:!1,permitirEditarModal:!0,separador:"cell"},null,8,["configuracionColumnas","datos"])):U("",!0)])])]),_:1}),p(X,{name:"historial_material_tarea_usado"},{default:w(()=>[d("div",Dt,[d("div",Ut,[e[30]||(e[30]=d("label",{class:"q-mb-sm block"},"Seleccione una fecha para filtrar en el historial",-1)),d("small",qt,ya(a.rangoFechasHistorial),1)]),d("div",Vt,[d("div",Ot,[(A(!0),Y(Pa,null,Ia(a.fechasHistorialMaterialesUsados,o=>(A(),V(Na,{key:o.fecha,modelValue:a.fecha_historial,"onUpdate:modelValue":e[12]||(e[12]=C=>a.fecha_historial=C),val:o.fecha,label:o.fecha},null,8,["modelValue","val","label"]))),128))])]),d("div",Rt,[a.historialMaterialTareaUsadoPorFecha.length?(A(),V(q,{key:0,titulo:"Historial material tarea usado",configuracionColumnas:a.columnasMaterial,datos:a.historialMaterialTareaUsadoPorFecha,"alto-fijo":!1,permitirConsultar:!1,permitirEliminar:!1,permitirEditar:!1,permitirEditarModal:!0,separador:"cell",accion1:a.botonEditarCantidadTareaHistorial},null,8,["configuracionColumnas","datos","accion1"])):U("",!0)])])]),_:1})]),_:1},8,["modelValue"])]),_:1})])):U("",!0),a.mostrarMaterialStock?(A(),Y("div",Pt,[e[31]||(e[31]=d("br",null,null,-1)),p(oa,{modelValue:a.usarMaterialStock,"onUpdate:modelValue":e[14]||(e[14]=o=>a.usarMaterialStock=o),label:"Usar material de mi stock","checked-icon":"bi-eye",color:"positive",dense:""},null,8,["modelValue"])])):U("",!0),a.usarMaterialStock?(A(),Y("div",It,[p(Ea,{class:"rounded-card"},{default:w(()=>[p(Ha,{modelValue:a.tabMaterialStock,"onUpdate:modelValue":e[18]||(e[18]=o=>a.tabMaterialStock=o),class:ma(["text-primary",{"bg-grey-1":!a.$q.dark.isActive}]),"active-color":"primary",align:"justify","no-caps":"","inline-label":""},{default:w(()=>[p(W,{name:"usar_material_stock",label:"Usar material de mi stock",onClick:e[15]||(e[15]=()=>a.clienteMaterialStock=null)}),p(W,{name:"resumen_material_stock_utilizado",label:"Resumen de material utilizado",onClick:e[16]||(e[16]=o=>a.actualizarTablaResumenMaterialesStock())}),a.esCoordinador?(A(),V(W,{key:0,name:"historial_material_stock_usado",label:"Editar historial de material de stock usado",onClick:e[17]||(e[17]=o=>a.resetearFiltroHistorialStock())})):U("",!0)]),_:1},8,["modelValue","class"]),p(La,{modelValue:a.tabMaterialStock,"onUpdate:modelValue":e[23]||(e[23]=o=>a.tabMaterialStock=o),animated:"",class:"bg-body"},{default:w(()=>[p(X,{name:"usar_material_stock"},{default:w(()=>[d("div",Nt,[d("div",Ht,[e[32]||(e[32]=d("label",{class:"q-mb-sm block"},"Seleccione un cliente para filtrar el material",-1)),p(Ba,{modelValue:a.clienteMaterialStock,"onUpdate:modelValue":[e[19]||(e[19]=o=>a.clienteMaterialStock=o),e[20]||(e[20]=o=>a.obtenerMaterialesStock(a.clienteMaterialStock))],options:a.listadosAuxiliares.clientesMaterialesEmpleado,hint:a.subtarea.cliente,"transition-show":"scale","transition-hide":"scale","use-input":"","input-debounce":"0","options-dense":"",clearable:"",dense:"",outlined:"","option-label":o=>o.razon_social,"option-value":o=>o.cliente_id,"emit-value":"","map-options":""},null,8,["modelValue","options","hint","option-label","option-value"])]),d("div",Bt,[e[33]||(e[33]=d("br",null,null,-1)),p(oa,{modelValue:a.mostrarMaterialStockConStock,"onUpdate:modelValue":e[21]||(e[21]=o=>a.mostrarMaterialStockConStock=o),label:"Mostrar s\xF3lo material con stock mayor a cero","checked-icon":"bi-bag-check",icon:"bi-bag",color:"positive",dense:""},null,8,["modelValue"])]),d("div",Lt,[a.materialesStock.length?(A(),V(q,{key:0,titulo:"Materiales de stock del responsable",configuracionColumnas:a.columnasMaterial,datos:a.materialesStock,"alto-fijo":!1,permitirConsultar:!1,permitirEliminar:!1,permitirEditar:!1,"permitir-buscar":!0,permitirEditarModal:!0,separador:"cell","ajustar-celdas":!0,accion1:a.botonEditarCantidadStock},null,8,["configuracionColumnas","datos","accion1"])):U("",!0)])])]),_:1}),p(X,{name:"resumen_material_stock_utilizado"},{default:w(()=>[d("div",$t,[d("div",Gt,[a.resumenMaterialStockUsado.length?(A(),V(q,{key:0,titulo:"Resumen material stock usado",configuracionColumnas:a.configuracionColumnasResumenMaterialOcupado,datos:a.resumenMaterialStockUsado,"alto-fijo":!1,permitirConsultar:!1,permitirEliminar:!1,permitirEditar:!1,permitirEditarModal:!0,"ajustar-celdas":!0,separador:"cell"},null,8,["configuracionColumnas","datos"])):U("",!0)])])]),_:1}),p(X,{name:"historial_material_stock_usado"},{default:w(()=>[d("div",Qt,[d("div",Jt,[e[34]||(e[34]=d("label",{class:"q-mb-sm block"},"Seleccione una fecha para filtrar en el historial",-1)),d("small",Zt,ya(a.rangoFechasHistorial),1)]),d("div",Kt,[d("div",Yt,[(A(!0),Y(Pa,null,Ia(a.fechasHistorialMaterialesStockUsados,o=>(A(),V(Na,{key:o.fecha,modelValue:a.fecha_historial_stock,"onUpdate:modelValue":e[22]||(e[22]=C=>a.fecha_historial_stock=C),val:o.fecha,label:o.fecha},null,8,["modelValue","val","label"]))),128))])])]),a.historialMaterialStockUsadoPorFecha.length?(A(),V(q,{key:0,titulo:"Historial material stock usado",configuracionColumnas:a.columnasMaterial,datos:a.historialMaterialStockUsadoPorFecha,"alto-fijo":!1,permitirConsultar:!1,permitirEliminar:!1,permitirEditar:!1,permitirEditarModal:!0,separador:"cell","ajustar-celdas":!0,accion1:a.botonEditarCantidadStockHistorial},null,8,["configuracionColumnas","datos","accion1"])):U("",!0)]),_:1})]),_:1},8,["modelValue"])]),_:1})])):U("",!0),d("div",Wt,[p(h,{ref:"refArchivoSeguimiento",mixin:a.mixinArchivoSeguimiento,endpoint:a.endpoint,"permitir-eliminar":a.permitirSubir,"permitir-subir":a.permitirSubir},{"boton-subir":w(()=>[a.mostrarBotonSubir?(A(),V(Oa,{key:0,color:"positive",push:"","no-caps":"",class:"full-width q-mb-lg",onClick:e[24]||(e[24]=o=>a.subirArchivos())},{default:w(()=>[p(Ra,{name:"bi-upload",class:"q-mr-sm",size:"xs"}),e[35]||(e[35]=Ne(" Subir archivos seleccionados"))]),_:1})):U("",!0)]),_:1},8,["mixin","endpoint","permitir-eliminar","permitir-subir"])])])]),_:1}),p(k,{ref:"refVisorImagen"},null,512),p(m,{comportamiento:a.modales,"mixin-modal":a.mixin,"confirmar-cerrar":!1,persistente:!1},null,8,["comportamiento","mixin-modal"])]),_:1})}var Ci=Ie(St,[["render",Xt]]);const Ga={TELCONET:2,NEDETEL:3},Ti=(a,e,s)=>{const T=ct(),y=Ka(),l=Za(),E=Je(),{notificarAdvertencia:q,confirmar:h,notificarCorrecto:k,promptItems:m,prompt:o}=ra(),C=ra(),D=new x;let P;const la=b(),O=sa({latitud_llegada:null,longitud_llegada:null,empleado_responsable_subtarea:null,coordinador_registrante_llegada:null}),pa={titulo:"Ejecutar",icono:"bi-play-fill",color:"positive",visible:({entidad:t})=>[f.AGENDADO,f.REALIZADO].includes(t.estado)&&t.puede_ejecutar&&(t.es_responsable||l.can("puede.ejecutar.subtareas")),accion:({entidad:t,posicion:u})=>{R(t),h("\xBFEst\xE1 seguro de iniciar el trabajo?",async()=>{var r;if(t.es_dependiente){const{result:c}=await new ut().consultar(t.subtarea_dependiente_id);if(![f.REALIZADO,f.FINALIZADO].includes((r=c.estado)!=null?r:""))return q("No puedes proceder. Primero debes realizar la subtarea "+c.codigo_subtarea)}const S={estado_subtarea_llegada:f.EJECUTANDO,...O};try{const{result:c}=await new x().ejecutar(t.id,S);l.esTecnico?P(f.EJECUTANDO):I(u,c),k("Trabajo ejecutado exitosamente!"),T.getSubtareaDestino(l.user.id)}catch(c){if(Ca(c)){const j=c.erroresValidacion;await Ta(j,ra())}}})}},ba={titulo:"Pausar",icono:"bi-pause-circle",color:"blue-6",visible:({entidad:t})=>t.estado===f.EJECUTANDO&&(t.es_responsable||l.can("puede.pausar.subtareas")),accion:({entidad:t,posicion:u})=>{R(t),h("\xBFEst\xE1 seguro de pausar la subtarea?",()=>{const S=sa({mensaje:"Seleccione el motivo de la pausa",accion:async r=>{const c={estado_subtarea_llegada:f.PAUSADO,motivo_pausa_id:r,...O},{result:j}=await new x().pausar(t.id,c);l.esTecnico?P(f.PAUSADO):I(u,j),k("Trabajo pausado exitosamente!"),T.getSubtareaDestino(l.user.id)},tipo:"radio",items:s.motivosPausas.map(r=>({label:r.motivo,value:r.id}))});m(S)})}},H={titulo:"Reanudar",icono:"bi-play-circle",color:"positive",visible:({entidad:t})=>t.estado===f.PAUSADO&&t.puede_ejecutar&&(t.es_responsable||l.can("puede.ejecutar.subtareas")),accion:async({entidad:t,posicion:u})=>{R(t),h("\xBFEst\xE1 seguro de reanudar el trabajo?",async()=>{const S={estado_subtarea_llegada:f.EJECUTANDO,...O},{result:r}=await new x().reanudar(t.id,S);l.esTecnico?P(f.EJECUTANDO):I(u,r),k("Trabajo ha sido reanudado exitosamente!"),T.getSubtareaDestino(l.user.id)})}},fa={titulo:"Realizado",icono:"bi-check-circle",color:"positive",visible:({entidad:t})=>[f.EJECUTANDO,f.PAUSADO].includes(t.estado)&&(l.esJefeTecnico||l.esCoordinador||t.es_responsable||l.esAdministrador),accion:({entidad:t,posicion:u})=>{R(t);const S=s.causasIntervenciones.filter(c=>c.tipo_trabajo===t.tipo_trabajo),r=sa({mensaje:"Seleccione la causa de intervenci\xF3n",accion:async c=>{B({entidad:t,posicion:u,causa_intervencion_id:c})},tipo:"radio",requerido:S.length,items:S.map(c=>({label:c.nombre,value:c.id}))});t.cliente_id===Ga.NEDETEL?m(r):B({entidad:t,posicion:u})}};function B(t){const{entidad:u,posicion:S,causa_intervencion_id:r}=t;h("\xBFEst\xE1 seguro de que complet\xF3 el trabajo?",async()=>{try{const c={estado_subtarea_llegada:f.REALIZADO,causa_intervencion_id:r,...O},{result:j}=await new x().realizar(u.id,c);l.esTecnico?ea(S):I(S,j),T.getSubtareaDestino(l.user.id),k("La subtarea se ha realizado exitosamente!")}catch(c){if(Ca(c)){const j=c.erroresValidacion;Ta(j,C)}}})}const _a={titulo:"Seguimiento",icono:"bi-check2-square",color:"indigo",visible:({entidad:t})=>![f.AGENDADO,f.CREADO].includes(t.estado)&&(l.esJefeTecnico||l.esCoordinador||l.esAdministrador||t.es_responsable),accion:async({entidad:t})=>{y.idSubtareaSeleccionada=t.id,y.idTareaSeleccionada=t.tarea_id,y.proyecto_id=t.proyecto_id,y.etapa_id=t.etapa_id,y.cliente_id=t.cliente_id,y.idEmpleadoResponsable=t.empleado_responsable_id,y.idEmergencia=t.seguimiento,y.codigoSubtarea=t.codigo_subtarea,y.subtarea=t,e.abrirModalEntidad("SeguimientoSubtareaPage")}},ga={titulo:"Ver alimentaci\xF3n",icono:"bi-cookie",color:"orange",visible:({entidad:t})=>[f.FINALIZADO].includes(t.estado),accion:async({entidad:t})=>{e.abrirModalEntidad("VerAlimentacionGrupoPage",{idSubtarea:t.id})}},na={titulo:"Finalizar",color:"positive",icono:"bi-check",visible:({entidad:t})=>t.estado===f.REALIZADO,accion:async({entidad:t,posicion:u})=>{const S=sa({mensaje:"Confirme la causa de intervenci\xF3n",accion:r=>{y.idSubtareaSeleccionada=t.id,t.tipo_trabajo==="STANDBY"?J({entidad:t,posicion:u}):G({entidad:t,causa_intervencion_id:r,posicion:u})},requerido:!1,defecto:t.causa_intervencion_id,tipo:"radio",items:s.causasIntervenciones.filter(r=>r.tipo_trabajo===t.tipo_trabajo).map(r=>({label:r.nombre,value:r.id}))});t.cliente_id===Ga.NEDETEL?m(S):J({entidad:t,posicion:u})}};async function G(t){const{entidad:u}=t;la.value=t,e.abrirModalEntidad("AlimentacionGrupoPage",{idGrupo:u.grupo_id,idSubtarea:u.id,idTarea:u.tarea_id})}async function Q(t){switch(t){case"AlimentacionGrupoPage":await J(la.value),e.cerrarModalEntidad();break}}async function J(t){const{entidad:u,causa_intervencion_id:S,posicion:r}=t;o({titulo:"Gastos adicionales",mensaje:"Ingrese los gastos adicionales.",requerido:!0,accion:async j=>{try{const{result:K}=await D.finalizar(u.id,{causa_intervencion_id:S,gastos_adicionales:j});I(r,K),k("Trabajo finalizada exitosamente!")}catch(K){if(Ca(K)){const da=K.erroresValidacion;Ta(da,C)}}}})}const aa={titulo:"Suspender",icono:"bi-power",color:"negative",visible:({entidad:t})=>[f.EJECUTANDO,f.AGENDADO].includes(t.estado)&&t.puede_suspender&&(l.esJefeTecnico||l.esCoordinador||t.es_responsable),accion:({entidad:t,posicion:u})=>{R(t),h("\xBFEst\xE1 seguro de suspender el trabajo?",()=>{const S={mensaje:"Seleccione el motivo de la suspenci\xF3n del trabajo",accion:async r=>{const c={motivo_suspendido_id:r,estado_subtarea_llegada:f.SUSPENDIDO,...O};await new x().suspender(t.id,c),(l.esCoordinador||l.esJefeTecnico)&&P(f.SUSPENDIDO),l.esTecnico&&ea(u),k("Trabajo suspendido exitosamente!"),T.getSubtareaDestino(l.user.id)},tipo:"radio",items:s.motivosSuspendidos.map(r=>({label:r.motivo,value:r.id}))};m(S)})}},Z={titulo:"Cancelar",color:"negative",icono:"bi-x-circle",visible:({entidad:t})=>t.estado===f.SUSPENDIDO,accion:({entidad:t,posicion:u})=>h(["\xBFEst\xE1 seguro de cancelar definitivamente la subtarea?"],async()=>{const S={mensaje:"Seleccione el motivo de la cancelaci\xF3n",accion:async r=>{const{result:c}=await D.cancelar(t.id,r);t.estado=f.CANCELADO,t.fecha_hora_cancelado=c.fecha_hora_cancelado,t.motivo_cancelado=c.motivo_cancelado,k("Trabajo cancelado exitosamente!"),I(u,t)},tipo:"radio",items:s.motivosSuspendidos.map(r=>({label:r.motivo,value:r.id}))};m(S)})},va={titulo:"Reagendar",color:"orange-8",icono:"bi-calendar-check",visible:({entidad:t})=>[f.AGENDADO,f.SUSPENDIDO].includes(t.estado),accion:async({entidad:t,posicion:u})=>h("\xBFEst\xE1 seguro de reagendar la subtarea?",()=>{E.codigoSubtareaSeleccionada=t.codigo_subtarea,E.fechaHoraSuspendido=t.fecha_hora_suspendido,E.motivoSuspendido=t.motivo_suspendido,E.idSubtareaSeleccionada=t.id,E.tareaTieneSubtareas=t.tiene_subtareas,E.posicionSubtareaSeleccionada=u,E.subtareaEsVentana=t.es_ventana,E.fechaInicioTrabajo=t.fecha_inicio_trabajo,E.horaInicioTrabajo=t.hora_inicio_trabajo,E.horaFinTrabajo=t.hora_fin_trabajo,e.abrirModalEntidad("ReagendarPage")})};function R(t){Ge(u=>{O.latitud_llegada=u.coords.latitude,O.longitud_llegada=u.coords.longitude,O.empleado_responsable_subtarea=l.esTecnico?l.user.id:l.esCoordinador||l.esJefeTecnico?t.empleado_responsable_id:null,O.coordinador_registrante_llegada=l.esCoordinador||l.esJefeTecnico?l.user.id:null})}const L=t=>P=t;function I(t,u){t>=0&&(a.value.splice(t,1,u),a.value=[...a.value])}function ea(t){t>=0&&a.value.splice(t,1)}return{btnIniciar:pa,btnPausar:ba,btnReanudar:H,btnRealizar:fa,btnSeguimiento:_a,btnCancelar:Z,btnReagendar:va,btnSuspender:aa,btnFinalizar:na,setFiltrarTrabajoAsignado:L,guardadoModalesSubtarea:Q,btnVerAlimentacion:ga}};export{x as C,Ci as S,Ga as c,Ti as u};
