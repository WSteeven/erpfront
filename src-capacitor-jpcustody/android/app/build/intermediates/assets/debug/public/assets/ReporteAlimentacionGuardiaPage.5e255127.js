import{d as me,m as fe,bd as pe,c as v,R as ce,e as be,E as ve,q as ge,w as H,A as ye,s as we,bG as qe,_ as Qe,v as r,P as V,F as a,z as e,be as g,y as t,bf as Ve,B as u,D as n,x as m,J as h,I as K,j as W,O as k,a9 as X,Q as T,K as f,G as _,H as P}from"./index.b8e09611.js";import{Q as F,a as p}from"./QSelect.b920278b.js";import{Q as x,a as ee,C as oe}from"./QPopupProxy.685eacb5.js";import{a as ae}from"./QToolbar.afeb6de9.js";import{Q as he}from"./QBtnGroup.7d38eecd.js";import{Q as z,a as c}from"./QItemSection.ec4cc512.js";import{Q as le}from"./QChip.f8f308fa.js";import{a as se,Q as R}from"./QTable.c4bfb038.js";import{Q as te}from"./QBadge.89898cd2.js";import{Q as ke}from"./QExpansionItem.795361a7.js";import{Q as Ce}from"./QPage.e6f8825d.js";import{Q as ze,a as De}from"./QLayout.9e55ed7f.js";import{M as Ae}from"./ModalEntidad.54c9ab3a.js";import{u as Oe,v as Re,A as Ne}from"./utils.9344cd7e.js";import{C as je}from"./ContenedorSimpleMixin.4e22246b.js";import{u as Ue}from"./filtrosListadosGenerales.87fcb144.js";import{a as Ee,B as Se}from"./Bitacora.a31b94c3.js";import{Z as Ie}from"./ZonaController.fdb195f9.js";import"./QMenu.b3fb639b.js";import"./position-engine.799c9136.js";import"./format.8ac60962.js";import"./use-fullscreen.37810a50.js";import"./QScrollObserver.8813f664.js";import"./QResizeObserver.1422c274.js";import"./configuracion_general.1d29d94f.js";import"./ConfiguracionController.a136b041.js";import"./entidadAuditable.75a46700.js";var Te=me({components:{ModalEntidad:Ae},setup(){const l=fe();pe().setQuasar(l),Oe().setQuasar(l);const o=v(!1),N=v(!1),j=v(!1),D=v("-"),U=v(0),s=v(!1),i=v([]),{notificarError:w,notificarAdvertencia:q}=ce(),b=be({empleado:null,zona:null,jornada:null,fecha_inicio:"",fecha_fin:"",accion:""}),A=v([]),re=[{name:"fecha",label:"Fecha",align:"left",field:"fecha",sortable:!0},{name:"zona",label:"Zona",align:"left",field:"zona",sortable:!0},{name:"jornadas",label:"Jornadas",align:"left",field:"jornadas"},{name:"monto",label:"Monto",align:"right",field:"monto",sortable:!0}],B=v([]),Z=new je(Ee,new Se),{listadosAuxiliares:E}=Z.useReferencias(),{obtenerListados:ne,cargarVista:ie}=Z.useComportamiento(),{empleados:$,filtrarEmpleados:de}=Ue(E);ie(async()=>{await ne({empleados:new ve,zonas:new Ie}),b.fecha_fin=Re(ge),$.value=E.empleados.filter(d=>d.roles?d.roles.split(",").map(O=>O.trim().toUpperCase()).includes("GUARDIA"):!1),B.value=E.zonas}),H(N,d=>{d?b.empleado=null:b.jornada=null}),H(j,d=>{d?b.empleado=null:b.zona=null});async function ue(d){var S,O,M,G,J,L,Y;o.value=!0;try{const y=ye.getInstance();let C=y.getEndpoint(we.bitacoras)+"/reportes";const I="reporte_alimentacion_guardia";if(b.accion=d,d==="excel"||d==="pdf"){C=qe.URL_BASE+C,await Ne(C,"POST","blob",d==="excel"?"xlsx":"pdf",I,b);return}const Q=(await y.post(C,b)).data;s.value=((S=Q.total)==null?void 0:S.guardia)==="TODOS",s.value?(i.value=Q.detalle||[],A.value=[],D.value="TODOS"):(A.value=Q.detalle||[],i.value=[],D.value=((O=Q.total)==null?void 0:O.guardia)||Q.guardia||"-"),U.value=s.value?(G=(M=Q.total)==null?void 0:M.monto_total)!=null?G:0:(J=Q.monto_total)!=null?J:0,(!s.value&&A.value.length<1||s.value&&i.value.length<1)&&q("No se encontraron registros para los filtros ingresados.")}catch(y){if(((L=y.response)==null?void 0:L.status)===422){const C=y.response.data.errors,I=Object.values(C).flat();q(I.join(`
`))}else((Y=y.response)==null?void 0:Y.status)===404?q(y.response.data.message||"No se encontraron resultados"):(console.error("Error inesperado:",y),w("Ocurri\xF3 un error inesperado al generar el reporte"))}finally{o.value=!1}}return{filtros:b,listado:A,columnasDetalle:re,empleados:$,zonas:B,mostrarJornada:N,mostrarZona:j,resumenGuardia:D,totalMonto:U,buscarReporte:ue,filtrarEmpleados:de,mostrarVarios:s,guardiasDetalle:i}}});const _e={class:"q-pa-md"},Pe={class:"text-h6 text-bold text-warning flex items-center"},Fe={class:"row q-col-gutter-sm q-pa-sm q-py-md"},Be={key:0,class:"col-12 col-md-4"},Ze={class:"col-12 col-md-2"},$e={class:"row items-center justify-end"},Me={class:"col-12 col-md-2"},Ge={class:"row items-center justify-end"},Je={key:1,class:"col-12 col-md-2"},Le={key:2,class:"col-12 col-md-2"},Ye={class:"q-mb-sm block row items-center justify-between"},He={key:3,class:"col-12 col-md-2"},Ke={key:4,class:"col-12 col-md-2"},We={class:"q-mb-sm block row items-center justify-between"},Xe={class:"col-12 col-md-12 q-mt-md"},xe={class:"text-center"},eo={class:"row q-col-gutter-md"},oo={key:0,class:"col-12 col-md-4"},ao={key:1,class:"col-12 col-md-4"},lo={key:2,class:"col-12 col-md-4"},so={class:"col-12 col-md-4"},to={class:"col-12 col-md-4"};function ro(l,o,N,j,D,U){return r(),V(De,null,{default:a(()=>[e(ze,null,{default:a(()=>[e(Ce,{padding:""},{default:a(()=>[e(g,null,{default:a(()=>[t("div",_e,[e(Ve,{class:"q-px-lg q-pt-lg q-pb-sm"},{default:a(()=>[t("div",Pe,[e(u,{name:"assignment",class:"q-mr-sm"}),o[14]||(o[14]=n(" Reporte de Alimentaci\xF3n de Guardias "))])]),_:1}),t("div",Fe,[!l.mostrarZona&&!l.mostrarJornada?(r(),m("div",Be,[o[15]||(o[15]=t("label",{class:"q-mb-sm block"},"Seleccione un guardia",-1)),e(F,{modelValue:l.filtros.empleado,"onUpdate:modelValue":o[0]||(o[0]=s=>l.filtros.empleado=s),options:l.empleados,"transition-show":"scale","transition-hide":"scale","options-dense":"",dense:"",outlined:"","use-input":"","input-debounce":"0","option-label":s=>s.nombres+" "+s.apellidos,"option-value":s=>s.id,"emit-value":"","map-options":""},null,8,["modelValue","options","option-label","option-value"])])):h("",!0),t("div",Ze,[o[16]||(o[16]=t("label",{class:"q-mb-sm block"},"Fecha de inicio",-1)),e(K,{modelValue:l.filtros.fecha_inicio,"onUpdate:modelValue":o[2]||(o[2]=s=>l.filtros.fecha_inicio=s),placeholder:"Obligatorio",outlined:"",dense:""},{append:a(()=>[e(u,{name:"event",class:"cursor-pointer"},{default:a(()=>[e(x,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:a(()=>[e(ee,{modelValue:l.filtros.fecha_inicio,"onUpdate:modelValue":o[1]||(o[1]=s=>l.filtros.fecha_inicio=s),mask:"YYYY-MM-DD","today-btn":""},{default:a(()=>[t("div",$e,[W(e(k,{label:"Cerrar",color:"primary",flat:""},null,512),[[oe]])])]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),t("div",Me,[o[17]||(o[17]=t("label",{class:"q-mb-sm block"},"Fecha fin",-1)),e(K,{modelValue:l.filtros.fecha_fin,"onUpdate:modelValue":o[4]||(o[4]=s=>l.filtros.fecha_fin=s),placeholder:"Opcional",outlined:"",dense:""},{append:a(()=>[e(u,{name:"event",class:"cursor-pointer"},{default:a(()=>[e(x,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:a(()=>[e(ee,{modelValue:l.filtros.fecha_fin,"onUpdate:modelValue":o[3]||(o[3]=s=>l.filtros.fecha_fin=s),mask:"YYYY-MM-DD","today-btn":""},{default:a(()=>[t("div",Ge,[W(e(k,{label:"Cerrar",color:"primary",flat:""},null,512),[[oe]])])]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),l.mostrarZona?(r(),m("div",Le,[t("label",Ye,[o[20]||(o[20]=t("span",null,"Seleccione una zona",-1)),e(k,{flat:"",dense:"",round:"",size:"sm",icon:"close",color:"red",onClick:o[6]||(o[6]=()=>{l.mostrarZona=!1,l.filtros.zona=null})},{default:a(()=>[e(ae,null,{default:a(()=>o[19]||(o[19]=[n("Quitar Filtro de Zona")])),_:1})]),_:1})]),e(F,{modelValue:l.filtros.zona,"onUpdate:modelValue":o[7]||(o[7]=s=>l.filtros.zona=s),options:l.zonas,"transition-show":"scale","transition-hide":"scale","options-dense":"",dense:"",outlined:"",label:"Opcional","option-label":s=>s.nombre,"option-value":s=>s.id,"emit-value":"","map-options":""},null,8,["modelValue","options","option-label","option-value"])])):(r(),m("div",Je,[o[18]||(o[18]=t("label",{class:"q-mb-sm block"},"\xBFFiltrar por zona?",-1)),e(X,{modelValue:l.mostrarZona,"onUpdate:modelValue":o[5]||(o[5]=s=>l.mostrarZona=s),color:"primary",dense:"","left-label":""},null,8,["modelValue"])])),l.mostrarJornada?(r(),m("div",Ke,[t("label",We,[o[23]||(o[23]=t("span",null,"Seleccione jornada",-1)),e(k,{flat:"",dense:"",round:"",size:"sm",icon:"close",color:"red",onClick:o[9]||(o[9]=()=>{l.mostrarJornada=!1,l.filtros.jornada=null})},{default:a(()=>[e(ae,null,{default:a(()=>o[22]||(o[22]=[n("Eliminar jornada")])),_:1})]),_:1})]),e(F,{modelValue:l.filtros.jornada,"onUpdate:modelValue":o[10]||(o[10]=s=>l.filtros.jornada=s),options:["DIURNA","NOCTURNA"],"transition-show":"scale","transition-hide":"scale","options-dense":"",dense:"",outlined:"",label:"Opcional"},null,8,["modelValue"])])):(r(),m("div",He,[o[21]||(o[21]=t("label",{class:"q-mb-sm block"},"\xBFFiltrar por jornada?",-1)),e(X,{modelValue:l.mostrarJornada,"onUpdate:modelValue":o[8]||(o[8]=s=>l.mostrarJornada=s),color:"primary",dense:"","left-label":""},null,8,["modelValue"])])),t("div",Xe,[t("div",xe,[e(he,{push:""},{default:a(()=>[e(k,{color:"primary",class:"full-width","no-caps":"","no-wrap":"",push:"",glossy:"",onClick:o[11]||(o[11]=s=>l.buscarReporte("consulta"))},{default:a(()=>[e(u,{name:"bi-search",size:"xs",class:"q-pr-sm"}),o[24]||(o[24]=t("span",null,"Consultar",-1))]),_:1}),e(k,{color:"positive",class:"full-width","no-caps":"","no-wrap":"",push:"",glossy:"",onClick:o[12]||(o[12]=s=>l.buscarReporte("excel"))},{default:a(()=>[e(u,{name:"bi-file-earmark-excel-fill",size:"xs",class:"q-mr-sm"}),o[25]||(o[25]=t("span",null,"Excel",-1))]),_:1}),e(k,{color:"negative",class:"full-width","no-caps":"","no-wrap":"",push:"",glossy:"",onClick:o[13]||(o[13]=s=>l.buscarReporte("pdf"))},{default:a(()=>[e(u,{name:"bi-file-earmark-pdf-fill",size:"xs",class:"q-mr-sm"}),o[26]||(o[26]=t("span",null,"PDF",-1))]),_:1})]),_:1})])])])])]),_:1}),!l.mostrarVarios&&l.listado.length>0||l.mostrarVarios?(r(),V(g,{key:0,class:"q-mt-md q-pa-md"},{default:a(()=>[o[32]||(o[32]=t("div",{class:"text-h6 text-primary"},"Resumen general",-1)),e(T,{class:"q-my-sm"}),t("div",eo,[l.mostrarVarios?h("",!0):(r(),m("div",oo,[e(g,{flat:"",bordered:"",class:"q-pa-md full-height",style:{height:"100%"}},{default:a(()=>[e(z,null,{default:a(()=>[e(c,{avatar:""},{default:a(()=>[e(u,{name:"person",size:"md",color:"primary"})]),_:1}),e(c,null,{default:a(()=>[e(p,{class:"text-subtitle2"},{default:a(()=>[n(f(l.resumenGuardia),1)]),_:1}),e(p,{caption:""},{default:a(()=>o[27]||(o[27]=[n("GUARDIA DE SEGURIDAD")])),_:1})]),_:1})]),_:1})]),_:1})])),l.mostrarZona&&l.filtros.zona?(r(),m("div",ao,[e(g,{flat:"",bordered:"",class:"q-pa-md full-height",style:{height:"100%"}},{default:a(()=>[e(z,null,{default:a(()=>[e(c,{avatar:""},{default:a(()=>[e(u,{name:"map",size:"md",color:"primary"})]),_:1}),e(c,null,{default:a(()=>[e(p,{class:"text-subtitle2"},{default:a(()=>{var s;return[n(f(((s=l.zonas.find(i=>i.id===l.filtros.zona))==null?void 0:s.nombre)||"-"),1)]}),_:1}),e(p,{caption:""},{default:a(()=>o[28]||(o[28]=[n("ZONA")])),_:1})]),_:1})]),_:1})]),_:1})])):h("",!0),l.mostrarJornada&&l.filtros.jornada?(r(),m("div",lo,[e(g,{flat:"",bordered:"",class:"q-pa-md full-height",style:{height:"100%"}},{default:a(()=>[e(z,null,{default:a(()=>[e(c,{avatar:""},{default:a(()=>[e(u,{name:"schedule",size:"md",color:"primary"})]),_:1}),e(c,null,{default:a(()=>[e(p,{class:"text-subtitle2"},{default:a(()=>[n(f(l.filtros.jornada),1)]),_:1}),e(p,{caption:""},{default:a(()=>o[29]||(o[29]=[n("JORNADA")])),_:1})]),_:1})]),_:1})]),_:1})])):h("",!0),t("div",so,[e(g,{flat:"",bordered:"",class:"q-pa-md full-height",style:{height:"100%"}},{default:a(()=>[e(z,null,{default:a(()=>[e(c,{avatar:""},{default:a(()=>[e(u,{name:"event",size:"md",color:"primary"})]),_:1}),e(c,null,{default:a(()=>[e(p,{class:"text-subtitle1"},{default:a(()=>[n(f(l.filtros.fecha_inicio)+" al "+f(l.filtros.fecha_fin),1)]),_:1}),e(p,{caption:""},{default:a(()=>o[30]||(o[30]=[n("PERIODO")])),_:1})]),_:1})]),_:1})]),_:1})]),t("div",to,[e(g,{flat:"",bordered:"",class:"q-pa-md full-height",style:{height:"100%"}},{default:a(()=>[e(z,null,{default:a(()=>[e(c,{avatar:""},{default:a(()=>[e(u,{name:"attach_money",size:"md",color:"primary"})]),_:1}),e(c,null,{default:a(()=>[e(p,{class:"text-subtitle1"},{default:a(()=>[n(" $"+f(l.totalMonto)+".00 ",1)]),_:1}),e(p,{caption:""},{default:a(()=>o[31]||(o[31]=[n("TOTAL DE ALIMENTACION")])),_:1})]),_:1})]),_:1})]),_:1})])])]),_:1})):h("",!0),!l.mostrarVarios&&l.listado.length>0?(r(),V(g,{key:1,class:"q-mt-md q-pa-md",flat:"",bordered:""},{default:a(()=>[o[33]||(o[33]=t("div",{class:"text-h6 text-primary"},"Detalle por d\xEDa",-1)),e(T,{class:"q-my-sm"}),e(se,{rows:l.listado,columns:l.columnasDetalle,"row-key":"fecha",dense:"",flat:"",bordered:"",class:"q-mb-md",pagination:{rowsPerPage:5}},{"body-cell-jornadas":a(s=>[e(R,{props:s},{default:a(()=>[(r(!0),m(_,null,P(s.value,i=>(r(),V(le,{key:i,dense:"",color:i==="NOCTURNA"?"indigo-7":"amber-7","text-color":"white",class:"q-mr-xs",icon:"schedule"},{default:a(()=>[n(f(i),1)]),_:2},1032,["color"]))),128))]),_:2},1032,["props"])]),"body-cell-monto":a(s=>[e(R,{props:s},{default:a(()=>[e(te,{color:"green-6"},{default:a(()=>[n("$"+f(s.value),1)]),_:2},1024)]),_:2},1032,["props"])]),_:1},8,["rows","columns"])]),_:1})):h("",!0),l.mostrarVarios?(r(),V(g,{key:2,class:"q-mt-md q-pa-md",flat:"",bordered:""},{default:a(()=>[o[34]||(o[34]=t("div",{class:"text-h6 text-primary"},"Detalle por guardia",-1)),e(T,{class:"q-my-sm"}),(r(!0),m(_,null,P(l.guardiasDetalle,(s,i)=>(r(),V(ke,{key:i,label:s.guardia,caption:"Total alimentaci\xF3n: $"+s.monto_total,"expand-separator":"","header-class":"bg-grey-1 text-bold"},{default:a(()=>[e(se,{rows:s.detalle,columns:l.columnasDetalle,"row-key":"fecha",dense:"",flat:"",bordered:"",class:"q-mb-md",pagination:{rowsPerPage:5}},{"body-cell-jornadas":a(w=>[e(R,{props:w},{default:a(()=>[(r(!0),m(_,null,P(w.value,q=>(r(),V(le,{key:q,dense:"",color:q==="NOCTURNA"?"indigo-7":"amber-7","text-color":"white",class:"q-mr-xs",icon:"schedule"},{default:a(()=>[n(f(q),1)]),_:2},1032,["color"]))),128))]),_:2},1032,["props"])]),"body-cell-monto":a(w=>[e(R,{props:w},{default:a(()=>[e(te,{color:"green-6"},{default:a(()=>[n("$"+f(w.value),1)]),_:2},1024)]),_:2},1032,["props"])]),_:2},1032,["rows","columns"])]),_:2},1032,["label","caption"]))),128))]),_:1})):h("",!0)]),_:1})]),_:1})]),_:1})}var To=Qe(Te,[["render",ro]]);export{To as default};
